{
  "version": 3,
  "sources": ["../../../../../apps/erpnext/node_modules/onscan.js/onscan.js", "../../../../../apps/pasigono/node_modules/written-number/lib/util.js", "../../../../../apps/pasigono/node_modules/written-number/lib/index.js", "../../../../../apps/pasigono/pasigono/custom_scripts/stripe_terminal/stripe_terminal.js", "../../../../../apps/pasigono/pasigono/pos_assets/pos_item_selector.js", "../../../../../apps/pasigono/pasigono/pos_assets/pos_item_cart.js", "../../../../../apps/pasigono/pasigono/pos_assets/pos_item_details.js", "../../../../../apps/pasigono/pasigono/custom_scripts/pos_scripts/pos_item_details.js", "../../../../../apps/pasigono/pasigono/pos_assets/pos_number_pad.js", "../../../../../apps/pasigono/pasigono/pos_assets/pos_payment.js", "../../../../../apps/pasigono/pasigono/custom_scripts/pos_scripts/pos_payment.js", "../../../../../apps/pasigono/pasigono/pos_assets/pos_past_order_list.js", "../../../../../apps/pasigono/pasigono/pos_assets/pos_past_order_summary.js", "../../../../../apps/pasigono/pasigono/custom_scripts/pos_scripts/pos_past_order_summary.js", "../../../../../apps/pasigono/pasigono/pos_assets/pos_controller.js", "../../../../../apps/pasigono/pasigono/custom_scripts/pos_scripts/pos_controller.js"],
  "sourcesContent": ["/*\n * onScan.js - scan-events for hardware barcodes scanners in javascript\n */\n;(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define(factory()) :\n    global.onScan = factory()\n}(this, (function () {\n\tvar onScan = {\t\n\t\t\n\t\t/**\n\t\t * \n\t\t * @param DomElement oDomElement\n\t\t * @param Object oOptions\n\t\t * @return self\n\t\t */\n\t\tattachTo: function(oDomElement, oOptions) {\n\t\n\t\t\tif(oDomElement.scannerDetectionData !== undefined){\n\t\t\t\tthrow new Error(\"onScan.js is already initialized for DOM element \" + oDomElement);\n\t\t\t}\n\t\n\t\t\tvar oDefaults = {\n\t\t\t\tonScan: function(sScanned, iQty){}, // Callback after detection of a successfull scanning:  function(){sScancode, iCount)}()\n\t\t\t\tonScanError: function(oDebug){}, // Callback after detection of a unsuccessfull scanning (scanned string in parameter)\n\t\t\t\tonKeyProcess: function(sChar, oEvent){}, // Callback after receiving and processing a char (scanned char in parameter)\n\t\t\t\tonKeyDetect: function(iKeyCode, oEvent){}, // Callback after detecting a keyDown (key char in parameter) - in contrast to onKeyProcess, this fires for non-character keys like tab, arrows, etc. too!\n\t\t\t\tonPaste: function(sPasted, oEvent){}, // Callback after receiving a value on paste, no matter if it is a valid code or not\n\t\t\t\tkeyCodeMapper: function(oEvent) {return onScan.decodeKeyEvent(oEvent)}, // Custom function to decode a keydown event into a character. Must return decoded character or NULL if the given event should not be processed.\n\t\t\t\tonScanButtonLongPress: function(){}, // Callback after detection of a successfull scan while the scan button was pressed and held down\n\t\t\t\tscanButtonKeyCode:false, // Key code of the scanner hardware button (if the scanner button a acts as a key itself) \n\t\t\t\tscanButtonLongPressTime:500, // How long (ms) the hardware button should be pressed, until a callback gets executed\n\t\t\t\ttimeBeforeScanTest:100, // Wait duration (ms) after keypress event to check if scanning is finished\n\t\t\t\tavgTimeByChar:30, // Average time (ms) between 2 chars. Used to do difference between keyboard typing and scanning\n\t\t\t\tminLength:6, // Minimum length for a scanning\n\t\t\t\tsuffixKeyCodes:[9,13], // Chars to remove and means end of scanning\n\t\t\t\tprefixKeyCodes:[], // Chars to remove and means start of scanning\n\t\t\t\tignoreIfFocusOn:false, // do not handle scans if the currently focused element matches this selector or object\n\t\t\t\tstopPropagation:false, // Stop immediate propagation on keypress event\n\t\t\t\tpreventDefault:false, // Prevent default action on keypress event\n\t\t\t\tcaptureEvents:false, // Get the events before any listeners deeper in the DOM\n\t\t\t\treactToKeydown:true, // look for scan input in keyboard events\n\t\t\t\treactToPaste:false, // look for scan input in paste events\n\t\t\t\tsingleScanQty: 1, // Quantity of Items put out to onScan in a single scan\n\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\toOptions = this._mergeOptions(oDefaults, oOptions);\n\t\n\t\t\t// initializing options and variables on DomElement\n\t\t\toDomElement.scannerDetectionData = {\n\t\t\t\t\toptions: oOptions,\n\t\t\t\t\tvars:{\n\t\t\t\t\t\tfirstCharTime: 0,\n\t\t\t\t\t\tlastCharTime: 0,\n\t\t\t\t\t\taccumulatedString: '',\n\t\t\t\t\t\ttestTimer: false,\n\t\t\t\t\t\tlongPressTimeStart: 0,\n\t\t\t\t\t\tlongPressed: false\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t};\n\t\t\t\n\t\t\t// initializing handlers (based on settings)\n\t\t\tif (oOptions.reactToPaste === true){\n\t\t\t\toDomElement.addEventListener(\"paste\", this._handlePaste, oOptions.captureEvents);\n\t\t\t}\n\t\t\tif (oOptions.scanButtonKeyCode !== false){\n\t\t\t\toDomElement.addEventListener(\"keyup\", this._handleKeyUp, oOptions.captureEvents);\n\t\t\t}\n\t\t\tif (oOptions.reactToKeydown === true || oOptions.scanButtonKeyCode !== false){\t\n\t\t\t\toDomElement.addEventListener(\"keydown\", this._handleKeyDown, oOptions.captureEvents);\n\t\t\t}\n\t\t\treturn this;\n\t\t},\n\t\t\n\t\t/**\n\t\t * \n\t\t * @param DomElement oDomElement\n\t\t * @return void\n\t\t */\n\t\tdetachFrom: function(oDomElement) {\n\t\t\t// detaching all used events\n\t\t\tif (oDomElement.scannerDetectionData.options.reactToPaste){\n\t\t\t\toDomElement.removeEventListener(\"paste\", this._handlePaste);\n\t\t\t}\n\t\t\tif (oDomElement.scannerDetectionData.options.scanButtonKeyCode !== false){\n\t\t\t\toDomElement.removeEventListener(\"keyup\", this._handleKeyUp);\n\t\t\t}\n\t\t\toDomElement.removeEventListener(\"keydown\", this._handleKeyDown);\n\t\t\t\n\t\t\t// clearing data off DomElement\n\t\t\toDomElement.scannerDetectionData = undefined; \n\t\t\treturn;\n\t\t},\n\t\t\n\t\t/**\n\t\t * \n\t\t * @param DomElement oDomElement\n\t\t * @return Object\n\t\t */\n\t\tgetOptions: function(oDomElement){\n\t\t\treturn oDomElement.scannerDetectionData.options;\t\t\t\n\t\t},\n\t\n\t\t/**\n\t\t * \n\t\t * @param DomElement oDomElement\n\t\t * @param Object oOptions\n\t\t * @return self\n\t\t */\n\t\tsetOptions: function(oDomElement, oOptions){\n\t\t\t// check if some handlers need to be changed based on possible option changes\n\t\t\tswitch (oDomElement.scannerDetectionData.options.reactToPaste){\n\t\t\t\tcase true: \n\t\t\t\t\tif (oOptions.reactToPaste === false){\n\t\t\t\t\t\toDomElement.removeEventListener(\"paste\", this._handlePaste);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase false:\n\t\t\t\t\tif (oOptions.reactToPaste === true){\n\t\t\t\t\t\toDomElement.addEventListener(\"paste\", this._handlePaste);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t\n\t\t\tswitch (oDomElement.scannerDetectionData.options.scanButtonKeyCode){\n\t\t\t\tcase false:\n\t\t\t\t\tif (oOptions.scanButtonKeyCode !== false){\n\t\t\t\t\t\toDomElement.addEventListener(\"keyup\", this._handleKeyUp);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault: \n\t\t\t\t\tif (oOptions.scanButtonKeyCode === false){\n\t\t\t\t\t\toDomElement.removeEventListener(\"keyup\", this._handleKeyUp);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t\n\t\t\t// merge old and new options\n\t\t\toDomElement.scannerDetectionData.options = this._mergeOptions(oDomElement.scannerDetectionData.options, oOptions);\n\t\t\n\t\t\t// reinitiallize\n\t\t\tthis._reinitialize(oDomElement);\n\t\t\treturn this;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Transforms key codes into characters.\n\t\t * \n\t\t * By default, only the follwing key codes are taken into account\n\t\t * - 48-90 (letters and regular numbers)\n\t\t * - 96-105 (numeric keypad numbers)\n\t\t * - 106-111 (numeric keypad operations)\n\t\t * \n\t\t * All other keys will yield empty strings!\n\t\t * \n\t\t * The above keycodes will be decoded using the KeyboardEvent.key property on modern\n\t\t * browsers. On older browsers the method will fall back to String.fromCharCode()\n\t\t * putting the result to upper/lower case depending on KeyboardEvent.shiftKey if\n\t\t * it is set.\n\t\t * \n\t\t * @param KeyboardEvent oEvent\n\t\t * @return string\n\t\t */\n\t\tdecodeKeyEvent : function (oEvent) {\n\t\t\tvar iCode = this._getNormalizedKeyNum(oEvent);\n\t\t\tswitch (true) {\n\t\t\t\tcase iCode >= 48 && iCode <= 90: // numbers and letters\n\t\t\t\tcase iCode >= 106 && iCode <= 111: // operations on numeric keypad (+, -, etc.)\n\t\t\t\t\tif (oEvent.key !== undefined && oEvent.key !== '') {\n\t\t\t\t\t\treturn oEvent.key;\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\tvar sDecoded = String.fromCharCode(iCode);\n\t\t\t\t\tswitch (oEvent.shiftKey) {\n\t\t\t\t\t\tcase false: sDecoded = sDecoded.toLowerCase(); break;\n\t\t\t\t\t\tcase true: sDecoded = sDecoded.toUpperCase(); break;\n\t\t\t\t\t}\n\t\t\t\t\treturn sDecoded;\n\t\t\t\tcase iCode >= 96 && iCode <= 105: // numbers on numeric keypad\n\t\t\t\t\treturn 0+(iCode-96);\n\t\t\t}\n\t\t\treturn '';\n\t\t},\n\t\t\n\t\t/**\n\t\t * Simulates a scan of the provided code.\n\t     *\n\t\t * The scan code can be defined as\n\t\t * - a string - in this case no keyCode decoding is done and the code is merely validated\n\t\t * against constraints like minLenght, etc.\n\t\t * - an array of keyCodes (e.g. `[70,71,80]`) - will produce `keydown` events with corresponding\n\t\t * `keyCode` properties. NOTE: these events will have empty `key` properties, so decoding may\n\t\t * yield different results than with native events.\n\t\t * - an array of objects (e.g. `[{keyCode: 70, key: \"F\", shiftKey: true}, {keyCode: 71, key: \"g\"}]`) -\n\t\t * this way almost any event can be simulated, but it's a lot of work to do.\n\t\t *\n\t\t * @param DomElement oDomElement\n\t\t * @param string|array mStringOrArray\n\t\t * @return self\n\t\t */\n\t\tsimulate: function(oDomElement, mStringOrArray){\n\t\t\tthis._reinitialize(oDomElement);\n\t\t\tif (Array.isArray(mStringOrArray)){\n\t\t\t\tmStringOrArray.forEach(function(mKey){\n\t\t\t\t\tvar oEventProps = {};\n\t\t\t\t\tif( (typeof mKey === \"object\" || typeof mKey === 'function') && (mKey !== null) ) {\n\t\t\t\t\t\toEventProps = mKey;\n\t\t\t\t\t} else {\n\t\t\t\t\t\toEventProps.keyCode = parseInt(mKey);\n\t\t\t\t\t}\n\t\t\t\t\tvar oEvent = new KeyboardEvent('keydown', oEventProps);\n\t\t\t\t\tdocument.dispatchEvent(oEvent);\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tthis._validateScanCode(oDomElement, mStringOrArray);\n\t\t\t}\n\t\t\treturn this;\n\t\t},\n\t\t\n\t\t/**\n\t\t * @private\n\t\t * @param DomElement oDomElement\n\t\t * @return void\n\t\t */\n\t\t_reinitialize: function(oDomElement){\n\t\t\tvar oVars = oDomElement.scannerDetectionData.vars;\n\t\t\toVars.firstCharTime = 0;\n\t\t\toVars.lastCharTime = 0;\n\t\t\toVars.accumulatedString = '';\n\t\t\treturn;\n\t\t},\n\t\t\n\t\t/**\n\t\t * @private\n\t\t * @param DomElement oDomElement\n\t     * @return boolean\n\t\t */\n\t\t_isFocusOnIgnoredElement: function(oDomElement){\n\t\t\t\n\t\t\tvar ignoreSelectors = oDomElement.scannerDetectionData.options.ignoreIfFocusOn;\n\t\n\t        if(!ignoreSelectors){\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\n\t\t\tvar oFocused = document.activeElement;\n\t\t\t\n\t\t\t// checks if ignored element is an array, and if so it checks if one of the elements of it is an active one\n\t\t\tif (Array.isArray(ignoreSelectors)){\n\t\t\t\tfor(var i=0; i<ignoreSelectors.length; i++){\n\t\t\t\t\tif(oFocused.matches(ignoreSelectors[i]) === true){\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t// if the option consists of an single element, it only checks this one\n\t\t\t} else if (oFocused.matches(ignoreSelectors)){\n\t\t\t\treturn true;\t\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\t// if the active element is not listed in the ignoreIfFocusOn option, return false\n\t\t    return false;\n\t    },\n\t\t\n\t    /**\n\t     * Validates the scan code accumulated by the given DOM element and fires the respective events.\n\t     * \n\t     * @private\n\t     * @param DomElement oDomElement\n\t     * @return boolean\n\t     */\n\t\t_validateScanCode: function(oDomElement, sScanCode){\n\t\t\tvar oScannerData = oDomElement.scannerDetectionData;\t\t\t\n\t\t\tvar oOptions = oScannerData.options;\n\t\t\tvar iSingleScanQty = oScannerData.options.singleScanQty;\n\t\t\tvar iFirstCharTime = oScannerData.vars.firstCharTime;\n\t\t\tvar iLastCharTime = oScannerData.vars.lastCharTime;\n\t\t\tvar oScanError = {};\n\t        var oEvent;\n\t        \n\t\t\tswitch(true){\n\t\t\t\t\n\t\t\t\t// detect codes that are too short\n\t\t\t\tcase (sScanCode.length < oOptions.minLength):\n\t\t\t\t\toScanError = {\n\t\t\t\t\t\tmessage: \"Receieved code is shorter then minimal length\"\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\t// detect codes that were entered too slow\t\n\t\t\t\tcase ((iLastCharTime - iFirstCharTime) > (sScanCode.length * oOptions.avgTimeByChar)):\n\t\t\t\t\toScanError = {\n\t\t\t\t\t\tmessage: \"Receieved code was not entered in time\"\n\t\t\t\t\t};\t\t\t\t\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\t// if a code was not filtered out earlier it is valid\t\n\t\t\t\tdefault:\n\t\t\t\t\toOptions.onScan.call(oDomElement, sScanCode, iSingleScanQty);\n\t\t\t\t\toEvent = new CustomEvent(\n\t\t\t\t\t\t'scan',\n\t\t\t\t\t\t{\t\n\t\t\t\t\t\t\tdetail: { \n\t\t\t\t\t\t\t\tscanCode: sScanCode,\n\t\t\t\t\t\t\t\tqty: iSingleScanQty\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\toDomElement.dispatchEvent(oEvent);\n\t\t\t\t\tonScan._reinitialize(oDomElement);\n\t\t\t\t\treturn true;\n\t\t\t}\n\t\t\t\n\t\t\t// If an error occurred (otherwise the method would return earlier) create an object for errordetection\n\t\t\toScanError.scanCode = sScanCode;\n\t\t\toScanError.scanDuration = iLastCharTime - iFirstCharTime;\n\t\t\toScanError.avgTimeByChar = oOptions.avgTimeByChar;\n\t\t\toScanError.minLength = oOptions.minLength;\n\t\t\t\n\t\t\toOptions.onScanError.call(oDomElement, oScanError);\n\t\t\t\n\t\t\toEvent = new CustomEvent(\n\t\t\t\t'scanError', \n\t\t\t\t{detail: oScanError}\n\t\t\t);\n\t\t\toDomElement.dispatchEvent(oEvent);\n\t\t\t\n\t\t\tonScan._reinitialize(oDomElement);\n\t\t\treturn false;\n\t    },\n\t\n\t    /**\n\t     * @private\n\t     * @param Object oDefaults\n\t     * @param Object oOptions\n\t     * @return Object\n\t     */\n\t\t_mergeOptions: function(oDefaults, oOptions){\n\t\t\tvar oExtended = {};\n\t\t\tvar prop;\n\t\t\tfor (prop in oDefaults){\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(oDefaults, prop)){\n\t\t\t\t\toExtended[prop] = oDefaults[prop];\n\t\t\t\t}\n\t\t\t}\t\t\t\n\t\t\tfor (prop in oOptions){\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(oOptions, prop)){\n\t\t\t\t\toExtended[prop] = oOptions[prop];\n\t\t\t\t}\n\t\t\t}\t\t\t\n\t\t\treturn oExtended;\n\t\t},\n\t\n\t\t/**\n\t\t * @private\n\t\t * @param KeyboardEvent e\n\t\t * @return int\n\t\t * @see https://www.w3schools.com/jsref/event_key_keycode.asp\n\t\t */\n\t\t_getNormalizedKeyNum: function(e){\n\t\t\treturn e.which || e.keyCode;\n\t\t},\n\t\n\t\n\t\t/**\n\t\t * @private\n\t\t * @param KeyboardEvent e\n\t\t * @return void\n\t\t */\n\t\t_handleKeyDown: function(e){\n\t\t\tvar iKeyCode = onScan._getNormalizedKeyNum(e);\n\t\t\tvar oOptions = this.scannerDetectionData.options;\n\t\t\tvar oVars = this.scannerDetectionData.vars;\n\t\t\tvar bScanFinished = false;\n\t\t\t\n\t\t\tif (oOptions.onKeyDetect.call(this, iKeyCode, e) === false) {\n\t\t\t\treturn;\n\t\t\t}\t\t\n\t\t\t\n\t\t\tif (onScan._isFocusOnIgnoredElement(this)){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\t\t\t\n\t        // If it's just the button of the scanner, ignore it and wait for the real input\n\t\t    if(oOptions.scanButtonKeyCode !== false && iKeyCode==oOptions.scanButtonKeyCode) {\n\t\t\t\t\n\t\t\t\t// if the button was first pressed, start a timeout for the callback, which gets interrupted if the scanbutton gets released\n\t\t\t\tif (!oVars.longPressed){\n\t\t\t\t\toVars.longPressTimer = setTimeout( oOptions.onScanButtonLongPress, oOptions.scanButtonLongPressTime, this);\n\t\t\t\t\toVars.longPressed = true;\n\t\t\t\t}\n\t\n\t\t\t\treturn;\n\t        }\n\t\t\t\n\t\t\tswitch(true){\n\t\t\t\t// If it's not the first character and we encounter a terminating character, trigger scan process\n\t\t\t\tcase (oVars.firstCharTime && oOptions.suffixKeyCodes.indexOf(iKeyCode)!==-1):\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\tbScanFinished=true;\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\t// If it's the first character and we encountered one of the starting characters, don't process the scan\t\n\t\t\t\tcase (!oVars.firstCharTime && oOptions.prefixKeyCodes.indexOf(iKeyCode)!==-1):\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\tbScanFinished=false;\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\t// Otherwise, just add the character to the scan string we're building\t\n\t\t\t\tdefault:\n\t\t\t\t\tvar character = oOptions.keyCodeMapper.call(this, e);\n\t\t\t\t\tif (character === null){\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\toVars.accumulatedString += character;\n\t\t\t\t\t\n\t\t\t\t\tif (oOptions.preventDefault) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t\tif (oOptions.stopPropagation) {\n\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tbScanFinished=false;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t        \n\t\t\tif(!oVars.firstCharTime){\n\t\t\t\toVars.firstCharTime=Date.now();\n\t\t\t}\n\t\t\t\n\t\t\toVars.lastCharTime=Date.now();\n\t\n\t\t\tif(oVars.testTimer){ \n\t\t\t\tclearTimeout(oVars.testTimer);\n\t\t\t}\n\t\t\t\n\t\t\tif(bScanFinished){\n\t\t\t\tonScan._validateScanCode(this, oVars.accumulatedString);\n\t\t\t\toVars.testTimer=false;\n\t\t\t} else {\n\t\t\t\toVars.testTimer=setTimeout(onScan._validateScanCode, oOptions.timeBeforeScanTest, this, oVars.accumulatedString);\n\t\t\t}\n\t\n\t\t\toOptions.onKeyProcess.call(this, character, e);\n\t\t\treturn;\n\t\t},\n\t\t\n\t\t/**\n\t\t * @private\n\t\t * @param Event e\n\t\t * @return void\n\t\t */\n\t\t_handlePaste: function(e){\n\t\n\t\t\tvar oOptions = this.scannerDetectionData.options;\n\t\t\tvar oVars = this.scannerDetectionData.vars;\n\t\t\tvar sPasteString = (event.clipboardData || window.clipboardData).getData('text');\n\t\t\t\n\t\t\t// if the focus is on an ignored element, abort\n\t\t\tif (onScan._isFocusOnIgnoredElement(this)){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\te.preventDefault();\n\n\t\t\tif (oOptions.stopPropagation) {\n\t\t\t\te.stopImmediatePropagation();\n\t\t\t}\n\t\t\t\t\t\t\n\t\t\toOptions.onPaste.call(this, sPasteString, event);\n\t\t\t\n\t\t\toVars.firstCharTime = 0;\n\t\t\toVars.lastCharTime = 0;\n\t\t\t\n\t\t\t// validate the string\n\t\t\tonScan._validateScanCode(this, sPasteString);\n\t\t\treturn;\n\t\t},\n\t\t\n\t\t/**\n\t\t * @private\n\t\t * @param KeyboardEvent e\n\t\t * @return void\n\t\t */\n\t\t_handleKeyUp: function(e){\n\t\t\t// if the focus is on an ignored element, abort\n\t\t\tif (onScan._isFocusOnIgnoredElement(this)){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tvar iKeyCode = onScan._getNormalizedKeyNum(e);\n\t\t\t\n\t\t\t// if hardware key is not being pressed anymore stop the timeout and reset\n\t\t\tif (iKeyCode == this.scannerDetectionData.options.scanButtonKeyCode){\n\t\t\t\tclearTimeout(this.scannerDetectionData.vars.longPressTimer);\n\t\t\t\tthis.scannerDetectionData.vars.longPressed = false;\n\t\t\t}\n\t\t\treturn;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Returns TRUE the scanner is currently in the middle of a scan sequence.\n\t\t * \n\t\t * @param DomElement\n\t\t * @return boolean\n\t\t */\n\t\tisScanInProgressFor: function(oDomElement) {\n\t\t\treturn oDomElement.scannerDetectionData.vars.firstCharTime > 0;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Returns TRUE if onScan is attached to the given DOM element and FALSE otherwise.\n\t\t * \n\t\t * @param DomElement\n\t\t * @return boolean\n\t\t */\n\t\tisAttachedTo: function(oDomElement) {\n\t\t\treturn (oDomElement.scannerDetectionData !== undefined);\n\t\t}\n\t};\n\t\n\treturn onScan;\n})));", "\"use strict\";\n/**\n * Merges a set of default keys with a target object\n * (Like _.defaults, but will also extend onto null/undefined)\n *\n * @param {Object} [target] The object to extend\n * @param {Object} defaults The object to default to\n * @return {Object} extendedTarget\n */\n\nfunction defaults(target, defs) {\n  if (target == null) target = {};\n  var ret = {};\n  var keys = Object.keys(defs);\n  for (var i = 0, len = keys.length; i < len; i++) {\n    var key = keys[i];\n    ret[key] = target[key] || defs[key];\n  }\n  return ret;\n}\nexports.defaults = defaults;\n", "\"use strict\";\nexports = module.exports = writtenNumber;\nvar util = require(\"./util\");\n\nvar languages = [\"en\", \"es\", \"ar\", \"az\", \"pt\", \"fr\", \"eo\", \"it\", \"vi\", \"tr\", \"uk\", \"ru\", \"id\"];\nvar i18n = {\n  en: require(\"./i18n/en.json\"),\n  es: require(\"./i18n/es.json\"),\n  ar: require(\"./i18n/ar.json\"),\n  az: require(\"./i18n/az.json\"),\n  pt: require(\"./i18n/pt.json\"),\n  ptPT: require(\"./i18n/pt-PT.json\"),\n  fr: require(\"./i18n/fr.json\"),\n  eo: require(\"./i18n/eo.json\"),\n  it: require(\"./i18n/it.json\"),\n  vi: require(\"./i18n/vi.json\"),\n  tr: require(\"./i18n/tr.json\"),\n  hu: require(\"./i18n/hu.json\"),\n  enIndian: require(\"./i18n/en-indian.json\"),\n  uk: require(\"./i18n/uk.json\"),\n  ru: require(\"./i18n/ru.json\"),\n  id: require(\"./i18n/id.json\")\n};\nexports.i18n = i18n;\n\nvar shortScale = [100];\nfor (var i = 1; i <= 16; i++) {\n  shortScale.push(Math.pow(10, i * 3));\n}\n\nvar longScale = [100, 1000];\nfor (i = 1; i <= 15; i++) {\n  longScale.push(Math.pow(10, i * 6));\n}\n\nwrittenNumber.defaults = {\n  noAnd: false,\n  alternativeBase: null,\n  lang: \"en\"\n};\n\n/**\n * Converts numbers to their written form.\n *\n * @param {Number} n The number to convert\n * @param {Object} [options] An object representation of the options\n * @return {String} writtenN The written form of `n`\n */\n\nfunction writtenNumber(n, options) {\n  options = options || {};\n  options = util.defaults(options, writtenNumber.defaults);\n\n  if (n < 0) {\n    return \"\";\n  }\n\n  n = Math.round(+n);\n\n  var language = typeof options.lang === \"string\"\n    ? i18n[options.lang]\n    : options.lang;\n\n  if (!language) {\n    if (languages.indexOf(writtenNumber.defaults.lang) < 0) {\n      writtenNumber.defaults.lang = \"en\";\n    }\n\n    language = i18n[writtenNumber.defaults.lang];\n  }\n  \n  var scale = language.useLongScale ? longScale : shortScale;\n  var units = language.units;\n  var unit;\n\n  if (!(units instanceof Array)) {\n    var rawUnits = units;\n\n    units = [];\n    scale = Object.keys(rawUnits);\n\n    for (var i in scale) {\n      units.push(rawUnits[scale[i]]);\n      scale[i] = Math.pow(10, parseInt(scale[i]));\n    }\n  }\n\n  var baseCardinals = language.base;\n  var alternativeBaseCardinals = options.alternativeBase \n    ? language.alternativeBase[options.alternativeBase]\n    : {};\n\n  if (language.unitExceptions[n]) return language.unitExceptions[n];\n  if (alternativeBaseCardinals[n]) return alternativeBaseCardinals[n];\n  if (baseCardinals[n]) return baseCardinals[n];\n  if (n < 100)\n    return handleSmallerThan100(n, language, unit, baseCardinals, alternativeBaseCardinals, options);\n\n  var m = n % 100;\n  var ret = [];\n\n  if (m) {\n    if (\n      options.noAnd &&\n      !(language.andException && language.andException[10])\n    ) {\n      ret.push(writtenNumber(m, options));\n    } else {\n      ret.push(language.unitSeparator + writtenNumber(m, options));\n    }\n  }\n\n  var firstSignificant;\n\n  for (var i = 0, len = units.length; i < len; i++) {\n    var r = Math.floor(n / scale[i]);\n    var divideBy;\n\n    if (i === len - 1) divideBy = 1000000;\n    else divideBy = scale[i + 1] / scale[i];\n\n    r %= divideBy;\n\n    unit = units[i];\n\n    if (!r) continue;\n    firstSignificant = scale[i];\n\n    if (unit.useBaseInstead) {\n      var shouldUseBaseException =\n        unit.useBaseException.indexOf(r) > -1 &&\n        (unit.useBaseExceptionWhenNoTrailingNumbers\n          ? i === 0 && ret.length\n          : true);\n      if (!shouldUseBaseException) {\n        ret.push(alternativeBaseCardinals[r * scale[i]] || baseCardinals[r * scale[i]]);\n      } else {\n        ret.push(r > 1 && unit.plural ? unit.plural : unit.singular);\n      }\n      continue;\n    }\n\n    var str;\n    if (typeof unit === \"string\") {\n      str = unit;\n    } else if (r === 1 || unit.useSingularEnding && r % 10 === 1\n      && (!unit.avoidEndingRules || unit.avoidEndingRules.indexOf(r) < 0)) {\n      str = unit.singular;\n    } else if (unit.few && (r > 1 && r < 5 || unit.useFewEnding && r % 10 > 1 && r % 10 < 5\n      && (!unit.avoidEndingRules || unit.avoidEndingRules.indexOf(r) < 0))) {\n      str = unit.few;\n    } else {\n      str = unit.plural && (!unit.avoidInNumberPlural || !m)\n        ? unit.plural\n        : unit.singular;\n      \n      // Languages with dual\n      str = (r === 2 && unit.dual) ? unit.dual : str;\n      \n      // \"restrictedPlural\" : use plural only for 3 to 10\n      str = (r > 10 && unit.restrictedPlural) ? unit.singular : str;\n    }\n\n    if (\n      unit.avoidPrefixException &&\n      unit.avoidPrefixException.indexOf(r) > -1\n    ) {\n      ret.push(str);\n      continue;\n    }\n\n    var exception = language.unitExceptions[r];\n    var number =\n      exception ||\n      writtenNumber(\n        r,\n        util.defaults(\n          {\n            // Languages with and exceptions need to set `noAnd` to false\n            noAnd: !((language.andException && language.andException[r]) ||\n              unit.andException) && true,\n            alternativeBase: unit.useAlternativeBase\n          },\n          options\n        )\n      );\n    n -= r * scale[i];\n    ret.push(number + \" \" + str);\n  }\n\n  var firstSignificantN = firstSignificant * Math.floor(n / firstSignificant);\n  var rest = n - firstSignificantN;\n\n  if (\n    language.andWhenTrailing &&\n    firstSignificant &&\n    0 < rest &&\n    ret[0].indexOf(language.unitSeparator) !== 0\n  ) {\n    ret = [ret[0], language.unitSeparator.replace(/\\s+$/, \"\")].concat(\n      ret.slice(1)\n    );\n  }\n  \n  // Languages that have separators for all cardinals.\n  if (language.allSeparator) {\n    for (var j = 0; j < ret.length-1; j++) {\n      ret[j] = language.allSeparator + ret[j];      \n    }\n  }\n  var result = ret.reverse().join(\" \");\n  return result;\n}\n\nfunction handleSmallerThan100(n, language, unit, baseCardinals, alternativeBaseCardinals, options) {\n  var dec = Math.floor(n / 10) * 10;\n  unit = n - dec;\n  if (unit) {\n    return (\n      alternativeBaseCardinals[dec] || baseCardinals[dec] + language.baseSeparator + writtenNumber(unit, options)\n    );\n  }\n  return alternativeBaseCardinals[dec] || baseCardinals[dec];\n}\n", "erpnext.PointOfSale.StripeTerminal = function(){\n\tvar connectiontoken = \"\";\n\tvar terminal;\n\tvar loading_dialog, connecting_dialog, message_dilaog, confirm_dialog;\n\tvar payment_object,is_online;\n\tvar me = this;\n\n\tthis.assign_stripe_connection_token = function(payment, is_online) {\n\t\tpayment_object = payment;\n\t\tis_online = is_online;\n\t\tshow_loading_modal('Connecting to Stripe Terminal', 'Please Wait<br>Connecting to Stripe Terminal');\n\t\tfrappe.dom.freeze();\n\t\tfrappe.call({\n\t\t\tmethod: \"pasigono.pasigono.api.get_stripe_terminal_token\",\n\t\t\tfreeze: true,\n\t\t\theaders: {\n\t\t\t\t\"X-Requested-With\": \"XMLHttpRequest\"\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\tif (r.message) {\n\t\t\t\t\tconnectiontoken = r.message.secret;\n\t\t\t\t\tterminal = StripeTerminal.create({\n\t\t\t\t\t\tonFetchConnectionToken: fetchConnectionToken,\n\t\t\t\t\t\tonUnexpectedReaderDisconnect: unexpectedDisconnect\n\t\t\t\t\t});\n\t\t\t\t\tconnect_to_stripe_terminal(payment, is_online);\n\t\t\t\t} else {\n\t\t\t\t\tshow_error_dialog('Please configure the stripe settings.');\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction fetchConnectionToken() {\n\t\treturn connectiontoken;\n\n\t}\n\n\tfunction show_loading_modal(title, message) {\n\t\tloading_dialog = new frappe.ui.Dialog({\n\t\t\ttitle: title,\n\t\t\tfields: [{\n\t\t\t\t\tlabel: '',\n\t\t\t\t\tfieldname: 'show_dialog',\n\t\t\t\t\tfieldtype: 'HTML'\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t\tvar html = '<div style=\"min-height:200px;position: relative;text-align: center;padding-top: 75px;line-height: 25px;font-size: 15px;\">';\n\t\thtml += '<div style=\"\">' + message + '</div>';\n\t\thtml += '</div>';\n\t\tloading_dialog.fields_dict.show_dialog.$wrapper.html(html);\n\t\tloading_dialog.show();\n\t}\n\n\tfunction unexpectedDisconnect() {\n\t\tfrappe.msgprint(\"Error: Stripe terminal unexpectedly disconnected. Please reload page\")\n\t}\n\n\tfunction connect_to_stripe_terminal(payment, is_online) {\n\t\tfrappe.dom.freeze();\n\t\tfrappe.call({\n\t\t\tmethod: \"pasigono.pasigono.api.get_stripe_terminal_settings\",\n\t\t\tfreeze: true,\n\t\t\theaders: {\n\t\t\t\t\"X-Requested-With\": \"XMLHttpRequest\"\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\tvar isSimulated = false;\n\t\t\t\tvar testCardNumber = \"\";\n\t\t\t\tvar testCardtype = \"\";\n\t\t\t\tif (r.message != undefined) {\n\t\t\t\t\tif (r.message.enable_test_mode == 1) {\n\t\t\t\t\t\tisSimulated = true;\n\t\t\t\t\t\ttestCardNumber = r.message.card_number;\n\t\t\t\t\t\ttestCardtype = r.message.card_type;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tvar config = {\n\t\t\t\t\tsimulated: isSimulated\n\t\t\t\t};\n\t\t\t\tterminal.discoverReaders(config).then(function (discoverResult) {\n\t\t\t\t\tif (discoverResult.error) {\n\t\t\t\t\t\tconnecting_dialog.hide();\n\t\t\t\t\t\tshow_error_dialog('No Stripe readers found.');\n\t\t\t\t\t} else if (discoverResult.discoveredReaders.length === 0) {\n\t\t\t\t\t\tconnecting_dialog.hide();\n\t\t\t\t\t\tshow_error_dialog('No Stripe readers found.');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar devices = '';\n\t\t\t\t\t\tfor(let x in discoverResult.discoveredReaders){\n\t\t\t\t\t\t\tdevices = devices + '\\n' + discoverResult.discoveredReaders[x].label;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar d = new frappe.ui.Dialog({\n\t\t\t\t\t\t\t'fields': [\n\t\t\t\t\t\t\t\t{'fieldname': 'stripe_readers', 'fieldtype': 'Select', 'reqd': 1, 'label': 'Stripe Reader', 'options': devices }\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tprimary_action: function(){\n\t\t\t\t\t\t\t\tvar selected = d.get_values().stripe_readers;\n\t\t\t\t\t\t\t\tvar selectedReader;\n\t\t\t\t\t\t\t\tfor(let x in discoverResult.discoveredReaders){\n\t\t\t\t\t\t\t\t\tif(discoverResult.discoveredReaders[x].label == selected){\n\t\t\t\t\t\t\t\t\t\tselectedReader = discoverResult.discoveredReaders[x];\n\t\t\t\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tterminal.connectReader(selectedReader).then(function (connectResult) {\n\t\t\t\t\t\t\t\t\tif (connectResult.error) {\n\t\t\t\t\t\t\t\t\t\tconnecting_dialog.hide();\n\t\t\t\t\t\t\t\t\t\tshow_error_dialog('Failed to connect.' + connectResult.error.message);\n\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tif (r.message.enable_test_mode == 1 && testCardNumber != \"\" && testCardtype != \"\") {\n\t\t\t\t\t\t\t\t\t\t\tterminal.setSimulatorConfiguration({\n\t\t\t\t\t\t\t\t\t\t\t\t'testCardNumber': testCardNumber,\n\t\t\t\t\t\t\t\t\t\t\t\t'testPaymentMethod': testCardtype\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tloading_dialog.hide();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tsecondary_action: function(){\n\t\t\t\t\t\t\t\tfrappe.msgprint('Please disable Stripe Terminal in the POS Profile.');\n\t\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tsecondary_action_label: 'Cancel',\n\t\t\t\t\t\t\ttitle: 'Select a Stripe Terminal device'\n\t\t\t\t\t\t});\n\t\t\t\t\t\td.show();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\t\n\t\n\tthis.display_details = async function(payment){\n\t\tvar frm = payment.frm.doc;\n\t\tvar items = [];\n\t\tvar taxes = Math.round(payment.frm.doc.total_taxes_and_charges*100);\n\t\tvar total = Math.round(payment.frm.doc.grand_total*100);\n\t\tvar currency = payment.frm.doc.currency;\n\t\tfrm.items.forEach(function(row){\n\t\t\tvar amount = row.amount*100;\n\t\t\tvar item = {\n\t\t\t\t\"description\": row.item_name,\n\t\t\t\t\"quantity\": Math.round(row.qty),\n\t\t\t\t\"amount\": Math.round(amount)\n\t\t\t};\n\t\t\titems.push(item);\n\t\t});\n\t\tawait terminal.clearReaderDisplay();\n\t\tterminal.setReaderDisplay({\n\t\t\ttype: 'cart',\n\t\t\tcart: {\n\t\t\t\tline_items: items,\n\t\t\t\ttax: taxes,\n\t\t\t\ttotal: total,\n\t\t\t\tcurrency: currency\n\t\t\t}\n\t\t});\n\t}\n\n\tthis.collecting_payments = function(payment, is_online) {\n\t\tif(payment.frm.doc.is_return == 1){\n\t\t\tconfirm_dialog = new frappe.ui.Dialog({\n\t\t\t\ttitle: 'Confirm, refund through Stripe',\n\t\t\t\tfields: [{\n\t\t\t\t\t\tlabel: '',\n\t\t\t\t\t\tfieldname: 'show_dialog',\n\t\t\t\t\t\tfieldtype: 'HTML'\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tprimary_action_label: \"Confirm\",\n\t\t\t\tprimary_action(values) {\n\t\t\t\t\tconfirm_dialog.hide();\n\t\t\t\t\trefund_payment(payment, is_online);\n\t\t\t\t},\n\t\t\t\tsecondary_action_label: \"Cancel\",\n\t\t\t\tsecondary_action(values) {\n\t\t\t\t\tconfirm_dialog.hide();\n\t\t\t\t}\n\t\t\t});\n\t\t\tvar html = '<div style=\"text-align: center;\">Please confirm. Refund of ' + payment.frm.doc.currency.toUpperCase() + ' ';\n\t\t\thtml += payment.frm.doc.grand_total * -1 + ' through stripe.</div>';\n\t\t\tconfirm_dialog.fields_dict.show_dialog.$wrapper.html(html);\n\t\t\tconfirm_dialog.show();\n\t\t}\n\t\telse{\n\t\t\tcreate_payment(payment, is_online);\n\t\t}\n\t}\n\t\n\t\n\tfunction refund_payment(payment, is_online){\n\t\tshow_loading_modal('Refunding Payments', 'Please Wait<br>Refunding Payments');\n\t\tfrappe.dom.freeze();\n\t\tvar payments = payment.frm.doc.payments;\n\t\tpayments.forEach(function(row){\n\t\t\tif(row.mode_of_payment == window.stripe_mode_of_payment){\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"pasigono.pasigono.api.refund_payment\",\n\t\t\t\t\tfreeze: true,\n\t\t\t\t\targs: {\n\t\t\t\t\t\t\"payment_intent_id\": row.card_payment_intent,\n\t\t\t\t\t\t\"amount\": row.base_amount.toFixed(2)*-100\n\t\t\t\t\t},\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t\"X-Requested-With\": \"XMLHttpRequest\"\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(result){\n\t\t\t\t\t\tloading_dialog.hide();\n\t\t\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\t\t\tif (is_online) {\n\t\t\t\t\t\t\tpayment.frm.savesubmit()\n\t\t\t\t\t\t\t\t.then((sales_invoice) => {\n\t\t\t\t\t\t\t\t\tif (sales_invoice && sales_invoice.doc) {\n\t\t\t\t\t\t\t\t\t\tpayment.frm.doc.docstatus = sales_invoice.doc.docstatus;\n\t\t\t\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\t\t\t\tindicator: 'green',\n\t\t\t\t\t\t\t\t\t\t\tmessage: __(`POS invoice ${sales_invoice.doc.name} created succesfully`)\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tpayment.toggle_components(false);\n\t\t\t\t\t\t\t\t\t\tpayment.order_summary.toggle_component(true);\n\t\t\t\t\t\t\t\t\t\tpayment.order_summary.load_summary_of(payment.frm.doc, true);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpayment.payment.events.submit_invoice();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\t\n\t\n\tfunction create_payment(payment, is_online){\n\t\tshow_loading_modal('Collecting Payments', 'Please Wait<br>Collecting Payments');\n\t\tfrappe.dom.freeze();\n\t\tfrappe.call({\n\t\t\tmethod: \"pasigono.pasigono.api.payment_intent_creation\",\n\t\t\tfreeze: true,\n\t\t\targs: {\n\t\t\t\t\"sales_invoice\": payment.frm.doc\n\t\t\t},\n\t\t\theaders: {\n\t\t\t\t\"X-Requested-With\": \"XMLHttpRequest\"\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tterminal.collectPaymentMethod(r.message.client_secret).then(function (result) {\n\t\t\t\t\tif (result.error) {\n\t\t\t\t\t\tloading_dialog.hide();\n\t\t\t\t\t\tshow_payment_error_dialog(result.error.message);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tterminal.processPayment(result.paymentIntent).then(function (result) {\n\t\t\t\t\t\t\tif (result.error) {\n\t\t\t\t\t\t\t\tloading_dialog.hide();\n\t\t\t\t\t\t\t\tshow_payment_error_dialog(result.error.message);\n\t\t\t\t\t\t\t} else if (result.paymentIntent) {\n\t\t\t\t\t\t\t\tloading_dialog.hide();\n\t\t\t\t\t\t\t\tconfirm_dialog = new frappe.ui.Dialog({\n\t\t\t\t\t\t\t\t\ttitle: 'Confirm Stripe Payment',\n\t\t\t\t\t\t\t\t\tfields: [{\n\t\t\t\t\t\t\t\t\t\t\tlabel: '',\n\t\t\t\t\t\t\t\t\t\t\tfieldname: 'show_dialog',\n\t\t\t\t\t\t\t\t\t\t\tfieldtype: 'HTML'\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tprimary_action_label: \"Confirm\",\n\t\t\t\t\t\t\t\t\tprimary_action(values) {\n\t\t\t\t\t\t\t\t\t\tcapture_payment(payment, is_online, result.paymentIntent);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tsecondary_action_label: \"Cancel\",\n\t\t\t\t\t\t\t\t\tsecondary_action(values) {\n\t\t\t\t\t\t\t\t\t\tcancel_payment(payment, is_online, result.paymentIntent);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tvar html = '<div style=\"text-align: center;\">Please confirm. Payment of ' + result.paymentIntent.currency.toUpperCase() + ' ';\n\t\t\t\t\t\t\t\thtml += result.paymentIntent.amount/100 + ' through stripe.</div>';\n\t\t\t\t\t\t\t\tconfirm_dialog.fields_dict.show_dialog.$wrapper.html(html);\n\t\t\t\t\t\t\t\tconfirm_dialog.show();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t}\n\t\t})\n\t}\n\t\n\t\n\tfunction cancel_payment(payment, is_online, payment_intent){\n\t\tconfirm_dialog.hide();\n\t\t\n\t\tvar canceling_dialog = new frappe.ui.Dialog({\n\t\t\ttitle: 'Canceling Stripe Terminal',\n\t\t\tfields: [{\n\t\t\t\t\tlabel: '',\n\t\t\t\t\tfieldname: 'show_dialog',\n\t\t\t\t\tfieldtype: 'HTML'\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t\tvar html = '<div style=\"min-height:200px;position: relative;text-align: center;padding-top: 75px;line-height: 25px;font-size: 15px;\">';\n\t\thtml += '<div style=\"\">Please Wait<br>Canceling Stripe Terminal</div>';\n\t\thtml += '</div>';\n\t\tcanceling_dialog.fields_dict.show_dialog.$wrapper.html(html);\n\t\tcanceling_dialog.show();\n\t\tfrappe.call({\n\t\t\tmethod: \"pasigono.pasigono.api.cancel_payment_intent\",\n\t\t\tfreeze: true,\n\t\t\targs: {\n\t\t\t\t\"payment_intent_id\": payment_intent.id,\n\t\t\t\t\"sales_invoice_id\": payment.frm.doc.name\n\t\t\t},\n\t\t\theaders: {\n\t\t\t\t\"X-Requested-With\": \"XMLHttpRequest\"\n\t\t\t},\n\t\t\tcallback: function (intent_result) {\n\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\tcanceling_dialog.hide();\n\t\t\t\tfrappe.msgprint(\"Stripe payment cancelled.\");\n\t\t\t}\n\t\t})\n\t}\n\t\n\t\n\tfunction capture_payment(payment, is_online, payment_intent){\n\t\tconfirm_dialog.hide();\n\t\tshow_loading_modal('COllecting Payments', 'Please Wait<br>Collecting Payments');\n\t\tfrappe.call({\n\t\t\tmethod: \"pasigono.pasigono.api.capture_payment_intent\",\n\t\t\tfreeze: true,\n\t\t\targs: {\n\t\t\t\t\"payment_intent_id\": payment_intent.id,\n\t\t\t\t\"sales_invoice_id\": payment.frm.doc.name\n\t\t\t},\n\t\t\theaders: {\n\t\t\t\t\"X-Requested-With\": \"XMLHttpRequest\"\n\t\t\t},\n\t\t\tcallback: function (intent_result) {\n\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\tloading_dialog.hide();\n\t\t\t\tvar payments = payment.frm.doc.payments;\n\t\t\t\tpayments.forEach(function(row){\n\t\t\t\t\tif(row.mode_of_payment == window.stripe_mode_of_payment){\n\t\t\t\t\t\tvar card_info = intent_result.message.charges.data[0].payment_method_details.card_present;\n\t\t\t\t\t\trow.card_brand = card_info.brand;\n\t\t\t\t\t\trow.card_last4 = card_info.last4;\n\t\t\t\t\t\trow.card_account_type = card_info.receipt.account_type;\n\t\t\t\t\t\trow.card_application_preferred_name = card_info.receipt.application_preferred_name;\n\t\t\t\t\t\trow.card_dedicated_file_name = card_info.receipt.dedicated_file_name;\n\t\t\t\t\t\trow.card_authorization_response_code = card_info.receipt.authorization_response_code;\n\t\t\t\t\t\trow.card_application_cryptogram = card_info.receipt.application_cryptogram;\n\t\t\t\t\t\trow.card_terminal_verification_results = card_info.receipt.terminal_verification_results;\n\t\t\t\t\t\trow.card_transaction_status_information = card_info.receipt.transaction_status_information;\n\t\t\t\t\t\trow.card_authorization_code = card_info.receipt.authorization_code;\n\t\t\t\t\t\trow.card_charge_id = intent_result.message.charges.data[0].id;\n\t\t\t\t\t\trow.card_payment_intent = intent_result.message.charges.data[0].payment_intent;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (is_online) {\n\t\t\t\t\tpayment.frm.savesubmit()\n\t\t\t\t\t\t.then((sales_invoice) => {\n\t\t\t\t\t\t\t//For raw printing\n\t\t\t\t\t\t\tif(window.open_cash_drawer_automatically == 1){\n\t\t\t\t\t\t\t\tpayment.payment.events.open_cash_drawer();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif(window.automatically_print == 1){\n\t\t\t\t\t\t\t\tpayment.payment.events.raw_print(this.frm);\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (sales_invoice && sales_invoice.doc) {\n\t\t\t\t\t\t\t\tpayment.frm.doc.docstatus = sales_invoice.doc.docstatus;\n\t\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\t\tindicator: 'green',\n\t\t\t\t\t\t\t\t\tmessage: __(`POS invoice ${sales_invoice.doc.name} created succesfully`)\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\t\tmethod: \"pasigono.pasigono.api.update_payment_intent\",\n\t\t\t\t\t\t\t\t\tfreeze: true,\n\t\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\t\t\"payment_intent_id\": payment_intent.id,\n\t\t\t\t\t\t\t\t\t\t\"sales_invoice_id\": sales_invoice.doc.name\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t\t\t\"X-Requested-With\": \"XMLHttpRequest\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tcallback: function (intent_result) {\n\t\t\t\t\t\t\t\t\t\tpayment.toggle_components(false);\n\t\t\t\t\t\t\t\t\t\tpayment.order_summary.toggle_component(true);\n\t\t\t\t\t\t\t\t\t\tpayment.order_summary.load_summary_of(payment.frm.doc, true);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t} else {\n\t\t\t\t\tpayment.payment.events.submit_invoice();\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\t\n\tfunction retry_stripe_terminal(me, payment_object, is_online)\n\t{\n\t\tmessage_dilaog.hide();\n\t\tme.collecting_payments(payment_object, is_online);\n\t\t//assign_stripe_connection_token\n\t\t//me.assign_stripe_connection_token(payment_object, is_online);\n\t}\n\tfunction change_payment_method()\n\t{\n\t\tmessage_dilaog.hide();\n\t\t$(\".num-col.brand-primary\").click();\n\t\t\n\t}\n\t\n\tfunction show_error_dialog(message) {\n\t\tmessage_dilaog = new frappe.ui.Dialog({\n\t\t\ttitle: 'Message',\n\t\t\tfields: [{\n\t\t\t\t\tlabel: '',\n\t\t\t\t\tfieldname: 'show_dialog',\n\t\t\t\t\tfieldtype: 'HTML'\n\t\t\t\t},\n\t\t\t],\n\t\t\tprimary_action_label: \"Retry\",\n\t\t\tprimary_action(values) {\n\t\t\t\tretry_stripe_terminal(me);\n\t\t\t\tmessage_dilaog.hide();\n\t\t\t}\n\t\t});\n\t\tvar html = \"<p>\" + message + \"</p>\";\n\t\tmessage_dilaog.fields_dict.show_dialog.$wrapper.html(html);\n\t\tmessage_dilaog.show();\n\t}\n\t\n\tfunction show_payment_error_dialog(message) {\n\t\tmessage_dilaog = new frappe.ui.Dialog({\n\t\t\ttitle: 'Message',\n\t\t\tfields: [{\n\t\t\t\t\tlabel: '',\n\t\t\t\t\tfieldname: 'show_dialog',\n\t\t\t\t\tfieldtype: 'HTML'\n\n\t\t\t\t},\n\n\t\t\t],\n\t\t\tprimary_action_label: \"Retry\",\n\t\t\tsecondary_action_label: \"Change Payment Mode\",\n\t\t\tprimary_action(values) {\n\t\t\t\tretry_stripe_terminal(me, payment_object, is_online);\n\t\t\t\t//me.collecting_payments(payment_object, is_online);\n\t\t\t},\n\t\t\tsecondary_action(values) {\n\t\t\t\tchange_payment_method();\n\t\t\t}\n\t\t});\n\t\tvar html = \"<p>\" + message + \"</p>\";\n\t\tmessage_dilaog.fields_dict.show_dialog.$wrapper.html(html);\n\t\tmessage_dilaog.show();\n\t}\n}\n", "import onScan from 'onscan.js';\n\nerpnext.PointOfSale.ItemSelector = class {\n\t// eslint-disable-next-line no-unused-vars\n\tconstructor({ frm, wrapper, events, pos_profile, settings }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.pos_profile = pos_profile;\n\t\tthis.hide_images = settings.hide_images;\n\t\tthis.auto_add_item = settings.auto_add_item_to_cart;\n\n\t\tthis.inti_component();\n\t}\n\n\tinti_component() {\n\t\tthis.prepare_dom();\n\t\tthis.make_search_bar();\n\t\tthis.load_items_data();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"items-selector\">\n\t\t\t\t<div class=\"filter-section\">\n\t\t\t\t\t<div class=\"label\">${__('All Items')}</div>\n\t\t\t\t\t<div class=\"search-field\"></div>\n\t\t\t\t\t<div class=\"item-group-field\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"items-container\"></div>\n\t\t\t</section>`\n\t\t);\n\n\t\tthis.$component = this.wrapper.find('.items-selector');\n\t\tthis.$items_container = this.$component.find('.items-container');\n\t}\n\n\tasync load_items_data() {\n\t\tif (!this.item_group) {\n\t\t\tconst res = await frappe.db.get_value(\"Item Group\", {lft: 1, is_group: 1}, \"name\");\n\t\t\tthis.parent_item_group = res.message.name;\n\t\t}\n\t\tif (!this.price_list) {\n\t\t\tconst res = await frappe.db.get_value(\"POS Profile\", this.pos_profile, \"selling_price_list\");\n\t\t\tthis.price_list = res.message.selling_price_list;\n\t\t}\n\n\t\tthis.get_items({}).then(({message}) => {\n\t\t\tthis.render_item_list(message.items);\n\t\t});\n\t}\n\n\tget_items({start = 0, page_length = 40, search_term=''}) {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst price_list = (doc && doc.selling_price_list) || this.price_list;\n\t\tlet { item_group, pos_profile } = this;\n\t\tconsole.log({'this': this});\n\t\tconsole.log({\"item_group\": item_group, \"pos_profile\": pos_profile});\n\t\t!item_group && (item_group = this.parent_item_group);\n\n\t\treturn frappe.call({\n\t\t\tmethod: \"erpnext.selling.page.point_of_sale.point_of_sale.get_items\",\n\t\t\tfreeze: true,\n\t\t\targs: { start, page_length, price_list, item_group, search_term, pos_profile },\n\t\t});\n\t}\n\n\n\trender_item_list(items) {\n\t\tthis.$items_container.html('');\n\n\t\titems.forEach(item => {\n\t\t\tconst item_html = this.get_item_html(item);\n\t\t\tthis.$items_container.append(item_html);\n\t\t});\n\t}\n\n\tget_item_html(item) {\n\t\tconst me = this;\n\t\t// eslint-disable-next-line no-unused-vars\n\t\tconst { item_image, serial_no, batch_no, barcode, actual_qty, stock_uom, price_list_rate } = item;\n\t\tconst precision = flt(price_list_rate, 2) % 1 != 0 ? 2 : 0;\n\t\tlet indicator_color;\n\t\tlet qty_to_display = actual_qty;\n\n\t\tif (item.is_stock_item) {\n\t\t\tindicator_color = (actual_qty > 10 ? \"green\" : actual_qty <= 0 ? \"red\" : \"orange\");\n\n\t\t\tif (Math.round(qty_to_display) > 999) {\n\t\t\t\tqty_to_display = Math.round(qty_to_display)/1000;\n\t\t\t\tqty_to_display = qty_to_display.toFixed(1) + 'K';\n\t\t\t}\n\t\t} else {\n\t\t\tindicator_color = '';\n\t\t\tqty_to_display = '';\n\t\t}\n\n\t\tfunction get_item_image_html() {\n\t\t\tif (!me.hide_images && item_image) {\n\t\t\t\treturn `<div class=\"item-qty-pill\">\n\t\t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap ${indicator_color}\">${qty_to_display}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"flex items-center justify-center h-32 border-b-grey text-6xl text-grey-100\">\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tonerror=\"cur_pos.item_selector.handle_broken_image(this)\"\n\t\t\t\t\t\t\t\tclass=\"h-full\" src=\"${item_image}\"\n\t\t\t\t\t\t\t\talt=\"${frappe.get_abbr(item.item_name)}\"\n\t\t\t\t\t\t\t\tstyle=\"object-fit: cover;\">\n\t\t\t\t\t\t</div>`;\n\t\t\t} else {\n\t\t\t\treturn `<div class=\"item-qty-pill\">\n\t\t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap ${indicator_color}\">${qty_to_display}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"item-display abbr\">${frappe.get_abbr(item.item_name)}</div>`;\n\t\t\t}\n\t\t}\n\n\t\treturn (\n\t\t\t`<div class=\"item-wrapper\"\n\t\t\t\tdata-item-code=\"${escape(item.item_code)}\" data-serial-no=\"${escape(serial_no)}\"\n\t\t\t\tdata-batch-no=\"${escape(batch_no)}\" data-uom=\"${escape(stock_uom)}\"\n\t\t\t\tdata-rate=\"${escape(price_list_rate || 0)}\"\n\t\t\t\ttitle=\"${item.item_name}\">\n\n\t\t\t\t${get_item_image_html()}\n\n\t\t\t\t<div class=\"item-detail\">\n\t\t\t\t\t<div class=\"item-name\">\n\t\t\t\t\t\t${frappe.ellipsis(item.item_name, 18)}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"item-rate\">${format_currency(price_list_rate, item.currency, precision) || 0}</div>\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t);\n\t}\n\n\thandle_broken_image($img) {\n\t\tconst item_abbr = $($img).attr('alt');\n\t\t$($img).parent().replaceWith(`<div class=\"item-display abbr\">${item_abbr}</div>`);\n\t}\n\n\tmake_search_bar() {\n\t\tconst me = this;\n\t\tconst doc = me.events.get_frm().doc;\n\t\tthis.$component.find('.search-field').html('');\n\t\tthis.$component.find('.item-group-field').html('');\n\n\t\tthis.search_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __('Search'),\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\tplaceholder: __('Search by item code, serial number or barcode')\n\t\t\t},\n\t\t\tparent: this.$component.find('.search-field'),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.item_group_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __('Item Group'),\n\t\t\t\tfieldtype: 'Link',\n\t\t\t\toptions: 'Item Group',\n\t\t\t\tplaceholder: __('Select item group'),\n\t\t\t\tonchange: function() {\n\t\t\t\t\tme.item_group = this.value;\n\t\t\t\t\t!me.item_group && (me.item_group = me.parent_item_group);\n\t\t\t\t\tme.filter_items();\n\t\t\t\t},\n\t\t\t\tget_query: function () {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tquery: 'erpnext.selling.page.point_of_sale.point_of_sale.item_group_query',\n\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\tpos_profile: doc ? doc.pos_profile : ''\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t\tparent: this.$component.find('.item-group-field'),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.search_field.toggle_label(false);\n\t\tthis.item_group_field.toggle_label(false);\n\n\t\tthis.attach_clear_btn();\n\t}\n\n\tattach_clear_btn() {\n\t\tthis.search_field.$wrapper.find('.control-input').append(\n\t\t\t`<span class=\"link-btn\" style=\"top: 2px;\">\n\t\t\t\t<a class=\"btn-open no-decoration\" title=\"${__(\"Clear\")}\">\n\t\t\t\t\t${frappe.utils.icon('close', 'sm')}\n\t\t\t\t</a>\n\t\t\t</span>`\n\t\t);\n\n\t\tthis.$clear_search_btn = this.search_field.$wrapper.find('.link-btn');\n\n\t\tthis.$clear_search_btn.on('click', 'a', () => {\n\t\t\tthis.set_search_value('');\n\t\t\tthis.search_field.set_focus();\n\t\t});\n\t}\n\n\tset_search_value(value) {\n\t\t$(this.search_field.$input[0]).val(value).trigger(\"input\");\n\t}\n\n\tbind_events() {\n\t\tconst me = this;\n\t\twindow.onScan = onScan;\n\n\t\tonScan.decodeKeyEvent = function (oEvent) {\n\t\t\tvar iCode = this._getNormalizedKeyNum(oEvent);\n\t\t\tswitch (true) {\n\t\t\t\tcase iCode >= 48 && iCode <= 90: // numbers and letters\n\t\t\t\tcase iCode >= 106 && iCode <= 111: // operations on numeric keypad (+, -, etc.)\n\t\t\t\tcase (iCode >= 160 && iCode <= 164) || iCode == 170: // ^ ! # $ *\n\t\t\t\tcase iCode >= 186 && iCode <= 194: // (; = , - . / `)\n\t\t\t\tcase iCode >= 219 && iCode <= 222: // ([ \\ ] ')\n\t\t\t\tcase iCode == 32: // spacebar\n\t\t\t\t\tif (oEvent.key !== undefined && oEvent.key !== '') {\n\t\t\t\t\t\treturn oEvent.key;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar sDecoded = String.fromCharCode(iCode);\n\t\t\t\t\tswitch (oEvent.shiftKey) {\n\t\t\t\t\t\tcase false: sDecoded = sDecoded.toLowerCase(); break;\n\t\t\t\t\t\tcase true: sDecoded = sDecoded.toUpperCase(); break;\n\t\t\t\t\t}\n\t\t\t\t\treturn sDecoded;\n\t\t\t\tcase iCode >= 96 && iCode <= 105: // numbers on numeric keypad\n\t\t\t\t\treturn 0 + (iCode - 96);\n\t\t\t}\n\t\t\treturn '';\n\t\t};\n\n\t\tonScan.attachTo(document, {\n\t\t\tonScan: (sScancode) => {\n\t\t\t\tif (this.search_field && this.$component.is(':visible')) {\n\t\t\t\t\tthis.search_field.set_focus();\n\t\t\t\t\tthis.set_search_value(sScancode);\n\t\t\t\t\tthis.barcode_scanned = true;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.$component.on('click', '.item-wrapper', function() {\n\t\t\tconst $item = $(this);\n\t\t\tconst item_code = unescape($item.attr('data-item-code'));\n\t\t\tlet batch_no = unescape($item.attr('data-batch-no'));\n\t\t\tlet serial_no = unescape($item.attr('data-serial-no'));\n\t\t\tlet uom = unescape($item.attr('data-uom'));\n\t\t\tlet rate = unescape($item.attr('data-rate'));\n\n\t\t\t// escape(undefined) returns \"undefined\" then unescape returns \"undefined\"\n\t\t\tbatch_no = batch_no === \"undefined\" ? undefined : batch_no;\n\t\t\tserial_no = serial_no === \"undefined\" ? undefined : serial_no;\n\t\t\tuom = uom === \"undefined\" ? undefined : uom;\n\t\t\trate = rate === \"undefined\" ? undefined : rate;\n\n\t\t\tme.events.item_selected({\n\t\t\t\tfield: 'qty',\n\t\t\t\tvalue: \"+1\",\n\t\t\t\titem: { item_code, batch_no, serial_no, uom, rate }\n\t\t\t});\n\t\t\tme.search_field.set_focus();\n\t\t});\n\n\t\tthis.search_field.$input.on('input', (e) => {\n\t\t\tclearTimeout(this.last_search);\n\t\t\tthis.last_search = setTimeout(() => {\n\t\t\t\tconst search_term = e.target.value;\n\t\t\t\tthis.filter_items({ search_term });\n\t\t\t}, 300);\n\n\t\t\tthis.$clear_search_btn.toggle(\n\t\t\t\tBoolean(this.search_field.$input.val())\n\t\t\t);\n\t\t});\n\n\t\tthis.search_field.$input.on('focus', () => {\n\t\t\tthis.$clear_search_btn.toggle(\n\t\t\t\tBoolean(this.search_field.$input.val())\n\t\t\t);\n\t\t});\n\t}\n\n\tattach_shortcuts() {\n\t\tconst ctrl_label = frappe.utils.is_mac() ? '\u2318' : 'Ctrl';\n\t\tthis.search_field.parent.attr(\"title\", `${ctrl_label}+I`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+i\",\n\t\t\taction: () => this.search_field.set_focus(),\n\t\t\tcondition: () => this.$component.is(':visible'),\n\t\t\tdescription: __(\"Focus on search input\"),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page\n\t\t});\n\t\tthis.item_group_field.parent.attr(\"title\", `${ctrl_label}+G`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+g\",\n\t\t\taction: () => this.item_group_field.set_focus(),\n\t\t\tcondition: () => this.$component.is(':visible'),\n\t\t\tdescription: __(\"Focus on Item Group filter\"),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page\n\t\t});\n\n\t\t// for selecting the last filtered item on search\n\t\tfrappe.ui.keys.on(\"enter\", () => {\n\t\t\tconst selector_is_visible = this.$component.is(':visible');\n\t\t\tif (!selector_is_visible || this.search_field.get_value() === \"\") return;\n\n\t\t\tif (this.items.length == 1) {\n\t\t\t\tthis.$items_container.find(\".item-wrapper\").click();\n\t\t\t\tfrappe.utils.play_sound(\"submit\");\n\t\t\t\tthis.set_search_value('');\n\t\t\t} else if (this.items.length == 0 && this.barcode_scanned) {\n\t\t\t\t// only show alert of barcode is scanned and enter is pressed\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tmessage: __(\"No items found. Scan barcode again.\"),\n\t\t\t\t\tindicator: 'orange'\n\t\t\t\t});\n\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\tthis.barcode_scanned = false;\n\t\t\t\tthis.set_search_value('');\n\t\t\t}\n\t\t});\n\t}\n\n\tfilter_items({ search_term='' }={}) {\n\t\tif (search_term) {\n\t\t\tsearch_term = search_term.toLowerCase();\n\n\t\t\t// memoize\n\t\t\tthis.search_index = this.search_index || {};\n\t\t\tif (this.search_index[search_term]) {\n\t\t\t\tconst items = this.search_index[search_term];\n\t\t\t\tthis.items = items;\n\t\t\t\tthis.render_item_list(items);\n\t\t\t\tthis.auto_add_item && this.items.length == 1 && this.add_filtered_item_to_cart();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.get_items({ search_term })\n\t\t\t.then(({ message }) => {\n\t\t\t\t// eslint-disable-next-line no-unused-vars\n\t\t\t\tconst { items, serial_no, batch_no, barcode } = message;\n\t\t\t\tif (search_term && !barcode) {\n\t\t\t\t\tthis.search_index[search_term] = items;\n\t\t\t\t}\n\t\t\t\tthis.items = items;\n\t\t\t\tthis.render_item_list(items);\n\t\t\t\tthis.auto_add_item && this.items.length == 1 && this.add_filtered_item_to_cart();\n\t\t\t});\n\t}\n\n\tadd_filtered_item_to_cart() {\n\t\tthis.$items_container.find(\".item-wrapper\").click();\n\t\tthis.set_search_value('');\n\t}\n\n\tresize_selector(minimize) {\n\t\tminimize ?\n\t\t\tthis.$component.find('.filter-section').css('grid-template-columns', 'repeat(1, minmax(0, 1fr))') :\n\t\t\tthis.$component.find('.filter-section').css('grid-template-columns', 'repeat(12, minmax(0, 1fr))');\n\n\t\tminimize ?\n\t\t\tthis.$component.find('.search-field').css('margin', 'var(--margin-sm) 0px') :\n\t\t\tthis.$component.find('.search-field').css('margin', '0px var(--margin-sm)');\n\n\t\tminimize ?\n\t\t\tthis.$component.css('grid-column', 'span 2 / span 2') :\n\t\t\tthis.$component.css('grid-column', 'span 6 / span 6');\n\n\t\tminimize ?\n\t\t\tthis.$items_container.css('grid-template-columns', 'repeat(1, minmax(0, 1fr))') :\n\t\t\tthis.$items_container.css('grid-template-columns', 'repeat(4, minmax(0, 1fr))');\n\t}\n\n\ttoggle_component(show) {\n\t\tthis.set_search_value('');\n\t\tthis.$component.css('display', show ? 'flex': 'none');\n\t}\n};\n", "erpnext.PointOfSale.ItemCart = class {\n  constructor({ wrapper, events, settings }) {\n    this.wrapper = wrapper;\n    this.events = events;\n    this.customer_info = undefined;\n    this.hide_images = settings.hide_images;\n    this.allowed_customer_groups = settings.customer_groups;\n    this.allow_rate_change = settings.allow_rate_change;\n    this.allow_discount_change = settings.allow_discount_change;\n    this.init_component();\n  }\n\n  init_component() {\n    this.prepare_dom();\n    this.init_child_components();\n    this.bind_events();\n    this.attach_shortcuts();\n  }\n\n  prepare_dom() {\n    this.wrapper.append(`<section class=\"customer-cart-container\"></section>`);\n\n    this.$component = this.wrapper.find('.customer-cart-container');\n  }\n\n  init_child_components() {\n    this.init_customer_selector();\n    this.init_cart_components();\n  }\n\n  init_customer_selector() {\n    this.$component.append(`<div class=\"customer-section\"></div>`);\n    this.$customer_section = this.$component.find('.customer-section');\n    this.make_customer_selector();\n  }\n\n  reset_customer_selector() {\n    const frm = this.events.get_frm();\n    frm.set_value('customer', '');\n    this.make_customer_selector();\n    this.customer_field.set_focus();\n  }\n\n  init_cart_components() {\n    this.$component.append(\n      `<div class=\"cart-container\">\n\t\t\t\t<div class=\"abs-cart-container\">\n\t\t\t\t\t<div class=\"cart-label\">${__('Item Cart')}</div>\n\t\t\t\t\t<div class=\"cart-header\">\n\t\t\t\t\t\t<div class=\"name-header\">${__('Item')}</div>\n\t\t\t\t\t\t<div class=\"qty-header\">${__('Quantity')}</div>\n\t\t\t\t\t\t<div class=\"rate-amount-header\">${__('Amount')}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"cart-items-section\"></div>\n\t\t\t\t\t<div class=\"cart-totals-section\"></div>\n\t\t\t\t\t<div class=\"numpad-section\"></div>\n\t\t\t\t</div>\n\t\t\t</div>`\n    );\n    this.$cart_container = this.$component.find('.cart-container');\n\n    this.make_cart_totals_section();\n    this.make_cart_items_section();\n    this.make_cart_numpad();\n  }\n\n  make_cart_items_section() {\n    this.$cart_header = this.$component.find('.cart-header');\n    this.$cart_items_wrapper = this.$component.find('.cart-items-section');\n\n    this.make_no_items_placeholder();\n  }\n\n  make_no_items_placeholder() {\n    this.$cart_header.css('display', 'none');\n    this.$cart_items_wrapper.html(\n      `<div class=\"no-item-wrapper\">${__('No items in cart')}</div>`\n    );\n  }\n\n  get_discount_icon() {\n    return `<svg class=\"discount-icon\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n\t\t\t\t<path d=\"M19 15.6213C19 15.2235 19.158 14.842 19.4393 14.5607L20.9393 13.0607C21.5251 12.4749 21.5251 11.5251 20.9393 10.9393L19.4393 9.43934C19.158 9.15804 19 8.7765 19 8.37868V6.5C19 5.67157 18.3284 5 17.5 5H15.6213C15.2235 5 14.842 4.84196 14.5607 4.56066L13.0607 3.06066C12.4749 2.47487 11.5251 2.47487 10.9393 3.06066L9.43934 4.56066C9.15804 4.84196 8.7765 5 8.37868 5H6.5C5.67157 5 5 5.67157 5 6.5V8.37868C5 8.7765 4.84196 9.15804 4.56066 9.43934L3.06066 10.9393C2.47487 11.5251 2.47487 12.4749 3.06066 13.0607L4.56066 14.5607C4.84196 14.842 5 15.2235 5 15.6213V17.5C5 18.3284 5.67157 19 6.5 19H8.37868C8.7765 19 9.15804 19.158 9.43934 19.4393L10.9393 20.9393C11.5251 21.5251 12.4749 21.5251 13.0607 20.9393L14.5607 19.4393C14.842 19.158 15.2235 19 15.6213 19H17.5C18.3284 19 19 18.3284 19 17.5V15.6213Z\" stroke-miterlimit=\"10\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t<path d=\"M15 9L9 15\" stroke-miterlimit=\"10\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t<path d=\"M10.5 9.5C10.5 10.0523 10.0523 10.5 9.5 10.5C8.94772 10.5 8.5 10.0523 8.5 9.5C8.5 8.94772 8.94772 8.5 9.5 8.5C10.0523 8.5 10.5 8.94772 10.5 9.5Z\" fill=\"white\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t<path d=\"M15.5 14.5C15.5 15.0523 15.0523 15.5 14.5 15.5C13.9477 15.5 13.5 15.0523 13.5 14.5C13.5 13.9477 13.9477 13.5 14.5 13.5C15.0523 13.5 15.5 13.9477 15.5 14.5Z\" fill=\"white\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t</svg>`;\n  }\n\n  make_cart_totals_section() {\n    this.$totals_section = this.$component.find('.cart-totals-section');\n\n    this.$totals_section.append(\n      `<div class=\"add-discount-wrapper\">\n\t\t\t\t${this.get_discount_icon()} ${__('Add Discount')}\n\t\t\t</div>\n\t\t\t<div class=\"item-qty-total-container\">\n\t\t\t\t<div class=\"item-qty-total-label\">${__('Total Items')}</div>\n\t\t\t\t<div class=\"item-qty-total-value\">0.00</div>\n\t\t\t</div>\n\t\t\t<div class=\"net-total-container\">\n\t\t\t\t<div class=\"net-total-label\">${__('Net Total')}</div>\n\t\t\t\t<div class=\"net-total-value\">0.00</div>\n\t\t\t</div>\n\t\t\t<div class=\"taxes-container\"></div>\n\t\t\t<div class=\"grand-total-container\">\n\t\t\t\t<div>${__('Grand Total')}</div>\n\t\t\t\t<div>0.00</div>\n\t\t\t</div>\n\t\t\t<div class=\"checkout-btn\">${__('Checkout')}</div>\n\t\t\t<div class=\"edit-cart-btn\">${__('Edit Cart')}</div>`\n    );\n\n    this.$add_discount_elem = this.$component.find('.add-discount-wrapper');\n  }\n\n  make_cart_numpad() {\n    this.$numpad_section = this.$component.find('.numpad-section');\n\n    this.number_pad = new erpnext.PointOfSale.NumberPad({\n      wrapper: this.$numpad_section,\n      events: {\n        numpad_event: this.on_numpad_event.bind(this),\n      },\n      cols: 5,\n      keys: [\n        [1, 2, 3, 'Quantity'],\n        [4, 5, 6, 'Discount'],\n        [7, 8, 9, 'Rate'],\n        ['.', 0, 'Delete', 'Remove'],\n      ],\n      css_classes: [\n        ['', '', '', 'col-span-2'],\n        ['', '', '', 'col-span-2'],\n        ['', '', '', 'col-span-2'],\n        ['', '', '', 'col-span-2 remove-btn'],\n      ],\n      fieldnames_map: { Quantity: 'qty', Discount: 'discount_percentage' },\n    });\n\n    this.$numpad_section.prepend(\n      `<div class=\"numpad-totals\">\n\t\t\t<span class=\"numpad-item-qty-total\"></span>\n\t\t\t\t<span class=\"numpad-net-total\"></span>\n\t\t\t\t<span class=\"numpad-grand-total\"></span>\n\t\t\t</div>`\n    );\n\n    this.$numpad_section.append(\n      `<div class=\"numpad-btn checkout-btn\" data-button-value=\"checkout\">${__(\n        'Checkout'\n      )}</div>`\n    );\n  }\n\n  bind_events() {\n    const me = this;\n    this.$customer_section.on('click', '.reset-customer-btn', function () {\n      me.reset_customer_selector();\n    });\n\n    this.$customer_section.on('click', '.close-details-btn', function () {\n      me.toggle_customer_info(false);\n    });\n\n    this.$customer_section.on('click', '.customer-display', function (e) {\n      if ($(e.target).closest('.reset-customer-btn').length) return;\n\n      const show = me.$cart_container.is(':visible');\n      me.toggle_customer_info(show);\n    });\n\n    this.$cart_items_wrapper.on('click', '.cart-item-wrapper', function () {\n      const $cart_item = $(this);\n\n      me.toggle_item_highlight(this);\n\n      const payment_section_hidden = !me.$totals_section\n        .find('.edit-cart-btn')\n        .is(':visible');\n      if (!payment_section_hidden) {\n        // payment section is visible\n        // edit cart first and then open item details section\n        me.$totals_section.find('.edit-cart-btn').click();\n      }\n\n      const item_row_name = unescape($cart_item.attr('data-row-name'));\n      me.events.cart_item_clicked({ name: item_row_name });\n      this.numpad_value = '';\n    });\n\n    this.$component.on('click', '.checkout-btn', async function () {\n      if ($(this).attr('style').indexOf('--blue-500') == -1) return;\n\n      await me.events.checkout();\n      me.toggle_checkout_btn(false);\n\n      me.allow_discount_change && me.$add_discount_elem.removeClass('d-none');\n    });\n\n    this.$totals_section.on('click', '.edit-cart-btn', () => {\n      this.events.edit_cart();\n      this.toggle_checkout_btn(true);\n    });\n\n    this.$component.on('click', '.add-discount-wrapper', () => {\n      const can_edit_discount =\n        this.$add_discount_elem.find('.edit-discount-btn').length;\n\n      if (!this.discount_field || can_edit_discount)\n        this.show_discount_control();\n    });\n\n    frappe.ui.form.on('POS Invoice', 'paid_amount', (frm) => {\n      // called when discount is applied\n      this.update_totals_section(frm);\n    });\n  }\n\n  attach_shortcuts() {\n    for (let row of this.number_pad.keys) {\n      for (let btn of row) {\n        if (typeof btn !== 'string') continue; // do not make shortcuts for numbers\n\n        let shortcut_key = `ctrl+${frappe.scrub(String(btn))[0]}`;\n        if (btn === 'Delete') shortcut_key = 'ctrl+backspace';\n        if (btn === 'Remove') shortcut_key = 'shift+ctrl+backspace';\n        if (btn === '.') shortcut_key = 'ctrl+>';\n\n        // to account for fieldname map\n        const fieldname = this.number_pad.fieldnames[btn]\n          ? this.number_pad.fieldnames[btn]\n          : typeof btn === 'string'\n          ? frappe.scrub(btn)\n          : btn;\n\n        let shortcut_label = shortcut_key\n          .split('+')\n          .map(frappe.utils.to_title_case)\n          .join('+');\n        shortcut_label = frappe.utils.is_mac()\n          ? shortcut_label.replace('Ctrl', '\u2318')\n          : shortcut_label;\n        this.$numpad_section\n          .find(`.numpad-btn[data-button-value=\"${fieldname}\"]`)\n          .attr('title', shortcut_label);\n\n        frappe.ui.keys.on(`${shortcut_key}`, () => {\n          const cart_is_visible = this.$component.is(':visible');\n          if (\n            cart_is_visible &&\n            this.item_is_selected &&\n            this.$numpad_section.is(':visible')\n          ) {\n            this.$numpad_section\n              .find(`.numpad-btn[data-button-value=\"${fieldname}\"]`)\n              .click();\n          }\n        });\n      }\n    }\n    const ctrl_label = frappe.utils.is_mac() ? '\u2318' : 'Ctrl';\n    this.$component.find('.checkout-btn').attr('title', `${ctrl_label}+Enter`);\n    frappe.ui.keys.add_shortcut({\n      shortcut: 'ctrl+enter',\n      action: () => this.$component.find('.checkout-btn').click(),\n      condition: () =>\n        this.$component.is(':visible') &&\n        !this.$totals_section.find('.edit-cart-btn').is(':visible'),\n      description: __('Checkout Order / Submit Order / New Order'),\n      ignore_inputs: true,\n      page: cur_page.page.page,\n    });\n    this.$component.find('.edit-cart-btn').attr('title', `${ctrl_label}+E`);\n    frappe.ui.keys.on('ctrl+e', () => {\n      const item_cart_visible = this.$component.is(':visible');\n      const checkout_btn_invisible = !this.$totals_section\n        .find('.checkout-btn')\n        .is('visible');\n      if (item_cart_visible && checkout_btn_invisible) {\n        this.$component.find('.edit-cart-btn').click();\n      }\n    });\n    this.$component\n      .find('.add-discount-wrapper')\n      .attr('title', `${ctrl_label}+D`);\n    frappe.ui.keys.add_shortcut({\n      shortcut: 'ctrl+d',\n      action: () => this.$component.find('.add-discount-wrapper').click(),\n      condition: () => this.$add_discount_elem.is(':visible'),\n      description: __('Add Order Discount'),\n      ignore_inputs: true,\n      page: cur_page.page.page,\n    });\n    frappe.ui.keys.on('escape', () => {\n      const item_cart_visible = this.$component.is(':visible');\n      if (\n        item_cart_visible &&\n        this.discount_field &&\n        this.discount_field.parent.is(':visible')\n      ) {\n        this.discount_field.set_value(0);\n      }\n    });\n  }\n\n  toggle_item_highlight(item) {\n    const $cart_item = $(item);\n    const item_is_highlighted =\n      $cart_item.attr('style') == 'background-color:var(--gray-50);';\n\n    if (!item || item_is_highlighted) {\n      this.item_is_selected = false;\n      this.$cart_container\n        .find('.cart-item-wrapper')\n        .css('background-color', '');\n    } else {\n      $cart_item.css('background-color', 'var(--gray-50)');\n      this.item_is_selected = true;\n      this.$cart_container\n        .find('.cart-item-wrapper')\n        .not(item)\n        .css('background-color', '');\n    }\n  }\n\n  make_customer_selector() {\n    this.$customer_section.html(`\n\t\t\t<div class=\"customer-field\"></div>\n\t\t`);\n    const me = this;\n    const query = { query: 'erpnext.controllers.queries.customer_query' };\n    const allowed_customer_group = this.allowed_customer_groups || [];\n    if (allowed_customer_group.length) {\n      query.filters = {\n        customer_group: ['in', allowed_customer_group],\n      };\n    }\n    this.customer_field = frappe.ui.form.make_control({\n      df: {\n        label: __('Customer'),\n        fieldtype: 'Link',\n        options: 'Customer',\n        placeholder: __('Search by customer name, phone, email.'),\n        get_query: () => query,\n        onchange: function () {\n          if (this.value) {\n            const frm = me.events.get_frm();\n            frappe.dom.freeze();\n            frappe.model.set_value(\n              frm.doc.doctype,\n              frm.doc.name,\n              'customer',\n              this.value\n            );\n            frm.script_manager\n              .trigger('customer', frm.doc.doctype, frm.doc.name)\n              .then(() => {\n                frappe.run_serially([\n                  () => me.fetch_customer_details(this.value),\n                  () => me.events.customer_details_updated(me.customer_info),\n                  () => me.update_customer_section(),\n                  () => me.update_totals_section(),\n                  () => frappe.dom.unfreeze(),\n                ]);\n              });\n          }\n        },\n      },\n      parent: this.$customer_section.find('.customer-field'),\n      render_input: true,\n    });\n    this.customer_field.toggle_label(false);\n  }\n\n  fetch_customer_details(customer) {\n    if (customer) {\n      return new Promise((resolve) => {\n        frappe.db\n          .get_value('Customer', customer, [\n            'email_id',\n            'mobile_no',\n            'image',\n            'loyalty_program',\n          ])\n          .then(({ message }) => {\n            const { loyalty_program } = message;\n            // if loyalty program then fetch loyalty points too\n            if (loyalty_program) {\n              frappe.call({\n                method:\n                  'erpnext.accounts.doctype.loyalty_program.loyalty_program.get_loyalty_program_details_with_points',\n                args: { customer, loyalty_program, silent: true },\n                callback: (r) => {\n                  const { loyalty_points, conversion_factor } = r.message;\n                  if (!r.exc) {\n                    this.customer_info = {\n                      ...message,\n                      customer,\n                      loyalty_points,\n                      conversion_factor,\n                    };\n                    resolve();\n                  }\n                },\n              });\n            } else {\n              this.customer_info = { ...message, customer };\n              resolve();\n            }\n          });\n      });\n    } else {\n      return new Promise((resolve) => {\n        this.customer_info = {};\n        resolve();\n      });\n    }\n  }\n\n  show_discount_control() {\n    this.$add_discount_elem.css({ padding: '0px', border: 'none' });\n    this.$add_discount_elem.html(`<div class=\"add-discount-field\"></div>`);\n    const me = this;\n    const frm = me.events.get_frm();\n    let discount = frm.doc.additional_discount_percentage;\n\n    this.discount_field = frappe.ui.form.make_control({\n      df: {\n        label: __('Discount'),\n        fieldtype: 'Data',\n        placeholder: discount\n          ? discount + '%'\n          : __('Enter discount percentage.'),\n        input_class: 'input-xs',\n        onchange: function () {\n          if (flt(this.value) != 0) {\n            frappe.model.set_value(\n              frm.doc.doctype,\n              frm.doc.name,\n              'additional_discount_percentage',\n              flt(this.value)\n            );\n            me.hide_discount_control(this.value);\n          } else {\n            frappe.model.set_value(\n              frm.doc.doctype,\n              frm.doc.name,\n              'additional_discount_percentage',\n              0\n            );\n            me.$add_discount_elem.css({\n              border: '1px dashed var(--gray-500)',\n              padding: 'var(--padding-sm) var(--padding-md)',\n            });\n            me.$add_discount_elem.html(\n              `${me.get_discount_icon()} ${__('Add Discount')}`\n            );\n            me.discount_field = undefined;\n          }\n        },\n      },\n      parent: this.$add_discount_elem.find('.add-discount-field'),\n      render_input: true,\n    });\n    this.discount_field.toggle_label(false);\n    this.discount_field.set_focus();\n  }\n\n  hide_discount_control(discount) {\n    if (!discount) {\n      this.$add_discount_elem.css({ padding: '0px', border: 'none' });\n      this.$add_discount_elem.html(`<div class=\"add-discount-field\"></div>`);\n    } else {\n      this.$add_discount_elem.css({\n        border: '1px dashed var(--dark-green-500)',\n        padding: 'var(--padding-sm) var(--padding-md)',\n      });\n      this.$add_discount_elem.html(\n        `<div class=\"edit-discount-btn\">\n\t\t\t\t\t${this.get_discount_icon()} ${__('Additional')}&nbsp;${String(\n          discount\n        ).bold()}% ${__('discount applied')}\n\t\t\t\t</div>`\n      );\n    }\n  }\n\n  update_customer_section() {\n    const me = this;\n    const {\n      customer,\n      email_id = '',\n      mobile_no = '',\n      image,\n    } = this.customer_info || {};\n\n    if (customer) {\n      this.$customer_section.html(\n        `<div class=\"customer-details\">\n\t\t\t\t\t<div class=\"customer-display\">\n\t\t\t\t\t\t${this.get_customer_image()}\n\t\t\t\t\t\t<div class=\"customer-name-desc\">\n\t\t\t\t\t\t\t<div class=\"customer-name\">${customer}</div>\n\t\t\t\t\t\t\t${get_customer_description()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"reset-customer-btn\" data-customer=\"${escape(customer)}\">\n\t\t\t\t\t\t\t<svg width=\"32\" height=\"32\" viewBox=\"0 0 14 14\" fill=\"none\">\n\t\t\t\t\t\t\t\t<path d=\"M4.93764 4.93759L7.00003 6.99998M9.06243 9.06238L7.00003 6.99998M7.00003 6.99998L4.93764 9.06238L9.06243 4.93759\" stroke=\"#8D99A6\"/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>`\n      );\n    } else {\n      // reset customer selector\n      this.reset_customer_selector();\n    }\n\n    function get_customer_description() {\n      if (!email_id && !mobile_no) {\n        return `<div class=\"customer-desc\">${__(\n          'Click to add email / phone'\n        )}</div>`;\n      } else if (email_id && !mobile_no) {\n        return `<div class=\"customer-desc\">${email_id}</div>`;\n      } else if (mobile_no && !email_id) {\n        return `<div class=\"customer-desc\">${mobile_no}</div>`;\n      } else {\n        return `<div class=\"customer-desc\">${email_id} - ${mobile_no}</div>`;\n      }\n    }\n  }\n\n  get_customer_image() {\n    const { customer, image } = this.customer_info || {};\n    if (image) {\n      return `<div class=\"customer-image\"><img src=\"${image}\" alt=\"${image}\"\"></div>`;\n    } else {\n      return `<div class=\"customer-image customer-abbr\">${frappe.get_abbr(\n        customer\n      )}</div>`;\n    }\n  }\n\n  update_totals_section(frm) {\n    if (!frm) frm = this.events.get_frm();\n\n    this.render_net_total(frm.doc.net_total);\n    this.render_total_item_qty(frm.doc.items);\n    const grand_total = cint(frappe.sys_defaults.disable_rounded_total)\n      ? frm.doc.grand_total\n      : frm.doc.rounded_total;\n    this.render_grand_total(grand_total);\n\n    this.render_taxes(frm.doc.taxes);\n  }\n\n  render_net_total(value) {\n    const currency = this.events.get_frm().doc.currency;\n    this.$totals_section\n      .find('.net-total-container')\n      .html(\n        `<div>${__('Net Total')}</div><div>${format_currency(\n          value,\n          currency\n        )}</div>`\n      );\n\n    this.$numpad_section\n      .find('.numpad-net-total')\n      .html(\n        `<div>${__('Net Total')}: <span>${format_currency(\n          value,\n          currency\n        )}</span></div>`\n      );\n  }\n\n  render_total_item_qty(items) {\n    var total_item_qty = 0;\n    items.map((item) => {\n      total_item_qty = total_item_qty + item.qty;\n    });\n\n    this.$totals_section\n      .find('.item-qty-total-container')\n      .html(`<div>${__('Total Quantity')}</div><div>${total_item_qty}</div>`);\n\n    this.$numpad_section\n      .find('.numpad-item-qty-total')\n      .html(\n        `<div>${__('Total Quantity')}: <span>${total_item_qty}</span></div>`\n      );\n  }\n\n  render_grand_total(value) {\n    const currency = this.events.get_frm().doc.currency;\n    this.$totals_section\n      .find('.grand-total-container')\n      .html(\n        `<div>${__('Grand Total')}</div><div>${format_currency(\n          value,\n          currency\n        )}</div>`\n      );\n\n    this.$numpad_section\n      .find('.numpad-grand-total')\n      .html(\n        `<div>${__('Grand Total')}: <span>${format_currency(\n          value,\n          currency\n        )}</span></div>`\n      );\n  }\n\n  render_taxes(taxes) {\n    if (taxes.length) {\n      const currency = this.events.get_frm().doc.currency;\n      const taxes_html = taxes\n        .map((t) => {\n          if (t.tax_amount_after_discount_amount == 0.0) return;\n          const description = /[0-9]+/.test(t.description)\n            ? t.description\n            : `${t.description} @ ${t.rate}%`;\n          return `<div class=\"tax-row\">\n\t\t\t\t\t<div class=\"tax-label\">ISV 15%</div>\n\t\t\t\t\t<div class=\"tax-value\">${format_currency(\n            t.tax_amount_after_discount_amount,\n            currency\n          )}</div>\n\t\t\t\t</div>`;\n        })\n        .join('');\n      this.$totals_section\n        .find('.taxes-container')\n        .css('display', 'flex')\n        .html(taxes_html);\n    } else {\n      this.$totals_section\n        .find('.taxes-container')\n        .css('display', 'none')\n        .html('');\n    }\n  }\n\n  get_cart_item({ name }) {\n    const item_selector = `.cart-item-wrapper[data-row-name=\"${escape(name)}\"]`;\n    return this.$cart_items_wrapper.find(item_selector);\n  }\n\n  get_item_from_frm(item) {\n    const doc = this.events.get_frm().doc;\n    return doc.items.find((i) => i.name == item.name);\n  }\n\n  update_item_html(item, remove_item) {\n    const $item = this.get_cart_item(item);\n\n    if (remove_item) {\n      $item && $item.next().remove() && $item.remove();\n    } else {\n      const item_row = this.get_item_from_frm(item);\n      this.render_cart_item(item_row, $item);\n    }\n\n    const no_of_cart_items =\n      this.$cart_items_wrapper.find('.cart-item-wrapper').length;\n    this.highlight_checkout_btn(no_of_cart_items > 0);\n\n    this.update_empty_cart_section(no_of_cart_items);\n  }\n\n  render_cart_item(item_data, $item_to_update) {\n    const currency = this.events.get_frm().doc.currency;\n    const me = this;\n\n    if (!$item_to_update.length) {\n      this.$cart_items_wrapper.append(\n        `<div class=\"cart-item-wrapper\" data-row-name=\"${escape(\n          item_data.name\n        )}\"></div>\n\t\t\t\t<div class=\"seperator\"></div>`\n      );\n      $item_to_update = this.get_cart_item(item_data);\n    }\n\n    $item_to_update.html(\n      `${get_item_image_html()}\n\t\t\t<div class=\"item-name-desc\">\n\t\t\t\t<div class=\"item-name\">\n\t\t\t\t\t${item_data.item_name}\n\t\t\t\t</div>\n\t\t\t\t${get_description_html()}\n\t\t\t</div>\n\t\t\t${get_rate_discount_html()}`\n    );\n\n    set_dynamic_rate_header_width();\n\n    function set_dynamic_rate_header_width() {\n      const rate_cols = Array.from(\n        me.$cart_items_wrapper.find('.item-rate-amount')\n      );\n      me.$cart_header.find('.rate-amount-header').css('width', '');\n      me.$cart_items_wrapper.find('.item-rate-amount').css('width', '');\n      let max_width = rate_cols.reduce((max_width, elm) => {\n        if ($(elm).width() > max_width) max_width = $(elm).width();\n        return max_width;\n      }, 0);\n\n      max_width += 1;\n      if (max_width == 1) max_width = '';\n\n      me.$cart_header.find('.rate-amount-header').css('width', max_width);\n      me.$cart_items_wrapper.find('.item-rate-amount').css('width', max_width);\n    }\n\n    function get_rate_discount_html() {\n      if (\n        item_data.rate &&\n        item_data.amount &&\n        item_data.rate !== item_data.amount\n      ) {\n        return `\n\t\t\t\t\t<div class=\"item-qty-rate\">\n\t\t\t\t\t\t<div class=\"item-qty\"><span>${item_data.qty || 0}</span></div>\n\t\t\t\t\t\t<div class=\"item-rate-amount\">\n\t\t\t\t\t\t\t<div class=\"item-rate\">${format_currency(item_data.amount, currency)}</div>\n\t\t\t\t\t\t\t<div class=\"item-amount\">${format_currency(item_data.rate, currency)}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`;\n      } else {\n        return `\n\t\t\t\t\t<div class=\"item-qty-rate\">\n\t\t\t\t\t\t<div class=\"item-qty\"><span>${item_data.qty || 0}</span></div>\n\t\t\t\t\t\t<div class=\"item-rate-amount\">\n\t\t\t\t\t\t\t<div class=\"item-rate\">${format_currency(item_data.rate, currency)}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`;\n      }\n    }\n\n    function get_description_html() {\n      if (item_data.description) {\n        if (item_data.description.indexOf('<div>') != -1) {\n          try {\n            item_data.description = $(item_data.description).text();\n          } catch (error) {\n            item_data.description = item_data.description\n              .replace(/<div>/g, ' ')\n              .replace(/<\\/div>/g, ' ')\n              .replace(/ +/g, ' ');\n          }\n        }\n        item_data.description = frappe.ellipsis(item_data.description, 45);\n        return `<div class=\"item-desc\">${item_data.description}</div>`;\n      }\n      return ``;\n    }\n\n    function get_item_image_html() {\n      const { image, item_name } = item_data;\n      if (!me.hide_images && image) {\n        return `\n\t\t\t\t\t<div class=\"item-image\">\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tonerror=\"cur_pos.cart.handle_broken_image(this)\"\n\t\t\t\t\t\t\tsrc=\"${image}\" alt=\"${frappe.get_abbr(item_name)}\"\">\n\t\t\t\t\t</div>`;\n      } else {\n        return `<div class=\"item-image item-abbr\">${frappe.get_abbr(\n          item_name\n        )}</div>`;\n      }\n    }\n  }\n\n  handle_broken_image($img) {\n    const item_abbr = $($img).attr('alt');\n    $($img)\n      .parent()\n      .replaceWith(`<div class=\"item-image item-abbr\">${item_abbr}</div>`);\n  }\n\n  update_selector_value_in_cart_item(selector, value, item) {\n    const $item_to_update = this.get_cart_item(item);\n    $item_to_update.attr(`data-${selector}`, escape(value));\n  }\n\n  toggle_checkout_btn(show_checkout) {\n    if (show_checkout) {\n      this.$totals_section.find('.checkout-btn').css('display', 'flex');\n      this.$totals_section.find('.edit-cart-btn').css('display', 'none');\n    } else {\n      this.$totals_section.find('.checkout-btn').css('display', 'none');\n      this.$totals_section.find('.edit-cart-btn').css('display', 'flex');\n    }\n  }\n\n  highlight_checkout_btn(toggle) {\n    if (toggle) {\n      this.$add_discount_elem.css('display', 'flex');\n      this.$cart_container.find('.checkout-btn').css({\n        'background-color': 'var(--blue-500)',\n      });\n    } else {\n      this.$add_discount_elem.css('display', 'none');\n      this.$cart_container.find('.checkout-btn').css({\n        'background-color': 'var(--blue-200)',\n      });\n    }\n  }\n\n  update_empty_cart_section(no_of_cart_items) {\n    const $no_item_element = this.$cart_items_wrapper.find('.no-item-wrapper');\n\n    // if cart has items and no item is present\n    no_of_cart_items > 0 &&\n      $no_item_element &&\n      $no_item_element.remove() &&\n      this.$cart_header.css('display', 'flex');\n\n    no_of_cart_items === 0 &&\n      !$no_item_element.length &&\n      this.make_no_items_placeholder();\n  }\n\n  on_numpad_event($btn) {\n    const current_action = $btn.attr('data-button-value');\n    const action_is_field_edit = [\n      'qty',\n      'discount_percentage',\n      'rate',\n    ].includes(current_action);\n    const action_is_allowed = action_is_field_edit\n      ? (current_action == 'rate' && this.allow_rate_change) ||\n        (current_action == 'discount_percentage' &&\n          this.allow_discount_change) ||\n        current_action == 'qty'\n      : true;\n\n    const action_is_pressed_twice = this.prev_action === current_action;\n    const first_click_event = !this.prev_action;\n    const field_to_edit_changed =\n      this.prev_action && this.prev_action != current_action;\n\n    if (action_is_field_edit) {\n      if (!action_is_allowed) {\n        const label =\n          current_action == 'rate' ? 'Rate'.bold() : 'Discount'.bold();\n        const message = __(\n          'Editing {0} is not allowed as per POS Profile settings',\n          [label]\n        );\n        frappe.show_alert({\n          indicator: 'red',\n          message: message,\n        });\n        frappe.utils.play_sound('error');\n        return;\n      }\n\n      if (first_click_event || field_to_edit_changed) {\n        this.prev_action = current_action;\n      } else if (action_is_pressed_twice) {\n        this.prev_action = undefined;\n      }\n      this.numpad_value = '';\n    } else if (current_action === 'checkout') {\n      this.prev_action = undefined;\n      this.toggle_item_highlight();\n      this.events.numpad_event(undefined, current_action);\n      return;\n    } else if (current_action === 'remove') {\n      this.prev_action = undefined;\n      this.toggle_item_highlight();\n      this.events.numpad_event(undefined, current_action);\n      return;\n    } else {\n      this.numpad_value =\n        current_action === 'delete'\n          ? this.numpad_value.slice(0, -1)\n          : this.numpad_value + current_action;\n      this.numpad_value = this.numpad_value || 0;\n    }\n\n    const first_click_event_is_not_field_edit =\n      !action_is_field_edit && first_click_event;\n\n    if (first_click_event_is_not_field_edit) {\n      frappe.show_alert({\n        indicator: 'red',\n        message: __('Please select a field to edit from numpad'),\n      });\n      frappe.utils.play_sound('error');\n      return;\n    }\n\n    if (\n      flt(this.numpad_value) > 100 &&\n      this.prev_action === 'discount_percentage'\n    ) {\n      frappe.show_alert({\n        message: __('Discount cannot be greater than 100%'),\n        indicator: 'orange',\n      });\n      frappe.utils.play_sound('error');\n      this.numpad_value = current_action;\n    }\n\n    this.highlight_numpad_btn($btn, current_action);\n    this.events.numpad_event(this.numpad_value, this.prev_action);\n  }\n\n  highlight_numpad_btn($btn, curr_action) {\n    const curr_action_is_highlighted = $btn.hasClass('highlighted-numpad-btn');\n    const curr_action_is_action = [\n      'qty',\n      'discount_percentage',\n      'rate',\n      'done',\n    ].includes(curr_action);\n\n    if (!curr_action_is_highlighted) {\n      $btn.addClass('highlighted-numpad-btn');\n    }\n    if (this.prev_action === curr_action && curr_action_is_highlighted) {\n      // if Qty is pressed twice\n      $btn.removeClass('highlighted-numpad-btn');\n    }\n    if (\n      this.prev_action &&\n      this.prev_action !== curr_action &&\n      curr_action_is_action\n    ) {\n      // Order: Qty -> Rate then remove Qty highlight\n      const prev_btn = $(`[data-button-value='${this.prev_action}']`);\n      prev_btn.removeClass('highlighted-numpad-btn');\n    }\n    if (!curr_action_is_action || curr_action === 'done') {\n      // if numbers are clicked\n      setTimeout(() => {\n        $btn.removeClass('highlighted-numpad-btn');\n      }, 200);\n    }\n  }\n\n  toggle_numpad(show) {\n    if (show) {\n      this.$totals_section.css('display', 'none');\n      this.$numpad_section.css('display', 'flex');\n    } else {\n      this.$totals_section.css('display', 'flex');\n      this.$numpad_section.css('display', 'none');\n    }\n    this.reset_numpad();\n  }\n\n  reset_numpad() {\n    this.numpad_value = '';\n    this.prev_action = undefined;\n    this.$numpad_section\n      .find('.highlighted-numpad-btn')\n      .removeClass('highlighted-numpad-btn');\n  }\n\n  toggle_numpad_field_edit(fieldname) {\n    if (['qty', 'discount_percentage', 'rate'].includes(fieldname)) {\n      this.$numpad_section.find(`[data-button-value=\"${fieldname}\"]`).click();\n    }\n  }\n\n  toggle_customer_info(show) {\n    if (show) {\n      const { customer } = this.customer_info || {};\n\n      this.$cart_container.css('display', 'none');\n      this.$customer_section.css({\n        height: '100%',\n        'padding-top': '0px',\n      });\n      this.$customer_section.find('.customer-details').html(\n        `<div class=\"header\">\n\t\t\t\t\t<div class=\"label\">Contact Details</div>\n\t\t\t\t\t<div class=\"close-details-btn\">\n\t\t\t\t\t\t<svg width=\"32\" height=\"32\" viewBox=\"0 0 14 14\" fill=\"none\">\n\t\t\t\t\t\t\t<path d=\"M4.93764 4.93759L7.00003 6.99998M9.06243 9.06238L7.00003 6.99998M7.00003 6.99998L4.93764 9.06238L9.06243 4.93759\" stroke=\"#8D99A6\"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"customer-display\">\n\t\t\t\t\t${this.get_customer_image()}\n\t\t\t\t\t<div class=\"customer-name-desc\">\n\t\t\t\t\t\t<div class=\"customer-name\">${customer}</div>\n\t\t\t\t\t\t<div class=\"customer-desc\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"customer-fields-container\">\n\t\t\t\t\t<div class=\"email_id-field\"></div>\n\t\t\t\t\t<div class=\"mobile_no-field\"></div>\n\t\t\t\t\t<div class=\"loyalty_program-field\"></div>\n\t\t\t\t\t<div class=\"loyalty_points-field\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"transactions-label\">Recent Transactions</div>`\n      );\n      // transactions need to be in diff div from sticky elem for scrolling\n      this.$customer_section.append(\n        `<div class=\"customer-transactions\"></div>`\n      );\n\n      this.render_customer_fields();\n      this.fetch_customer_transactions();\n    } else {\n      this.$cart_container.css('display', 'flex');\n      this.$customer_section.css({\n        height: '',\n        'padding-top': '',\n      });\n\n      this.update_customer_section();\n    }\n  }\n\n  render_customer_fields() {\n    const $customer_form = this.$customer_section.find(\n      '.customer-fields-container'\n    );\n\n    const dfs = [\n      {\n        fieldname: 'email_id',\n        label: __('Email'),\n        fieldtype: 'Data',\n        options: 'email',\n        placeholder: __(\"Enter customer's email\"),\n      },\n      {\n        fieldname: 'mobile_no',\n        label: __('Phone Number'),\n        fieldtype: 'Data',\n        placeholder: __(\"Enter customer's phone number\"),\n      },\n      {\n        fieldname: 'loyalty_program',\n        label: __('Loyalty Program'),\n        fieldtype: 'Link',\n        options: 'Loyalty Program',\n        placeholder: __('Select Loyalty Program'),\n      },\n      {\n        fieldname: 'loyalty_points',\n        label: __('Loyalty Points'),\n        fieldtype: 'Data',\n        read_only: 1,\n      },\n    ];\n\n    const me = this;\n    dfs.forEach((df) => {\n      this[`customer_${df.fieldname}_field`] = frappe.ui.form.make_control({\n        df: { ...df, onchange: handle_customer_field_change },\n        parent: $customer_form.find(`.${df.fieldname}-field`),\n        render_input: true,\n      });\n      this[`customer_${df.fieldname}_field`].set_value(\n        this.customer_info[df.fieldname]\n      );\n    });\n\n    function handle_customer_field_change() {\n      const current_value = me.customer_info[this.df.fieldname];\n      const current_customer = me.customer_info.customer;\n\n      if (\n        this.value &&\n        current_value != this.value &&\n        this.df.fieldname != 'loyalty_points'\n      ) {\n        frappe.call({\n          method:\n            'erpnext.selling.page.point_of_sale.point_of_sale.set_customer_info',\n          args: {\n            fieldname: this.df.fieldname,\n            customer: current_customer,\n            value: this.value,\n          },\n          callback: (r) => {\n            if (!r.exc) {\n              me.customer_info[this.df.fieldname] = this.value;\n              frappe.show_alert({\n                message: __('Customer contact updated successfully.'),\n                indicator: 'green',\n              });\n              frappe.utils.play_sound('submit');\n            }\n          },\n        });\n      }\n    }\n  }\n\n  fetch_customer_transactions() {\n    frappe.db\n      .get_list('POS Invoice', {\n        filters: { customer: this.customer_info.customer, docstatus: 1 },\n        fields: [\n          'name',\n          'grand_total',\n          'status',\n          'posting_date',\n          'posting_time',\n          'currency',\n        ],\n        limit: 20,\n      })\n      .then((res) => {\n        const transaction_container = this.$customer_section.find(\n          '.customer-transactions'\n        );\n\n        if (!res.length) {\n          transaction_container.html(\n            `<div class=\"no-transactions-placeholder\">No recent transactions found</div>`\n          );\n          return;\n        }\n\n        const elapsed_time = moment(\n          res[0].posting_date + ' ' + res[0].posting_time\n        ).fromNow();\n        this.$customer_section\n          .find('.customer-desc')\n          .html(`Last transacted ${elapsed_time}`);\n\n        res.forEach((invoice) => {\n          const posting_datetime = moment(\n            invoice.posting_date + ' ' + invoice.posting_time\n          ).format('Do MMMM, h:mma');\n          let indicator_color = {\n            Paid: 'green',\n            Draft: 'red',\n            Return: 'gray',\n            Consolidated: 'blue',\n          };\n\n          transaction_container.append(\n            `<div class=\"invoice-wrapper\" data-invoice-name=\"${escape(\n              invoice.name\n            )}\">\n\t\t\t\t\t\t<div class=\"invoice-name-date\">\n\t\t\t\t\t\t\t<div class=\"invoice-name\">${invoice.name}</div>\n\t\t\t\t\t\t\t<div class=\"invoice-date\">${posting_datetime}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"invoice-total-status\">\n\t\t\t\t\t\t\t<div class=\"invoice-total\">\n\t\t\t\t\t\t\t\t${format_currency(invoice.grand_total, invoice.currency, 0) || 0}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"invoice-status\">\n\t\t\t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap ${\n                  indicator_color[invoice.status]\n                }\">\n\t\t\t\t\t\t\t\t\t<span>${invoice.status}</span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"seperator\"></div>`\n          );\n        });\n      });\n  }\n\n  attach_refresh_field_event(frm) {\n    $(frm.wrapper).off('refresh-fields');\n    $(frm.wrapper).on('refresh-fields', () => {\n      if (frm.doc.items.length) {\n        this.$cart_items_wrapper.html('');\n        frm.doc.items.forEach((item) => {\n          this.update_item_html(item);\n        });\n      }\n      this.update_totals_section(frm);\n    });\n  }\n\n  load_invoice() {\n    const frm = this.events.get_frm();\n\n    this.attach_refresh_field_event(frm);\n\n    this.fetch_customer_details(frm.doc.customer).then(() => {\n      this.events.customer_details_updated(this.customer_info);\n      this.update_customer_section();\n    });\n\n    this.$cart_items_wrapper.html('');\n    if (frm.doc.items.length) {\n      frm.doc.items.forEach((item) => {\n        this.update_item_html(item);\n      });\n    } else {\n      this.make_no_items_placeholder();\n      this.highlight_checkout_btn(false);\n    }\n\n    this.update_totals_section(frm);\n\n    if (frm.doc.docstatus === 1) {\n      this.$totals_section.find('.checkout-btn').css('display', 'none');\n      this.$totals_section.find('.edit-cart-btn').css('display', 'none');\n    } else {\n      this.$totals_section.find('.checkout-btn').css('display', 'flex');\n      this.$totals_section.find('.edit-cart-btn').css('display', 'none');\n    }\n\n    this.toggle_component(true);\n  }\n\n  toggle_component(show) {\n    show\n      ? this.$component.css('display', 'flex')\n      : this.$component.css('display', 'none');\n  }\n};\n", "erpnext.PointOfSale.ItemDetails = class {\n\tconstructor({ wrapper, events, settings }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.hide_images = settings.hide_images;\n\t\tthis.allow_rate_change = settings.allow_rate_change;\n\t\tthis.allow_discount_change = settings.allow_discount_change;\n\t\tthis.current_item = {};\n\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.init_child_components();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"item-details-container\"></section>`\n\t\t)\n\n\t\tthis.$component = this.wrapper.find('.item-details-container');\n\t}\n\n\tinit_child_components() {\n\t\tthis.$component.html(\n\t\t\t`<div class=\"item-details-header\">\n\t\t\t\t<div class=\"label\">${__('Item Details')}</div>\n\t\t\t\t<div class=\"close-btn\">\n\t\t\t\t\t<svg width=\"32\" height=\"32\" viewBox=\"0 0 14 14\" fill=\"none\">\n\t\t\t\t\t\t<path d=\"M4.93764 4.93759L7.00003 6.99998M9.06243 9.06238L7.00003 6.99998M7.00003 6.99998L4.93764 9.06238L9.06243 4.93759\" stroke=\"#8D99A6\"/>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"item-display\">\n\t\t\t\t<div class=\"item-name-desc-price\">\n\t\t\t\t\t<div class=\"item-name\"></div>\n\t\t\t\t\t<div class=\"item-desc\"></div>\n\t\t\t\t\t<div class=\"item-price\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"item-image\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"discount-section\"></div>\n\t\t\t<div class=\"form-container\"></div>`\n\t\t)\n\n\t\tthis.$item_name = this.$component.find('.item-name');\n\t\tthis.$item_description = this.$component.find('.item-desc');\n\t\tthis.$item_price = this.$component.find('.item-price');\n\t\tthis.$item_image = this.$component.find('.item-image');\n\t\tthis.$form_container = this.$component.find('.form-container');\n\t\tthis.$dicount_section = this.$component.find('.discount-section');\n\t}\n\n\tcompare_with_current_item(item) {\n\t\t// returns true if `item` is currently being edited\n\t\treturn item && item.name == this.current_item.name;\n\t}\n\n\tasync toggle_item_details_section(item) {\n\t\tconst current_item_changed = !this.compare_with_current_item(item);\n\n\t\t// if item is null or highlighted cart item is clicked twice\n\t\tconst hide_item_details = !Boolean(item) || !current_item_changed;\n\n\t\tif ((!hide_item_details && current_item_changed) || hide_item_details) {\n\t\t\t// if item details is being closed OR if item details is opened but item is changed\n\t\t\t// in both cases, if the current item is a serialized item, then validate and remove the item\n\t\t\tawait this.validate_serial_batch_item();\n\t\t}\n\n\t\tthis.events.toggle_item_selector(!hide_item_details);\n\t\tthis.toggle_component(!hide_item_details);\n\n\t\tif (item && current_item_changed) {\n\t\t\tthis.doctype = item.doctype;\n\t\t\tthis.item_meta = frappe.get_meta(this.doctype);\n\t\t\tthis.name = item.name;\n\t\t\tthis.item_row = item;\n\t\t\tthis.currency = this.events.get_frm().doc.currency;\n\n\t\t\tthis.current_item = item;\n\n\t\t\tthis.render_dom(item);\n\t\t\tthis.render_discount_dom(item);\n\t\t\tthis.render_form(item);\n\t\t\tthis.events.highlight_cart_item(item);\n\t\t} else {\n\t\t\tthis.current_item = {};\n\t\t}\n\t}\n\n\tvalidate_serial_batch_item() {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst item_row = doc.items.find(item => item.name === this.name);\n\n\t\tif (!item_row) return;\n\n\t\tconst serialized = item_row.has_serial_no;\n\t\tconst batched = item_row.has_batch_no;\n\t\tconst no_serial_selected = !item_row.serial_no;\n\t\tconst no_batch_selected = !item_row.batch_no;\n\n\t\tif ((serialized && no_serial_selected) || (batched && no_batch_selected) ||\n\t\t\t(serialized && batched && (no_batch_selected || no_serial_selected))) {\n\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"Item is removed since no serial / batch no selected.\"),\n\t\t\t\tindicator: 'orange'\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"cancel\");\n\t\t\treturn this.events.remove_item_from_cart();\n\t\t}\n\t}\n\n\trender_dom(item) {\n\t\tlet { item_name, description, image, price_list_rate } = item;\n\n\t\tfunction get_description_html() {\n\t\t\tif (description) {\n\t\t\t\tdescription = description.indexOf('...') === -1 && description.length > 140 ? description.substr(0, 139) + '...' : description;\n\t\t\t\treturn description;\n\t\t\t}\n\t\t\treturn ``;\n\t\t}\n\n\t\tthis.$item_name.html(item_name);\n\t\tthis.$item_description.html(get_description_html());\n\t\tthis.$item_price.html(format_currency(price_list_rate, this.currency));\n\t\tif (!this.hide_images && image) {\n\t\t\tthis.$item_image.html(\n\t\t\t\t`<img\n\t\t\t\t\tonerror=\"cur_pos.item_details.handle_broken_image(this)\"\n\t\t\t\t\tclass=\"h-full\" src=\"${image}\"\n\t\t\t\t\talt=\"${frappe.get_abbr(item_name)}\"\n\t\t\t\t\tstyle=\"object-fit: cover;\">`\n\t\t\t);\n\t\t} else {\n\t\t\tthis.$item_image.html(`<div class=\"item-abbr\">${frappe.get_abbr(item_name)}</div>`);\n\t\t}\n\n\t}\n\n\thandle_broken_image($img) {\n\t\tconst item_abbr = $($img).attr('alt');\n\t\t$($img).replaceWith(`<div class=\"item-abbr\">${item_abbr}</div>`);\n\t}\n\n\trender_discount_dom(item) {\n\t\tif (item.discount_percentage) {\n\t\t\tthis.$dicount_section.html(\n\t\t\t\t`<div class=\"item-rate\">${format_currency(item.price_list_rate, this.currency)}</div>\n\t\t\t\t<div class=\"item-discount\">${item.discount_percentage}% off</div>`\n\t\t\t)\n\t\t\tthis.$item_price.html(format_currency(item.rate, this.currency));\n\t\t} else {\n\t\t\tthis.$dicount_section.html(``)\n\t\t}\n\t}\n\n\trender_form(item) {\n\t\tconst fields_to_display = this.get_form_fields(item);\n\t\tthis.$form_container.html('');\n\n\t\tfields_to_display.forEach((fieldname, idx) => {\n\t\t\tthis.$form_container.append(\n\t\t\t\t`<div class=\"${fieldname}-control\" data-fieldname=\"${fieldname}\"></div>`\n\t\t\t)\n\n\t\t\tconst field_meta = this.item_meta.fields.find(df => df.fieldname === fieldname);\n\t\t\tfieldname === 'discount_percentage' ? (field_meta.label = __('Discount (%)')) : '';\n\t\t\tconst me = this;\n\n\t\t\tthis[`${fieldname}_control`] = frappe.ui.form.make_control({\n\t\t\t\tdf: {\n\t\t\t\t\t...field_meta,\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tme.events.form_updated(me.current_item, fieldname, this.value);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tparent: this.$form_container.find(`.${fieldname}-control`),\n\t\t\t\trender_input: true,\n\t\t\t})\n\t\t\tthis[`${fieldname}_control`].set_value(item[fieldname]);\n\t\t});\n\n\t\tthis.make_auto_serial_selection_btn(item);\n\n\t\tthis.bind_custom_control_change_event();\n\t}\n\n\tget_form_fields(item) {\n\t\tconst fields = ['qty', 'uom', 'rate', 'conversion_factor', 'discount_percentage', 'warehouse', 'actual_qty', 'price_list_rate'];\n\t\tif (item.has_serial_no) fields.push('serial_no');\n\t\tif (item.has_batch_no) fields.push('batch_no');\n\t\treturn fields;\n\t}\n\n\tmake_auto_serial_selection_btn(item) {\n\t\tif (item.has_serial_no) {\n\t\t\tif (!item.has_batch_no) {\n\t\t\t\tthis.$form_container.append(\n\t\t\t\t\t`<div class=\"grid-filler no-select\"></div>`\n\t\t\t\t);\n\t\t\t}\n\t\t\tconst label = __('Auto Fetch Serial Numbers');\n\t\t\tthis.$form_container.append(\n\t\t\t\t`<div class=\"btn btn-sm btn-secondary auto-fetch-btn\">${label}</div>`\n\t\t\t);\n\t\t\tthis.$form_container.find('.serial_no-control').find('textarea').css('height', '6rem');\n\t\t}\n\t}\n\n\tbind_custom_control_change_event() {\n\t\tconst me = this;\n\t\tif (this.rate_control) {\n\t\t\tthis.rate_control.df.onchange = function() {\n\t\t\t\tif (this.value || flt(this.value) === 0) {\n\t\t\t\t\tme.events.form_updated(me.current_item, 'rate', this.value).then(() => {\n\t\t\t\t\t\tconst item_row = frappe.get_doc(me.doctype, me.name);\n\t\t\t\t\t\tconst doc = me.events.get_frm().doc;\n\t\t\t\t\t\tme.$item_price.html(format_currency(item_row.rate, doc.currency));\n\t\t\t\t\t\tme.render_discount_dom(item_row);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.rate_control.df.read_only = !this.allow_rate_change;\n\t\t\tthis.rate_control.refresh();\n\t\t}\n\n\t\tif (this.discount_percentage_control && !this.allow_discount_change) {\n\t\t\tthis.discount_percentage_control.df.read_only = 1;\n\t\t\tthis.discount_percentage_control.refresh();\n\t\t}\n\n\t\tif (this.warehouse_control) {\n\t\t\tthis.warehouse_control.df.reqd = 1;\n\t\t\tthis.warehouse_control.df.onchange = function() {\n\t\t\t\tif (this.value) {\n\t\t\t\t\tme.events.form_updated(me.current_item, 'warehouse', this.value).then(() => {\n\t\t\t\t\t\tme.item_stock_map = me.events.get_item_stock_map();\n\t\t\t\t\t\tconst available_qty = me.item_stock_map[me.item_row.item_code] && me.item_stock_map[me.item_row.item_code][this.value];\n\t\t\t\t\t\tif (available_qty === undefined) {\n\t\t\t\t\t\t\tme.events.get_available_stock(me.item_row.item_code, this.value).then(() => {\n\t\t\t\t\t\t\t\t// item stock map is updated now reset warehouse\n\t\t\t\t\t\t\t\tme.warehouse_control.set_value(this.value);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t} else if (available_qty === 0) {\n\t\t\t\t\t\t\tme.warehouse_control.set_value('');\n\t\t\t\t\t\t\tconst bold_item_code = me.item_row.item_code.bold();\n\t\t\t\t\t\t\tconst bold_warehouse = this.value.bold();\n\t\t\t\t\t\t\tfrappe.throw(\n\t\t\t\t\t\t\t\t__('Item Code: {0} is not available under warehouse {1}.', [bold_item_code, bold_warehouse])\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tme.actual_qty_control.set_value(available_qty);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.warehouse_control.df.get_query = () => {\n\t\t\t\treturn {\n\t\t\t\t\tfilters: { company: this.events.get_frm().doc.company }\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.warehouse_control.refresh();\n\t\t}\n\n\t\tif (this.serial_no_control) {\n\t\t\tthis.serial_no_control.df.reqd = 1;\n\t\t\tthis.serial_no_control.df.onchange = async function() {\n\t\t\t\t!me.current_item.batch_no && await me.auto_update_batch_no();\n\t\t\t\tme.events.form_updated(me.current_item, 'serial_no', this.value);\n\t\t\t}\n\t\t\tthis.serial_no_control.refresh();\n\t\t}\n\n\t\tif (this.batch_no_control) {\n\t\t\tthis.batch_no_control.df.reqd = 1;\n\t\t\tthis.batch_no_control.df.get_query = () => {\n\t\t\t\treturn {\n\t\t\t\t\tquery: 'erpnext.controllers.queries.get_batch_no',\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\titem_code: me.item_row.item_code,\n\t\t\t\t\t\twarehouse: me.item_row.warehouse,\n\t\t\t\t\t\tposting_date: me.events.get_frm().doc.posting_date\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.batch_no_control.refresh();\n\t\t}\n\n\t\tif (this.uom_control) {\n\t\t\tthis.uom_control.df.onchange = function() {\n\t\t\t\tme.events.form_updated(me.current_item, 'uom', this.value);\n\n\t\t\t\tconst item_row = frappe.get_doc(me.doctype, me.name);\n\t\t\t\tme.conversion_factor_control.df.read_only = (item_row.stock_uom == this.value);\n\t\t\t\tme.conversion_factor_control.refresh();\n\t\t\t}\n\t\t}\n\n\t\tfrappe.model.on(\"POS Invoice Item\", \"*\", (fieldname, value, item_row) => {\n\t\t\tconst field_control = this[`${fieldname}_control`];\n\t\t\tconst item_row_is_being_edited = this.compare_with_current_item(item_row);\n\n\t\t\tif (item_row_is_being_edited && field_control && field_control.get_value() !== value) {\n\t\t\t\tfield_control.set_value(value);\n\t\t\t\tcur_pos.update_cart_html(item_row);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync auto_update_batch_no() {\n\t\tif (this.serial_no_control && this.batch_no_control) {\n\t\t\tconst selected_serial_nos = this.serial_no_control.get_value().split(`\\n`).filter(s => s);\n\t\t\tif (!selected_serial_nos.length) return;\n\n\t\t\t// find batch nos of the selected serial no\n\t\t\tconst serials_with_batch_no = await frappe.db.get_list(\"Serial No\", {\n\t\t\t\tfilters: { 'name': [\"in\", selected_serial_nos]},\n\t\t\t\tfields: [\"batch_no\", \"name\"]\n\t\t\t});\n\t\t\tconst batch_serial_map = serials_with_batch_no.reduce((acc, r) => {\n\t\t\t\tif (!acc[r.batch_no]) {\n\t\t\t\t\tacc[r.batch_no] = [];\n\t\t\t\t}\n\t\t\t\tacc[r.batch_no] = [...acc[r.batch_no], r.name];\n\t\t\t\treturn acc;\n\t\t\t}, {});\n\t\t\t// set current item's batch no and serial no\n\t\t\tconst batch_no = Object.keys(batch_serial_map)[0];\n\t\t\tconst batch_serial_nos = batch_serial_map[batch_no].join(`\\n`);\n\t\t\t// eg. 10 selected serial no. -> 5 belongs to first batch other 5 belongs to second batch\n\t\t\tconst serial_nos_belongs_to_other_batch = selected_serial_nos.length !== batch_serial_map[batch_no].length;\n\n\t\t\tconst current_batch_no = this.batch_no_control.get_value();\n\t\t\tcurrent_batch_no != batch_no && await this.batch_no_control.set_value(batch_no);\n\n\t\t\tif (serial_nos_belongs_to_other_batch) {\n\t\t\t\tthis.serial_no_control.set_value(batch_serial_nos);\n\t\t\t\tthis.qty_control.set_value(batch_serial_map[batch_no].length);\n\n\t\t\t\tdelete batch_serial_map[batch_no];\n\t\t\t\tthis.events.clone_new_batch_item_in_frm(batch_serial_map, this.current_item);\n\t\t\t}\n\t\t}\n\t}\n\n\tbind_events() {\n\t\tthis.bind_auto_serial_fetch_event();\n\t\tthis.bind_fields_to_numpad_fields();\n\n\t\tthis.$component.on('click', '.close-btn', () => {\n\t\t\tthis.events.close_item_details();\n\t\t});\n\t}\n\n\tattach_shortcuts() {\n\t\tthis.wrapper.find('.close-btn').attr(\"title\", \"Esc\");\n\t\tfrappe.ui.keys.on(\"escape\", () => {\n\t\t\tconst item_details_visible = this.$component.is(\":visible\");\n\t\t\tif (item_details_visible) {\n\t\t\t\tthis.events.close_item_details();\n\t\t\t}\n\t\t});\n\t}\n\n\tbind_fields_to_numpad_fields() {\n\t\tconst me = this;\n\t\tthis.$form_container.on('click', '.input-with-feedback', function() {\n\t\t\tconst fieldname = $(this).attr('data-fieldname');\n\t\t\tif (this.last_field_focused != fieldname) {\n\t\t\t\tme.events.item_field_focused(fieldname);\n\t\t\t\tthis.last_field_focused = fieldname;\n\t\t\t}\n\t\t});\n\t}\n\n\tbind_auto_serial_fetch_event() {\n\t\tthis.$form_container.on('click', '.auto-fetch-btn', () => {\n\t\t\tthis.batch_no_control && this.batch_no_control.set_value('');\n\t\t\tlet qty = this.qty_control.get_value();\n\t\t\tlet conversion_factor = this.conversion_factor_control.get_value();\n\t\t\tlet expiry_date = this.item_row.has_batch_no ? this.events.get_frm().doc.posting_date : \"\";\n\n\t\t\tlet numbers = frappe.call({\n\t\t\t\tmethod: \"erpnext.stock.doctype.serial_no.serial_no.auto_fetch_serial_number\",\n\t\t\t\targs: {\n\t\t\t\t\tqty: qty * conversion_factor,\n\t\t\t\t\titem_code: this.current_item.item_code,\n\t\t\t\t\twarehouse: this.warehouse_control.get_value() || '',\n\t\t\t\t\tbatch_nos: this.current_item.batch_no || '',\n\t\t\t\t\tposting_date: expiry_date,\n\t\t\t\t\tfor_doctype: 'POS Invoice'\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tnumbers.then((data) => {\n\t\t\t\tlet auto_fetched_serial_numbers = data.message;\n\t\t\t\tlet records_length = auto_fetched_serial_numbers.length;\n\t\t\t\tif (!records_length) {\n\t\t\t\t\tconst warehouse = this.warehouse_control.get_value().bold();\n\t\t\t\t\tconst item_code = this.current_item.item_code.bold();\n\t\t\t\t\tfrappe.msgprint(\n\t\t\t\t\t\t__('Serial numbers unavailable for Item {0} under warehouse {1}. Please try changing warehouse.', [item_code, warehouse])\n\t\t\t\t\t);\n\t\t\t\t} else if (records_length < qty) {\n\t\t\t\t\tfrappe.msgprint(\n\t\t\t\t\t\t__('Fetched only {0} available serial numbers.', [records_length])\n\t\t\t\t\t);\n\t\t\t\t\tthis.qty_control.set_value(records_length);\n\t\t\t\t}\n\t\t\t\tnumbers = auto_fetched_serial_numbers.join(`\\n`);\n\t\t\t\tthis.serial_no_control.set_value(numbers);\n\t\t\t});\n\t\t})\n\t}\n\n\ttoggle_component(show) {\n\t\tshow ? this.$component.css('display', 'flex') : this.$component.css('display', 'none');\n\t}\n}\n", "erpnext.PointOfSale.ItemDetails = class extends erpnext.PointOfSale.ItemDetails {\n\tasync init_child_components(){\n\t\tthis.$component.html(\n\t\t\t`<div class=\"item-details-header\">\n\t\t\t\t<div class=\"label\">Item Details</div>\n\t\t\t\t<div class=\"close-btn\">\n\t\t\t\t\t<svg width=\"32\" height=\"32\" viewBox=\"0 0 14 14\" fill=\"none\">\n\t\t\t\t\t\t<path d=\"M4.93764 4.93759L7.00003 6.99998M9.06243 9.06238L7.00003 6.99998M7.00003 6.99998L4.93764 9.06238L9.06243 4.93759\" stroke=\"#8D99A6\"/>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"item-display\">\n\t\t\t\t<div class=\"item-name-desc-price\">\n\t\t\t\t\t<div class=\"item-name\"></div>\n\t\t\t\t\t<div class=\"item-desc\"></div>\n\t\t\t\t\t<div class=\"item-price\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"item-image\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"discount-section\"></div>\n\t\t\t<div class=\"form-container\"></div>\n\t\t\t<div>\n\t\t\t\t<div class=\"btn\" id=\"sendData\" style=\"display: none;\">Get Weight</div>\n\t\t\t</div>`\n\t\t)\n\t\t\n\t\tthis.$item_name = this.$component.find('.item-name');\n\t\tthis.$item_description = this.$component.find('.item-desc');\n\t\tthis.$item_price = this.$component.find('.item-price');\n\t\tthis.$item_image = this.$component.find('.item-image');\n\t\tthis.$form_container = this.$component.find('.form-container');\n\t\tthis.$dicount_section = this.$component.find('.discount-section');\n\t\t\n\t\t//Initialize connection with serial device\n\t\tif(window.enable_weigh_scale == 1){\n\t\t\t//Check if the browser supports serial device connection\n\t\t\twindow.checkPort(false);\n\t\t\tif(typeof(window.mettlerWorker) == \"undefined\"){\n\t\t\t\tvar me = this;\n\t\t\t\twindow.mettlerWorker = new Worker(\"/assets/js/pos-mettler-toledo.min.js\");\n\t\t\t\twindow.mettlerWorker.onmessage = function(e){\n\t\t\t\t\tif(e.data.message == \"No Port\"){\n\t\t\t\t\t\twindow.checkPort(true);\n\t\t\t\t\t}\n\t\t\t\t\telse if(e.data.message == \"weight\" && window.is_item_details_open){\n\t\t\t\t\t\twindow.weight = e.data.weight;\n\t\t\t\t\t\t//Wait for 300ms before changing value as a hack to circumvent a bug(?)\n\t\t\t\t\t\t//where the device sends incorrect weight\n\t\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\t\tme.qty_control.set_value(window.weight);\n\t\t\t\t\t\t}, 300);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\twindow.mettlerWorker.postMessage({\"command\": \"connect\"});\n\t\t\t}\n\t\t\t\n\t\t\tthis.$component.on('click', '#sendData', () => {\n\t\t\t\t//window.sendData();\n\t\t\t});\n\t\t\t//$('#sendData').show();\n\t\t}\n\t}\n\t\n\tasync toggle_item_details_section(item) {\n\t\twindow.is_item_details_open = true;\n\t\tconst current_item_changed = !this.compare_with_current_item(item);\n\n\t\t// if item is null or highlighted cart item is clicked twice\n\t\tconst hide_item_details = !Boolean(item) || !current_item_changed;\n\n\t\tthis.events.toggle_item_selector(!hide_item_details);\n\t\tthis.toggle_component(!hide_item_details);\n\t\t\n\t\tif ((!hide_item_details && current_item_changed) || hide_item_details) {\n\t\t\t// if item details is being closed OR if item details is opened but item is changed\n\t\t\t// in both cases, if the current item is a serialized item, then validate and remove the item\n\t\t\tawait this.validate_serial_batch_item();\n        } \n\n\t\tif (item && current_item_changed) {\n\t\t\tthis.doctype = item.doctype;\n\t\t\tthis.item_meta = frappe.get_meta(this.doctype);\n\t\t\tthis.name = item.name;\n\t\t\tthis.item_row = item;\n\t\t\tthis.currency = this.events.get_frm().doc.currency;\n\n\t\t\tthis.current_item = item;\n\n\t\t\tthis.render_dom(item);\n\t\t\tthis.render_discount_dom(item);\n\t\t\tthis.render_form(item);\n\t\t\tthis.events.highlight_cart_item(item);\n\t\t\t\n\t\t\t//Set initial weight for weigh scale\n\t\t\twindow.old_weight = 0;\t\t\t\n\t\t} else {\n\t\t\tthis.current_item = {};\n\t\t}\n\t\tif(window.enable_weigh_scale == 1){\n\t\t\twindow.mettlerWorker.postMessage({\"command\": \"start\"});\n\t\t}\n\t}\n}\n", "erpnext.PointOfSale.NumberPad = class {\n\tconstructor({ wrapper, events, cols, keys, css_classes, fieldnames_map }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.cols = cols;\n\t\tthis.keys = keys;\n\t\tthis.css_classes = css_classes || [];\n\t\tthis.fieldnames = fieldnames_map || {};\n\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.bind_events();\n\t}\n\n\tprepare_dom() {\n\t\tconst { cols, keys, css_classes, fieldnames } = this;\n\n\t\tfunction get_keys() {\n\t\t\treturn keys.reduce((a, row, i) => {\n\t\t\t\treturn a + row.reduce((a2, number, j) => {\n\t\t\t\t\tconst class_to_append = css_classes && css_classes[i] ? css_classes[i][j] : '';\n\t\t\t\t\tconst fieldname = fieldnames && fieldnames[number] ?\n\t\t\t\t\t\tfieldnames[number] : typeof number === 'string' ? frappe.scrub(number) : number;\n\n\t\t\t\t\treturn a2 + `<div class=\"numpad-btn ${class_to_append}\" data-button-value=\"${fieldname}\">${__(number)}</div>`;\n\t\t\t\t}, '');\n\t\t\t}, '');\n\t\t}\n\n\t\tthis.wrapper.html(\n\t\t\t`<div class=\"numpad-container\">\n\t\t\t\t${get_keys()}\n\t\t\t</div>`\n\t\t)\n\t}\n\n\tbind_events() {\n\t\tconst me = this;\n\t\tthis.wrapper.on('click', '.numpad-btn', function() {\n\t\t\tconst $btn = $(this);\n\t\t\tme.events.numpad_event($btn);\n\t\t});\n\t}\n}\n", "/* eslint-disable no-unused-vars */\nerpnext.PointOfSale.Payment = class {\n\tconstructor({ events, wrapper }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.initialize_numpad();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"payment-container\">\n\t\t\t\t<div class=\"section-label payment-section\">${__('Payment Method')}</div>\n\t\t\t\t<div class=\"payment-modes\"></div>\n\t\t\t\t<div class=\"fields-numpad-container\">\n\t\t\t\t\t<div class=\"fields-section\">\n\t\t\t\t\t\t<div class=\"section-label\">${__('Additional Information')}</div>\n\t\t\t\t\t\t<div class=\"invoice-fields\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"number-pad\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"totals-section\">\n\t\t\t\t\t<div class=\"totals\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"submit-order-btn\">${__(\"Complete Order\")}</div>\n\t\t\t</section>`\n\t\t);\n\t\tthis.$component = this.wrapper.find('.payment-container');\n\t\tthis.$payment_modes = this.$component.find('.payment-modes');\n\t\tthis.$totals_section = this.$component.find('.totals-section');\n\t\tthis.$totals = this.$component.find('.totals');\n\t\tthis.$numpad = this.$component.find('.number-pad');\n\t\tthis.$invoice_fields_section = this.$component.find('.fields-section');\n\t}\n\n\tmake_invoice_fields_control() {\n\t\tfrappe.db.get_doc(\"POS Settings\", undefined).then((doc) => {\n\t\t\tconst fields = doc.invoice_fields;\n\t\t\tif (!fields.length) return;\n\n\t\t\tthis.$invoice_fields = this.$invoice_fields_section.find('.invoice-fields');\n\t\t\tthis.$invoice_fields.html('');\n\t\t\tconst frm = this.events.get_frm();\n\n\t\t\tfields.forEach(df => {\n\t\t\t\tthis.$invoice_fields.append(\n\t\t\t\t\t`<div class=\"invoice_detail_field ${df.fieldname}-field\" data-fieldname=\"${df.fieldname}\"></div>`\n\t\t\t\t);\n\t\t\t\tlet df_events = {\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tfrm.set_value(this.df.fieldname, this.get_value());\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tif (df.fieldtype == \"Button\") {\n\t\t\t\t\tdf_events = {\n\t\t\t\t\t\tclick: function() {\n\t\t\t\t\t\t\tif (frm.script_manager.has_handlers(df.fieldname, frm.doc.doctype)) {\n\t\t\t\t\t\t\t\tfrm.script_manager.trigger(df.fieldname, frm.doc.doctype, frm.doc.docname);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tthis[`${df.fieldname}_field`] = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\t...df,\n\t\t\t\t\t\t...df_events\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$invoice_fields.find(`.${df.fieldname}-field`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\tthis[`${df.fieldname}_field`].set_value(frm.doc[df.fieldname]);\n\t\t\t});\n\t\t});\n\t}\n\n\tinitialize_numpad() {\n\t\tconst me = this;\n\t\tthis.number_pad = new erpnext.PointOfSale.NumberPad({\n\t\t\twrapper: this.$numpad,\n\t\t\tevents: {\n\t\t\t\tnumpad_event: function($btn) {\n\t\t\t\t\tme.on_numpad_clicked($btn);\n\t\t\t\t}\n\t\t\t},\n\t\t\tcols: 3,\n\t\t\tkeys: [\n\t\t\t\t[ 1, 2, 3 ],\n\t\t\t\t[ 4, 5, 6 ],\n\t\t\t\t[ 7, 8, 9 ],\n\t\t\t\t[ '.', 0, 'Delete' ]\n\t\t\t],\n\t\t});\n\n\t\tthis.numpad_value = '';\n\t}\n\n\ton_numpad_clicked($btn) {\n\t\tconst button_value = $btn.attr('data-button-value');\n\n\t\thighlight_numpad_btn($btn);\n\t\tthis.numpad_value = button_value === 'delete' ? this.numpad_value.slice(0, -1) : this.numpad_value + button_value;\n\t\tthis.selected_mode.$input.get(0).focus();\n\t\tthis.selected_mode.set_value(this.numpad_value);\n\n\t\tfunction highlight_numpad_btn($btn) {\n\t\t\t$btn.addClass('shadow-base-inner bg-selected');\n\t\t\tsetTimeout(() => {\n\t\t\t\t$btn.removeClass('shadow-base-inner bg-selected');\n\t\t\t}, 100);\n\t\t}\n\t}\n\n\tbind_events() {\n\t\tconst me = this;\n\n\t\tthis.$payment_modes.on('click', '.mode-of-payment', function(e) {\n\t\t\tconst mode_clicked = $(this);\n\t\t\t// if clicked element doesn't have .mode-of-payment class then return\n\t\t\tif (!$(e.target).is(mode_clicked)) return;\n\n\t\t\tconst scrollLeft = mode_clicked.offset().left - me.$payment_modes.offset().left + me.$payment_modes.scrollLeft();\n\t\t\tme.$payment_modes.animate({ scrollLeft });\n\n\t\t\tconst mode = mode_clicked.attr('data-mode');\n\n\t\t\t// hide all control fields and shortcuts\n\t\t\t$(`.mode-of-payment-control`).css('display', 'none');\n\t\t\t$(`.cash-shortcuts`).css('display', 'none');\n\t\t\tme.$payment_modes.find(`.pay-amount`).css('display', 'inline');\n\t\t\tme.$payment_modes.find(`.loyalty-amount-name`).css('display', 'none');\n\n\t\t\t// remove highlight from all mode-of-payments\n\t\t\t$('.mode-of-payment').removeClass('border-primary');\n\n\t\t\tif (mode_clicked.hasClass('border-primary')) {\n\t\t\t\t// clicked one is selected then unselect it\n\t\t\t\tmode_clicked.removeClass('border-primary');\n\t\t\t\tme.selected_mode = '';\n\t\t\t} else {\n\t\t\t\t// clicked one is not selected then select it\n\t\t\t\tmode_clicked.addClass('border-primary');\n\t\t\t\tmode_clicked.find('.mode-of-payment-control').css('display', 'flex');\n\t\t\t\tmode_clicked.find('.cash-shortcuts').css('display', 'grid');\n\t\t\t\tme.$payment_modes.find(`.${mode}-amount`).css('display', 'none');\n\t\t\t\tme.$payment_modes.find(`.${mode}-name`).css('display', 'inline');\n\n\t\t\t\tme.selected_mode = me[`${mode}_control`];\n\t\t\t\tme.selected_mode && me.selected_mode.$input.get(0).focus();\n\t\t\t\tme.auto_set_remaining_amount();\n\t\t\t}\n\t\t});\n\n\t\tfrappe.ui.form.on('POS Invoice', 'contact_mobile', (frm) => {\n\t\t\tconst contact = frm.doc.contact_mobile;\n\t\t\tconst request_button = $(this.request_for_payment_field?.$input[0]);\n\t\t\tif (contact) {\n\t\t\t\trequest_button.removeClass('btn-default').addClass('btn-primary');\n\t\t\t} else {\n\t\t\t\trequest_button.removeClass('btn-primary').addClass('btn-default');\n\t\t\t}\n\t\t});\n\n\t\tfrappe.ui.form.on('POS Invoice', 'coupon_code', (frm) => {\n\t\t\tif (frm.doc.coupon_code && !frm.applying_pos_coupon_code) {\n\t\t\t\tif (!frm.doc.ignore_pricing_rule) {\n\t\t\t\t\tfrm.applying_pos_coupon_code = true;\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => frm.doc.ignore_pricing_rule=1,\n\t\t\t\t\t\t() => frm.trigger('ignore_pricing_rule'),\n\t\t\t\t\t\t() => frm.doc.ignore_pricing_rule=0,\n\t\t\t\t\t\t() => frm.trigger('apply_pricing_rule'),\n\t\t\t\t\t\t() => frm.save(),\n\t\t\t\t\t\t() => this.update_totals_section(frm.doc),\n\t\t\t\t\t\t() => (frm.applying_pos_coupon_code = false)\n\t\t\t\t\t]);\n\t\t\t\t} else if (frm.doc.ignore_pricing_rule) {\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __(\"Ignore Pricing Rule is enabled. Cannot apply coupon code.\"),\n\t\t\t\t\t\tindicator: \"orange\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.setup_listener_for_payments();\n\n\t\tthis.$payment_modes.on('click', '.shortcut', function() {\n\t\t\tconst value = $(this).attr('data-value');\n\t\t\tme.selected_mode.set_value(value);\n\t\t});\n\n\t\tthis.$component.on('click', '.submit-order-btn', () => {\n\t\t\tconst doc = this.events.get_frm().doc;\n\t\t\tconst paid_amount = doc.paid_amount;\n\t\t\tconst items = doc.items;\n\n\t\t\tif (paid_amount == 0 || !items.length) {\n\t\t\t\tconst message = items.length ? __(\"You cannot submit the order without payment.\") : __(\"You cannot submit empty order.\");\n\t\t\t\tfrappe.show_alert({ message, indicator: \"orange\" });\n\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.events.submit_invoice();\n\t\t});\n\n\t\tfrappe.ui.form.on('POS Invoice', 'paid_amount', (frm) => {\n\t\t\tthis.update_totals_section(frm.doc);\n\n\t\t\t// need to re calculate cash shortcuts after discount is applied\n\t\t\tconst is_cash_shortcuts_invisible = !this.$payment_modes.find('.cash-shortcuts').is(':visible');\n\t\t\tthis.attach_cash_shortcuts(frm.doc);\n\t\t\t!is_cash_shortcuts_invisible && this.$payment_modes.find('.cash-shortcuts').css('display', 'grid');\n\t\t\tthis.render_payment_mode_dom();\n\t\t});\n\n\t\tfrappe.ui.form.on('POS Invoice', 'loyalty_amount', (frm) => {\n\t\t\tconst formatted_currency = format_currency(frm.doc.loyalty_amount, frm.doc.currency);\n\t\t\tthis.$payment_modes.find(`.loyalty-amount-amount`).html(formatted_currency);\n\t\t});\n\n\t\tfrappe.ui.form.on(\"Sales Invoice Payment\", \"amount\", (frm, cdt, cdn) => {\n\t\t\t// for setting correct amount after loyalty points are redeemed\n\t\t\tconst default_mop = locals[cdt][cdn];\n\t\t\tconst mode = default_mop.mode_of_payment.replace(/ +/g, \"_\").toLowerCase();\n\t\t\tif (this[`${mode}_control`] && this[`${mode}_control`].get_value() != default_mop.amount) {\n\t\t\t\tthis[`${mode}_control`].set_value(default_mop.amount);\n\t\t\t}\n\t\t});\n\t}\n\n\tsetup_listener_for_payments() {\n\t\tfrappe.realtime.on(\"process_phone_payment\", (data) => {\n\t\t\tconst doc = this.events.get_frm().doc;\n\t\t\tconst { response, amount, success, failure_message } = data;\n\t\t\tlet message, title;\n\n\t\t\tif (success) {\n\t\t\t\ttitle = __(\"Payment Received\");\n\t\t\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total) ? doc.grand_total : doc.rounded_total;\n\t\t\t\tif (amount >= grand_total) {\n\t\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\t\tmessage = __(\"Payment of {0} received successfully.\", [format_currency(amount, doc.currency, 0)]);\n\t\t\t\t\tthis.events.submit_invoice();\n\t\t\t\t\tcur_frm.reload_doc();\n\n\t\t\t\t} else {\n\t\t\t\t\tmessage = __(\"Payment of {0} received successfully. Waiting for other requests to complete...\", [format_currency(amount, doc.currency, 0)]);\n\t\t\t\t}\n\t\t\t} else if (failure_message) {\n\t\t\t\tmessage = failure_message;\n\t\t\t\ttitle = __(\"Payment Failed\");\n\t\t\t}\n\n\t\t\tfrappe.msgprint({ \"message\": message, \"title\": title });\n\t\t});\n\t}\n\n\tauto_set_remaining_amount() {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total) ? doc.grand_total : doc.rounded_total;\n\t\tconst remaining_amount = grand_total - doc.paid_amount;\n\t\tconst current_value = this.selected_mode ? this.selected_mode.get_value() : undefined;\n\t\tif (!current_value && remaining_amount > 0 && this.selected_mode) {\n\t\t\tthis.selected_mode.set_value(remaining_amount);\n\t\t}\n\t}\n\n\tattach_shortcuts() {\n\t\tconst ctrl_label = frappe.utils.is_mac() ? '\u2318' : 'Ctrl';\n\t\tthis.$component.find('.submit-order-btn').attr(\"title\", `${ctrl_label}+Enter`);\n\t\tfrappe.ui.keys.on(\"ctrl+enter\", () => {\n\t\t\tconst payment_is_visible = this.$component.is(\":visible\");\n\t\t\tconst active_mode = this.$payment_modes.find(\".border-primary\");\n\t\t\tif (payment_is_visible && active_mode.length) {\n\t\t\t\tthis.$component.find('.submit-order-btn').click();\n\t\t\t}\n\t\t});\n\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"tab\",\n\t\t\taction: () => {\n\t\t\t\tconst payment_is_visible = this.$component.is(\":visible\");\n\t\t\t\tlet active_mode = this.$payment_modes.find(\".border-primary\");\n\t\t\t\tactive_mode = active_mode.length ? active_mode.attr(\"data-mode\") : undefined;\n\n\t\t\t\tif (!active_mode) return;\n\n\t\t\t\tconst mode_of_payments = Array.from(this.$payment_modes.find(\".mode-of-payment\")).map(m => $(m).attr(\"data-mode\"));\n\t\t\t\tconst mode_index = mode_of_payments.indexOf(active_mode);\n\t\t\t\tconst next_mode_index = (mode_index + 1) % mode_of_payments.length;\n\t\t\t\tconst next_mode_to_be_clicked = this.$payment_modes.find(`.mode-of-payment[data-mode=\"${mode_of_payments[next_mode_index]}\"]`);\n\n\t\t\t\tif (payment_is_visible && mode_index != next_mode_index) {\n\t\t\t\t\tnext_mode_to_be_clicked.click();\n\t\t\t\t}\n\t\t\t},\n\t\t\tcondition: () => this.$component.is(':visible') && this.$payment_modes.find(\".border-primary\").length,\n\t\t\tdescription: __(\"Switch Between Payment Modes\"),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page\n\t\t});\n\t}\n\n\ttoggle_numpad() {\n\t\t// pass\n\t}\n\n\trender_payment_section() {\n\t\tthis.render_payment_mode_dom();\n\t\tthis.make_invoice_fields_control();\n\t\tthis.update_totals_section();\n\t\tthis.focus_on_default_mop();\n\t}\n\n\tedit_cart() {\n\t\tthis.events.toggle_other_sections(false);\n\t\tthis.toggle_component(false);\n\t}\n\n\tcheckout() {\n\t\tthis.events.toggle_other_sections(true);\n\t\tthis.toggle_component(true);\n\n\t\tthis.render_payment_section();\n\t}\n\n\ttoggle_remarks_control() {\n\t\tif (this.$remarks.find('.frappe-control').length) {\n\t\t\tthis.$remarks.html('+ Add Remark');\n\t\t} else {\n\t\t\tthis.$remarks.html('');\n\t\t\tthis[`remark_control`] = frappe.ui.form.make_control({\n\t\t\t\tdf: {\n\t\t\t\t\tlabel: __('Remark'),\n\t\t\t\t\tfieldtype: 'Data',\n\t\t\t\t\tonchange: function() {}\n\t\t\t\t},\n\t\t\t\tparent: this.$totals_section.find(`.remarks`),\n\t\t\t\trender_input: true,\n\t\t\t});\n\t\t\tthis[`remark_control`].set_value('');\n\t\t}\n\t}\n\n\trender_payment_mode_dom() {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst payments = doc.payments;\n\t\tconst currency = doc.currency;\n\n\t\tthis.$payment_modes.html(`${\n\t\t\tpayments.map((p, i) => {\n\t\t\t\tconst mode = p.mode_of_payment.replace(/ +/g, \"_\").toLowerCase();\n\t\t\t\tconst payment_type = p.type;\n\t\t\t\tconst margin = i % 2 === 0 ? 'pr-2' : 'pl-2';\n\t\t\t\tconst amount = p.amount > 0 ? format_currency(p.amount, currency) : '';\n\n\t\t\t\treturn (`\n\t\t\t\t\t<div class=\"payment-mode-wrapper\">\n\t\t\t\t\t\t<div class=\"mode-of-payment\" data-mode=\"${mode}\" data-payment-type=\"${payment_type}\">\n\t\t\t\t\t\t\t${p.mode_of_payment}\n\t\t\t\t\t\t\t<div class=\"${mode}-amount pay-amount\">${amount}</div>\n\t\t\t\t\t\t\t<div class=\"${mode} mode-of-payment-control\"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`);\n\t\t\t}).join('')\n\t\t}`);\n\n\t\tpayments.forEach(p => {\n\t\t\tconst mode = p.mode_of_payment.replace(/ +/g, \"_\").toLowerCase();\n\t\t\tconst me = this;\n\t\t\tthis[`${mode}_control`] = frappe.ui.form.make_control({\n\t\t\t\tdf: {\n\t\t\t\t\tlabel: p.mode_of_payment,\n\t\t\t\t\tfieldtype: 'Currency',\n\t\t\t\t\tplaceholder: __('Enter {0} amount.', [p.mode_of_payment]),\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tconst current_value = frappe.model.get_value(p.doctype, p.name, 'amount');\n\t\t\t\t\t\tif (current_value != this.value) {\n\t\t\t\t\t\t\tfrappe.model\n\t\t\t\t\t\t\t\t.set_value(p.doctype, p.name, 'amount', flt(this.value))\n\t\t\t\t\t\t\t\t.then(() => me.update_totals_section())\n\n\t\t\t\t\t\t\tconst formatted_currency = format_currency(this.value, currency);\n\t\t\t\t\t\t\tme.$payment_modes.find(`.${mode}-amount`).html(formatted_currency);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tparent: this.$payment_modes.find(`.${mode}.mode-of-payment-control`),\n\t\t\t\trender_input: true,\n\t\t\t});\n\t\t\tthis[`${mode}_control`].toggle_label(false);\n\t\t\tthis[`${mode}_control`].set_value(p.amount);\n\t\t});\n\n\t\tthis.render_loyalty_points_payment_mode();\n\n\t\tthis.attach_cash_shortcuts(doc);\n\t}\n\n\tfocus_on_default_mop() {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst payments = doc.payments;\n\t\tpayments.forEach(p => {\n\t\t\tconst mode = p.mode_of_payment.replace(/ +/g, \"_\").toLowerCase();\n\t\t\tif (p.default) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.$payment_modes.find(`.${mode}.mode-of-payment-control`).parent().click();\n\t\t\t\t}, 500);\n\t\t\t}\n\t\t});\n\t}\n\n\tattach_cash_shortcuts(doc) {\n\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total) ? doc.grand_total : doc.rounded_total;\n\t\tconst currency = doc.currency;\n\n\t\tconst shortcuts = this.get_cash_shortcuts(flt(grand_total));\n\n\t\tthis.$payment_modes.find('.cash-shortcuts').remove();\n\t\tlet shortcuts_html = shortcuts.map(s => {\n\t\t\treturn `<div class=\"shortcut\" data-value=\"${s}\">${format_currency(s, currency, 0)}</div>`;\n\t\t}).join('');\n\n\t\tthis.$payment_modes.find('[data-payment-type=\"Cash\"]').find('.mode-of-payment-control')\n\t\t\t.after(`<div class=\"cash-shortcuts\">${shortcuts_html}</div>`);\n\t}\n\n\tget_cash_shortcuts(grand_total) {\n\t\tlet steps = [1, 5, 10];\n\t\tconst digits = String(Math.round(grand_total)).length;\n\n\t\tsteps = steps.map(x => x * (10 ** (digits - 2)));\n\n\t\tconst get_nearest = (amount, x) => {\n\t\t\tlet nearest_x = Math.ceil((amount / x)) * x;\n\t\t\treturn nearest_x === amount ? nearest_x + x : nearest_x;\n\t\t};\n\n\t\treturn steps.reduce((finalArr, x) => {\n\t\t\tlet nearest_x = get_nearest(grand_total, x);\n\t\t\tnearest_x = finalArr.indexOf(nearest_x) != -1 ? nearest_x + x : nearest_x;\n\t\t\treturn [...finalArr, nearest_x];\n\t\t}, []);\n\t}\n\n\trender_loyalty_points_payment_mode() {\n\t\tconst me = this;\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst { loyalty_program, loyalty_points, conversion_factor } = this.events.get_customer_details();\n\n\t\tthis.$payment_modes.find(`.mode-of-payment[data-mode=\"loyalty-amount\"]`).parent().remove();\n\n\t\tif (!loyalty_program) return;\n\n\t\tlet description, read_only, max_redeemable_amount;\n\t\tif (!loyalty_points) {\n\t\t\tdescription = __(\"You don't have enough points to redeem.\");\n\t\t\tread_only = true;\n\t\t} else {\n\t\t\tmax_redeemable_amount = flt(flt(loyalty_points) * flt(conversion_factor), precision(\"loyalty_amount\", doc));\n\t\t\tdescription = __(\"You can redeem upto {0}.\", [format_currency(max_redeemable_amount)]);\n\t\t\tread_only = false;\n\t\t}\n\n\t\tconst margin = this.$payment_modes.children().length % 2 === 0 ? 'pr-2' : 'pl-2';\n\t\tconst amount = doc.loyalty_amount > 0 ? format_currency(doc.loyalty_amount, doc.currency) : '';\n\t\tthis.$payment_modes.append(\n\t\t\t`<div class=\"payment-mode-wrapper\">\n\t\t\t\t<div class=\"mode-of-payment loyalty-card\" data-mode=\"loyalty-amount\" data-payment-type=\"loyalty-amount\">\n\t\t\t\t\tRedeem Loyalty Points\n\t\t\t\t\t<div class=\"loyalty-amount-amount pay-amount\">${amount}</div>\n\t\t\t\t\t<div class=\"loyalty-amount-name\">${loyalty_program}</div>\n\t\t\t\t\t<div class=\"loyalty-amount mode-of-payment-control\"></div>\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t);\n\n\t\tthis['loyalty-amount_control'] = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __(\"Redeem Loyalty Points\"),\n\t\t\t\tfieldtype: 'Currency',\n\t\t\t\tplaceholder: __(\"Enter amount to be redeemed.\"),\n\t\t\t\toptions: 'company:currency',\n\t\t\t\tread_only,\n\t\t\t\tonchange: async function() {\n\t\t\t\t\tif (!loyalty_points) return;\n\n\t\t\t\t\tif (this.value > max_redeemable_amount) {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __(\"You cannot redeem more than {0}.\", [format_currency(max_redeemable_amount)]),\n\t\t\t\t\t\t\tindicator: \"red\"\n\t\t\t\t\t\t});\n\t\t\t\t\t\tfrappe.utils.play_sound(\"submit\");\n\t\t\t\t\t\tme['loyalty-amount_control'].set_value(0);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst redeem_loyalty_points = this.value > 0 ? 1 : 0;\n\t\t\t\t\tawait frappe.model.set_value(doc.doctype, doc.name, 'redeem_loyalty_points', redeem_loyalty_points);\n\t\t\t\t\tfrappe.model.set_value(doc.doctype, doc.name, 'loyalty_points', parseInt(this.value / conversion_factor));\n\t\t\t\t},\n\t\t\t\tdescription\n\t\t\t},\n\t\t\tparent: this.$payment_modes.find(`.loyalty-amount.mode-of-payment-control`),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis['loyalty-amount_control'].toggle_label(false);\n\n\t\t// this.render_add_payment_method_dom();\n\t}\n\n\trender_add_payment_method_dom() {\n\t\tconst docstatus = this.events.get_frm().doc.docstatus;\n\t\tif (docstatus === 0)\n\t\t\tthis.$payment_modes.append(\n\t\t\t\t`<div class=\"w-full pr-2\">\n\t\t\t\t\t<div class=\"add-mode-of-payment w-half text-grey mb-4 no-select pointer\">+ Add Payment Method</div>\n\t\t\t\t</div>`\n\t\t\t);\n\t}\n\n\tupdate_totals_section(doc) {\n\t\tif (!doc) doc = this.events.get_frm().doc;\n\t\tconst paid_amount = doc.paid_amount;\n\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total) ? doc.grand_total : doc.rounded_total;\n\t\tconst remaining = grand_total - doc.paid_amount;\n\t\tconst change = doc.change_amount || remaining <= 0 ? -1 * remaining : undefined;\n\t\tconst currency = doc.currency;\n\t\tconst label = change ? __('Change') : __('To Be Paid');\n\n\t\tthis.$totals.html(\n\t\t\t`<div class=\"col\">\n\t\t\t\t<div class=\"total-label\">${__('Grand Total')}</div>\n\t\t\t\t<div class=\"value\">${format_currency(grand_total, currency)}</div>\n\t\t\t</div>\n\t\t\t<div class=\"seperator-y\"></div>\n\t\t\t<div class=\"col\">\n\t\t\t\t<div class=\"total-label\">${__('Paid Amount')}</div>\n\t\t\t\t<div class=\"value\">${format_currency(paid_amount, currency)}</div>\n\t\t\t</div>\n\t\t\t<div class=\"seperator-y\"></div>\n\t\t\t<div class=\"col\">\n\t\t\t\t<div class=\"total-label\">${label}</div>\n\t\t\t\t<div class=\"value\">${format_currency(change || remaining, currency)}</div>\n\t\t\t</div>`\n\t\t);\n\t}\n\n\ttoggle_component(show) {\n\t\tshow ? this.$component.css('display', 'flex') : this.$component.css('display', 'none');\n\t}\n};\n", "erpnext.PointOfSale.Payment = class extends erpnext.PointOfSale.Payment {\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"payment-container\">\n\t\t\t\t<div class=\"section-label payment-section\">Payment Method</div>\n\t\t\t\t<div class=\"payment-modes\"></div>\n\t\t\t\t<div class=\"fields-numpad-container\">\n\t\t\t\t\t<div class=\"fields-section\">\n\t\t\t\t\t\t<div class=\"section-label\">Additional Information</div>\n\t\t\t\t\t\t<div class=\"invoice-fields\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"number-pad\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"totals-section\">\n\t\t\t\t\t<div class=\"totals\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"submit-order-btn\">Complete Order</div>\n\t\t\t</section>`\n\t\t);\n\t\tthis.$component = this.wrapper.find('.payment-container');\n\t\tthis.$payment_modes = this.$component.find('.payment-modes');\n\t\tthis.$totals_section = this.$component.find('.totals-section');\n\t\tthis.$totals = this.$component.find('.totals');\n\t\tthis.$numpad = this.$component.find('.number-pad');\n\t\tthis.$invoice_fields_section = this.$component.find('.fields-section');\n\t}\n\t\n\tmake_invoice_fields_control() {\n\t\tfrappe.db.get_doc(\"POS Settings\", undefined).then((doc) => {\n\t\t\tconst fields = doc.invoice_fields;\n\t\t\tif (!fields.length) return;\n\n\t\t\tthis.$invoice_fields = this.$invoice_fields_section.find('.invoice-fields');\n\t\t\tthis.$invoice_fields.html('');\n\t\t\tconst frm = this.events.get_frm();\n\n\t\t\tfields.forEach(df => {\n\t\t\t\tthis.$invoice_fields.append(\n\t\t\t\t\t`<div class=\"invoice_detail_field ${df.fieldname}-field\" data-fieldname=\"${df.fieldname}\"></div>`\n\t\t\t\t);\n\t\t\t\tlet df_events = {\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tfrm.set_value(this.df.fieldname, this.get_value());\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tif (df.fieldtype == \"Button\") {\n\t\t\t\t\tdf_events = {\n\t\t\t\t\t\tclick: function() {\n\t\t\t\t\t\t\tif (frm.script_manager.has_handlers(df.fieldname, frm.doc.doctype)) {\n\t\t\t\t\t\t\t\tfrm.script_manager.trigger(df.fieldname, frm.doc.doctype, frm.doc.docname);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tthis[`${df.fieldname}_field`] = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\t...df,\n\t\t\t\t\t\t...df_events\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$invoice_fields.find(`.${df.fieldname}-field`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\tthis[`${df.fieldname}_field`].set_value(frm.doc[df.fieldname]);\n\t\t\t});\n\t\t});\n\t\t\n\t\t//For raw printing buttons\n\t\tif(window.enable_raw_print == 1){\n\t\t\tthis.$invoice_fields_section.find('.invoice-fields').append(\n\t\t\t\t`<div style=\"position: absolute; bottom: 0; width: 100%; margin-bottom: 10px;\" class=\"summary-btn btn btn-default cash-drawer-btn\">\n\t\t\t\t\tOpen Cash Drawer\n\t\t\t\t</div>`\n\t\t\t);\n\t\t}\n\t}\n\t\n\tbind_events() {\n\t\tconst me = this;\n\n\t\tthis.$payment_modes.on('click', '.mode-of-payment', function(e) {\n\t\t\tconst mode_clicked = $(this);\n\t\t\t// if clicked element doesn't have .mode-of-payment class then return\n\t\t\tif (!$(e.target).is(mode_clicked)) return;\n\n\t\t\tconst scrollLeft = mode_clicked.offset().left - me.$payment_modes.offset().left + me.$payment_modes.scrollLeft();\n\t\t\tme.$payment_modes.animate({ scrollLeft });\n\n\t\t\tconst mode = mode_clicked.attr('data-mode');\n\n\t\t\t// hide all control fields and shortcuts\n\t\t\t$(`.mode-of-payment-control`).css('display', 'none');\n\t\t\t$(`.cash-shortcuts`).css('display', 'none');\n\t\t\tme.$payment_modes.find(`.pay-amount`).css('display', 'inline');\n\t\t\tme.$payment_modes.find(`.loyalty-amount-name`).css('display', 'none');\n\n\t\t\t// remove highlight from all mode-of-payments\n\t\t\t$('.mode-of-payment').removeClass('border-primary');\n\n\t\t\tif (mode_clicked.hasClass('border-primary')) {\n\t\t\t\t// clicked one is selected then unselect it\n\t\t\t\tmode_clicked.removeClass('border-primary');\n\t\t\t\tme.selected_mode = '';\n\t\t\t} else {\n\t\t\t\t// clicked one is not selected then select it\n\t\t\t\tmode_clicked.addClass('border-primary');\n\t\t\t\tmode_clicked.find('.mode-of-payment-control').css('display', 'flex');\n\t\t\t\tmode_clicked.find('.cash-shortcuts').css('display', 'grid');\n\t\t\t\tme.$payment_modes.find(`.${mode}-amount`).css('display', 'none');\n\t\t\t\tme.$payment_modes.find(`.${mode}-name`).css('display', 'inline');\n\n\t\t\t\tme.selected_mode = me[`${mode}_control`];\n\t\t\t\tme.selected_mode && me.selected_mode.$input.get(0).focus();\n\t\t\t\tme.auto_set_remaining_amount();\n\t\t\t}\n\t\t});\n\t\t\n\t\tfrappe.ui.form.on('POS Invoice', 'contact_mobile', (frm) => {\n\t\t\tconst contact = frm.doc.contact_mobile;\n\t\t\tconst request_button = $(this.request_for_payment_field.$input[0]);\n\t\t\tif (contact) {\n\t\t\t\trequest_button.removeClass('btn-default').addClass('btn-primary');\n\t\t\t} else {\n\t\t\t\trequest_button.removeClass('btn-primary').addClass('btn-default');\n\t\t\t}\n\t\t});\n\t\t\n\t\tfrappe.ui.form.on('POS Invoice', 'coupon_code', (frm) => {\n\t\t\tif (frm.doc.coupon_code && !frm.applying_pos_coupon_code) {\n\t\t\t\tif (!frm.doc.ignore_pricing_rule) {\n\t\t\t\t\tfrm.applying_pos_coupon_code = true;\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => frm.doc.ignore_pricing_rule=1,\n\t\t\t\t\t\t() => frm.trigger('ignore_pricing_rule'),\n\t\t\t\t\t\t() => frm.doc.ignore_pricing_rule=0,\n\t\t\t\t\t\t() => frm.trigger('apply_pricing_rule'),\n\t\t\t\t\t\t() => frm.save(),\n\t\t\t\t\t\t() => this.update_totals_section(frm.doc),\n\t\t\t\t\t\t() => (frm.applying_pos_coupon_code = false)\n\t\t\t\t\t]);\n\t\t\t\t} else if (frm.doc.ignore_pricing_rule) {\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __(\"Ignore Pricing Rule is enabled. Cannot apply coupon code.\"),\n\t\t\t\t\t\tindicator: \"orange\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.setup_listener_for_payments();\n\n\t\tthis.$payment_modes.on('click', '.shortcut', function() {\n\t\t\tconst value = $(this).attr('data-value');\n\t\t\tme.selected_mode.set_value(value);\n\t\t});\n\n\t\tthis.$component.on('click', '.submit-order-btn', () => {\n\t\t\tconst doc = this.events.get_frm().doc;\n\t\t\tconst paid_amount = doc.paid_amount;\n\t\t\tconst items = doc.items;\n\n\t\t\tif (paid_amount == 0 || !items.length) {\n\t\t\t\tconst message = items.length ? __(\"You cannot submit the order without payment.\") : __(\"You cannot submit empty order.\");\n\t\t\t\tfrappe.show_alert({ message, indicator: \"orange\" });\n\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.events.submit_invoice();\n\t\t});\n\n\t\tfrappe.ui.form.on('POS Invoice', 'paid_amount', (frm) => {\n\t\t\tthis.update_totals_section(frm.doc);\n\n\t\t\t// need to re calculate cash shortcuts after discount is applied\n\t\t\tconst is_cash_shortcuts_invisible = !this.$payment_modes.find('.cash-shortcuts').is(':visible');\n\t\t\tthis.attach_cash_shortcuts(frm.doc);\n\t\t\t!is_cash_shortcuts_invisible && this.$payment_modes.find('.cash-shortcuts').css('display', 'grid');\n\t\t\tthis.render_payment_mode_dom();\n\t\t});\n\n\t\tfrappe.ui.form.on('POS Invoice', 'loyalty_amount', (frm) => {\n\t\t\tconst formatted_currency = format_currency(frm.doc.loyalty_amount, frm.doc.currency);\n\t\t\tthis.$payment_modes.find(`.loyalty-amount-amount`).html(formatted_currency);\n\t\t});\n\n\t\tfrappe.ui.form.on(\"Sales Invoice Payment\", \"amount\", (frm, cdt, cdn) => {\n\t\t\t// for setting correct amount after loyalty points are redeemed\n\t\t\tconst default_mop = locals[cdt][cdn];\n\t\t\tconst mode = default_mop.mode_of_payment.replace(/ +/g, \"_\").toLowerCase();\n\t\t\tif (this[`${mode}_control`] && this[`${mode}_control`].get_value() != default_mop.amount) {\n\t\t\t\tthis[`${mode}_control`].set_value(default_mop.amount);\n\t\t\t}\n\t\t});\n\t\t//For raw printing buttons\n\t\tthis.$component.on('click', '.cash-drawer-btn', () => {\n\t\t\tthis.events.open_cash_drawer();\n\t\t});\n\t}\n\t\n\tcheckout() {\n\t\tthis.events.toggle_other_sections(true);\n\t\tthis.toggle_component(true);\n\n\t\tthis.render_payment_section();\n\t\t\n\t\t//For weigh scale\n\t\tif(window.enable_weigh_scale == 1){\n\t\t\tif(typeof(window.mettlerWorker) != \"undefined\"){\n\t\t\t\twindow.mettlerWorker.postMessage({\"command\": \"stop\"});\n\t\t\t}\n\t\t}\n\t}\n}\n", "erpnext.PointOfSale.PastOrderList = class {\n\tconstructor({ wrapper, events }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.make_filter_section();\n\t\tthis.bind_events();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"past-order-list\">\n\t\t\t\t<div class=\"filter-section\">\n\t\t\t\t\t<div class=\"label\">${__('Recent Orders')}</div>\n\t\t\t\t\t<div class=\"search-field\"></div>\n\t\t\t\t\t<div class=\"status-field\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"invoices-container\"></div>\n\t\t\t</section>`\n\t\t);\n\n\t\tthis.$component = this.wrapper.find('.past-order-list');\n\t\tthis.$invoices_container = this.$component.find('.invoices-container');\n\t}\n\n\tbind_events() {\n\t\tthis.search_field.$input.on('input', (e) => {\n\t\t\tclearTimeout(this.last_search);\n\t\t\tthis.last_search = setTimeout(() => {\n\t\t\t\tconst search_term = e.target.value;\n\t\t\t\tthis.refresh_list(search_term, this.status_field.get_value());\n\t\t\t}, 300);\n\t\t});\n\t\tconst me = this;\n\t\tthis.$invoices_container.on('click', '.invoice-wrapper', function() {\n\t\t\tconst invoice_name = unescape($(this).attr('data-invoice-name'));\n\n\t\t\tme.events.open_invoice_data(invoice_name);\n\t\t});\n\t}\n\n\tmake_filter_section() {\n\t\tconst me = this;\n\t\tthis.search_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __('Search'),\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\tplaceholder: __('Search by invoice id or customer name')\n\t\t\t},\n\t\t\tparent: this.$component.find('.search-field'),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.status_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __('Invoice Status'),\n\t\t\t\tfieldtype: 'Select',\n\t\t\t\toptions: `Draft\\nPaid\\nConsolidated\\nReturn`,\n\t\t\t\tplaceholder: __('Filter by invoice status'),\n\t\t\t\tonchange: function() {\n\t\t\t\t\tif (me.$component.is(':visible')) me.refresh_list();\n\t\t\t\t}\n\t\t\t},\n\t\t\tparent: this.$component.find('.status-field'),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.search_field.toggle_label(false);\n\t\tthis.status_field.toggle_label(false);\n\t\tthis.status_field.set_value('Draft');\n\t}\n\n\trefresh_list() {\n\t\tfrappe.dom.freeze();\n\t\tthis.events.reset_summary();\n\t\tconst search_term = this.search_field.get_value();\n\t\tconst status = this.status_field.get_value();\n\n\t\tthis.$invoices_container.html('');\n\n\t\treturn frappe.call({\n\t\t\tmethod: \"erpnext.selling.page.point_of_sale.point_of_sale.get_past_order_list\",\n\t\t\tfreeze: true,\n\t\t\targs: { search_term, status },\n\t\t\tcallback: (response) => {\n\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\tresponse.message.forEach(invoice => {\n\t\t\t\t\tconst invoice_html = this.get_invoice_html(invoice);\n\t\t\t\t\tthis.$invoices_container.append(invoice_html);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tget_invoice_html(invoice) {\n\t\tconst posting_datetime = moment(invoice.posting_date+\" \"+invoice.posting_time).format(\"Do MMMM, h:mma\");\n\t\treturn (\n\t\t\t`<div class=\"invoice-wrapper\" data-invoice-name=\"${escape(invoice.name)}\">\n\t\t\t\t<div class=\"invoice-name-date\">\n\t\t\t\t\t<div class=\"invoice-name\">${invoice.name}</div>\n\t\t\t\t\t<div class=\"invoice-date\">\n\t\t\t\t\t\t<svg class=\"mr-2\" width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"1\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n\t\t\t\t\t\t\t<path d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\"/><circle cx=\"12\" cy=\"7\" r=\"4\"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t${frappe.ellipsis(invoice.customer, 20)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"invoice-total-status\">\n\t\t\t\t\t<div class=\"invoice-total\">${format_currency(invoice.grand_total, invoice.currency, 0) || 0}</div>\n\t\t\t\t\t<div class=\"invoice-date\">${posting_datetime}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"seperator\"></div>`\n\t\t);\n\t}\n\n\ttoggle_component(show) {\n\t\tshow ? this.$component.css('display', 'flex') && this.refresh_list() : this.$component.css('display', 'none');\n\t}\n};\n", "erpnext.PointOfSale.PastOrderSummary = class {\n\tconstructor({ wrapper, events }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.init_email_print_dialog();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"past-order-summary\">\n\t\t\t\t<div class=\"no-summary-placeholder\">\n\t\t\t\t\t${__('Select an invoice to load summary data')}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"invoice-summary-wrapper\">\n\t\t\t\t\t<div class=\"abs-container\">\n\t\t\t\t\t\t<div class=\"upper-section\"></div>\n\t\t\t\t\t\t<div class=\"label\">${__('Items')}</div>\n\t\t\t\t\t\t<div class=\"items-container summary-container\"></div>\n\t\t\t\t\t\t<div class=\"label\">${__('Totals')}</div>\n\t\t\t\t\t\t<div class=\"totals-container summary-container\"></div>\n\t\t\t\t\t\t<div class=\"label\">${__('Payments')}</div>\n\t\t\t\t\t\t<div class=\"payments-container summary-container\"></div>\n\t\t\t\t\t\t<div class=\"summary-btns\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</section>`\n\t\t);\n\n\t\tthis.$component = this.wrapper.find('.past-order-summary');\n\t\tthis.$summary_wrapper = this.$component.find('.invoice-summary-wrapper');\n\t\tthis.$summary_container = this.$component.find('.abs-container');\n\t\tthis.$upper_section = this.$summary_container.find('.upper-section');\n\t\tthis.$items_container = this.$summary_container.find('.items-container');\n\t\tthis.$totals_container = this.$summary_container.find('.totals-container');\n\t\tthis.$payment_container = this.$summary_container.find('.payments-container');\n\t\tthis.$summary_btns = this.$summary_container.find('.summary-btns');\n\t}\n\n\tinit_email_print_dialog() {\n\t\tconst email_dialog = new frappe.ui.Dialog({\n\t\t\ttitle: 'Email Receipt',\n\t\t\tfields: [\n\t\t\t\t{fieldname: 'email_id', fieldtype: 'Data', options: 'Email', label: 'Email ID'},\n\t\t\t\t// {fieldname:'remarks', fieldtype:'Text', label:'Remarks (if any)'}\n\t\t\t],\n\t\t\tprimary_action: () => {\n\t\t\t\tthis.send_email();\n\t\t\t},\n\t\t\tprimary_action_label: __('Send'),\n\t\t});\n\t\tthis.email_dialog = email_dialog;\n\n\t\tconst print_dialog = new frappe.ui.Dialog({\n\t\t\ttitle: 'Print Receipt',\n\t\t\tfields: [\n\t\t\t\t{fieldname: 'print', fieldtype: 'Data', label: 'Print Preview'}\n\t\t\t],\n\t\t\tprimary_action: () => {\n\t\t\t\tthis.print_receipt();\n\t\t\t},\n\t\t\tprimary_action_label: __('Print'),\n\t\t});\n\t\tthis.print_dialog = print_dialog;\n\t}\n\n\tget_upper_section_html(doc) {\n\t\tconst { status } = doc;\n\t\tlet indicator_color = '';\n\n\t\tin_list(['Paid', 'Consolidated'], status) && (indicator_color = 'green');\n\t\tstatus === 'Draft' && (indicator_color = 'red');\n\t\tstatus === 'Return' && (indicator_color = 'grey');\n\n\t\treturn `<div class=\"left-section\">\n\t\t\t\t\t<div class=\"customer-name\">${doc.customer}</div>\n\t\t\t\t\t<div class=\"customer-email\">${this.customer_email}</div>\n\t\t\t\t\t<div class=\"cashier\">${__('Sold by')}: ${doc.owner}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"right-section\">\n\t\t\t\t\t<div class=\"paid-amount\">${format_currency(doc.paid_amount, doc.currency)}</div>\n\t\t\t\t\t<div class=\"invoice-name\">${doc.name}</div>\n\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap ${indicator_color}\"><span>${doc.status}</span></span>\n\t\t\t\t</div>`;\n\t}\n\n\tget_item_html(doc, item_data) {\n\t\treturn `<div class=\"item-row-wrapper\">\n\t\t\t\t\t<div class=\"item-name\">${item_data.item_name}</div>\n\t\t\t\t\t<div class=\"item-qty\">${item_data.qty || 0}</div>\n\t\t\t\t\t<div class=\"item-rate-disc\">${get_rate_discount_html()}</div>\n\t\t\t\t</div>`;\n\n\t\tfunction get_rate_discount_html() {\n\t\t\tif (item_data.rate && item_data.price_list_rate && item_data.rate !== item_data.price_list_rate) {\n\t\t\t\treturn `<span class=\"item-disc\">(${item_data.discount_percentage}% off)</span>\n\t\t\t\t\t\t<div class=\"item-rate\">${format_currency(item_data.rate, doc.currency)}</div>`;\n\t\t\t} else {\n\t\t\t\treturn `<div class=\"item-rate\">${format_currency(item_data.price_list_rate || item_data.rate, doc.currency)}</div>`;\n\t\t\t}\n\t\t}\n\t}\n\n\tget_discount_html(doc) {\n\t\tif (doc.discount_amount) {\n\t\t\treturn `<div class=\"summary-row-wrapper\">\n\t\t\t\t\t\t<div>Discount (${doc.additional_discount_percentage} %)</div>\n\t\t\t\t\t\t<div>${format_currency(doc.discount_amount, doc.currency)}</div>\n\t\t\t\t\t</div>`;\n\t\t} else {\n\t\t\treturn ``;\n\t\t}\n\t}\n\n\tget_net_total_html(doc) {\n\t\treturn `<div class=\"summary-row-wrapper\">\n\t\t\t\t\t<div>${__('Net Total')}</div>\n\t\t\t\t\t<div>${format_currency(doc.net_total, doc.currency)}</div>\n\t\t\t\t</div>`;\n\t}\n\n\tget_taxes_html(doc) {\n\t\tif (!doc.taxes.length) return '';\n\n\t\tlet taxes_html = doc.taxes.map(t => {\n\t\t\tconst description = /[0-9]+/.test(t.description) ? t.description : `${t.description} @ ${t.rate}%`;\n\t\t\treturn `\n\t\t\t\t<div class=\"tax-row\">\n\t\t\t\t\t<div class=\"tax-label\">${description}</div>\n\t\t\t\t\t<div class=\"tax-value\">${format_currency(t.tax_amount_after_discount_amount, doc.currency)}</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}).join('');\n\n\t\treturn `<div class=\"taxes-wrapper\">${taxes_html}</div>`;\n\t}\n\n\tget_grand_total_html(doc) {\n\t\treturn `<div class=\"summary-row-wrapper grand-total\">\n\t\t\t\t\t<div>${__('Grand Total')}</div>\n\t\t\t\t\t<div>${format_currency(doc.grand_total, doc.currency)}</div>\n\t\t\t\t</div>`;\n\t}\n\n\tget_payment_html(doc, payment) {\n\t\treturn `<div class=\"summary-row-wrapper payments\">\n\t\t\t\t\t<div>${__(payment.mode_of_payment)}</div>\n\t\t\t\t\t<div>${format_currency(payment.amount, doc.currency)}</div>\n\t\t\t\t</div>`;\n\t}\n\n\tbind_events() {\n\t\tthis.$summary_container.on('click', '.return-btn', () => {\n\t\t\tthis.events.process_return(this.doc.name);\n\t\t\tthis.toggle_component(false);\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'flex');\n\t\t\tthis.$summary_wrapper.css('display', 'none');\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.edit-btn', () => {\n\t\t\tthis.events.edit_order(this.doc.name);\n\t\t\tthis.toggle_component(false);\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'flex');\n\t\t\tthis.$summary_wrapper.css('display', 'none');\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.delete-btn', () => {\n\t\t\tthis.events.delete_order(this.doc.name);\n\t\t\tthis.show_summary_placeholder();\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.delete-btn', () => {\n\t\t\tthis.events.delete_order(this.doc.name);\n\t\t\tthis.show_summary_placeholder();\n\t\t\t// this.toggle_component(false);\n\t\t\t// this.$component.find('.no-summary-placeholder').removeClass('d-none');\n\t\t\t// this.$summary_wrapper.addClass('d-none');\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.new-btn', () => {\n\t\t\tthis.events.new_order();\n\t\t\tthis.toggle_component(false);\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'flex');\n\t\t\tthis.$summary_wrapper.css('display', 'none');\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.email-btn', () => {\n\t\t\tthis.email_dialog.fields_dict.email_id.set_value(this.customer_email);\n\t\t\tthis.email_dialog.show();\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.print-btn', () => {\n\t\t\tthis.print_receipt();\n\t\t});\n\t}\n\n\tprint_receipt() {\n\t\tconst frm = this.events.get_frm();\n\t\tfrappe.utils.print(\n\t\t\tthis.doc.doctype,\n\t\t\tthis.doc.name,\n\t\t\tfrm.pos_print_format,\n\t\t\tthis.doc.letter_head,\n\t\t\tthis.doc.language || frappe.boot.lang\n\t\t);\n\t}\n\n\tattach_shortcuts() {\n\t\tconst ctrl_label = frappe.utils.is_mac() ? '\u2318' : 'Ctrl';\n\t\tthis.$summary_container.find('.print-btn').attr(\"title\", `${ctrl_label}+P`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+p\",\n\t\t\taction: () => this.$summary_container.find('.print-btn').click(),\n\t\t\tcondition: () => this.$component.is(':visible') && this.$summary_container.find('.print-btn').is(\":visible\"),\n\t\t\tdescription: __(\"Print Receipt\"),\n\t\t\tpage: cur_page.page.page\n\t\t});\n\t\tthis.$summary_container.find('.new-btn').attr(\"title\", `${ctrl_label}+Enter`);\n\t\tfrappe.ui.keys.on(\"ctrl+enter\", () => {\n\t\t\tconst summary_is_visible = this.$component.is(\":visible\");\n\t\t\tif (summary_is_visible && this.$summary_container.find('.new-btn').is(\":visible\")) {\n\t\t\t\tthis.$summary_container.find('.new-btn').click();\n\t\t\t}\n\t\t});\n\t\tthis.$summary_container.find('.edit-btn').attr(\"title\", `${ctrl_label}+E`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+e\",\n\t\t\taction: () => this.$summary_container.find('.edit-btn').click(),\n\t\t\tcondition: () => this.$component.is(':visible') && this.$summary_container.find('.edit-btn').is(\":visible\"),\n\t\t\tdescription: __(\"Edit Receipt\"),\n\t\t\tpage: cur_page.page.page\n\t\t});\n\t}\n\n\tsend_email() {\n\t\tconst frm = this.events.get_frm();\n\t\tconst recipients = this.email_dialog.get_values().email_id;\n\t\tconst doc = this.doc || frm.doc;\n\t\tconst print_format = frm.pos_print_format;\n\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.core.doctype.communication.email.make\",\n\t\t\targs: {\n\t\t\t\trecipients: recipients,\n\t\t\t\tsubject: __(frm.meta.name) + ': ' + doc.name,\n\t\t\t\tdoctype: doc.doctype,\n\t\t\t\tname: doc.name,\n\t\t\t\tsend_email: 1,\n\t\t\t\tprint_format,\n\t\t\t\tsender_full_name: frappe.user.full_name(),\n\t\t\t\t_lang: doc.language\n\t\t\t},\n\t\t\tcallback: r => {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tfrappe.utils.play_sound(\"email\");\n\t\t\t\t\tif (r.message[\"emails_not_sent_to\"]) {\n\t\t\t\t\t\tfrappe.msgprint(__(\n\t\t\t\t\t\t\t\"Email not sent to {0} (unsubscribed / disabled)\",\n\t\t\t\t\t\t\t[ frappe.utils.escape_html(r.message[\"emails_not_sent_to\"]) ]\n\t\t\t\t\t\t));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __('Email sent successfully.'),\n\t\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tthis.email_dialog.hide();\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.msgprint(__(\"There were errors while sending email. Please try again.\"));\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tadd_summary_btns(map) {\n\t\tthis.$summary_btns.html('');\n\t\tmap.forEach(m => {\n\t\t\tif (m.condition) {\n\t\t\t\tm.visible_btns.forEach(b => {\n\t\t\t\t\tconst class_name = b.split(' ')[0].toLowerCase();\n\t\t\t\t\tconst btn = __(b);\n\t\t\t\t\tthis.$summary_btns.append(\n\t\t\t\t\t\t`<div class=\"summary-btn btn btn-default ${class_name}-btn\">${btn}</div>`\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tthis.$summary_btns.children().last().removeClass('mr-4');\n\t}\n\n\ttoggle_summary_placeholder(show) {\n\t\tif (show) {\n\t\t\tthis.$summary_wrapper.css('display', 'none');\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'flex');\n\t\t} else {\n\t\t\tthis.$summary_wrapper.css('display', 'flex');\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'none');\n\t\t}\n\t}\n\n\tget_condition_btn_map(after_submission) {\n\t\tif (after_submission)\n\t\t\treturn [{ condition: true, visible_btns: ['Print Receipt', 'Email Receipt', 'New Order'] }];\n\n\t\treturn [\n\t\t\t{ condition: this.doc.docstatus === 0, visible_btns: ['Edit Order', 'Delete Order'] },\n\t\t\t{ condition: !this.doc.is_return && this.doc.docstatus === 1, visible_btns: ['Print Receipt', 'Email Receipt', 'Return']},\n\t\t\t{ condition: this.doc.is_return && this.doc.docstatus === 1, visible_btns: ['Print Receipt', 'Email Receipt']}\n\t\t];\n\t}\n\n\tload_summary_of(doc, after_submission=false) {\n\t\tafter_submission ?\n\t\t\tthis.$component.css('grid-column', 'span 10 / span 10') :\n\t\t\tthis.$component.css('grid-column', 'span 6 / span 6');\n\n\t\tthis.toggle_summary_placeholder(false);\n\n\t\tthis.doc = doc;\n\n\t\tthis.attach_document_info(doc);\n\n\t\tthis.attach_items_info(doc);\n\n\t\tthis.attach_totals_info(doc);\n\n\t\tthis.attach_payments_info(doc);\n\n\t\tconst condition_btns_map = this.get_condition_btn_map(after_submission);\n\n\t\tthis.add_summary_btns(condition_btns_map);\n\t}\n\n\tattach_document_info(doc) {\n\t\tfrappe.db.get_value('Customer', this.doc.customer, 'email_id').then(({ message }) => {\n\t\t\tthis.customer_email = message.email_id || '';\n\t\t\tconst upper_section_dom = this.get_upper_section_html(doc);\n\t\t\tthis.$upper_section.html(upper_section_dom);\n\t\t});\n\t}\n\n\tattach_items_info(doc) {\n\t\tthis.$items_container.html('');\n\t\tdoc.items.forEach(item => {\n\t\t\tconst item_dom = this.get_item_html(doc, item);\n\t\t\tthis.$items_container.append(item_dom);\n\t\t\tthis.set_dynamic_rate_header_width();\n\t\t});\n\t}\n\n\tset_dynamic_rate_header_width() {\n\t\tconst rate_cols = Array.from(this.$items_container.find(\".item-rate-disc\"));\n\t\tthis.$items_container.find(\".item-rate-disc\").css(\"width\", \"\");\n\t\tlet max_width = rate_cols.reduce((max_width, elm) => {\n\t\t\tif ($(elm).width() > max_width)\n\t\t\t\tmax_width = $(elm).width();\n\t\t\treturn max_width;\n\t\t}, 0);\n\n\t\tmax_width += 1;\n\t\tif (max_width == 1) max_width = \"\";\n\n\t\tthis.$items_container.find(\".item-rate-disc\").css(\"width\", max_width);\n\t}\n\n\tattach_payments_info(doc) {\n\t\tthis.$payment_container.html('');\n\t\tdoc.payments.forEach(p => {\n\t\t\tif (p.amount) {\n\t\t\t\tconst payment_dom = this.get_payment_html(doc, p);\n\t\t\t\tthis.$payment_container.append(payment_dom);\n\t\t\t}\n\t\t});\n\t\tif (doc.redeem_loyalty_points && doc.loyalty_amount) {\n\t\t\tconst payment_dom = this.get_payment_html(doc, {\n\t\t\t\tmode_of_payment: 'Loyalty Points',\n\t\t\t\tamount: doc.loyalty_amount,\n\t\t\t});\n\t\t\tthis.$payment_container.append(payment_dom);\n\t\t}\n\t}\n\n\tattach_totals_info(doc) {\n\t\tthis.$totals_container.html('');\n\n\t\tconst net_total_dom = this.get_net_total_html(doc);\n\t\tconst taxes_dom = this.get_taxes_html(doc);\n\t\tconst discount_dom = this.get_discount_html(doc);\n\t\tconst grand_total_dom = this.get_grand_total_html(doc);\n\t\tthis.$totals_container.append(net_total_dom);\n\t\tthis.$totals_container.append(taxes_dom);\n\t\tthis.$totals_container.append(discount_dom);\n\t\tthis.$totals_container.append(grand_total_dom);\n\t}\n\n\ttoggle_component(show) {\n\t\tshow ? this.$component.css('display', 'flex') : this.$component.css('display', 'none');\n\t}\n};\n", "erpnext.PointOfSale.PastOrderSummary = class extends erpnext.PointOfSale.PastOrderSummary{\n\tbind_events() {\n\t\tthis.$summary_container.on('click', '.return-btn', () => {\n\t\t\tthis.events.process_return(this.doc.name);\n\t\t\tthis.toggle_component(false);\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'flex');\n\t\t\tthis.$summary_wrapper.css('display', 'none');\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.edit-btn', () => {\n\t\t\tthis.events.edit_order(this.doc.name);\n\t\t\tthis.toggle_component(false);\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'flex');\n\t\t\tthis.$summary_wrapper.css('display', 'none');\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.delete-btn', () => {\n\t\t\tthis.events.delete_order(this.doc.name);\n\t\t\tthis.show_summary_placeholder();\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.delete-btn', () => {\n\t\t\tthis.events.delete_order(this.doc.name);\n\t\t\tthis.show_summary_placeholder();\n\t\t\t// this.toggle_component(false);\n\t\t\t// this.$component.find('.no-summary-placeholder').removeClass('d-none');\n\t\t\t// this.$summary_wrapper.addClass('d-none');\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.new-btn', () => {\n\t\t\tthis.events.new_order();\n\t\t\tthis.toggle_component(false);\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'flex');\n\t\t\tthis.$summary_wrapper.css('display', 'none');\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.email-btn', () => {\n\t\t\tthis.email_dialog.fields_dict.email_id.set_value(this.customer_email);\n\t\t\tthis.email_dialog.show();\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.print-btn', () => {\n\t\t\tthis.print_receipt();\n\t\t});\n\t\t\n\t\t//For raw print\n\t\tthis.$summary_container.on('click', '.direct-print-btn', () => {\n\t\t\tthis.events.raw_print();\n\t\t});\n\t\t\n\t\tthis.$summary_container.on('click', '.cash-drawer-btn', () => {\n\t\t\tthis.events.open_cash_drawer();\n\t\t});\n\t}\n\t\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"past-order-summary\">\n\t\t\t\t<div class=\"no-summary-placeholder\">\n\t\t\t\t\t${__('Select an invoice to load summary data')}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"invoice-summary-wrapper\">\n\t\t\t\t\t<div class=\"abs-container\">\n\t\t\t\t\t\t<div class=\"upper-section\"></div>\n\t\t\t\t\t\t<div class=\"label\">${__('Items')}</div>\n\t\t\t\t\t\t<div class=\"items-container summary-container\"></div>\n\t\t\t\t\t\t<div class=\"label\">${__('Totals')}</div>\n\t\t\t\t\t\t<div class=\"totals-container summary-container\"></div>\n\t\t\t\t\t\t<div class=\"label\">${__('Payments')}</div>\n\t\t\t\t\t\t<div class=\"payments-container summary-container\"></div>\n\t\t\t\t\t\t<div class=\"summary-btns\"></div>\n\t\t\t\t\t\t<div class=\"raw-btns summary-container\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</section>`\n\t\t);\n\n\t\tthis.$component = this.wrapper.find('.past-order-summary');\n\t\tthis.$summary_wrapper = this.$component.find('.invoice-summary-wrapper');\n\t\tthis.$summary_container = this.$component.find('.abs-container');\n\t\tthis.$upper_section = this.$summary_container.find('.upper-section');\n\t\tthis.$items_container = this.$summary_container.find('.items-container');\n\t\tthis.$totals_container = this.$summary_container.find('.totals-container');\n\t\tthis.$payment_container = this.$summary_container.find('.payments-container');\n\t\tthis.$summary_btns = this.$summary_container.find('.summary-btns');\n\t\tthis.$raw_btns = this.$summary_container.find('.raw-btns');\n\t}\n\t\n\tload_summary_of(doc, after_submission=false) {\n\t\tafter_submission ?\n\t\t\tthis.$component.css('grid-column', 'span 10 / span 10') :\n\t\t\tthis.$component.css('grid-column', 'span 6 / span 6');\n\n\t\tthis.toggle_summary_placeholder(false);\n\n\t\tthis.doc = doc;\n\n\t\tthis.attach_document_info(doc);\n\n\t\tthis.attach_items_info(doc);\n\n\t\tthis.attach_totals_info(doc);\n\n\t\tthis.attach_payments_info(doc);\n\n\t\tconst condition_btns_map = this.get_condition_btn_map(after_submission);\n\n\t\tthis.add_summary_btns(condition_btns_map);\n\t\tthis.add_raw_btns();\n\t}\n\t\n\tadd_raw_btns(){\n\t\tthis.$raw_btns.html('');\n\t\tif(window.enable_raw_print == 1 && window.raw_printer){\n\t\t\tthis.$raw_btns.append(\n\t\t\t\t`<div class=\"summary-btn btn btn-default direct-print-btn\">Direct Print</div>\n\t\t\t\t<div style=\"margin-top: 10px;\" class=\"summary-btn btn btn-default cash-drawer-btn\">Open Cash Drawer</div>`\n\t\t\t);\n\t\t}\n\t\tthis.$raw_btns.children().last().removeClass('mr-4');\n\t}\n};\n", "erpnext.PointOfSale.Controller = class {\n\tconstructor(wrapper) {\n\t\tthis.wrapper = $(wrapper).find('.layout-main-section');\n\t\tthis.page = wrapper.page;\n\n\t\tthis.check_opening_entry();\n\t}\n\n\tfetch_opening_entry() {\n\t\treturn frappe.call(\"erpnext.selling.page.point_of_sale.point_of_sale.check_opening_entry\", { \"user\": frappe.session.user });\n\t}\n\n\tcheck_opening_entry() {\n\t\tthis.fetch_opening_entry().then((r) => {\n\t\t\tif (r.message.length) {\n\t\t\t\t// assuming only one opening voucher is available for the current user\n\t\t\t\tthis.prepare_app_defaults(r.message[0]);\n\t\t\t} else {\n\t\t\t\tthis.create_opening_voucher();\n\t\t\t}\n\t\t});\n\t}\n\n\tcreate_opening_voucher() {\n\t\tconst me = this;\n\t\tconst table_fields = [\n\t\t\t{\n\t\t\t\tfieldname: \"mode_of_payment\", fieldtype: \"Link\",\n\t\t\t\tin_list_view: 1, label: \"Mode of Payment\",\n\t\t\t\toptions: \"Mode of Payment\", reqd: 1\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"opening_amount\", fieldtype: \"Currency\",\n\t\t\t\tin_list_view: 1, label: \"Opening Amount\",\n\t\t\t\toptions: \"company:company_currency\",\n\t\t\t\tchange: function () {\n\t\t\t\t\tdialog.fields_dict.balance_details.df.data.some(d => {\n\t\t\t\t\t\tif (d.idx == this.doc.idx) {\n\t\t\t\t\t\t\td.opening_amount = this.value;\n\t\t\t\t\t\t\tdialog.fields_dict.balance_details.grid.refresh();\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst fetch_pos_payment_methods = () => {\n\t\t\tconst pos_profile = dialog.fields_dict.pos_profile.get_value();\n\t\t\tif (!pos_profile) return;\n\t\t\tfrappe.db.get_doc(\"POS Profile\", pos_profile).then(({ payments }) => {\n\t\t\t\tdialog.fields_dict.balance_details.df.data = [];\n\t\t\t\tpayments.forEach(pay => {\n\t\t\t\t\tconst { mode_of_payment } = pay;\n\t\t\t\t\tdialog.fields_dict.balance_details.df.data.push({ mode_of_payment, opening_amount: '0' });\n\t\t\t\t});\n\t\t\t\tdialog.fields_dict.balance_details.grid.refresh();\n\t\t\t});\n\t\t}\n\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Create POS Opening Entry'),\n\t\t\tstatic: true,\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Link', label: __('Company'), default: frappe.defaults.get_default('company'),\n\t\t\t\t\toptions: 'Company', fieldname: 'company', reqd: 1\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Link', label: __('POS Profile'),\n\t\t\t\t\toptions: 'POS Profile', fieldname: 'pos_profile', reqd: 1,\n\t\t\t\t\tget_query: () => pos_profile_query,\n\t\t\t\t\tonchange: () => fetch_pos_payment_methods()\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: \"balance_details\",\n\t\t\t\t\tfieldtype: \"Table\",\n\t\t\t\t\tlabel: \"Opening Balance Details\",\n\t\t\t\t\tcannot_add_rows: false,\n\t\t\t\t\tin_place_edit: true,\n\t\t\t\t\treqd: 1,\n\t\t\t\t\tdata: [],\n\t\t\t\t\tfields: table_fields\n\t\t\t\t}\n\t\t\t],\n\t\t\tprimary_action: async function({ company, pos_profile, balance_details }) {\n\t\t\t\tif (!balance_details.length) {\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __(\"Please add Mode of payments and opening balance details.\"),\n\t\t\t\t\t\tindicator: 'red'\n\t\t\t\t\t})\n\t\t\t\t\treturn frappe.utils.play_sound(\"error\");\n\t\t\t\t}\n\n\t\t\t\t// filter balance details for empty rows\n\t\t\t\tbalance_details = balance_details.filter(d => d.mode_of_payment);\n\n\t\t\t\tconst method = \"erpnext.selling.page.point_of_sale.point_of_sale.create_opening_voucher\";\n\t\t\t\tconst res = await frappe.call({ method, args: { pos_profile, company, balance_details }, freeze:true });\n\t\t\t\t!res.exc && me.prepare_app_defaults(res.message);\n\t\t\t\tdialog.hide();\n\t\t\t},\n\t\t\tprimary_action_label: __('Submit')\n\t\t});\n\t\tdialog.show();\n\t\tconst pos_profile_query = {\n\t\t\tquery: 'erpnext.accounts.doctype.pos_profile.pos_profile.pos_profile_query',\n\t\t\tfilters: { company: dialog.fields_dict.company.get_value() }\n\t\t};\n\t}\n\n\tasync prepare_app_defaults(data) {\n\t\tthis.pos_opening = data.name;\n\t\tthis.company = data.company;\n\t\tthis.pos_profile = data.pos_profile;\n\t\tthis.pos_opening_time = data.period_start_date;\n\t\tthis.item_stock_map = {};\n\t\tthis.settings = {};\n\n\t\tfrappe.db.get_value('Stock Settings', undefined, 'allow_negative_stock').then(({ message }) => {\n\t\t\tthis.allow_negative_stock = flt(message.allow_negative_stock) || false;\n\t\t});\n\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.selling.page.point_of_sale.point_of_sale.get_pos_profile_data\",\n\t\t\targs: { \"pos_profile\": this.pos_profile },\n\t\t\tcallback: (res) => {\n\t\t\t\tconst profile = res.message;\n\t\t\t\tObject.assign(this.settings, profile);\n\t\t\t\tthis.settings.customer_groups = profile.customer_groups.map(group => group.name);\n\t\t\t\tthis.make_app();\n\t\t\t}\n\t\t});\n\t}\n\n\tset_opening_entry_status() {\n\t\tthis.page.set_title_sub(\n\t\t\t`<span class=\"indicator orange\">\n\t\t\t\t<a class=\"text-muted\" href=\"#Form/POS%20Opening%20Entry/${this.pos_opening}\">\n\t\t\t\t\tOpened at ${moment(this.pos_opening_time).format(\"Do MMMM, h:mma\")}\n\t\t\t\t</a>\n\t\t\t</span>`);\n\t}\n\n\tmake_app() {\n\t\tthis.prepare_dom();\n\t\tthis.prepare_components();\n\t\tthis.prepare_menu();\n\t\tthis.make_new_invoice();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<div class=\"point-of-sale-app\"></div>`\n\t\t);\n\n\t\tthis.$components_wrapper = this.wrapper.find('.point-of-sale-app');\n\t}\n\n\tprepare_components() {\n\t\tthis.init_item_selector();\n\t\tthis.init_item_details();\n\t\tthis.init_item_cart();\n\t\tthis.init_payments();\n\t\tthis.init_recent_order_list();\n\t\tthis.init_order_summary();\n\t}\n\n\tprepare_menu() {\n\t\tthis.page.clear_menu();\n\n\t\tthis.page.add_menu_item(__(\"Open Form View\"), this.open_form_view.bind(this), false, 'Ctrl+F');\n\n\t\tthis.page.add_menu_item(__(\"Toggle Recent Orders\"), this.toggle_recent_order.bind(this), false, 'Ctrl+O');\n\n\t\tthis.page.add_menu_item(__(\"Save as Draft\"), this.save_draft_invoice.bind(this), false, 'Ctrl+S');\n\n\t\tthis.page.add_menu_item(__('Close the POS'), this.close_pos.bind(this), false, 'Shift+Ctrl+C');\n\t}\n\n\topen_form_view() {\n\t\tfrappe.model.sync(this.frm.doc);\n\t\tfrappe.set_route(\"Form\", this.frm.doc.doctype, this.frm.doc.name);\n\t}\n\n\ttoggle_recent_order() {\n\t\tconst show = this.recent_order_list.$component.is(':hidden');\n\t\tthis.toggle_recent_order_list(show);\n\t}\n\n\tsave_draft_invoice() {\n\t\tif (!this.$components_wrapper.is(\":visible\")) return;\n\n\t\tif (this.frm.doc.items.length == 0) {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"You must add atleast one item to save it as draft.\"),\n\t\t\t\tindicator:'red'\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\treturn;\n\t\t}\n\n\t\tthis.frm.save(undefined, undefined, undefined, () => {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"There was an error saving the document.\"),\n\t\t\t\tindicator: 'red'\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t}).then(() => {\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => frappe.dom.freeze(),\n\t\t\t\t() => this.make_new_invoice(),\n\t\t\t\t() => frappe.dom.unfreeze(),\n\t\t\t]);\n\t\t});\n\t}\n\n\tclose_pos() {\n\t\tif (!this.$components_wrapper.is(\":visible\")) return;\n\n\t\tlet voucher = frappe.model.get_new_doc('POS Closing Entry');\n\t\tvoucher.pos_profile = this.frm.doc.pos_profile;\n\t\tvoucher.user = frappe.session.user;\n\t\tvoucher.company = this.frm.doc.company;\n\t\tvoucher.pos_opening_entry = this.pos_opening;\n\t\tvoucher.period_end_date = frappe.datetime.now_datetime();\n\t\tvoucher.posting_date = frappe.datetime.now_date();\n\t\tfrappe.set_route('Form', 'POS Closing Entry', voucher.name);\n\t}\n\n\tinit_item_selector() {\n\t\tthis.item_selector = new erpnext.PointOfSale.ItemSelector({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tpos_profile: this.pos_profile,\n\t\t\tsettings: this.settings,\n\t\t\tevents: {\n\t\t\t\titem_selected: args => this.on_cart_update(args),\n\n\t\t\t\tget_frm: () => this.frm || {}\n\t\t\t}\n\t\t})\n\t}\n\n\tinit_item_cart() {\n\t\tthis.cart = new erpnext.PointOfSale.ItemCart({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tsettings: this.settings,\n\t\t\tevents: {\n\t\t\t\tget_frm: () => this.frm,\n\n\t\t\t\tcart_item_clicked: (item) => {\n\t\t\t\t\tconst item_row = this.get_item_from_frm(item);\n\t\t\t\t\tthis.item_details.toggle_item_details_section(item_row);\n\t\t\t\t},\n\n\t\t\t\tnumpad_event: (value, action) => this.update_item_field(value, action),\n\n\t\t\t\tcheckout: () => this.save_and_checkout(),\n\n\t\t\t\tedit_cart: () => this.payment.edit_cart(),\n\n\t\t\t\tcustomer_details_updated: (details) => {\n\t\t\t\t\tthis.customer_details = details;\n\t\t\t\t\t// will add/remove LP payment method\n\t\t\t\t\tthis.payment.render_loyalty_points_payment_mode();\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\tinit_item_details() {\n\t\tthis.item_details = new erpnext.PointOfSale.ItemDetails({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tsettings: this.settings,\n\t\t\tevents: {\n\t\t\t\tget_frm: () => this.frm,\n\n\t\t\t\ttoggle_item_selector: (minimize) => {\n\t\t\t\t\tthis.item_selector.resize_selector(minimize);\n\t\t\t\t\tthis.cart.toggle_numpad(minimize);\n\t\t\t\t},\n\n\t\t\t\tform_updated: (item, field, value) => {\n\t\t\t\t\tconst item_row = frappe.model.get_doc(item.doctype, item.name);\n\t\t\t\t\tif (item_row && item_row[field] != value) {\n\t\t\t\t\t\tconst args = {\n\t\t\t\t\t\t\tfield,\n\t\t\t\t\t\t\tvalue,\n\t\t\t\t\t\t\titem: this.item_details.current_item\n\t\t\t\t\t\t};\n\t\t\t\t\t\treturn this.on_cart_update(args);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t},\n\n\t\t\t\thighlight_cart_item: (item) => {\n\t\t\t\t\tconst cart_item = this.cart.get_cart_item(item);\n\t\t\t\t\tthis.cart.toggle_item_highlight(cart_item);\n\t\t\t\t},\n\n\t\t\t\titem_field_focused: (fieldname) => {\n\t\t\t\t\tthis.cart.toggle_numpad_field_edit(fieldname);\n\t\t\t\t},\n\t\t\t\tset_value_in_current_cart_item: (selector, value) => {\n\t\t\t\t\tthis.cart.update_selector_value_in_cart_item(selector, value, this.item_details.current_item);\n\t\t\t\t},\n\t\t\t\tclone_new_batch_item_in_frm: (batch_serial_map, item) => {\n\t\t\t\t\t// called if serial nos are 'auto_selected' and if those serial nos belongs to multiple batches\n\t\t\t\t\t// for each unique batch new item row is added in the form & cart\n\t\t\t\t\tObject.keys(batch_serial_map).forEach(batch => {\n\t\t\t\t\t\tconst item_to_clone = this.frm.doc.items.find(i => i.name == item.name);\n\t\t\t\t\t\tconst new_row = this.frm.add_child(\"items\", { ...item_to_clone });\n\t\t\t\t\t\t// update new serialno and batch\n\t\t\t\t\t\tnew_row.batch_no = batch;\n\t\t\t\t\t\tnew_row.serial_no = batch_serial_map[batch].join(`\\n`);\n\t\t\t\t\t\tnew_row.qty = batch_serial_map[batch].length;\n\t\t\t\t\t\tthis.frm.doc.items.forEach(row => {\n\t\t\t\t\t\t\tif (item.item_code === row.item_code) {\n\t\t\t\t\t\t\t\tthis.update_cart_html(row);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\tremove_item_from_cart: () => this.remove_item_from_cart(),\n\t\t\t\tget_item_stock_map: () => this.item_stock_map,\n\t\t\t\tclose_item_details: () => {\n\t\t\t\t\tthis.item_details.toggle_item_details_section(null);\n\t\t\t\t\tthis.cart.prev_action = null;\n\t\t\t\t\tthis.cart.toggle_item_highlight();\n\t\t\t\t},\n\t\t\t\tget_available_stock: (item_code, warehouse) => this.get_available_stock(item_code, warehouse)\n\t\t\t}\n\t\t});\n\t}\n\n\tinit_payments() {\n\t\tthis.payment = new erpnext.PointOfSale.Payment({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tevents: {\n\t\t\t\tget_frm: () => this.frm || {},\n\n\t\t\t\tget_customer_details: () => this.customer_details || {},\n\n\t\t\t\ttoggle_other_sections: (show) => {\n\t\t\t\t\tif (show) {\n\t\t\t\t\t\tthis.item_details.$component.is(':visible') ? this.item_details.$component.css('display', 'none') : '';\n\t\t\t\t\t\tthis.item_selector.toggle_component(false);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.item_selector.toggle_component(true);\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tsubmit_invoice: () => {\n\t\t\t\t\tthis.frm.savesubmit()\n\t\t\t\t\t\t.then((r) => {\n\t\t\t\t\t\t\tthis.toggle_components(false);\n\t\t\t\t\t\t\tthis.order_summary.toggle_component(true);\n\t\t\t\t\t\t\tthis.order_summary.load_summary_of(this.frm.doc, true);\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tindicator: 'green',\n\t\t\t\t\t\t\t\tmessage: __('POS invoice {0} created succesfully', [r.doc.name])\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tinit_recent_order_list() {\n\t\tthis.recent_order_list = new erpnext.PointOfSale.PastOrderList({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tevents: {\n\t\t\t\topen_invoice_data: (name) => {\n\t\t\t\t\tfrappe.db.get_doc('POS Invoice', name).then((doc) => {\n\t\t\t\t\t\tthis.order_summary.load_summary_of(doc);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\treset_summary: () => this.order_summary.toggle_summary_placeholder(true)\n\t\t\t}\n\t\t})\n\t}\n\n\tinit_order_summary() {\n\t\tthis.order_summary = new erpnext.PointOfSale.PastOrderSummary({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tevents: {\n\t\t\t\tget_frm: () => this.frm,\n\n\t\t\t\tprocess_return: (name) => {\n\t\t\t\t\tthis.recent_order_list.toggle_component(false);\n\t\t\t\t\tfrappe.db.get_doc('POS Invoice', name).then((doc) => {\n\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t() => this.make_return_invoice(doc),\n\t\t\t\t\t\t\t() => this.cart.load_invoice(),\n\t\t\t\t\t\t\t() => this.item_selector.toggle_component(true)\n\t\t\t\t\t\t]);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tedit_order: (name) => {\n\t\t\t\t\tthis.recent_order_list.toggle_component(false);\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => this.frm.refresh(name),\n\t\t\t\t\t\t() => this.frm.call('reset_mode_of_payments'),\n\t\t\t\t\t\t() => this.cart.load_invoice(),\n\t\t\t\t\t\t() => this.item_selector.toggle_component(true)\n\t\t\t\t\t]);\n\t\t\t\t},\n\t\t\t\tdelete_order: (name) => {\n\t\t\t\t\tfrappe.model.delete_doc(this.frm.doc.doctype, name, () => {\n\t\t\t\t\t\tthis.recent_order_list.refresh_list();\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tnew_order: () => {\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => frappe.dom.freeze(),\n\t\t\t\t\t\t() => this.make_new_invoice(),\n\t\t\t\t\t\t() => this.item_selector.toggle_component(true),\n\t\t\t\t\t\t() => frappe.dom.unfreeze(),\n\t\t\t\t\t]);\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\ttoggle_recent_order_list(show) {\n\t\tthis.toggle_components(!show);\n\t\tthis.recent_order_list.toggle_component(show);\n\t\tthis.order_summary.toggle_component(show);\n\t}\n\n\ttoggle_components(show) {\n\t\tthis.cart.toggle_component(show);\n\t\tthis.item_selector.toggle_component(show);\n\n\t\t// do not show item details or payment if recent order is toggled off\n\t\t!show ? (this.item_details.toggle_component(false) || this.payment.toggle_component(false)) : '';\n\t}\n\n\tmake_new_invoice() {\n\t\treturn frappe.run_serially([\n\t\t\t() => frappe.dom.freeze(),\n\t\t\t() => this.make_sales_invoice_frm(),\n\t\t\t() => this.set_pos_profile_data(),\n\t\t\t() => this.set_pos_profile_status(),\n\t\t\t() => this.cart.load_invoice(),\n\t\t\t() => frappe.dom.unfreeze()\n\t\t]);\n\t}\n\n\tmake_sales_invoice_frm() {\n\t\tconst doctype = 'POS Invoice';\n\t\treturn new Promise(resolve => {\n\t\t\tif (this.frm) {\n\t\t\t\tthis.frm = this.get_new_frm(this.frm);\n\t\t\t\tthis.frm.doc.items = [];\n\t\t\t\tthis.frm.doc.is_pos = 1\n\t\t\t\tresolve();\n\t\t\t} else {\n\t\t\t\tfrappe.model.with_doctype(doctype, () => {\n\t\t\t\t\tthis.frm = this.get_new_frm();\n\t\t\t\t\tthis.frm.doc.items = [];\n\t\t\t\t\tthis.frm.doc.is_pos = 1\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tget_new_frm(_frm) {\n\t\tconst doctype = 'POS Invoice';\n\t\tconst page = $('<div>');\n\t\tconst frm = _frm || new frappe.ui.form.Form(doctype, page, false);\n\t\tconst name = frappe.model.make_new_doc_and_get_name(doctype, true);\n\t\tfrm.refresh(name);\n\n\t\treturn frm;\n\t}\n\n\tasync make_return_invoice(doc) {\n\t\tfrappe.dom.freeze();\n\t\tthis.frm = this.get_new_frm(this.frm);\n\t\tthis.frm.doc.items = [];\n\t\treturn frappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.pos_invoice.pos_invoice.make_sales_return\",\n\t\t\targs: {\n\t\t\t\t'source_name': doc.name,\n\t\t\t\t'target_doc': this.frm.doc\n\t\t\t},\n\t\t\tcallback: (r) => {\n\t\t\t\tfrappe.model.sync(r.message);\n\t\t\t\tfrappe.get_doc(r.message.doctype, r.message.name).__run_link_triggers = false;\n\t\t\t\tthis.set_pos_profile_data().then(() => {\n\t\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tset_pos_profile_data() {\n\t\tif (this.company && !this.frm.doc.company) this.frm.doc.company = this.company;\n\t\tif ((this.pos_profile && !this.frm.doc.pos_profile) | (this.frm.doc.is_return && this.pos_profile != this.frm.doc.pos_profile)) {\n\t\t\tthis.frm.doc.pos_profile = this.pos_profile;\n\t\t}\n\n\t\tif (!this.frm.doc.company) return;\n\n\t\treturn this.frm.trigger(\"set_pos_data\");\n\t}\n\n\tset_pos_profile_status() {\n\t\tthis.page.set_indicator(this.pos_profile, \"blue\");\n\t}\n\n\tasync on_cart_update(args) {\n\t\tfrappe.dom.freeze();\n\t\tlet item_row = undefined;\n\t\ttry {\n\t\t\tlet { field, value, item } = args;\n\t\t\titem_row = this.get_item_from_frm(item);\n\t\t\tconst item_row_exists = !$.isEmptyObject(item_row);\n\n\t\t\tconst from_selector = field === 'qty' && value === \"+1\";\n\t\t\tif (from_selector)\n\t\t\t\tvalue = flt(item_row.qty) + flt(value);\n\n\t\t\tif (item_row_exists) {\n\t\t\t\tif (field === 'qty')\n\t\t\t\t\tvalue = flt(value);\n\n\t\t\t\tif (['qty', 'conversion_factor'].includes(field) && value > 0 && !this.allow_negative_stock) {\n\t\t\t\t\tconst qty_needed = field === 'qty' ? value * item_row.conversion_factor : item_row.qty * value;\n\t\t\t\t\tawait this.check_stock_availability(item_row, qty_needed, this.frm.doc.set_warehouse);\n\t\t\t\t}\n\n\t\t\t\tif (this.is_current_item_being_edited(item_row) || from_selector) {\n\t\t\t\t\tawait frappe.model.set_value(item_row.doctype, item_row.name, field, value);\n\t\t\t\t\tthis.update_cart_html(item_row);\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tif (!this.frm.doc.customer)\n\t\t\t\t\treturn this.raise_customer_selection_alert();\n\n\t\t\t\tconst { item_code, batch_no, serial_no, rate } = item;\n\n\t\t\t\tif (!item_code)\n\t\t\t\t\treturn;\n\n\t\t\t\tconst new_item = { item_code, batch_no, rate, [field]: value };\n\n\t\t\t\tif (serial_no) {\n\t\t\t\t\tawait this.check_serial_no_availablilty(item_code, this.frm.doc.set_warehouse, serial_no);\n\t\t\t\t\tnew_item['serial_no'] = serial_no;\n\t\t\t\t}\n\n\t\t\t\tif (field === 'serial_no')\n\t\t\t\t\tnew_item['qty'] = value.split(`\\n`).length || 0;\n\n\t\t\t\titem_row = this.frm.add_child('items', new_item);\n\n\t\t\t\tif (field === 'qty' && value !== 0 && !this.allow_negative_stock)\n\t\t\t\t\tawait this.check_stock_availability(item_row, value, this.frm.doc.set_warehouse);\n\n\t\t\t\tawait this.trigger_new_item_events(item_row);\n\n\t\t\t\tthis.update_cart_html(item_row);\n\n\t\t\t\tif (this.item_details.$component.is(':visible'))\n\t\t\t\t\tthis.edit_item_details_of(item_row);\n\n\t\t\t\tif (this.check_serial_batch_selection_needed(item_row) && !this.item_details.$component.is(':visible'))\n\t\t\t\t\tthis.edit_item_details_of(item_row);\n\t\t\t}\n\n\t\t} catch (error) {\n\t\t\tconsole.log(error);\n\t\t} finally {\n\t\t\tfrappe.dom.unfreeze();\n\t\t\treturn item_row;\n\t\t}\n\t}\n\n\traise_customer_selection_alert() {\n\t\tfrappe.dom.unfreeze();\n\t\tfrappe.show_alert({\n\t\t\tmessage: __('You must select a customer before adding an item.'),\n\t\t\tindicator: 'orange'\n\t\t});\n\t\tfrappe.utils.play_sound(\"error\");\n\t}\n\n\tget_item_from_frm({ name, item_code, batch_no, uom, rate }) {\n\t\tlet item_row = null;\n\t\tif (name) {\n\t\t\titem_row = this.frm.doc.items.find(i => i.name == name);\n\t\t} else {\n\t\t\t// if item is clicked twice from item selector\n\t\t\t// then \"item_code, batch_no, uom, rate\" will help in getting the exact item\n\t\t\t// to increase the qty by one\n\t\t\tconst has_batch_no = batch_no;\n\t\t\titem_row = this.frm.doc.items.find(\n\t\t\t\ti => i.item_code === item_code\n\t\t\t\t\t&& (!has_batch_no || (has_batch_no && i.batch_no === batch_no))\n\t\t\t\t\t&& (i.uom === uom)\n\t\t\t\t\t&& (i.rate == rate)\n\t\t\t);\n\t\t}\n\n\t\treturn item_row || {};\n\t}\n\n\tedit_item_details_of(item_row) {\n\t\tthis.item_details.toggle_item_details_section(item_row);\n\t}\n\n\tis_current_item_being_edited(item_row) {\n\t\treturn item_row.name == this.item_details.current_item.name;\n\t}\n\n\tupdate_cart_html(item_row, remove_item) {\n\t\tthis.cart.update_item_html(item_row, remove_item);\n\t\tthis.cart.update_totals_section(this.frm);\n\t}\n\n\tcheck_serial_batch_selection_needed(item_row) {\n\t\t// right now item details is shown for every type of item.\n\t\t// if item details is not shown for every item then this fn will be needed\n\t\tconst serialized = item_row.has_serial_no;\n\t\tconst batched = item_row.has_batch_no;\n\t\tconst no_serial_selected = !item_row.serial_no;\n\t\tconst no_batch_selected = !item_row.batch_no;\n\n\t\tif ((serialized && no_serial_selected) || (batched && no_batch_selected) ||\n\t\t\t(serialized && batched && (no_batch_selected || no_serial_selected))) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tasync trigger_new_item_events(item_row) {\n\t\tawait this.frm.script_manager.trigger('item_code', item_row.doctype, item_row.name);\n\t\tawait this.frm.script_manager.trigger('qty', item_row.doctype, item_row.name);\n\t}\n\n\tasync check_stock_availability(item_row, qty_needed, warehouse) {\n\t\tconst resp = (await this.get_available_stock(item_row.item_code, warehouse)).message;\n\t\tconst available_qty = resp[0];\n\t\tconst is_stock_item = resp[1];\n\n\t\tfrappe.dom.unfreeze();\n\t\tconst bold_item_code = item_row.item_code.bold();\n\t\tconst bold_warehouse = warehouse.bold();\n\t\tconst bold_available_qty = available_qty.toString().bold()\n\t\tif (!(available_qty > 0)) {\n\t\t\tif (is_stock_item) {\n\t\t\t\tfrappe.model.clear_doc(item_row.doctype, item_row.name);\n\t\t\t\tfrappe.throw({\n\t\t\t\t\ttitle: __(\"Not Available\"),\n\t\t\t\t\tmessage: __('Item Code: {0} is not available under warehouse {1}.', [bold_item_code, bold_warehouse])\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\t\t} else if (available_qty < qty_needed) {\n\t\t\tfrappe.throw({\n\t\t\t\tmessage: __('Stock quantity not enough for Item Code: {0} under warehouse {1}. Available quantity {2}.', [bold_item_code, bold_warehouse, bold_available_qty]),\n\t\t\t\tindicator: 'orange'\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t}\n\t\tfrappe.dom.freeze();\n\t}\n\n\tasync check_serial_no_availablilty(item_code, warehouse, serial_no) {\n\t\tconst method = \"erpnext.stock.doctype.serial_no.serial_no.get_pos_reserved_serial_nos\";\n\t\tconst args = {filters: { item_code, warehouse }}\n\t\tconst res = await frappe.call({ method, args });\n\n\t\tif (res.message.includes(serial_no)) {\n\t\t\tfrappe.throw({\n\t\t\t\ttitle: __(\"Not Available\"),\n\t\t\t\tmessage: __('Serial No: {0} has already been transacted into another POS Invoice.', [serial_no.bold()])\n\t\t\t});\n\t\t}\n\t}\n\n\tget_available_stock(item_code, warehouse) {\n\t\tconst me = this;\n\t\treturn frappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.pos_invoice.pos_invoice.get_stock_availability\",\n\t\t\targs: {\n\t\t\t\t'item_code': item_code,\n\t\t\t\t'warehouse': warehouse,\n\t\t\t},\n\t\t\tcallback(res) {\n\t\t\t\tif (!me.item_stock_map[item_code])\n\t\t\t\t\tme.item_stock_map[item_code] = {};\n\t\t\t\tme.item_stock_map[item_code][warehouse] = res.message[0];\n\t\t\t}\n\t\t});\n\t}\n\n\tupdate_item_field(value, field_or_action) {\n\t\tif (field_or_action === 'checkout') {\n\t\t\tthis.item_details.toggle_item_details_section(null);\n\t\t} else if (field_or_action === 'remove') {\n\t\t\tthis.remove_item_from_cart();\n\t\t} else {\n\t\t\tconst field_control = this.item_details[`${field_or_action}_control`];\n\t\t\tif (!field_control) return;\n\t\t\tfield_control.set_focus();\n\t\t\tvalue != \"\" && field_control.set_value(value);\n\t\t}\n\t}\n\n\tremove_item_from_cart() {\n\t\tfrappe.dom.freeze();\n\t\tconst { doctype, name, current_item } = this.item_details;\n\n\t\treturn frappe.model.set_value(doctype, name, 'qty', 0)\n\t\t\t.then(() => {\n\t\t\t\tfrappe.model.clear_doc(doctype, name);\n\t\t\t\tthis.update_cart_html(current_item, true);\n\t\t\t\tthis.item_details.toggle_item_details_section(null);\n\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t})\n\t\t\t.catch(e => console.log(e));\n\t}\n\n\tasync save_and_checkout() {\n\t\tif (this.frm.is_dirty()) {\n\t\t\tlet save_error = false;\n\t\t\tawait this.frm.save(null, null, null, () => save_error = true);\n\t\t\t// only move to payment section if save is successful\n\t\t\t!save_error && this.payment.checkout();\n\t\t\t// show checkout button on error\n\t\t\tsave_error && setTimeout(() => {\n\t\t\t\tthis.cart.toggle_checkout_btn(true);\n\t\t\t}, 300); // wait for save to finish\n\t\t} else {\n\t\t\tthis.payment.checkout();\n\t\t}\n\t}\n};\n", "var writtenNumber = require('written-number');\nerpnext.PointOfSale.Controller = class extends erpnext.PointOfSale.Controller {\n  make_app() {\n    this.prepare_dom();\n    this.prepare_components();\n    this.prepare_menu();\n    this.make_new_invoice();\n    this.init_stripe_terminal();\n  }\n\n  init_stripe_terminal() {\n    if (window.enable_stripe_terminal == 1) {\n      this.stripe = new erpnext.PointOfSale.StripeTerminal();\n      frappe.dom.freeze();\n      //this.stripe.connect_to_stripe_terminal(this, true);\n      this.stripe.assign_stripe_connection_token(this, true);\n      frappe.dom.unfreeze();\n    }\n  }\n\n  init_order_summary() {\n    this.order_summary = new erpnext.PointOfSale.PastOrderSummary({\n      wrapper: this.$components_wrapper,\n      events: {\n        get_frm: () => this.frm,\n\n        process_return: (name) => {\n          this.recent_order_list.toggle_component(false);\n          frappe.db.get_doc('POS Invoice', name).then((doc) => {\n            frappe.run_serially([\n              () => this.make_return_invoice(doc),\n              () => this.cart.load_invoice(),\n              () => this.item_selector.toggle_component(true),\n            ]);\n          });\n        },\n        edit_order: (name) => {\n          this.recent_order_list.toggle_component(false);\n          frappe.run_serially([\n            () => this.frm.refresh(name),\n            () => this.frm.call('reset_mode_of_payments'),\n            () => this.cart.load_invoice(),\n            () => this.item_selector.toggle_component(true),\n          ]);\n        },\n        delete_order: (name) => {\n          frappe.model.delete_doc(this.frm.doc.doctype, name, () => {\n            this.recent_order_list.refresh_list();\n          });\n        },\n        new_order: () => {\n          frappe.run_serially([\n            () => frappe.dom.freeze(),\n            () => this.make_new_invoice(),\n            () => this.item_selector.toggle_component(true),\n            () => frappe.dom.unfreeze(),\n          ]);\n        },\n        raw_print: () => {\n          this.raw_print(this.frm);\n        },\n        open_cash_drawer: () => {\n          this.open_cash_drawer();\n        },\n      },\n    });\n  }\n\n  async prepare_app_defaults(data) {\n    this.pos_opening = data.name;\n    this.company = data.company;\n    this.pos_profile = data.pos_profile;\n    this.pos_opening_time = data.period_start_date;\n    this.item_stock_map = {};\n    this.settings = {};\n    window.tax_templates = [];\n    window.company = {};\n\n    frappe.db\n      .get_value('Stock Settings', undefined, 'allow_negative_stock')\n      .then(({ message }) => {\n        this.allow_negative_stock = flt(message.allow_negative_stock) || false;\n      });\n\n    frappe.db\n      .get_list('Item Tax Template', {\n        filters: { company: this.company },\n        fields: ['name', 'title'],\n      })\n      .then((res) => {\n        window.tax_templates = res;\n      });\n\n    frappe.db.get_doc('Company', this.company).then((res) => {\n      window.company = res;\n    });\n\n    frappe.call({\n      method:\n        'erpnext.selling.page.point_of_sale.point_of_sale.get_pos_profile_data',\n      args: { pos_profile: this.pos_profile },\n      callback: (res) => {\n        const profile = res.message;\n        window.enable_raw_print = profile.enable_raw_printing;\n        window.enable_stripe_terminal = profile.enable_stripe_terminal;\n        window.stripe_mode_of_payment = profile.stripe_mode_of_payment;\n        //Select raw printer\n        if (window.enable_raw_print == 1) {\n          frappe.db.get_doc('QZ Tray Settings', undefined).then((qz_doc) => {\n            if (\n              qz_doc.trusted_certificate != null &&\n              qz_doc.trusted_certificate != '' &&\n              qz_doc.private_certificate != '' &&\n              qz_doc.private_certificate != null\n            ) {\n              frappe.ui.form.qz_init().then(function () {\n                ///// QZ Certificate ///\n                qz.security.setCertificatePromise(function (resolve, reject) {\n                  resolve(qz_doc.trusted_certificate);\n                });\n                qz.security.setSignaturePromise(function (toSign) {\n                  return function (resolve, reject) {\n                    try {\n                      var pk = KEYUTIL.getKey(qz_doc.private_certificate);\n                      //var sig = new KJUR.crypto.Signature({\"alg\": \"SHA512withRSA\"});  // Use \"SHA1withRSA\" for QZ Tray 2.0 and older\n                      var sig = new KJUR.crypto.Signature({\n                        alg: 'SHA1withRSA',\n                      }); // Use \"SHA1withRSA\" for QZ Tray 2.0 and older\n                      sig.init(pk);\n                      sig.updateString(toSign);\n                      var hex = sig.sign();\n                      resolve(stob64(hextorstr(hex)));\n                    } catch (err) {\n                      console.error(err);\n                      reject(err);\n                    }\n                  };\n                });\n              });\n            }\n            var d = new frappe.ui.Dialog({\n              fields: [\n                {\n                  fieldname: 'printer',\n                  fieldtype: 'Select',\n                  reqd: 1,\n                  label: 'Printer',\n                },\n              ],\n              primary_action: function () {\n                window.raw_printer = d.get_values().printer;\n                d.hide();\n              },\n              secondary_action: function () {\n                d.hide();\n              },\n              secondary_action_label: 'Cancel',\n              title: 'Select printer for Raw Printing',\n            });\n            frappe.ui.form.qz_get_printer_list().then((data) => {\n              d.set_df_property('printer', 'options', data);\n              d.show();\n            });\n          });\n        }\n        window.automatically_print = profile.automatically_print;\n        window.open_cash_drawer_automatically =\n          profile.open_cash_drawer_automatically;\n        //For weigh scale\n        window.enable_weigh_scale = profile.enable_weigh_scale;\n        Object.assign(this.settings, profile);\n        this.settings.customer_groups = profile.customer_groups.map(\n          (group) => group.name\n        );\n        this.make_app();\n      },\n    });\n\n    /*frappe.db.get_doc(\"POS Profile\", this.pos_profile).then((profile) => {\n\t\t\twindow.enable_raw_print = profile.enable_raw_printing;\n\t\t\twindow.enable_stripe_terminal = profile.enable_stripe_terminal;\n\t\t\twindow.stripe_mode_of_payment = profile.stripe_mode_of_payment;\n\t\t\t//Select raw printer\n\t\t\tif(window.enable_raw_print == 1){\n\t\t\t\tfrappe.db.get_doc('QZ Tray Settings', undefined).then((qz_doc) => {\n\t\t\t\t\tif(qz_doc.trusted_certificate != null && qz_doc.trusted_certificate != \"\" && qz_doc.private_certificate != \"\" && qz_doc.private_certificate != null){\n\t\t\t\t\t\tfrappe.ui.form.qz_init().then(function(){\n\t\t\t\t\t\t\t///// QZ Certificate ///\n\t\t\t\t\t\t\tqz.security.setCertificatePromise(function(resolve, reject) {\n\t\t\t\t\t\t\t\tresolve(qz_doc.trusted_certificate);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tqz.security.setSignaturePromise(function(toSign) {\n\t\t\t\t\t\t\t\treturn function(resolve, reject) {\n\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\tvar pk = KEYUTIL.getKey(qz_doc.private_certificate);\n\t\t\t\t\t\t\t\t\t\t//var sig = new KJUR.crypto.Signature({\"alg\": \"SHA512withRSA\"});  // Use \"SHA1withRSA\" for QZ Tray 2.0 and older\n\t\t\t\t\t\t\t\t\t\tvar sig = new KJUR.crypto.Signature({\"alg\": \"SHA1withRSA\"});  // Use \"SHA1withRSA\" for QZ Tray 2.0 and older\n\t\t\t\t\t\t\t\t\t\tsig.init(pk); \n\t\t\t\t\t\t\t\t\t\tsig.updateString(toSign);\n\t\t\t\t\t\t\t\t\t\tvar hex = sig.sign();\n\t\t\t\t\t\t\t\t\t\tresolve(stob64(hextorstr(hex)));\n\t\t\t\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t\t\t\tconsole.error(err);\n\t\t\t\t\t\t\t\t\t\treject(err);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t});\t\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tvar d = new frappe.ui.Dialog({\n\t\t\t\t\t\t'fields': [\n\t\t\t\t\t\t\t{'fieldname': 'printer', 'fieldtype': 'Select', 'reqd': 1, 'label': \"Printer\"}\n\t\t\t\t\t\t],\n\t\t\t\t\t\tprimary_action: function(){\n\t\t\t\t\t\t\twindow.raw_printer = d.get_values().printer;\n\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsecondary_action: function(){\n\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsecondary_action_label: \"Cancel\",\n\t\t\t\t\t\t'title': 'Select printer for Raw Printing'\n\t\t\t\t\t});\n\t\t\t\t\tfrappe.ui.form.qz_get_printer_list().then((data) => {\n\t\t\t\t\t\td.set_df_property('printer', 'options', data);\n\t\t\t\t\t\td.show();\n\t\t\t\t\t});\t\n\t\t\t\t});\n\t\t\t}\n\t\t\twindow.automatically_print = profile.automatically_print;\n\t\t\twindow.open_cash_drawer_automatically = profile.open_cash_drawer_automatically;\n\t\t\t//For weigh scale\n\t\t\twindow.enable_weigh_scale = profile.enable_weigh_scale;\n\t\t\tObject.assign(this.settings, profile);\n\t\t\tthis.settings.customer_groups = profile.customer_groups.map(group => group.customer_group);\n\t\t\tthis.make_app();\n\t\t});*/\n  }\n\n  init_item_details() {\n    this.item_details = new erpnext.PointOfSale.ItemDetails({\n      wrapper: this.$components_wrapper,\n      settings: this.settings,\n      events: {\n        get_frm: () => this.frm,\n\n        toggle_item_selector: (minimize) => {\n          this.item_selector.resize_selector(minimize);\n          this.cart.toggle_numpad(minimize);\n        },\n\n        form_updated: (item, field, value) => {\n          const item_row = frappe.model.get_doc(item.doctype, item.name);\n          if (item_row && item_row[field] != value) {\n            const args = {\n              field,\n              value,\n              item: this.item_details.current_item,\n            };\n            return this.on_cart_update(args);\n          }\n\n          return Promise.resolve();\n        },\n\n        highlight_cart_item: (item) => {\n          const cart_item = this.cart.get_cart_item(item);\n          this.cart.toggle_item_highlight(cart_item);\n        },\n\n        item_field_focused: (fieldname) => {\n          this.cart.toggle_numpad_field_edit(fieldname);\n        },\n        set_value_in_current_cart_item: (selector, value) => {\n          this.cart.update_selector_value_in_cart_item(\n            selector,\n            value,\n            this.item_details.current_item\n          );\n        },\n        clone_new_batch_item_in_frm: (batch_serial_map, item) => {\n          // called if serial nos are 'auto_selected' and if those serial nos belongs to multiple batches\n          // for each unique batch new item row is added in the form & cart\n          Object.keys(batch_serial_map).forEach((batch) => {\n            const item_to_clone = this.frm.doc.items.find(\n              (i) => i.name == item.name\n            );\n            const new_row = this.frm.add_child('items', { ...item_to_clone });\n            // update new serialno and batch\n            new_row.batch_no = batch;\n            new_row.serial_no = batch_serial_map[batch].join(`\\n`);\n            new_row.qty = batch_serial_map[batch].length;\n            this.frm.doc.items.forEach((row) => {\n              if (item.item_code === row.item_code) {\n                this.update_cart_html(row);\n              }\n            });\n          });\n        },\n        remove_item_from_cart: () => this.remove_item_from_cart(),\n        get_item_stock_map: () => this.item_stock_map,\n        close_item_details: () => {\n          this.item_details.toggle_item_details_section(null);\n          this.cart.prev_action = null;\n          this.cart.toggle_item_highlight();\n          //For weigh scale\n          if (window.enable_weigh_scale == 1) {\n            window.is_item_details_open = false;\n            window.mettlerWorker.postMessage({ command: 'stop' });\n          }\n        },\n        get_available_stock: (item_code, warehouse) =>\n          this.get_available_stock(item_code, warehouse),\n      },\n    });\n  }\n\n  remove_item_from_cart() {\n    frappe.dom.freeze();\n    const { doctype, name, current_item } = this.item_details;\n\n    return frappe.model\n      .set_value(doctype, name, 'qty', 0)\n      .then(() => {\n        frappe.model.clear_doc(doctype, name);\n        this.update_cart_html(current_item, true);\n        this.item_details.toggle_item_details_section(null);\n        frappe.dom.unfreeze();\n      })\n      .catch((e) => console.log(e));\n\n    //For weigh scale\n    if (window.enable_weigh_scale == 1) {\n      window.is_item_details_open = false;\n    }\n  }\n\n  init_payments() {\n    this.payment = new erpnext.PointOfSale.Payment({\n      wrapper: this.$components_wrapper,\n      events: {\n        get_frm: () => this.frm || {},\n\n        get_customer_details: () => this.customer_details || {},\n\n        toggle_other_sections: (show) => {\n          if (show) {\n            this.item_details.$component.is(':visible')\n              ? this.item_details.$component.css('display', 'none')\n              : '';\n            this.item_selector.toggle_component(false);\n          } else {\n            this.item_selector.toggle_component(true);\n          }\n        },\n\n        submit_invoice: () => {\n          //Support for stripe payments\n          var allowSubmit = 1;\n          if (window.enable_stripe_terminal == 1) {\n            if (this.frm.doc.payments.length > 0) {\n              for (var i = 0; i <= this.frm.doc.payments.length; i++) {\n                if (this.frm.doc.payments[i] != undefined) {\n                  if (\n                    this.frm.doc.payments[i].mode_of_payment ==\n                      window.stripe_mode_of_payment &&\n                    this.frm.doc.payments[i].base_amount != 0\n                  ) {\n                    if (this.frm.doc.payments[i].amount > 0) {\n                      allowSubmit = 0;\n                    } else if (\n                      this.frm.doc.is_return == 1 &&\n                      this.frm.doc.payments[i].card_payment_intent\n                    ) {\n                      allowSubmit = 0;\n                    } else if (\n                      this.frm.doc.is_return == 1 &&\n                      !this.frm.doc.payments[i].card_payment_intent\n                    ) {\n                      frappe.throw(\n                        'This transaction was not paid using a Stripe Payment. Please change the return payment method.'\n                      );\n                    }\n                  }\n                }\n              }\n            }\n          }\n\n          if (allowSubmit == 1) {\n            this.frm.savesubmit().then((r) => {\n              //For raw printing\n              if (window.open_cash_drawer_automatically == 1) {\n                this.open_cash_drawer();\n              }\n\n              if (window.automatically_print == 1) {\n                this.raw_print(this.frm);\n              }\n              this.toggle_components(false);\n              this.order_summary.toggle_component(true);\n              this.order_summary.load_summary_of(this.frm.doc, true);\n              frappe.show_alert({\n                indicator: 'green',\n                message: __('POS invoice {0} created succesfully', [\n                  r.doc.name,\n                ]),\n              });\n            });\n          } else {\n            //var stripe = new erpnext.PointOfSale.StripeTerminal();\n            //this.stripe.assign_stripe_connection_token(this,true);\n            this.stripe.collecting_payments(this, true);\n          }\n        },\n\n        raw_print: () => {\n          this.raw_print(this.frm);\n        },\n\n        open_cash_drawer: () => {\n          this.open_cash_drawer();\n        },\n      },\n    });\n  }\n\n  async on_cart_update(args) {\n    frappe.dom.freeze();\n    let item_row = undefined;\n    try {\n      let { field, value, item } = args;\n      item_row = this.get_item_from_frm(item);\n      const item_row_exists = !$.isEmptyObject(item_row);\n\n      const from_selector = field === 'qty' && value === '+1';\n      if (from_selector) value = flt(item_row.qty) + flt(value);\n\n      if (item_row_exists) {\n        if (field === 'qty') value = flt(value);\n\n        if (\n          ['qty', 'conversion_factor'].includes(field) &&\n          value > 0 &&\n          !this.allow_negative_stock\n        ) {\n          const qty_needed =\n            field === 'qty'\n              ? value * item_row.conversion_factor\n              : item_row.qty * value;\n          await this.check_stock_availability(\n            item_row,\n            qty_needed,\n            this.frm.doc.set_warehouse\n          );\n        }\n\n        if (this.is_current_item_being_edited(item_row) || from_selector) {\n          await frappe.model.set_value(\n            item_row.doctype,\n            item_row.name,\n            field,\n            value\n          );\n          this.update_cart_html(item_row);\n        }\n      } else {\n        if (!this.frm.doc.customer)\n          return this.raise_customer_selection_alert();\n\n        const { item_code, batch_no, serial_no, rate } = item;\n\n        if (!item_code) return;\n\n        const new_item = { item_code, batch_no, rate, [field]: value };\n\n        if (serial_no) {\n          await this.check_serial_no_availablilty(\n            item_code,\n            this.frm.doc.set_warehouse,\n            serial_no\n          );\n          new_item['serial_no'] = serial_no;\n        }\n\n        if (field === 'serial_no')\n          new_item['qty'] = value.split(`\\n`).length || 0;\n\n        item_row = this.frm.add_child('items', new_item);\n\n        if (field === 'qty' && value !== 0 && !this.allow_negative_stock)\n          await this.check_stock_availability(\n            item_row,\n            value,\n            this.frm.doc.set_warehouse\n          );\n\n        await this.trigger_new_item_events(item_row);\n\n        this.update_cart_html(item_row);\n\n        if (this.item_details.$component.is(':visible'))\n          this.edit_item_details_of(item_row);\n\n        if (\n          this.check_serial_batch_selection_needed(item_row) &&\n          !this.item_details.$component.is(':visible')\n        )\n          this.edit_item_details_of(item_row);\n      }\n    } catch (error) {\n      console.log(error);\n    } finally {\n      if (window.enable_stripe_terminal == 1) {\n        this.stripe.display_details(this);\n      }\n      frappe.dom.unfreeze();\n      return item_row;\n    }\n  }\n\n  open_cash_drawer() {\n    if (window.enable_raw_print == 1 && window.raw_printer) {\n      var me = this;\n      frappe.ui.form.qz_get_printer_list().then(function (printers) {\n        var config;\n        printers.forEach(function (printer) {\n          if (printer == window.raw_printer) {\n            config = qz.configs.create(printer);\n          }\n        });\n        var data = [\n          '\\x10' + '\\x14' + '\\x01' + '\\x00' + '\\x05', //Generate Pulse to kick-out cash drawer\n        ];\n        qz.print(config, data);\n      });\n    }\n  }\n\n  raw_print(frm) {\n    if (window.enable_raw_print == 1 && window.raw_printer) {\n      var me = this;\n\n      frappe.ui.form.qz_get_printer_list().then(function (printers) {\n        var config;\n        printers.forEach(function (printer) {\n          if (printer == window.raw_printer) {\n            config = qz.configs.create(printer);\n          }\n        });\n\n        var data = [\n          '\\x1B' + '\\x40', //init\n          '\\x1B' + '\\x61' + '\\x31', //center align\n          frm.doc.company + '\\x0A',\n          company.tax_id + '\\x0A',\n          frm.doc.company_address_display\n            .replace(/\\n/g, '')\n            .replace(/(<([^>]+)>)/gi, '\\x0A') + '\\x0A',\n          '\\x1B' + '\\x45' + '\\x0A', //bold on\n          'FACTURA' + '\\x0A',\n          '\\x1B' + '\\x45' + '\\x0A' + '\\x0A', //bold off\n          'Factura No.' + '\\x0A',\n          frm.doc.invoice_number + '\\x0A',\n          'CAI' + '\\x0A',\n          frm.doc.cai + '\\x0A' + '\\x0A',\n          'Fecha Limite Emision ' +\n            moment(frm.doc.fecha_limite_emision).format('DD-MM-YYYY') +\n            '\\x0A',\n          'Rango Autorizado' +\n            '\\x0A' +\n            frm.doc.rango_autorizado.replace(' al ', '\\x0A') +\n            '\\x0A',\n          '\\x1B' + '\\x61' + '\\x30' + '\\x0A' + '\\x0A', // left align\n          'Cliente : ' + frm.doc.customer_name + '\\x0A',\n          'RTN     : ' +\n            (frm.doc.customer_tax_id ? frm.doc.customer_tax_id : '') +\n            '\\x0A',\n          'Fecha   : ' +\n            moment(frm.doc.posting_date).format('DD-MM-YYYY') +\n            '\\x0A',\n          '\\x1B' + '\\x45' + '\\x0D' + '\\x0A', //bold on\n          'Descripcion                        Monto' + '\\x0A',\n          '----------------------------------------' + '\\x0A',\n          '\\x1B' + '\\x45' + '\\x0A', //bold off\n        ];\n        frm.doc.items.forEach(function (row) {\n          var rdata = me.get_item_print(\n            row.item_code,\n            row.qty,\n            row.rate,\n            row.amount,\n            frm.doc.currency\n          );\n          data.push.apply(data, rdata);\n        });\n        //data.push(\n        //\t'\\x1B' + '\\x61' + '\\x32' // right align\n        //);\n        data.push.apply(data, [\n          '----------------------------------------' + '\\x0A',\n        ]);\n        var tprint = me.get_total_print(frm.doc);\n        data.push.apply(data, tprint);\n        var extraprint = me.get_extra_print(frm.doc);\n        data.push.apply(data, extraprint);\n        var cut = [\n          '\\x0A' +\n            '\\x0A' +\n            '\\x0A' +\n            '\\x0A' +\n            '\\x0A' +\n            '\\x0A' +\n            '\\x0A' +\n            '\\x0A' +\n            '\\x0A' +\n            '\\x0A',\n          '\\x1B' + '\\x69',\n        ];\n        data.push.apply(data, cut); // cut paper (old syntax)\n        qz.print(config, data);\n      });\n    }\n  }\n\n  get_total_print(doc) {\n    var ret = [];\n    // Subtotal\n    var length = doc.net_total.toString().length;\n    var subtotal = 'Subtotal';\n    for (var i = length; i <= 11; i++) {\n      subtotal = subtotal + ' ';\n    }\n    subtotal = subtotal + format_currency(doc.net_total);\n    var tlength = subtotal.length;\n    //Add extra spaces to align everything to the right\n    for (var i = 0; i < 40 - tlength; i++) {\n      subtotal = ' ' + subtotal;\n    }\n    ret.push(subtotal + '\\x0A');\n\n    // Descuentos\n    var length = doc.discount_amount.toString().length;\n    var discounts = 'Descuentos y Rebajas';\n    for (var i = length; i <= 11; i++) {\n      discounts = discounts + ' ';\n    }\n    discounts = discounts + format_currency(doc.discount_amount);\n    var tlength = discounts.length;\n    //Add extra spaces to align everything to the right\n    for (var i = 0; i < 40 - tlength; i++) {\n      discounts = ' ' + discounts;\n    }\n    ret.push(discounts + '\\x0A');\n\n    //Taxes\n    var tax_rates_per_item = Object.entries(\n      JSON.parse(doc.taxes[0].item_wise_tax_detail)\n    );\n    var invoice_taxes = {\n      exento_total: 0.0,\n      exento_tax_total: 0.0,\n      exonerado_total: 0.0,\n      isv_15_total: 0.0,\n      isv_18_total: 0.0,\n      isv_15_tax_total: 0.0,\n      isv_18_tax_total: 0.0,\n    };\n\n    window.tax_templates.map((tax_template) => {\n      doc.items.forEach((item) => {\n        if (item.item_tax_template == tax_template.name) {\n          if (tax_template.title == 'ISV 15%') {\n            invoice_taxes.isv_15_total += item.net_amount;\n            tax_rates_per_item.map((tax_item) => {\n              if (tax_item[0] === item.item_code) {\n                invoice_taxes.isv_15_tax_total += tax_item[1][1];\n              }\n            });\n          }\n          if (tax_template.title == 'ISV 18%') {\n            invoice_taxes.isv_18_total += item.net_amount;\n            tax_rates_per_item.map((tax_item) => {\n              if (tax_item[0] === item.item_code) {\n                invoice_taxes.isv_18_tax_total += tax_item[1][1];\n              }\n            });\n          }\n          if (tax_template.title == 'Exento') {\n            invoice_taxes.exento_total += item.net_amount;\n            tax_rates_per_item.map((tax_item) => {\n              if (tax_item[0] === item.item_code) {\n                invoice_taxes.exento_tax_total += tax_item[1][1];\n              }\n            });\n          }\n        }\n      });\n    });\n\n    // Exento\n    var length = invoice_taxes.exento_total.toString().length;\n    var exempt = 'Importe Exento';\n    for (var i = length; i <= 11; i++) {\n      exempt = exempt + ' ';\n    }\n    exempt = exempt + format_currency(invoice_taxes.exento_total);\n    var tlength = exempt.length;\n    //Add extra spaces to align everything to the right\n    for (var i = 0; i < 40 - tlength; i++) {\n      exempt = ' ' + exempt;\n    }\n    ret.push(exempt + '\\x0A');\n\n    // Exonerado\n    var length = invoice_taxes.exonerado_total.toString().length;\n    var exempt = 'Importe Exonerado';\n    for (var i = length; i <= 11; i++) {\n      exempt = exempt + ' ';\n    }\n    exempt = exempt + format_currency(invoice_taxes.exonerado_total);\n    var tlength = exempt.length;\n    //Add extra spaces to align everything to the right\n    for (var i = 0; i < 40 - tlength; i++) {\n      exempt = ' ' + exempt;\n    }\n    ret.push(exempt + '\\x0A');\n\n    // Gravado 15\n    var length = invoice_taxes.isv_15_tax_total.toString().length;\n    var exempt = 'Importe Gravado ISV 15%';\n    for (var i = length; i <= 11; i++) {\n      exempt = exempt + ' ';\n    }\n    exempt = exempt + format_currency(invoice_taxes.isv_15_tax_total);\n    var tlength = exempt.length;\n    //Add extra spaces to align everything to the right\n    for (var i = 0; i < 40 - tlength; i++) {\n      exempt = ' ' + exempt;\n    }\n    ret.push(exempt + '\\x0A');\n\n    // Gravado 18\n    var length = invoice_taxes.isv_18_tax_total.toString().length;\n    var exempt = 'Importe Gravado ISV 18%';\n    for (var i = length; i <= 11; i++) {\n      exempt = exempt + ' ';\n    }\n    exempt = exempt + format_currency(invoice_taxes.isv_18_tax_total);\n    var tlength = exempt.length;\n    //Add extra spaces to align everything to the right\n    for (var i = 0; i < 40 - tlength; i++) {\n      exempt = ' ' + exempt;\n    }\n    ret.push(exempt + '\\x0A');\n\n    // ISV 15\n    var length = invoice_taxes.isv_15_total.toString().length;\n    var exempt = 'ISV 15%';\n    for (var i = length; i <= 11; i++) {\n      exempt = exempt + ' ';\n    }\n    exempt = exempt + format_currency(invoice_taxes.isv_15_total);\n    var tlength = exempt.length;\n    //Add extra spaces to align everything to the right\n    for (var i = 0; i < 40 - tlength; i++) {\n      exempt = ' ' + exempt;\n    }\n    ret.push(exempt + '\\x0A');\n\n    // ISV 18\n    var length = invoice_taxes.isv_18_total.toString().length;\n    var exempt = 'ISV 15%';\n    for (var i = length; i <= 11; i++) {\n      exempt = exempt + ' ';\n    }\n    exempt = exempt + format_currency(invoice_taxes.isv_18_total);\n    var tlength = exempt.length;\n    //Add extra spaces to align everything to the right\n    for (var i = 0; i < 40 - tlength; i++) {\n      exempt = ' ' + exempt;\n    }\n    ret.push(exempt + '\\x0A');\n\n    // if (doc.taxes && doc.taxes.length > 0) {\n    //   doc.taxes.forEach(function (row) {\n    //     length = row.total.toString().length;\n    //     total = row.description;\n    //     for (var i = length; i <= 11; i++) {\n    //       total = total + ' ';\n    //     }\n    //     total = total + doc.currency + doc.total.toString();\n    //     var tlength = total.length;\n    //     //Add extra spaces to align everything to the right\n    //     for (var i = 0; i < 40 - tlength; i++) {\n    //       total = ' ' + total;\n    //     }\n    //     ret.push(total + '\\x0A');\n    //   });\n    // }\n\n    //Grand Total\n    ret.push('\\x1B' + '\\x45' + '\\x0D'); //Bold on\n    var total = 'Total';\n    length = doc.grand_total.toString().length;\n    for (var i = length; i <= 11; i++) {\n      total = total + ' ';\n    }\n    total = total + format_currency(doc.grand_total);\n    var tlength = total.length;\n    //Add extra spaces to align everything to the right\n    for (var i = 0; i < 40 - tlength; i++) {\n      total = ' ' + total;\n    }\n    ret.push(total + '\\x0A');\n    ret.push('\\x1B' + '\\x45' + '\\x0A' + '\\x0A'); //Bold off\n\n    //Payments\n    var stripe_info = [];\n    var cash_drawer = [];\n    if (doc.payments && doc.payments.length > 0) {\n      doc.payments.forEach(function (row) {\n        if (row.base_amount > 0) {\n          length = row.base_amount.toString().length;\n          total = row.mode_of_payment + ' ';\n          for (var i = length; i <= 11; i++) {\n            total = total + ' ';\n          }\n          total = total + format_currency(row.base_amount);\n          var tlength = total.length;\n          //Add extra spaces to align everything to the right\n          for (var i = 0; i < 40 - tlength; i++) {\n            total = ' ' + total;\n          }\n          ret.push(total + '\\x0A');\n\n          //If it's a stripe payment, add mandatory information at end o receipt\n          if (\n            row.mode_of_payment == window.stripe_mode_of_payment &&\n            row.base_amount > 0\n          ) {\n            stripe_info = [\n              '\\x1B' + '\\x61' + '\\x31', // center align,\n              '\\x0A',\n              row.card_brand.toUpperCase() +\n                ' XXXXXXXXXXXX' +\n                row.card_last4 +\n                '\\x0A',\n              'Auth CD: ' + row.card_authorization_code + '\\x0A',\n              'AID: ' + row.card_dedicated_file_name + '\\x0A',\n              row.card_application_preferred_name + '\\x0A',\n              'TVR: ' + row.card_terminal_verification_results + '\\x0A',\n              'TSI: ' + row.card_transaction_status_information + '\\x0A',\n              'IAD: ' + row.card_dedicated_file_name,\n            ];\n          }\n        }\n      });\n    }\n\n    //Total Payments\n    ret.push('\\x1B' + '\\x45' + '\\x0D'); //Bold on\n    total = 'Recibido ';\n    length = doc.grand_total.toString().length;\n    for (var i = length; i <= 11; i++) {\n      total = total + ' ';\n    }\n    total = total + format_currency(doc.paid_amount);\n    var tlength = total.length;\n    //Add extra spaces to align everything to the right\n    for (var i = 0; i < 40 - tlength; i++) {\n      total = ' ' + total;\n    }\n    ret.push(total + '\\x0A');\n    ret.push('\\x1B' + '\\x45' + '\\x0A' + '\\x0A'); //Bold off\n\n    ret.push(writtenNumber(doc.grand_total, { lang: 'es' }) + '\\x0A' + '\\x0A');\n\n    //Add the stripe data\n    if (stripe_info.length > 0) {\n      ret.push.apply(ret, stripe_info);\n    }\n\n    return ret;\n  }\n\n  get_extra_print(doc) {\n    var ret = [\n      'Registro SAG ' +\n        (doc.identificativo_registro_sag\n          ? doc.identificativo_registro_sag.toString()\n          : '') +\n        '\\x0A',\n      'Const. Regis. Exonerado # ' +\n        (doc.correlativo_constancia_registro_exonerado\n          ? doc.correlativo_constancia_registro_exonerado.toString()\n          : '') +\n        '\\x0A',\n      'OC Exenta ' +\n        (doc.correlativo_orden_compra_exenta\n          ? doc.correlativo_orden_compra_exenta.toString()\n          : '') +\n        '\\x0A',\n    ];\n\n    return ret;\n  }\n\n  get_item_print(item, qty, rate, amount, currency) {\n    var ilength = item.length;\n    var ret = [];\n    //Put in for loop in case item length > 30\n    for (var i = 0; i < ilength; i = i + 29) {\n      ret.push(item.substring(i, i + 29) + '\\x0A');\n    }\n\n    //For quantity\n    var qty_rate = qty.toString() + ' @ ' + format_currency(rate);\n    var qlength = qty_rate.length;\n    for (var i = 0; i < 29 - qlength; i++) {\n      qty_rate = qty_rate + ' ';\n    }\n\n    //Add amount at end of qty-rate line\n    var alength = format_currency(amount).length;\n    for (var i = 0; i < 10 - alength; i++) {\n      qty_rate = qty_rate + ' ';\n    }\n    qty_rate = qty_rate + format_currency(amount);\n    ret.push(qty_rate + '\\x0A');\n    return ret;\n  }\n};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAGC,MAAC,UAAU,QAAQ,SAAS;AACzB,eAAO,YAAY,YAAY,OAAO,WAAW,cAAc,OAAO,UAAU,QAAQ,IACxF,OAAO,WAAW,cAAc,OAAO,MAAM,OAAO,QAAQ,CAAC,IAC7D,OAAO,SAAS,QAAQ;AAAA,MAC5B,GAAE,SAAO,WAAY;AACpB,YAAI,UAAS;AAAA,UAQZ,UAAU,SAAS,aAAa,UAAU;AAEzC,gBAAG,YAAY,yBAAyB,QAAU;AACjD,oBAAM,IAAI,MAAM,sDAAsD,WAAW;AAAA,YAClF;AAEA,gBAAI,YAAY;AAAA,cACf,QAAQ,SAAS,UAAU,MAAK;AAAA,cAAC;AAAA,cACjC,aAAa,SAAS,QAAO;AAAA,cAAC;AAAA,cAC9B,cAAc,SAAS,OAAO,QAAO;AAAA,cAAC;AAAA,cACtC,aAAa,SAAS,UAAU,QAAO;AAAA,cAAC;AAAA,cACxC,SAAS,SAAS,SAAS,QAAO;AAAA,cAAC;AAAA,cACnC,eAAe,SAAS,QAAQ;AAAC,uBAAO,QAAO,eAAe,MAAM;AAAA,cAAC;AAAA,cACrE,uBAAuB,WAAU;AAAA,cAAC;AAAA,cAClC,mBAAkB;AAAA,cAClB,yBAAwB;AAAA,cACxB,oBAAmB;AAAA,cACnB,eAAc;AAAA,cACd,WAAU;AAAA,cACV,gBAAe,CAAC,GAAE,EAAE;AAAA,cACpB,gBAAe,CAAC;AAAA,cAChB,iBAAgB;AAAA,cAChB,iBAAgB;AAAA,cAChB,gBAAe;AAAA,cACf,eAAc;AAAA,cACd,gBAAe;AAAA,cACf,cAAa;AAAA,cACb,eAAe;AAAA,YAChB;AAEA,uBAAW,KAAK,cAAc,WAAW,QAAQ;AAGjD,wBAAY,uBAAuB;AAAA,cACjC,SAAS;AAAA,cACT,MAAK;AAAA,gBACJ,eAAe;AAAA,gBACf,cAAc;AAAA,gBACd,mBAAmB;AAAA,gBACnB,WAAW;AAAA,gBACX,oBAAoB;AAAA,gBACpB,aAAa;AAAA,cACd;AAAA,YAEF;AAGA,gBAAI,SAAS,iBAAiB,MAAK;AAClC,0BAAY,iBAAiB,SAAS,KAAK,cAAc,SAAS,aAAa;AAAA,YAChF;AACA,gBAAI,SAAS,sBAAsB,OAAM;AACxC,0BAAY,iBAAiB,SAAS,KAAK,cAAc,SAAS,aAAa;AAAA,YAChF;AACA,gBAAI,SAAS,mBAAmB,QAAQ,SAAS,sBAAsB,OAAM;AAC5E,0BAAY,iBAAiB,WAAW,KAAK,gBAAgB,SAAS,aAAa;AAAA,YACpF;AACA,mBAAO;AAAA,UACR;AAAA,UAOA,YAAY,SAAS,aAAa;AAEjC,gBAAI,YAAY,qBAAqB,QAAQ,cAAa;AACzD,0BAAY,oBAAoB,SAAS,KAAK,YAAY;AAAA,YAC3D;AACA,gBAAI,YAAY,qBAAqB,QAAQ,sBAAsB,OAAM;AACxE,0BAAY,oBAAoB,SAAS,KAAK,YAAY;AAAA,YAC3D;AACA,wBAAY,oBAAoB,WAAW,KAAK,cAAc;AAG9D,wBAAY,uBAAuB;AACnC;AAAA,UACD;AAAA,UAOA,YAAY,SAAS,aAAY;AAChC,mBAAO,YAAY,qBAAqB;AAAA,UACzC;AAAA,UAQA,YAAY,SAAS,aAAa,UAAS;AAE1C,oBAAQ,YAAY,qBAAqB,QAAQ;AAAA,mBAC3C;AACJ,oBAAI,SAAS,iBAAiB,OAAM;AACnC,8BAAY,oBAAoB,SAAS,KAAK,YAAY;AAAA,gBAC3D;AACA;AAAA,mBACI;AACJ,oBAAI,SAAS,iBAAiB,MAAK;AAClC,8BAAY,iBAAiB,SAAS,KAAK,YAAY;AAAA,gBACxD;AACA;AAAA;AAGF,oBAAQ,YAAY,qBAAqB,QAAQ;AAAA,mBAC3C;AACJ,oBAAI,SAAS,sBAAsB,OAAM;AACxC,8BAAY,iBAAiB,SAAS,KAAK,YAAY;AAAA,gBACxD;AACA;AAAA;AAEA,oBAAI,SAAS,sBAAsB,OAAM;AACxC,8BAAY,oBAAoB,SAAS,KAAK,YAAY;AAAA,gBAC3D;AACA;AAAA;AAIF,wBAAY,qBAAqB,UAAU,KAAK,cAAc,YAAY,qBAAqB,SAAS,QAAQ;AAGhH,iBAAK,cAAc,WAAW;AAC9B,mBAAO;AAAA,UACR;AAAA,UAoBA,gBAAiB,SAAU,QAAQ;AAClC,gBAAI,QAAQ,KAAK,qBAAqB,MAAM;AAC5C,oBAAQ;AAAA,mBACF,UAAS,MAAM,SAAS;AAAA,mBACxB,UAAS,OAAO,SAAS;AAC7B,oBAAI,OAAO,QAAQ,UAAa,OAAO,QAAQ,IAAI;AAClD,yBAAO,OAAO;AAAA,gBACf;AAEA,oBAAI,WAAW,OAAO,aAAa,KAAK;AACxC,wBAAQ,OAAO;AAAA,uBACT;AAAO,+BAAW,SAAS,YAAY;AAAG;AAAA,uBAC1C;AAAM,+BAAW,SAAS,YAAY;AAAG;AAAA;AAE/C,uBAAO;AAAA,mBACH,UAAS,MAAM,SAAS;AAC5B,uBAAO,IAAG,SAAM;AAAA;AAElB,mBAAO;AAAA,UACR;AAAA,UAkBA,UAAU,SAAS,aAAa,gBAAe;AAC9C,iBAAK,cAAc,WAAW;AAC9B,gBAAI,MAAM,QAAQ,cAAc,GAAE;AACjC,6BAAe,QAAQ,SAAS,MAAK;AACpC,oBAAI,cAAc,CAAC;AACnB,oBAAK,QAAO,SAAS,YAAY,OAAO,SAAS,eAAgB,SAAS,MAAQ;AACjF,gCAAc;AAAA,gBACf,OAAO;AACN,8BAAY,UAAU,SAAS,IAAI;AAAA,gBACpC;AACA,oBAAI,SAAS,IAAI,cAAc,WAAW,WAAW;AACrD,yBAAS,cAAc,MAAM;AAAA,cAC9B,CAAC;AAAA,YACF,OAAO;AACN,mBAAK,kBAAkB,aAAa,cAAc;AAAA,YACnD;AACA,mBAAO;AAAA,UACR;AAAA,UAOA,eAAe,SAAS,aAAY;AACnC,gBAAI,QAAQ,YAAY,qBAAqB;AAC7C,kBAAM,gBAAgB;AACtB,kBAAM,eAAe;AACrB,kBAAM,oBAAoB;AAC1B;AAAA,UACD;AAAA,UAOA,0BAA0B,SAAS,aAAY;AAE9C,gBAAI,kBAAkB,YAAY,qBAAqB,QAAQ;AAEzD,gBAAG,CAAC,iBAAgB;AACzB,qBAAO;AAAA,YACR;AAEA,gBAAI,WAAW,SAAS;AAGxB,gBAAI,MAAM,QAAQ,eAAe,GAAE;AAClC,uBAAQ,IAAE,GAAG,IAAE,gBAAgB,QAAQ,KAAI;AAC1C,oBAAG,SAAS,QAAQ,gBAAgB,EAAE,MAAM,MAAK;AAChD,yBAAO;AAAA,gBACR;AAAA,cACD;AAAA,YAED,WAAW,SAAS,QAAQ,eAAe,GAAE;AAC5C,qBAAO;AAAA,YACR;AAGG,mBAAO;AAAA,UACR;AAAA,UASH,mBAAmB,SAAS,aAAa,WAAU;AAClD,gBAAI,eAAe,YAAY;AAC/B,gBAAI,WAAW,aAAa;AAC5B,gBAAI,iBAAiB,aAAa,QAAQ;AAC1C,gBAAI,iBAAiB,aAAa,KAAK;AACvC,gBAAI,gBAAgB,aAAa,KAAK;AACtC,gBAAI,aAAa,CAAC;AACZ,gBAAI;AAEV,oBAAO;AAAA,mBAGA,UAAU,SAAS,SAAS;AACjC,6BAAa;AAAA,kBACZ,SAAS;AAAA,gBACV;AACA;AAAA,mBAGM,gBAAgB,iBAAmB,UAAU,SAAS,SAAS;AACrE,6BAAa;AAAA,kBACZ,SAAS;AAAA,gBACV;AACA;AAAA;AAIA,yBAAS,OAAO,KAAK,aAAa,WAAW,cAAc;AAC3D,yBAAS,IAAI,YACZ,QACA;AAAA,kBACC,QAAQ;AAAA,oBACP,UAAU;AAAA,oBACV,KAAK;AAAA,kBACN;AAAA,gBACD,CACD;AACA,4BAAY,cAAc,MAAM;AAChC,wBAAO,cAAc,WAAW;AAChC,uBAAO;AAAA;AAIT,uBAAW,WAAW;AACtB,uBAAW,eAAe,gBAAgB;AAC1C,uBAAW,gBAAgB,SAAS;AACpC,uBAAW,YAAY,SAAS;AAEhC,qBAAS,YAAY,KAAK,aAAa,UAAU;AAEjD,qBAAS,IAAI,YACZ,aACA,EAAC,QAAQ,WAAU,CACpB;AACA,wBAAY,cAAc,MAAM;AAEhC,oBAAO,cAAc,WAAW;AAChC,mBAAO;AAAA,UACL;AAAA,UAQH,eAAe,SAAS,WAAW,UAAS;AAC3C,gBAAI,YAAY,CAAC;AACjB,gBAAI;AACJ,iBAAK,QAAQ,WAAU;AACtB,kBAAI,OAAO,UAAU,eAAe,KAAK,WAAW,IAAI,GAAE;AACzD,0BAAU,QAAQ,UAAU;AAAA,cAC7B;AAAA,YACD;AACA,iBAAK,QAAQ,UAAS;AACrB,kBAAI,OAAO,UAAU,eAAe,KAAK,UAAU,IAAI,GAAE;AACxD,0BAAU,QAAQ,SAAS;AAAA,cAC5B;AAAA,YACD;AACA,mBAAO;AAAA,UACR;AAAA,UAQA,sBAAsB,SAAS,GAAE;AAChC,mBAAO,EAAE,SAAS,EAAE;AAAA,UACrB;AAAA,UAQA,gBAAgB,SAAS,GAAE;AAC1B,gBAAI,WAAW,QAAO,qBAAqB,CAAC;AAC5C,gBAAI,WAAW,KAAK,qBAAqB;AACzC,gBAAI,QAAQ,KAAK,qBAAqB;AACtC,gBAAI,gBAAgB;AAEpB,gBAAI,SAAS,YAAY,KAAK,MAAM,UAAU,CAAC,MAAM,OAAO;AAC3D;AAAA,YACD;AAEA,gBAAI,QAAO,yBAAyB,IAAI,GAAE;AACzC;AAAA,YACD;AAGG,gBAAG,SAAS,sBAAsB,SAAS,YAAU,SAAS,mBAAmB;AAGnF,kBAAI,CAAC,MAAM,aAAY;AACtB,sBAAM,iBAAiB,WAAY,SAAS,uBAAuB,SAAS,yBAAyB,IAAI;AACzG,sBAAM,cAAc;AAAA,cACrB;AAEA;AAAA,YACK;AAEN,oBAAO;AAAA,mBAEA,OAAM,iBAAiB,SAAS,eAAe,QAAQ,QAAQ,MAAI;AACxE,kBAAE,eAAe;AACjB,kBAAE,yBAAyB;AAC3B,gCAAc;AACd;AAAA,mBAGK,EAAC,MAAM,iBAAiB,SAAS,eAAe,QAAQ,QAAQ,MAAI;AACzE,kBAAE,eAAe;AACjB,kBAAE,yBAAyB;AAC3B,gCAAc;AACd;AAAA;AAIA,oBAAI,YAAY,SAAS,cAAc,KAAK,MAAM,CAAC;AACnD,oBAAI,cAAc,MAAK;AACtB;AAAA,gBACD;AACA,sBAAM,qBAAqB;AAE3B,oBAAI,SAAS,gBAAgB;AAC5B,oBAAE,eAAe;AAAA,gBAClB;AACA,oBAAI,SAAS,iBAAiB;AAC7B,oBAAE,yBAAyB;AAAA,gBAC5B;AAEA,gCAAc;AACd;AAAA;AAGF,gBAAG,CAAC,MAAM,eAAc;AACvB,oBAAM,gBAAc,KAAK,IAAI;AAAA,YAC9B;AAEA,kBAAM,eAAa,KAAK,IAAI;AAE5B,gBAAG,MAAM,WAAU;AAClB,2BAAa,MAAM,SAAS;AAAA,YAC7B;AAEA,gBAAG,eAAc;AAChB,sBAAO,kBAAkB,MAAM,MAAM,iBAAiB;AACtD,oBAAM,YAAU;AAAA,YACjB,OAAO;AACN,oBAAM,YAAU,WAAW,QAAO,mBAAmB,SAAS,oBAAoB,MAAM,MAAM,iBAAiB;AAAA,YAChH;AAEA,qBAAS,aAAa,KAAK,MAAM,WAAW,CAAC;AAC7C;AAAA,UACD;AAAA,UAOA,cAAc,SAAS,GAAE;AAExB,gBAAI,WAAW,KAAK,qBAAqB;AACzC,gBAAI,QAAQ,KAAK,qBAAqB;AACtC,gBAAI,eAAgB,OAAM,iBAAiB,OAAO,eAAe,QAAQ,MAAM;AAG/E,gBAAI,QAAO,yBAAyB,IAAI,GAAE;AACzC;AAAA,YACD;AAEA,cAAE,eAAe;AAEjB,gBAAI,SAAS,iBAAiB;AAC7B,gBAAE,yBAAyB;AAAA,YAC5B;AAEA,qBAAS,QAAQ,KAAK,MAAM,cAAc,KAAK;AAE/C,kBAAM,gBAAgB;AACtB,kBAAM,eAAe;AAGrB,oBAAO,kBAAkB,MAAM,YAAY;AAC3C;AAAA,UACD;AAAA,UAOA,cAAc,SAAS,GAAE;AAExB,gBAAI,QAAO,yBAAyB,IAAI,GAAE;AACzC;AAAA,YACD;AAEA,gBAAI,WAAW,QAAO,qBAAqB,CAAC;AAG5C,gBAAI,YAAY,KAAK,qBAAqB,QAAQ,mBAAkB;AACnE,2BAAa,KAAK,qBAAqB,KAAK,cAAc;AAC1D,mBAAK,qBAAqB,KAAK,cAAc;AAAA,YAC9C;AACA;AAAA,UACD;AAAA,UAQA,qBAAqB,SAAS,aAAa;AAC1C,mBAAO,YAAY,qBAAqB,KAAK,gBAAgB;AAAA,UAC9D;AAAA,UAQA,cAAc,SAAS,aAAa;AACnC,mBAAQ,YAAY,yBAAyB;AAAA,UAC9C;AAAA,QACD;AAEA,eAAO;AAAA,MACR,CAAE;AAAA;AAAA;;;AC7gBF;AAAA;AAAA;AAUA,wBAAkB,QAAQ,MAAM;AAC9B,YAAI,UAAU;AAAM,mBAAS,CAAC;AAC9B,YAAI,MAAM,CAAC;AACX,YAAI,OAAO,OAAO,KAAK,IAAI;AAC3B,iBAAS,IAAI,GAAG,MAAM,KAAK,QAAQ,IAAI,KAAK,KAAK;AAC/C,cAAI,MAAM,KAAK;AACf,cAAI,OAAO,OAAO,QAAQ,KAAK;AAAA,QACjC;AACA,eAAO;AAAA,MACT;AACA,cAAQ,WAAW;AAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACpBnB;AAAA;AAAA;AACA,gBAAU,OAAO,UAAU;AAC3B,UAAI,OAAO;AAEX,UAAI,YAAY,CAAC,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,IAAI;AAC7F,UAAI,OAAO;AAAA,QACT,IAAI;AAAA,QACJ,IAAI;AAAA,QACJ,IAAI;AAAA,QACJ,IAAI;AAAA,QACJ,IAAI;AAAA,QACJ,MAAM;AAAA,QACN,IAAI;AAAA,QACJ,IAAI;AAAA,QACJ,IAAI;AAAA,QACJ,IAAI;AAAA,QACJ,IAAI;AAAA,QACJ,IAAI;AAAA,QACJ,UAAU;AAAA,QACV,IAAI;AAAA,QACJ,IAAI;AAAA,QACJ,IAAI;AAAA,MACN;AACA,cAAQ,OAAO;AAEf,UAAI,aAAa,CAAC,GAAG;AACrB,WAAS,IAAI,GAAG,KAAK,IAAI,KAAK;AAC5B,mBAAW,KAAK,KAAK,IAAI,IAAI,IAAI,CAAC,CAAC;AAAA,MACrC;AAFS;AAIT,UAAI,YAAY,CAAC,KAAK,GAAI;AAC1B,WAAK,IAAI,GAAG,KAAK,IAAI,KAAK;AACxB,kBAAU,KAAK,KAAK,IAAI,IAAI,IAAI,CAAC,CAAC;AAAA,MACpC;AAEA,qBAAc,WAAW;AAAA,QACvB,OAAO;AAAA,QACP,iBAAiB;AAAA,QACjB,MAAM;AAAA,MACR;AAUA,8BAAuB,GAAG,SAAS;AACjC,kBAAU,WAAW,CAAC;AACtB,kBAAU,KAAK,SAAS,SAAS,eAAc,QAAQ;AAEvD,YAAI,IAAI,GAAG;AACT,iBAAO;AAAA,QACT;AAEA,YAAI,KAAK,MAAM,CAAC,CAAC;AAEjB,YAAI,WAAW,OAAO,QAAQ,SAAS,WACnC,KAAK,QAAQ,QACb,QAAQ;AAEZ,YAAI,CAAC,UAAU;AACb,cAAI,UAAU,QAAQ,eAAc,SAAS,IAAI,IAAI,GAAG;AACtD,2BAAc,SAAS,OAAO;AAAA,UAChC;AAEA,qBAAW,KAAK,eAAc,SAAS;AAAA,QACzC;AAEA,YAAI,QAAQ,SAAS,eAAe,YAAY;AAChD,YAAI,QAAQ,SAAS;AACrB,YAAI;AAEJ,YAAI,CAAE,kBAAiB,QAAQ;AAC7B,cAAI,WAAW;AAEf,kBAAQ,CAAC;AACT,kBAAQ,OAAO,KAAK,QAAQ;AAE5B,mBAAS,MAAK,OAAO;AACnB,kBAAM,KAAK,SAAS,MAAM,IAAG;AAC7B,kBAAM,MAAK,KAAK,IAAI,IAAI,SAAS,MAAM,GAAE,CAAC;AAAA,UAC5C;AAAA,QACF;AAEA,YAAI,gBAAgB,SAAS;AAC7B,YAAI,2BAA2B,QAAQ,kBACnC,SAAS,gBAAgB,QAAQ,mBACjC,CAAC;AAEL,YAAI,SAAS,eAAe;AAAI,iBAAO,SAAS,eAAe;AAC/D,YAAI,yBAAyB;AAAI,iBAAO,yBAAyB;AACjE,YAAI,cAAc;AAAI,iBAAO,cAAc;AAC3C,YAAI,IAAI;AACN,iBAAO,qBAAqB,GAAG,UAAU,MAAM,eAAe,0BAA0B,OAAO;AAEjG,YAAI,IAAI,IAAI;AACZ,YAAI,MAAM,CAAC;AAEX,YAAI,GAAG;AACL,cACE,QAAQ,SACR,CAAE,UAAS,gBAAgB,SAAS,aAAa,MACjD;AACA,gBAAI,KAAK,eAAc,GAAG,OAAO,CAAC;AAAA,UACpC,OAAO;AACL,gBAAI,KAAK,SAAS,gBAAgB,eAAc,GAAG,OAAO,CAAC;AAAA,UAC7D;AAAA,QACF;AAEA,YAAI;AAEJ,iBAAS,KAAI,GAAG,MAAM,MAAM,QAAQ,KAAI,KAAK,MAAK;AAChD,cAAI,IAAI,KAAK,MAAM,IAAI,MAAM,GAAE;AAC/B,cAAI;AAEJ,cAAI,OAAM,MAAM;AAAG,uBAAW;AAAA;AACzB,uBAAW,MAAM,KAAI,KAAK,MAAM;AAErC,eAAK;AAEL,iBAAO,MAAM;AAEb,cAAI,CAAC;AAAG;AACR,6BAAmB,MAAM;AAEzB,cAAI,KAAK,gBAAgB;AACvB,gBAAI,yBACF,KAAK,iBAAiB,QAAQ,CAAC,IAAI,MAClC,MAAK,wCACF,OAAM,KAAK,IAAI,SACf;AACN,gBAAI,CAAC,wBAAwB;AAC3B,kBAAI,KAAK,yBAAyB,IAAI,MAAM,QAAO,cAAc,IAAI,MAAM,IAAG;AAAA,YAChF,OAAO;AACL,kBAAI,KAAK,IAAI,KAAK,KAAK,SAAS,KAAK,SAAS,KAAK,QAAQ;AAAA,YAC7D;AACA;AAAA,UACF;AAEA,cAAI;AACJ,cAAI,OAAO,SAAS,UAAU;AAC5B,kBAAM;AAAA,UACR,WAAW,MAAM,KAAK,KAAK,qBAAqB,IAAI,OAAO,KACrD,EAAC,KAAK,oBAAoB,KAAK,iBAAiB,QAAQ,CAAC,IAAI,IAAI;AACrE,kBAAM,KAAK;AAAA,UACb,WAAW,KAAK,OAAQ,KAAI,KAAK,IAAI,KAAK,KAAK,gBAAgB,IAAI,KAAK,KAAK,IAAI,KAAK,KAChF,EAAC,KAAK,oBAAoB,KAAK,iBAAiB,QAAQ,CAAC,IAAI,KAAK;AACtE,kBAAM,KAAK;AAAA,UACb,OAAO;AACL,kBAAM,KAAK,UAAW,EAAC,KAAK,uBAAuB,CAAC,KAChD,KAAK,SACL,KAAK;AAGT,kBAAO,MAAM,KAAK,KAAK,OAAQ,KAAK,OAAO;AAG3C,kBAAO,IAAI,MAAM,KAAK,mBAAoB,KAAK,WAAW;AAAA,UAC5D;AAEA,cACE,KAAK,wBACL,KAAK,qBAAqB,QAAQ,CAAC,IAAI,IACvC;AACA,gBAAI,KAAK,GAAG;AACZ;AAAA,UACF;AAEA,cAAI,YAAY,SAAS,eAAe;AACxC,cAAI,SACF,aACA,eACE,GACA,KAAK,SACH;AAAA,YAEE,OAAO,CAAG,UAAS,gBAAgB,SAAS,aAAa,MACvD,KAAK,iBAAiB;AAAA,YACxB,iBAAiB,KAAK;AAAA,UACxB,GACA,OACF,CACF;AACF,eAAK,IAAI,MAAM;AACf,cAAI,KAAK,SAAS,MAAM,GAAG;AAAA,QAC7B;AAEA,YAAI,oBAAoB,mBAAmB,KAAK,MAAM,IAAI,gBAAgB;AAC1E,YAAI,OAAO,IAAI;AAEf,YACE,SAAS,mBACT,oBACA,IAAI,QACJ,IAAI,GAAG,QAAQ,SAAS,aAAa,MAAM,GAC3C;AACA,gBAAM,CAAC,IAAI,IAAI,SAAS,cAAc,QAAQ,QAAQ,EAAE,CAAC,EAAE,OACzD,IAAI,MAAM,CAAC,CACb;AAAA,QACF;AAGA,YAAI,SAAS,cAAc;AACzB,mBAAS,IAAI,GAAG,IAAI,IAAI,SAAO,GAAG,KAAK;AACrC,gBAAI,KAAK,SAAS,eAAe,IAAI;AAAA,UACvC;AAAA,QACF;AACA,YAAI,SAAS,IAAI,QAAQ,EAAE,KAAK,GAAG;AACnC,eAAO;AAAA,MACT;AAEA,oCAA8B,GAAG,UAAU,MAAM,eAAe,0BAA0B,SAAS;AACjG,YAAI,MAAM,KAAK,MAAM,IAAI,EAAE,IAAI;AAC/B,eAAO,IAAI;AACX,YAAI,MAAM;AACR,iBACE,yBAAyB,QAAQ,cAAc,OAAO,SAAS,gBAAgB,eAAc,MAAM,OAAO;AAAA,QAE9G;AACA,eAAO,yBAAyB,QAAQ,cAAc;AAAA,MACxD;AAAA;AAAA;;;AC/NA,UAAQ,YAAY,iBAAiB,WAAU;AAC9C,QAAI,kBAAkB;AACtB,QAAI;AACJ,QAAI,gBAAgB,mBAAmB,gBAAgB;AACvD,QAAI,gBAAe;AACnB,QAAI,KAAK;AAET,SAAK,iCAAiC,SAAS,SAAS,YAAW;AAClE,uBAAiB;AACjB,mBAAY;AACZ,yBAAmB,iCAAiC,8CAA8C;AAClG,aAAO,IAAI,OAAO;AAClB,aAAO,KAAK;AAAA,QACX,QAAQ;AAAA,QACR,QAAQ;AAAA,QACR,SAAS;AAAA,UACR,oBAAoB;AAAA,QACrB;AAAA,QACA,UAAU,SAAU,GAAG;AACtB,iBAAO,IAAI,SAAS;AACpB,cAAI,EAAE,SAAS;AACd,8BAAkB,EAAE,QAAQ;AAC5B,uBAAW,eAAe,OAAO;AAAA,cAChC,wBAAwB;AAAA,cACxB,8BAA8B;AAAA,YAC/B,CAAC;AACD,uCAA2B,SAAS,UAAS;AAAA,UAC9C,OAAO;AACN,8BAAkB,uCAAuC;AAAA,UAC1D;AAAA,QACD;AAAA,MACD,CAAC;AAAA,IACF;AAEA,oCAAgC;AAC/B,aAAO;AAAA,IAER;AAEA,gCAA4B,OAAO,SAAS;AAC3C,uBAAiB,IAAI,OAAO,GAAG,OAAO;AAAA,QACrC;AAAA,QACA,QAAQ;AAAA,UAAC;AAAA,YACP,OAAO;AAAA,YACP,WAAW;AAAA,YACX,WAAW;AAAA,UACZ;AAAA,QACD;AAAA,MACD,CAAC;AACD,UAAI,OAAO;AACX,cAAQ,mBAAmB,UAAU;AACrC,cAAQ;AACR,qBAAe,YAAY,YAAY,SAAS,KAAK,IAAI;AACzD,qBAAe,KAAK;AAAA,IACrB;AAEA,oCAAgC;AAC/B,aAAO,SAAS,sEAAsE;AAAA,IACvF;AAEA,wCAAoC,SAAS,YAAW;AACvD,aAAO,IAAI,OAAO;AAClB,aAAO,KAAK;AAAA,QACX,QAAQ;AAAA,QACR,QAAQ;AAAA,QACR,SAAS;AAAA,UACR,oBAAoB;AAAA,QACrB;AAAA,QACA,UAAU,SAAU,GAAG;AACtB,iBAAO,IAAI,SAAS;AACpB,cAAI,cAAc;AAClB,cAAI,iBAAiB;AACrB,cAAI,eAAe;AACnB,cAAI,EAAE,WAAW,QAAW;AAC3B,gBAAI,EAAE,QAAQ,oBAAoB,GAAG;AACpC,4BAAc;AACd,+BAAiB,EAAE,QAAQ;AAC3B,6BAAe,EAAE,QAAQ;AAAA,YAC1B;AAAA,UACD;AAEA,cAAI,SAAS;AAAA,YACZ,WAAW;AAAA,UACZ;AACA,mBAAS,gBAAgB,MAAM,EAAE,KAAK,SAAU,gBAAgB;AAC/D,gBAAI,eAAe,OAAO;AACzB,gCAAkB,KAAK;AACvB,gCAAkB,0BAA0B;AAAA,YAC7C,WAAW,eAAe,kBAAkB,WAAW,GAAG;AACzD,gCAAkB,KAAK;AACvB,gCAAkB,0BAA0B;AAAA,YAC7C,OAAO;AACN,kBAAI,UAAU;AACd,uBAAQ,KAAK,eAAe,mBAAkB;AAC7C,0BAAU,UAAU,OAAO,eAAe,kBAAkB,GAAG;AAAA,cAChE;AACA,kBAAI,IAAI,IAAI,OAAO,GAAG,OAAO;AAAA,gBAC5B,UAAU;AAAA,kBACT,EAAC,aAAa,kBAAkB,aAAa,UAAU,QAAQ,GAAG,SAAS,iBAAiB,WAAW,QAAQ;AAAA,gBAChH;AAAA,gBACA,gBAAgB,WAAU;AACzB,sBAAI,WAAW,EAAE,WAAW,EAAE;AAC9B,sBAAI;AACJ,2BAAQ,KAAK,eAAe,mBAAkB;AAC7C,wBAAG,eAAe,kBAAkB,GAAG,SAAS,UAAS;AACxD,uCAAiB,eAAe,kBAAkB;AAClD,wBAAE,KAAK;AAAA,oBACR;AAAA,kBACD;AACA,2BAAS,cAAc,cAAc,EAAE,KAAK,SAAU,eAAe;AACpE,wBAAI,cAAc,OAAO;AACxB,wCAAkB,KAAK;AACvB,wCAAkB,uBAAuB,cAAc,MAAM,OAAO;AAAA,oBAErE,OAAO;AACN,0BAAI,EAAE,QAAQ,oBAAoB,KAAK,kBAAkB,MAAM,gBAAgB,IAAI;AAClF,iCAAS,0BAA0B;AAAA,0BAClC,kBAAkB;AAAA,0BAClB,qBAAqB;AAAA,wBACtB,CAAC;AAAA,sBACF;AACA,qCAAe,KAAK;AAAA,oBACrB;AAAA,kBACD,CAAC;AAAA,gBACF;AAAA,gBACA,kBAAkB,WAAU;AAC3B,yBAAO,SAAS,oDAAoD;AACpE,oBAAE,KAAK;AAAA,gBACR;AAAA,gBACA,wBAAwB;AAAA,gBACxB,OAAO;AAAA,cACR,CAAC;AACD,gBAAE,KAAK;AAAA,YACR;AAAA,UACD,CAAC;AAAA,QACF;AAAA,MACD,CAAC;AAAA,IACF;AAGA,SAAK,kBAAkB,eAAe,SAAQ;AAC7C,UAAI,MAAM,QAAQ,IAAI;AACtB,UAAI,QAAQ,CAAC;AACb,UAAI,QAAQ,KAAK,MAAM,QAAQ,IAAI,IAAI,0BAAwB,GAAG;AAClE,UAAI,QAAQ,KAAK,MAAM,QAAQ,IAAI,IAAI,cAAY,GAAG;AACtD,UAAI,WAAW,QAAQ,IAAI,IAAI;AAC/B,UAAI,MAAM,QAAQ,SAAS,KAAI;AAC9B,YAAI,SAAS,IAAI,SAAO;AACxB,YAAI,OAAO;AAAA,UACV,eAAe,IAAI;AAAA,UACnB,YAAY,KAAK,MAAM,IAAI,GAAG;AAAA,UAC9B,UAAU,KAAK,MAAM,MAAM;AAAA,QAC5B;AACA,cAAM,KAAK,IAAI;AAAA,MAChB,CAAC;AACD,YAAM,SAAS,mBAAmB;AAClC,eAAS,iBAAiB;AAAA,QACzB,MAAM;AAAA,QACN,MAAM;AAAA,UACL,YAAY;AAAA,UACZ,KAAK;AAAA,UACL;AAAA,UACA;AAAA,QACD;AAAA,MACD,CAAC;AAAA,IACF;AAEA,SAAK,sBAAsB,SAAS,SAAS,YAAW;AACvD,UAAG,QAAQ,IAAI,IAAI,aAAa,GAAE;AACjC,yBAAiB,IAAI,OAAO,GAAG,OAAO;AAAA,UACrC,OAAO;AAAA,UACP,QAAQ;AAAA,YAAC;AAAA,cACP,OAAO;AAAA,cACP,WAAW;AAAA,cACX,WAAW;AAAA,YACZ;AAAA,UACD;AAAA,UACA,sBAAsB;AAAA,UACtB,eAAe,QAAQ;AACtB,2BAAe,KAAK;AACpB,2BAAe,SAAS,UAAS;AAAA,UAClC;AAAA,UACA,wBAAwB;AAAA,UACxB,iBAAiB,QAAQ;AACxB,2BAAe,KAAK;AAAA,UACrB;AAAA,QACD,CAAC;AACD,YAAI,OAAO,gEAAgE,QAAQ,IAAI,IAAI,SAAS,YAAY,IAAI;AACpH,gBAAQ,QAAQ,IAAI,IAAI,cAAc,KAAK;AAC3C,uBAAe,YAAY,YAAY,SAAS,KAAK,IAAI;AACzD,uBAAe,KAAK;AAAA,MACrB,OACI;AACH,uBAAe,SAAS,UAAS;AAAA,MAClC;AAAA,IACD;AAGA,4BAAwB,SAAS,YAAU;AAC1C,yBAAmB,sBAAsB,mCAAmC;AAC5E,aAAO,IAAI,OAAO;AAClB,UAAI,WAAW,QAAQ,IAAI,IAAI;AAC/B,eAAS,QAAQ,SAAS,KAAI;AAC7B,YAAG,IAAI,mBAAmB,OAAO,wBAAuB;AACvD,iBAAO,KAAK;AAAA,YACX,QAAQ;AAAA,YACR,QAAQ;AAAA,YACR,MAAM;AAAA,cACL,qBAAqB,IAAI;AAAA,cACzB,UAAU,IAAI,YAAY,QAAQ,CAAC,IAAE;AAAA,YACtC;AAAA,YACA,SAAS;AAAA,cACR,oBAAoB;AAAA,YACrB;AAAA,YACA,UAAU,SAAS,QAAO;AACzB,6BAAe,KAAK;AACpB,qBAAO,IAAI,SAAS;AACpB,kBAAI,YAAW;AACd,wBAAQ,IAAI,WAAW,EACrB,KAAK,CAAC,kBAAkB;AACxB,sBAAI,iBAAiB,cAAc,KAAK;AACvC,4BAAQ,IAAI,IAAI,YAAY,cAAc,IAAI;AAC9C,2BAAO,WAAW;AAAA,sBACjB,WAAW;AAAA,sBACX,SAAS,GAAG,eAAe,cAAc,IAAI,0BAA0B;AAAA,oBACxE,CAAC;AACD,4BAAQ,kBAAkB,KAAK;AAC/B,4BAAQ,cAAc,iBAAiB,IAAI;AAC3C,4BAAQ,cAAc,gBAAgB,QAAQ,IAAI,KAAK,IAAI;AAAA,kBAC5D;AAAA,gBACD,CAAC;AAAA,cAEH,OAAO;AACN,wBAAQ,QAAQ,OAAO,eAAe;AAAA,cACvC;AAAA,YACD;AAAA,UACD,CAAC;AAAA,QACF;AAAA,MACD,CAAC;AAAA,IACF;AAGA,4BAAwB,SAAS,YAAU;AAC1C,yBAAmB,uBAAuB,oCAAoC;AAC9E,aAAO,IAAI,OAAO;AAClB,aAAO,KAAK;AAAA,QACX,QAAQ;AAAA,QACR,QAAQ;AAAA,QACR,MAAM;AAAA,UACL,iBAAiB,QAAQ,IAAI;AAAA,QAC9B;AAAA,QACA,SAAS;AAAA,UACR,oBAAoB;AAAA,QACrB;AAAA,QACA,UAAU,SAAU,GAAG;AACtB,mBAAS,qBAAqB,EAAE,QAAQ,aAAa,EAAE,KAAK,SAAU,QAAQ;AAC7E,gBAAI,OAAO,OAAO;AACjB,6BAAe,KAAK;AACpB,wCAA0B,OAAO,MAAM,OAAO;AAAA,YAC/C,OAAO;AACN,uBAAS,eAAe,OAAO,aAAa,EAAE,KAAK,SAAU,SAAQ;AACpE,oBAAI,QAAO,OAAO;AACjB,iCAAe,KAAK;AACpB,4CAA0B,QAAO,MAAM,OAAO;AAAA,gBAC/C,WAAW,QAAO,eAAe;AAChC,iCAAe,KAAK;AACpB,mCAAiB,IAAI,OAAO,GAAG,OAAO;AAAA,oBACrC,OAAO;AAAA,oBACP,QAAQ;AAAA,sBAAC;AAAA,wBACP,OAAO;AAAA,wBACP,WAAW;AAAA,wBACX,WAAW;AAAA,sBACZ;AAAA,oBACD;AAAA,oBACA,sBAAsB;AAAA,oBACtB,eAAe,QAAQ;AACtB,sCAAgB,SAAS,YAAW,QAAO,aAAa;AAAA,oBACzD;AAAA,oBACA,wBAAwB;AAAA,oBACxB,iBAAiB,QAAQ;AACxB,qCAAe,SAAS,YAAW,QAAO,aAAa;AAAA,oBACxD;AAAA,kBACD,CAAC;AACD,sBAAI,OAAO,iEAAiE,QAAO,cAAc,SAAS,YAAY,IAAI;AAC1H,0BAAQ,QAAO,cAAc,SAAO,MAAM;AAC1C,iCAAe,YAAY,YAAY,SAAS,KAAK,IAAI;AACzD,iCAAe,KAAK;AAAA,gBACrB;AAAA,cACD,CAAC;AAAA,YACF;AAAA,UACD,CAAC;AAAA,QAEF;AAAA,MACD,CAAC;AAAA,IACF;AAGA,4BAAwB,SAAS,YAAW,gBAAe;AAC1D,qBAAe,KAAK;AAEpB,UAAI,mBAAmB,IAAI,OAAO,GAAG,OAAO;AAAA,QAC3C,OAAO;AAAA,QACP,QAAQ;AAAA,UAAC;AAAA,YACP,OAAO;AAAA,YACP,WAAW;AAAA,YACX,WAAW;AAAA,UACZ;AAAA,QACD;AAAA,MACD,CAAC;AACD,UAAI,OAAO;AACX,cAAQ;AACR,cAAQ;AACR,uBAAiB,YAAY,YAAY,SAAS,KAAK,IAAI;AAC3D,uBAAiB,KAAK;AACtB,aAAO,KAAK;AAAA,QACX,QAAQ;AAAA,QACR,QAAQ;AAAA,QACR,MAAM;AAAA,UACL,qBAAqB,eAAe;AAAA,UACpC,oBAAoB,QAAQ,IAAI,IAAI;AAAA,QACrC;AAAA,QACA,SAAS;AAAA,UACR,oBAAoB;AAAA,QACrB;AAAA,QACA,UAAU,SAAU,eAAe;AAClC,iBAAO,IAAI,SAAS;AACpB,2BAAiB,KAAK;AACtB,iBAAO,SAAS,2BAA2B;AAAA,QAC5C;AAAA,MACD,CAAC;AAAA,IACF;AAGA,6BAAyB,SAAS,YAAW,gBAAe;AAC3D,qBAAe,KAAK;AACpB,yBAAmB,uBAAuB,oCAAoC;AAC9E,aAAO,KAAK;AAAA,QACX,QAAQ;AAAA,QACR,QAAQ;AAAA,QACR,MAAM;AAAA,UACL,qBAAqB,eAAe;AAAA,UACpC,oBAAoB,QAAQ,IAAI,IAAI;AAAA,QACrC;AAAA,QACA,SAAS;AAAA,UACR,oBAAoB;AAAA,QACrB;AAAA,QACA,UAAU,SAAU,eAAe;AAClC,iBAAO,IAAI,SAAS;AACpB,yBAAe,KAAK;AACpB,cAAI,WAAW,QAAQ,IAAI,IAAI;AAC/B,mBAAS,QAAQ,SAAS,KAAI;AAC7B,gBAAG,IAAI,mBAAmB,OAAO,wBAAuB;AACvD,kBAAI,YAAY,cAAc,QAAQ,QAAQ,KAAK,GAAG,uBAAuB;AAC7E,kBAAI,aAAa,UAAU;AAC3B,kBAAI,aAAa,UAAU;AAC3B,kBAAI,oBAAoB,UAAU,QAAQ;AAC1C,kBAAI,kCAAkC,UAAU,QAAQ;AACxD,kBAAI,2BAA2B,UAAU,QAAQ;AACjD,kBAAI,mCAAmC,UAAU,QAAQ;AACzD,kBAAI,8BAA8B,UAAU,QAAQ;AACpD,kBAAI,qCAAqC,UAAU,QAAQ;AAC3D,kBAAI,sCAAsC,UAAU,QAAQ;AAC5D,kBAAI,0BAA0B,UAAU,QAAQ;AAChD,kBAAI,iBAAiB,cAAc,QAAQ,QAAQ,KAAK,GAAG;AAC3D,kBAAI,sBAAsB,cAAc,QAAQ,QAAQ,KAAK,GAAG;AAAA,YACjE;AAAA,UACD,CAAC;AAED,cAAI,YAAW;AACd,oBAAQ,IAAI,WAAW,EACrB,KAAK,CAAC,kBAAkB;AAExB,kBAAG,OAAO,kCAAkC,GAAE;AAC7C,wBAAQ,QAAQ,OAAO,iBAAiB;AAAA,cACzC;AAEA,kBAAG,OAAO,uBAAuB,GAAE;AAClC,wBAAQ,QAAQ,OAAO,UAAU,KAAK,GAAG;AAAA,cAC1C;AAEA,kBAAI,iBAAiB,cAAc,KAAK;AACvC,wBAAQ,IAAI,IAAI,YAAY,cAAc,IAAI;AAC9C,uBAAO,WAAW;AAAA,kBACjB,WAAW;AAAA,kBACX,SAAS,GAAG,eAAe,cAAc,IAAI,0BAA0B;AAAA,gBACxE,CAAC;AACD,uBAAO,KAAK;AAAA,kBACX,QAAQ;AAAA,kBACR,QAAQ;AAAA,kBACR,MAAM;AAAA,oBACL,qBAAqB,eAAe;AAAA,oBACpC,oBAAoB,cAAc,IAAI;AAAA,kBACvC;AAAA,kBACA,SAAS;AAAA,oBACR,oBAAoB;AAAA,kBACrB;AAAA,kBACA,UAAU,SAAU,gBAAe;AAClC,4BAAQ,kBAAkB,KAAK;AAC/B,4BAAQ,cAAc,iBAAiB,IAAI;AAC3C,4BAAQ,cAAc,gBAAgB,QAAQ,IAAI,KAAK,IAAI;AAAA,kBAC5D;AAAA,gBACD,CAAC;AAAA,cACF;AAAA,YACD,CAAC;AAAA,UAEH,OAAO;AACN,oBAAQ,QAAQ,OAAO,eAAe;AAAA,UACvC;AAAA,QACD;AAAA,MACD,CAAC;AAAA,IACF;AAEA,mCAA+B,KAAI,iBAAgB,YACnD;AACC,qBAAe,KAAK;AACpB,UAAG,oBAAoB,iBAAgB,UAAS;AAAA,IAGjD;AACA,qCACA;AACC,qBAAe,KAAK;AACpB,QAAE,wBAAwB,EAAE,MAAM;AAAA,IAEnC;AAEA,+BAA2B,SAAS;AACnC,uBAAiB,IAAI,OAAO,GAAG,OAAO;AAAA,QACrC,OAAO;AAAA,QACP,QAAQ;AAAA,UAAC;AAAA,YACP,OAAO;AAAA,YACP,WAAW;AAAA,YACX,WAAW;AAAA,UACZ;AAAA,QACD;AAAA,QACA,sBAAsB;AAAA,QACtB,eAAe,QAAQ;AACtB,gCAAsB,EAAE;AACxB,yBAAe,KAAK;AAAA,QACrB;AAAA,MACD,CAAC;AACD,UAAI,OAAO,QAAQ,UAAU;AAC7B,qBAAe,YAAY,YAAY,SAAS,KAAK,IAAI;AACzD,qBAAe,KAAK;AAAA,IACrB;AAEA,uCAAmC,SAAS;AAC3C,uBAAiB,IAAI,OAAO,GAAG,OAAO;AAAA,QACrC,OAAO;AAAA,QACP,QAAQ;AAAA,UAAC;AAAA,YACP,OAAO;AAAA,YACP,WAAW;AAAA,YACX,WAAW;AAAA,UAEZ;AAAA,QAED;AAAA,QACA,sBAAsB;AAAA,QACtB,wBAAwB;AAAA,QACxB,eAAe,QAAQ;AACtB,gCAAsB,IAAI,gBAAgB,SAAS;AAAA,QAEpD;AAAA,QACA,iBAAiB,QAAQ;AACxB,gCAAsB;AAAA,QACvB;AAAA,MACD,CAAC;AACD,UAAI,OAAO,QAAQ,UAAU;AAC7B,qBAAe,YAAY,YAAY,SAAS,KAAK,IAAI;AACzD,qBAAe,KAAK;AAAA,IACrB;AAAA,EACD;;;ACvdA,sBAAmB;AAEnB,UAAQ,YAAY,eAAe,MAAM;AAAA,IAExC,YAAY,EAAE,KAAK,SAAS,QAAQ,aAAa,YAAY;AAC5D,WAAK,UAAU;AACf,WAAK,SAAS;AACd,WAAK,cAAc;AACnB,WAAK,cAAc,SAAS;AAC5B,WAAK,gBAAgB,SAAS;AAE9B,WAAK,eAAe;AAAA,IACrB;AAAA,IAEA,iBAAiB;AAChB,WAAK,YAAY;AACjB,WAAK,gBAAgB;AACrB,WAAK,gBAAgB;AACrB,WAAK,YAAY;AACjB,WAAK,iBAAiB;AAAA,IACvB;AAAA,IAEA,cAAc;AACb,WAAK,QAAQ,OACZ;AAAA;AAAA,0BAEuB,GAAG,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA,cAMtC;AAEA,WAAK,aAAa,KAAK,QAAQ,KAAK,iBAAiB;AACrD,WAAK,mBAAmB,KAAK,WAAW,KAAK,kBAAkB;AAAA,IAChE;AAAA,UAEM,kBAAkB;AACvB,UAAI,CAAC,KAAK,YAAY;AACrB,cAAM,MAAM,MAAM,OAAO,GAAG,UAAU,cAAc,EAAC,KAAK,GAAG,UAAU,EAAC,GAAG,MAAM;AACjF,aAAK,oBAAoB,IAAI,QAAQ;AAAA,MACtC;AACA,UAAI,CAAC,KAAK,YAAY;AACrB,cAAM,MAAM,MAAM,OAAO,GAAG,UAAU,eAAe,KAAK,aAAa,oBAAoB;AAC3F,aAAK,aAAa,IAAI,QAAQ;AAAA,MAC/B;AAEA,WAAK,UAAU,CAAC,CAAC,EAAE,KAAK,CAAC,EAAC,cAAa;AACtC,aAAK,iBAAiB,QAAQ,KAAK;AAAA,MACpC,CAAC;AAAA,IACF;AAAA,IAEA,UAAU,EAAC,QAAQ,GAAG,cAAc,IAAI,cAAY,MAAK;AACxD,YAAM,MAAM,KAAK,OAAO,QAAQ,EAAE;AAClC,YAAM,aAAc,OAAO,IAAI,sBAAuB,KAAK;AAC3D,UAAI,EAAE,YAAY,gBAAgB;AAClC,cAAQ,IAAI,EAAC,QAAQ,KAAI,CAAC;AAC1B,cAAQ,IAAI,EAAC,cAAc,YAAY,eAAe,YAAW,CAAC;AAClE,OAAC,cAAe,cAAa,KAAK;AAElC,aAAO,OAAO,KAAK;AAAA,QAClB,QAAQ;AAAA,QACR,QAAQ;AAAA,QACR,MAAM,EAAE,OAAO,aAAa,YAAY,YAAY,aAAa,YAAY;AAAA,MAC9E,CAAC;AAAA,IACF;AAAA,IAGA,iBAAiB,OAAO;AACvB,WAAK,iBAAiB,KAAK,EAAE;AAE7B,YAAM,QAAQ,UAAQ;AACrB,cAAM,YAAY,KAAK,cAAc,IAAI;AACzC,aAAK,iBAAiB,OAAO,SAAS;AAAA,MACvC,CAAC;AAAA,IACF;AAAA,IAEA,cAAc,MAAM;AACnB,YAAM,KAAK;AAEX,YAAM,EAAE,YAAY,WAAW,UAAU,SAAS,YAAY,WAAW,oBAAoB;AAC7F,YAAM,aAAY,IAAI,iBAAiB,CAAC,IAAI,KAAK,IAAI,IAAI;AACzD,UAAI;AACJ,UAAI,iBAAiB;AAErB,UAAI,KAAK,eAAe;AACvB,0BAAmB,aAAa,KAAK,UAAU,cAAc,IAAI,QAAQ;AAEzE,YAAI,KAAK,MAAM,cAAc,IAAI,KAAK;AACrC,2BAAiB,KAAK,MAAM,cAAc,IAAE;AAC5C,2BAAiB,eAAe,QAAQ,CAAC,IAAI;AAAA,QAC9C;AAAA,MACD,OAAO;AACN,0BAAkB;AAClB,yBAAiB;AAAA,MAClB;AAEA,qCAA+B;AAC9B,YAAI,CAAC,GAAG,eAAe,YAAY;AAClC,iBAAO;AAAA,uDAC4C,oBAAoB;AAAA;AAAA;AAAA;AAAA;AAAA,8BAK7C;AAAA,eACf,OAAO,SAAS,KAAK,SAAS;AAAA;AAAA;AAAA,QAG1C,OAAO;AACN,iBAAO;AAAA,uDAC4C,oBAAoB;AAAA;AAAA,uCAEpC,OAAO,SAAS,KAAK,SAAS;AAAA,QAClE;AAAA,MACD;AAEA,aACC;AAAA,sBACmB,OAAO,KAAK,SAAS,sBAAsB,OAAO,SAAS;AAAA,qBAC5D,OAAO,QAAQ,gBAAgB,OAAO,SAAS;AAAA,iBACnD,OAAO,mBAAmB,CAAC;AAAA,aAC/B,KAAK;AAAA;AAAA,MAEZ,oBAAoB;AAAA;AAAA;AAAA;AAAA,QAIlB,OAAO,SAAS,KAAK,WAAW,EAAE;AAAA;AAAA,8BAEZ,gBAAgB,iBAAiB,KAAK,UAAU,UAAS,KAAK;AAAA;AAAA;AAAA,IAI3F;AAAA,IAEA,oBAAoB,MAAM;AACzB,YAAM,YAAY,EAAE,IAAI,EAAE,KAAK,KAAK;AACpC,QAAE,IAAI,EAAE,OAAO,EAAE,YAAY,kCAAkC,iBAAiB;AAAA,IACjF;AAAA,IAEA,kBAAkB;AACjB,YAAM,KAAK;AACX,YAAM,MAAM,GAAG,OAAO,QAAQ,EAAE;AAChC,WAAK,WAAW,KAAK,eAAe,EAAE,KAAK,EAAE;AAC7C,WAAK,WAAW,KAAK,mBAAmB,EAAE,KAAK,EAAE;AAEjD,WAAK,eAAe,OAAO,GAAG,KAAK,aAAa;AAAA,QAC/C,IAAI;AAAA,UACH,OAAO,GAAG,QAAQ;AAAA,UAClB,WAAW;AAAA,UACX,aAAa,GAAG,+CAA+C;AAAA,QAChE;AAAA,QACA,QAAQ,KAAK,WAAW,KAAK,eAAe;AAAA,QAC5C,cAAc;AAAA,MACf,CAAC;AACD,WAAK,mBAAmB,OAAO,GAAG,KAAK,aAAa;AAAA,QACnD,IAAI;AAAA,UACH,OAAO,GAAG,YAAY;AAAA,UACtB,WAAW;AAAA,UACX,SAAS;AAAA,UACT,aAAa,GAAG,mBAAmB;AAAA,UACnC,UAAU,WAAW;AACpB,eAAG,aAAa,KAAK;AACrB,aAAC,GAAG,cAAe,IAAG,aAAa,GAAG;AACtC,eAAG,aAAa;AAAA,UACjB;AAAA,UACA,WAAW,WAAY;AACtB,mBAAO;AAAA,cACN,OAAO;AAAA,cACP,SAAS;AAAA,gBACR,aAAa,MAAM,IAAI,cAAc;AAAA,cACtC;AAAA,YACD;AAAA,UACD;AAAA,QACD;AAAA,QACA,QAAQ,KAAK,WAAW,KAAK,mBAAmB;AAAA,QAChD,cAAc;AAAA,MACf,CAAC;AACD,WAAK,aAAa,aAAa,KAAK;AACpC,WAAK,iBAAiB,aAAa,KAAK;AAExC,WAAK,iBAAiB;AAAA,IACvB;AAAA,IAEA,mBAAmB;AAClB,WAAK,aAAa,SAAS,KAAK,gBAAgB,EAAE,OACjD;AAAA,+CAC4C,GAAG,OAAO;AAAA,OAClD,OAAO,MAAM,KAAK,SAAS,IAAI;AAAA;AAAA,WAGpC;AAEA,WAAK,oBAAoB,KAAK,aAAa,SAAS,KAAK,WAAW;AAEpE,WAAK,kBAAkB,GAAG,SAAS,KAAK,MAAM;AAC7C,aAAK,iBAAiB,EAAE;AACxB,aAAK,aAAa,UAAU;AAAA,MAC7B,CAAC;AAAA,IACF;AAAA,IAEA,iBAAiB,OAAO;AACvB,QAAE,KAAK,aAAa,OAAO,EAAE,EAAE,IAAI,KAAK,EAAE,QAAQ,OAAO;AAAA,IAC1D;AAAA,IAEA,cAAc;AACb,YAAM,KAAK;AACX,aAAO,SAAS;AAEhB,4BAAO,iBAAiB,SAAU,QAAQ;AACzC,YAAI,QAAQ,KAAK,qBAAqB,MAAM;AAC5C,gBAAQ;AAAA,eACF,UAAS,MAAM,SAAS;AAAA,eACxB,UAAS,OAAO,SAAS;AAAA,eACxB,UAAS,OAAO,SAAS,OAAQ,SAAS;AAAA,eAC3C,UAAS,OAAO,SAAS;AAAA,eACzB,UAAS,OAAO,SAAS;AAAA,eACzB,SAAS;AACb,gBAAI,OAAO,QAAQ,UAAa,OAAO,QAAQ,IAAI;AAClD,qBAAO,OAAO;AAAA,YACf;AAEA,gBAAI,WAAW,OAAO,aAAa,KAAK;AACxC,oBAAQ,OAAO;AAAA,mBACT;AAAO,2BAAW,SAAS,YAAY;AAAG;AAAA,mBAC1C;AAAM,2BAAW,SAAS,YAAY;AAAG;AAAA;AAE/C,mBAAO;AAAA,eACH,UAAS,MAAM,SAAS;AAC5B,mBAAO,IAAK,SAAQ;AAAA;AAEtB,eAAO;AAAA,MACR;AAEA,4BAAO,SAAS,UAAU;AAAA,QACzB,QAAQ,CAAC,cAAc;AACtB,cAAI,KAAK,gBAAgB,KAAK,WAAW,GAAG,UAAU,GAAG;AACxD,iBAAK,aAAa,UAAU;AAC5B,iBAAK,iBAAiB,SAAS;AAC/B,iBAAK,kBAAkB;AAAA,UACxB;AAAA,QACD;AAAA,MACD,CAAC;AAED,WAAK,WAAW,GAAG,SAAS,iBAAiB,WAAW;AACvD,cAAM,QAAQ,EAAE,IAAI;AACpB,cAAM,YAAY,SAAS,MAAM,KAAK,gBAAgB,CAAC;AACvD,YAAI,WAAW,SAAS,MAAM,KAAK,eAAe,CAAC;AACnD,YAAI,YAAY,SAAS,MAAM,KAAK,gBAAgB,CAAC;AACrD,YAAI,MAAM,SAAS,MAAM,KAAK,UAAU,CAAC;AACzC,YAAI,OAAO,SAAS,MAAM,KAAK,WAAW,CAAC;AAG3C,mBAAW,aAAa,cAAc,SAAY;AAClD,oBAAY,cAAc,cAAc,SAAY;AACpD,cAAM,QAAQ,cAAc,SAAY;AACxC,eAAO,SAAS,cAAc,SAAY;AAE1C,WAAG,OAAO,cAAc;AAAA,UACvB,OAAO;AAAA,UACP,OAAO;AAAA,UACP,MAAM,EAAE,WAAW,UAAU,WAAW,KAAK,KAAK;AAAA,QACnD,CAAC;AACD,WAAG,aAAa,UAAU;AAAA,MAC3B,CAAC;AAED,WAAK,aAAa,OAAO,GAAG,SAAS,CAAC,MAAM;AAC3C,qBAAa,KAAK,WAAW;AAC7B,aAAK,cAAc,WAAW,MAAM;AACnC,gBAAM,cAAc,EAAE,OAAO;AAC7B,eAAK,aAAa,EAAE,YAAY,CAAC;AAAA,QAClC,GAAG,GAAG;AAEN,aAAK,kBAAkB,OACtB,QAAQ,KAAK,aAAa,OAAO,IAAI,CAAC,CACvC;AAAA,MACD,CAAC;AAED,WAAK,aAAa,OAAO,GAAG,SAAS,MAAM;AAC1C,aAAK,kBAAkB,OACtB,QAAQ,KAAK,aAAa,OAAO,IAAI,CAAC,CACvC;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,mBAAmB;AAClB,YAAM,aAAa,OAAO,MAAM,OAAO,IAAI,WAAM;AACjD,WAAK,aAAa,OAAO,KAAK,SAAS,GAAG,cAAc;AACxD,aAAO,GAAG,KAAK,aAAa;AAAA,QAC3B,UAAU;AAAA,QACV,QAAQ,MAAM,KAAK,aAAa,UAAU;AAAA,QAC1C,WAAW,MAAM,KAAK,WAAW,GAAG,UAAU;AAAA,QAC9C,aAAa,GAAG,uBAAuB;AAAA,QACvC,eAAe;AAAA,QACf,MAAM,SAAS,KAAK;AAAA,MACrB,CAAC;AACD,WAAK,iBAAiB,OAAO,KAAK,SAAS,GAAG,cAAc;AAC5D,aAAO,GAAG,KAAK,aAAa;AAAA,QAC3B,UAAU;AAAA,QACV,QAAQ,MAAM,KAAK,iBAAiB,UAAU;AAAA,QAC9C,WAAW,MAAM,KAAK,WAAW,GAAG,UAAU;AAAA,QAC9C,aAAa,GAAG,4BAA4B;AAAA,QAC5C,eAAe;AAAA,QACf,MAAM,SAAS,KAAK;AAAA,MACrB,CAAC;AAGD,aAAO,GAAG,KAAK,GAAG,SAAS,MAAM;AAChC,cAAM,sBAAsB,KAAK,WAAW,GAAG,UAAU;AACzD,YAAI,CAAC,uBAAuB,KAAK,aAAa,UAAU,MAAM;AAAI;AAElE,YAAI,KAAK,MAAM,UAAU,GAAG;AAC3B,eAAK,iBAAiB,KAAK,eAAe,EAAE,MAAM;AAClD,iBAAO,MAAM,WAAW,QAAQ;AAChC,eAAK,iBAAiB,EAAE;AAAA,QACzB,WAAW,KAAK,MAAM,UAAU,KAAK,KAAK,iBAAiB;AAE1D,iBAAO,WAAW;AAAA,YACjB,SAAS,GAAG,qCAAqC;AAAA,YACjD,WAAW;AAAA,UACZ,CAAC;AACD,iBAAO,MAAM,WAAW,OAAO;AAC/B,eAAK,kBAAkB;AACvB,eAAK,iBAAiB,EAAE;AAAA,QACzB;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,aAAa,EAAE,cAAY,OAAK,CAAC,GAAG;AACnC,UAAI,aAAa;AAChB,sBAAc,YAAY,YAAY;AAGtC,aAAK,eAAe,KAAK,gBAAgB,CAAC;AAC1C,YAAI,KAAK,aAAa,cAAc;AACnC,gBAAM,QAAQ,KAAK,aAAa;AAChC,eAAK,QAAQ;AACb,eAAK,iBAAiB,KAAK;AAC3B,eAAK,iBAAiB,KAAK,MAAM,UAAU,KAAK,KAAK,0BAA0B;AAC/E;AAAA,QACD;AAAA,MACD;AAEA,WAAK,UAAU,EAAE,YAAY,CAAC,EAC5B,KAAK,CAAC,EAAE,cAAc;AAEtB,cAAM,EAAE,OAAO,WAAW,UAAU,YAAY;AAChD,YAAI,eAAe,CAAC,SAAS;AAC5B,eAAK,aAAa,eAAe;AAAA,QAClC;AACA,aAAK,QAAQ;AACb,aAAK,iBAAiB,KAAK;AAC3B,aAAK,iBAAiB,KAAK,MAAM,UAAU,KAAK,KAAK,0BAA0B;AAAA,MAChF,CAAC;AAAA,IACH;AAAA,IAEA,4BAA4B;AAC3B,WAAK,iBAAiB,KAAK,eAAe,EAAE,MAAM;AAClD,WAAK,iBAAiB,EAAE;AAAA,IACzB;AAAA,IAEA,gBAAgB,UAAU;AACzB,iBACC,KAAK,WAAW,KAAK,iBAAiB,EAAE,IAAI,yBAAyB,2BAA2B,IAChG,KAAK,WAAW,KAAK,iBAAiB,EAAE,IAAI,yBAAyB,4BAA4B;AAElG,iBACC,KAAK,WAAW,KAAK,eAAe,EAAE,IAAI,UAAU,sBAAsB,IAC1E,KAAK,WAAW,KAAK,eAAe,EAAE,IAAI,UAAU,sBAAsB;AAE3E,iBACC,KAAK,WAAW,IAAI,eAAe,iBAAiB,IACpD,KAAK,WAAW,IAAI,eAAe,iBAAiB;AAErD,iBACC,KAAK,iBAAiB,IAAI,yBAAyB,2BAA2B,IAC9E,KAAK,iBAAiB,IAAI,yBAAyB,2BAA2B;AAAA,IAChF;AAAA,IAEA,iBAAiB,MAAM;AACtB,WAAK,iBAAiB,EAAE;AACxB,WAAK,WAAW,IAAI,WAAW,OAAO,SAAQ,MAAM;AAAA,IACrD;AAAA,EACD;;;ACjYA,UAAQ,YAAY,WAAW,MAAM;AAAA,IACnC,YAAY,EAAE,SAAS,QAAQ,YAAY;AACzC,WAAK,UAAU;AACf,WAAK,SAAS;AACd,WAAK,gBAAgB;AACrB,WAAK,cAAc,SAAS;AAC5B,WAAK,0BAA0B,SAAS;AACxC,WAAK,oBAAoB,SAAS;AAClC,WAAK,wBAAwB,SAAS;AACtC,WAAK,eAAe;AAAA,IACtB;AAAA,IAEA,iBAAiB;AACf,WAAK,YAAY;AACjB,WAAK,sBAAsB;AAC3B,WAAK,YAAY;AACjB,WAAK,iBAAiB;AAAA,IACxB;AAAA,IAEA,cAAc;AACZ,WAAK,QAAQ,OAAO,qDAAqD;AAEzE,WAAK,aAAa,KAAK,QAAQ,KAAK,0BAA0B;AAAA,IAChE;AAAA,IAEA,wBAAwB;AACtB,WAAK,uBAAuB;AAC5B,WAAK,qBAAqB;AAAA,IAC5B;AAAA,IAEA,yBAAyB;AACvB,WAAK,WAAW,OAAO,sCAAsC;AAC7D,WAAK,oBAAoB,KAAK,WAAW,KAAK,mBAAmB;AACjE,WAAK,uBAAuB;AAAA,IAC9B;AAAA,IAEA,0BAA0B;AACxB,YAAM,MAAM,KAAK,OAAO,QAAQ;AAChC,UAAI,UAAU,YAAY,EAAE;AAC5B,WAAK,uBAAuB;AAC5B,WAAK,eAAe,UAAU;AAAA,IAChC;AAAA,IAEA,uBAAuB;AACrB,WAAK,WAAW,OACd;AAAA;AAAA,+BAEyB,GAAG,WAAW;AAAA;AAAA,iCAEZ,GAAG,MAAM;AAAA,gCACV,GAAG,UAAU;AAAA,wCACL,GAAG,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAO/C;AACA,WAAK,kBAAkB,KAAK,WAAW,KAAK,iBAAiB;AAE7D,WAAK,yBAAyB;AAC9B,WAAK,wBAAwB;AAC7B,WAAK,iBAAiB;AAAA,IACxB;AAAA,IAEA,0BAA0B;AACxB,WAAK,eAAe,KAAK,WAAW,KAAK,cAAc;AACvD,WAAK,sBAAsB,KAAK,WAAW,KAAK,qBAAqB;AAErE,WAAK,0BAA0B;AAAA,IACjC;AAAA,IAEA,4BAA4B;AAC1B,WAAK,aAAa,IAAI,WAAW,MAAM;AACvC,WAAK,oBAAoB,KACvB,gCAAgC,GAAG,kBAAkB,SACvD;AAAA,IACF;AAAA,IAEA,oBAAoB;AAClB,aAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAMT;AAAA,IAEA,2BAA2B;AACzB,WAAK,kBAAkB,KAAK,WAAW,KAAK,sBAAsB;AAElE,WAAK,gBAAgB,OACnB;AAAA,MACA,KAAK,kBAAkB,KAAK,GAAG,cAAc;AAAA;AAAA;AAAA,wCAGX,GAAG,aAAa;AAAA;AAAA;AAAA;AAAA,mCAIrB,GAAG,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA,WAKtC,GAAG,aAAa;AAAA;AAAA;AAAA,+BAGI,GAAG,UAAU;AAAA,gCACZ,GAAG,WAAW,SAC1C;AAEA,WAAK,qBAAqB,KAAK,WAAW,KAAK,uBAAuB;AAAA,IACxE;AAAA,IAEA,mBAAmB;AACjB,WAAK,kBAAkB,KAAK,WAAW,KAAK,iBAAiB;AAE7D,WAAK,aAAa,IAAI,QAAQ,YAAY,UAAU;AAAA,QAClD,SAAS,KAAK;AAAA,QACd,QAAQ;AAAA,UACN,cAAc,KAAK,gBAAgB,KAAK,IAAI;AAAA,QAC9C;AAAA,QACA,MAAM;AAAA,QACN,MAAM;AAAA,UACJ,CAAC,GAAG,GAAG,GAAG,UAAU;AAAA,UACpB,CAAC,GAAG,GAAG,GAAG,UAAU;AAAA,UACpB,CAAC,GAAG,GAAG,GAAG,MAAM;AAAA,UAChB,CAAC,KAAK,GAAG,UAAU,QAAQ;AAAA,QAC7B;AAAA,QACA,aAAa;AAAA,UACX,CAAC,IAAI,IAAI,IAAI,YAAY;AAAA,UACzB,CAAC,IAAI,IAAI,IAAI,YAAY;AAAA,UACzB,CAAC,IAAI,IAAI,IAAI,YAAY;AAAA,UACzB,CAAC,IAAI,IAAI,IAAI,uBAAuB;AAAA,QACtC;AAAA,QACA,gBAAgB,EAAE,UAAU,OAAO,UAAU,sBAAsB;AAAA,MACrE,CAAC;AAED,WAAK,gBAAgB,QACnB;AAAA;AAAA;AAAA;AAAA,UAKF;AAEA,WAAK,gBAAgB,OACnB,qEAAqE,GACnE,UACF,SACF;AAAA,IACF;AAAA,IAEA,cAAc;AACZ,YAAM,KAAK;AACX,WAAK,kBAAkB,GAAG,SAAS,uBAAuB,WAAY;AACpE,WAAG,wBAAwB;AAAA,MAC7B,CAAC;AAED,WAAK,kBAAkB,GAAG,SAAS,sBAAsB,WAAY;AACnE,WAAG,qBAAqB,KAAK;AAAA,MAC/B,CAAC;AAED,WAAK,kBAAkB,GAAG,SAAS,qBAAqB,SAAU,GAAG;AACnE,YAAI,EAAE,EAAE,MAAM,EAAE,QAAQ,qBAAqB,EAAE;AAAQ;AAEvD,cAAM,OAAO,GAAG,gBAAgB,GAAG,UAAU;AAC7C,WAAG,qBAAqB,IAAI;AAAA,MAC9B,CAAC;AAED,WAAK,oBAAoB,GAAG,SAAS,sBAAsB,WAAY;AACrE,cAAM,aAAa,EAAE,IAAI;AAEzB,WAAG,sBAAsB,IAAI;AAE7B,cAAM,yBAAyB,CAAC,GAAG,gBAChC,KAAK,gBAAgB,EACrB,GAAG,UAAU;AAChB,YAAI,CAAC,wBAAwB;AAG3B,aAAG,gBAAgB,KAAK,gBAAgB,EAAE,MAAM;AAAA,QAClD;AAEA,cAAM,gBAAgB,SAAS,WAAW,KAAK,eAAe,CAAC;AAC/D,WAAG,OAAO,kBAAkB,EAAE,MAAM,cAAc,CAAC;AACnD,aAAK,eAAe;AAAA,MACtB,CAAC;AAED,WAAK,WAAW,GAAG,SAAS,iBAAiB,iBAAkB;AAC7D,YAAI,EAAE,IAAI,EAAE,KAAK,OAAO,EAAE,QAAQ,YAAY,KAAK;AAAI;AAEvD,cAAM,GAAG,OAAO,SAAS;AACzB,WAAG,oBAAoB,KAAK;AAE5B,WAAG,yBAAyB,GAAG,mBAAmB,YAAY,QAAQ;AAAA,MACxE,CAAC;AAED,WAAK,gBAAgB,GAAG,SAAS,kBAAkB,MAAM;AACvD,aAAK,OAAO,UAAU;AACtB,aAAK,oBAAoB,IAAI;AAAA,MAC/B,CAAC;AAED,WAAK,WAAW,GAAG,SAAS,yBAAyB,MAAM;AACzD,cAAM,oBACJ,KAAK,mBAAmB,KAAK,oBAAoB,EAAE;AAErD,YAAI,CAAC,KAAK,kBAAkB;AAC1B,eAAK,sBAAsB;AAAA,MAC/B,CAAC;AAED,aAAO,GAAG,KAAK,GAAG,eAAe,eAAe,CAAC,QAAQ;AAEvD,aAAK,sBAAsB,GAAG;AAAA,MAChC,CAAC;AAAA,IACH;AAAA,IAEA,mBAAmB;AACjB,eAAS,OAAO,KAAK,WAAW,MAAM;AACpC,iBAAS,OAAO,KAAK;AACnB,cAAI,OAAO,QAAQ;AAAU;AAE7B,cAAI,eAAe,QAAQ,OAAO,MAAM,OAAO,GAAG,CAAC,EAAE;AACrD,cAAI,QAAQ;AAAU,2BAAe;AACrC,cAAI,QAAQ;AAAU,2BAAe;AACrC,cAAI,QAAQ;AAAK,2BAAe;AAGhC,gBAAM,YAAY,KAAK,WAAW,WAAW,OACzC,KAAK,WAAW,WAAW,OAC3B,OAAO,QAAQ,WACf,OAAO,MAAM,GAAG,IAChB;AAEJ,cAAI,iBAAiB,aAClB,MAAM,GAAG,EACT,IAAI,OAAO,MAAM,aAAa,EAC9B,KAAK,GAAG;AACX,2BAAiB,OAAO,MAAM,OAAO,IACjC,eAAe,QAAQ,QAAQ,QAAG,IAClC;AACJ,eAAK,gBACF,KAAK,kCAAkC,aAAa,EACpD,KAAK,SAAS,cAAc;AAE/B,iBAAO,GAAG,KAAK,GAAG,GAAG,gBAAgB,MAAM;AACzC,kBAAM,kBAAkB,KAAK,WAAW,GAAG,UAAU;AACrD,gBACE,mBACA,KAAK,oBACL,KAAK,gBAAgB,GAAG,UAAU,GAClC;AACA,mBAAK,gBACF,KAAK,kCAAkC,aAAa,EACpD,MAAM;AAAA,YACX;AAAA,UACF,CAAC;AAAA,QACH;AAAA,MACF;AACA,YAAM,aAAa,OAAO,MAAM,OAAO,IAAI,WAAM;AACjD,WAAK,WAAW,KAAK,eAAe,EAAE,KAAK,SAAS,GAAG,kBAAkB;AACzE,aAAO,GAAG,KAAK,aAAa;AAAA,QAC1B,UAAU;AAAA,QACV,QAAQ,MAAM,KAAK,WAAW,KAAK,eAAe,EAAE,MAAM;AAAA,QAC1D,WAAW,MACT,KAAK,WAAW,GAAG,UAAU,KAC7B,CAAC,KAAK,gBAAgB,KAAK,gBAAgB,EAAE,GAAG,UAAU;AAAA,QAC5D,aAAa,GAAG,2CAA2C;AAAA,QAC3D,eAAe;AAAA,QACf,MAAM,SAAS,KAAK;AAAA,MACtB,CAAC;AACD,WAAK,WAAW,KAAK,gBAAgB,EAAE,KAAK,SAAS,GAAG,cAAc;AACtE,aAAO,GAAG,KAAK,GAAG,UAAU,MAAM;AAChC,cAAM,oBAAoB,KAAK,WAAW,GAAG,UAAU;AACvD,cAAM,yBAAyB,CAAC,KAAK,gBAClC,KAAK,eAAe,EACpB,GAAG,SAAS;AACf,YAAI,qBAAqB,wBAAwB;AAC/C,eAAK,WAAW,KAAK,gBAAgB,EAAE,MAAM;AAAA,QAC/C;AAAA,MACF,CAAC;AACD,WAAK,WACF,KAAK,uBAAuB,EAC5B,KAAK,SAAS,GAAG,cAAc;AAClC,aAAO,GAAG,KAAK,aAAa;AAAA,QAC1B,UAAU;AAAA,QACV,QAAQ,MAAM,KAAK,WAAW,KAAK,uBAAuB,EAAE,MAAM;AAAA,QAClE,WAAW,MAAM,KAAK,mBAAmB,GAAG,UAAU;AAAA,QACtD,aAAa,GAAG,oBAAoB;AAAA,QACpC,eAAe;AAAA,QACf,MAAM,SAAS,KAAK;AAAA,MACtB,CAAC;AACD,aAAO,GAAG,KAAK,GAAG,UAAU,MAAM;AAChC,cAAM,oBAAoB,KAAK,WAAW,GAAG,UAAU;AACvD,YACE,qBACA,KAAK,kBACL,KAAK,eAAe,OAAO,GAAG,UAAU,GACxC;AACA,eAAK,eAAe,UAAU,CAAC;AAAA,QACjC;AAAA,MACF,CAAC;AAAA,IACH;AAAA,IAEA,sBAAsB,MAAM;AAC1B,YAAM,aAAa,EAAE,IAAI;AACzB,YAAM,sBACJ,WAAW,KAAK,OAAO,KAAK;AAE9B,UAAI,CAAC,QAAQ,qBAAqB;AAChC,aAAK,mBAAmB;AACxB,aAAK,gBACF,KAAK,oBAAoB,EACzB,IAAI,oBAAoB,EAAE;AAAA,MAC/B,OAAO;AACL,mBAAW,IAAI,oBAAoB,gBAAgB;AACnD,aAAK,mBAAmB;AACxB,aAAK,gBACF,KAAK,oBAAoB,EACzB,IAAI,IAAI,EACR,IAAI,oBAAoB,EAAE;AAAA,MAC/B;AAAA,IACF;AAAA,IAEA,yBAAyB;AACvB,WAAK,kBAAkB,KAAK;AAAA;AAAA,GAE7B;AACC,YAAM,KAAK;AACX,YAAM,QAAQ,EAAE,OAAO,6CAA6C;AACpE,YAAM,yBAAyB,KAAK,2BAA2B,CAAC;AAChE,UAAI,uBAAuB,QAAQ;AACjC,cAAM,UAAU;AAAA,UACd,gBAAgB,CAAC,MAAM,sBAAsB;AAAA,QAC/C;AAAA,MACF;AACA,WAAK,iBAAiB,OAAO,GAAG,KAAK,aAAa;AAAA,QAChD,IAAI;AAAA,UACF,OAAO,GAAG,UAAU;AAAA,UACpB,WAAW;AAAA,UACX,SAAS;AAAA,UACT,aAAa,GAAG,wCAAwC;AAAA,UACxD,WAAW,MAAM;AAAA,UACjB,UAAU,WAAY;AACpB,gBAAI,KAAK,OAAO;AACd,oBAAM,MAAM,GAAG,OAAO,QAAQ;AAC9B,qBAAO,IAAI,OAAO;AAClB,qBAAO,MAAM,UACX,IAAI,IAAI,SACR,IAAI,IAAI,MACR,YACA,KAAK,KACP;AACA,kBAAI,eACD,QAAQ,YAAY,IAAI,IAAI,SAAS,IAAI,IAAI,IAAI,EACjD,KAAK,MAAM;AACV,uBAAO,aAAa;AAAA,kBAClB,MAAM,GAAG,uBAAuB,KAAK,KAAK;AAAA,kBAC1C,MAAM,GAAG,OAAO,yBAAyB,GAAG,aAAa;AAAA,kBACzD,MAAM,GAAG,wBAAwB;AAAA,kBACjC,MAAM,GAAG,sBAAsB;AAAA,kBAC/B,MAAM,OAAO,IAAI,SAAS;AAAA,gBAC5B,CAAC;AAAA,cACH,CAAC;AAAA,YACL;AAAA,UACF;AAAA,QACF;AAAA,QACA,QAAQ,KAAK,kBAAkB,KAAK,iBAAiB;AAAA,QACrD,cAAc;AAAA,MAChB,CAAC;AACD,WAAK,eAAe,aAAa,KAAK;AAAA,IACxC;AAAA,IAEA,uBAAuB,UAAU;AAC/B,UAAI,UAAU;AACZ,eAAO,IAAI,QAAQ,CAAC,YAAY;AAC9B,iBAAO,GACJ,UAAU,YAAY,UAAU;AAAA,YAC/B;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,UACF,CAAC,EACA,KAAK,CAAC,EAAE,cAAc;AACrB,kBAAM,EAAE,oBAAoB;AAE5B,gBAAI,iBAAiB;AACnB,qBAAO,KAAK;AAAA,gBACV,QACE;AAAA,gBACF,MAAM,EAAE,UAAU,iBAAiB,QAAQ,KAAK;AAAA,gBAChD,UAAU,CAAC,MAAM;AACf,wBAAM,EAAE,gBAAgB,sBAAsB,EAAE;AAChD,sBAAI,CAAC,EAAE,KAAK;AACV,yBAAK,gBAAgB,iCAChB,UADgB;AAAA,sBAEnB;AAAA,sBACA;AAAA,sBACA;AAAA,oBACF;AACA,4BAAQ;AAAA,kBACV;AAAA,gBACF;AAAA,cACF,CAAC;AAAA,YACH,OAAO;AACL,mBAAK,gBAAgB,iCAAK,UAAL,EAAc,SAAS;AAC5C,sBAAQ;AAAA,YACV;AAAA,UACF,CAAC;AAAA,QACL,CAAC;AAAA,MACH,OAAO;AACL,eAAO,IAAI,QAAQ,CAAC,YAAY;AAC9B,eAAK,gBAAgB,CAAC;AACtB,kBAAQ;AAAA,QACV,CAAC;AAAA,MACH;AAAA,IACF;AAAA,IAEA,wBAAwB;AACtB,WAAK,mBAAmB,IAAI,EAAE,SAAS,OAAO,QAAQ,OAAO,CAAC;AAC9D,WAAK,mBAAmB,KAAK,wCAAwC;AACrE,YAAM,KAAK;AACX,YAAM,MAAM,GAAG,OAAO,QAAQ;AAC9B,UAAI,WAAW,IAAI,IAAI;AAEvB,WAAK,iBAAiB,OAAO,GAAG,KAAK,aAAa;AAAA,QAChD,IAAI;AAAA,UACF,OAAO,GAAG,UAAU;AAAA,UACpB,WAAW;AAAA,UACX,aAAa,WACT,WAAW,MACX,GAAG,4BAA4B;AAAA,UACnC,aAAa;AAAA,UACb,UAAU,WAAY;AACpB,gBAAI,IAAI,KAAK,KAAK,KAAK,GAAG;AACxB,qBAAO,MAAM,UACX,IAAI,IAAI,SACR,IAAI,IAAI,MACR,kCACA,IAAI,KAAK,KAAK,CAChB;AACA,iBAAG,sBAAsB,KAAK,KAAK;AAAA,YACrC,OAAO;AACL,qBAAO,MAAM,UACX,IAAI,IAAI,SACR,IAAI,IAAI,MACR,kCACA,CACF;AACA,iBAAG,mBAAmB,IAAI;AAAA,gBACxB,QAAQ;AAAA,gBACR,SAAS;AAAA,cACX,CAAC;AACD,iBAAG,mBAAmB,KACpB,GAAG,GAAG,kBAAkB,KAAK,GAAG,cAAc,GAChD;AACA,iBAAG,iBAAiB;AAAA,YACtB;AAAA,UACF;AAAA,QACF;AAAA,QACA,QAAQ,KAAK,mBAAmB,KAAK,qBAAqB;AAAA,QAC1D,cAAc;AAAA,MAChB,CAAC;AACD,WAAK,eAAe,aAAa,KAAK;AACtC,WAAK,eAAe,UAAU;AAAA,IAChC;AAAA,IAEA,sBAAsB,UAAU;AAC9B,UAAI,CAAC,UAAU;AACb,aAAK,mBAAmB,IAAI,EAAE,SAAS,OAAO,QAAQ,OAAO,CAAC;AAC9D,aAAK,mBAAmB,KAAK,wCAAwC;AAAA,MACvE,OAAO;AACL,aAAK,mBAAmB,IAAI;AAAA,UAC1B,QAAQ;AAAA,UACR,SAAS;AAAA,QACX,CAAC;AACD,aAAK,mBAAmB,KACtB;AAAA,OACD,KAAK,kBAAkB,KAAK,GAAG,YAAY,UAAU,OAClD,QACF,EAAE,KAAK,MAAM,GAAG,kBAAkB;AAAA,WAEpC;AAAA,MACF;AAAA,IACF;AAAA,IAEA,0BAA0B;AACxB,YAAM,KAAK;AACX,YAAM;AAAA,QACJ;AAAA,QACA,WAAW;AAAA,QACX,YAAY;AAAA,QACZ;AAAA,UACE,KAAK,iBAAiB,CAAC;AAE3B,UAAI,UAAU;AACZ,aAAK,kBAAkB,KACrB;AAAA;AAAA,QAEA,KAAK,mBAAmB;AAAA;AAAA,oCAEI;AAAA,SAC3B,yBAAyB;AAAA;AAAA,uDAEqB,OAAO,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAOhE;AAAA,MACF,OAAO;AAEL,aAAK,wBAAwB;AAAA,MAC/B;AAEA,0CAAoC;AAClC,YAAI,CAAC,YAAY,CAAC,WAAW;AAC3B,iBAAO,8BAA8B,GACnC,4BACF;AAAA,QACF,WAAW,YAAY,CAAC,WAAW;AACjC,iBAAO,8BAA8B;AAAA,QACvC,WAAW,aAAa,CAAC,UAAU;AACjC,iBAAO,8BAA8B;AAAA,QACvC,OAAO;AACL,iBAAO,8BAA8B,cAAc;AAAA,QACrD;AAAA,MACF;AAAA,IACF;AAAA,IAEA,qBAAqB;AACnB,YAAM,EAAE,UAAU,UAAU,KAAK,iBAAiB,CAAC;AACnD,UAAI,OAAO;AACT,eAAO,yCAAyC,eAAe;AAAA,MACjE,OAAO;AACL,eAAO,6CAA6C,OAAO,SACzD,QACF;AAAA,MACF;AAAA,IACF;AAAA,IAEA,sBAAsB,KAAK;AACzB,UAAI,CAAC;AAAK,cAAM,KAAK,OAAO,QAAQ;AAEpC,WAAK,iBAAiB,IAAI,IAAI,SAAS;AACvC,WAAK,sBAAsB,IAAI,IAAI,KAAK;AACxC,YAAM,cAAc,KAAK,OAAO,aAAa,qBAAqB,IAC9D,IAAI,IAAI,cACR,IAAI,IAAI;AACZ,WAAK,mBAAmB,WAAW;AAEnC,WAAK,aAAa,IAAI,IAAI,KAAK;AAAA,IACjC;AAAA,IAEA,iBAAiB,OAAO;AACtB,YAAM,WAAW,KAAK,OAAO,QAAQ,EAAE,IAAI;AAC3C,WAAK,gBACF,KAAK,sBAAsB,EAC3B,KACC,QAAQ,GAAG,WAAW,eAAe,gBACnC,OACA,QACF,SACF;AAEF,WAAK,gBACF,KAAK,mBAAmB,EACxB,KACC,QAAQ,GAAG,WAAW,YAAY,gBAChC,OACA,QACF,gBACF;AAAA,IACJ;AAAA,IAEA,sBAAsB,OAAO;AAC3B,UAAI,iBAAiB;AACrB,YAAM,IAAI,CAAC,SAAS;AAClB,yBAAiB,iBAAiB,KAAK;AAAA,MACzC,CAAC;AAED,WAAK,gBACF,KAAK,2BAA2B,EAChC,KAAK,QAAQ,GAAG,gBAAgB,eAAe,sBAAsB;AAExE,WAAK,gBACF,KAAK,wBAAwB,EAC7B,KACC,QAAQ,GAAG,gBAAgB,YAAY,6BACzC;AAAA,IACJ;AAAA,IAEA,mBAAmB,OAAO;AACxB,YAAM,WAAW,KAAK,OAAO,QAAQ,EAAE,IAAI;AAC3C,WAAK,gBACF,KAAK,wBAAwB,EAC7B,KACC,QAAQ,GAAG,aAAa,eAAe,gBACrC,OACA,QACF,SACF;AAEF,WAAK,gBACF,KAAK,qBAAqB,EAC1B,KACC,QAAQ,GAAG,aAAa,YAAY,gBAClC,OACA,QACF,gBACF;AAAA,IACJ;AAAA,IAEA,aAAa,OAAO;AAClB,UAAI,MAAM,QAAQ;AAChB,cAAM,WAAW,KAAK,OAAO,QAAQ,EAAE,IAAI;AAC3C,cAAM,aAAa,MAChB,IAAI,CAAC,MAAM;AACV,cAAI,EAAE,oCAAoC;AAAK;AAC/C,gBAAM,cAAc,SAAS,KAAK,EAAE,WAAW,IAC3C,EAAE,cACF,GAAG,EAAE,iBAAiB,EAAE;AAC5B,iBAAO;AAAA;AAAA,8BAEa,gBAClB,EAAE,kCACF,QACF;AAAA;AAAA,QAEF,CAAC,EACA,KAAK,EAAE;AACV,aAAK,gBACF,KAAK,kBAAkB,EACvB,IAAI,WAAW,MAAM,EACrB,KAAK,UAAU;AAAA,MACpB,OAAO;AACL,aAAK,gBACF,KAAK,kBAAkB,EACvB,IAAI,WAAW,MAAM,EACrB,KAAK,EAAE;AAAA,MACZ;AAAA,IACF;AAAA,IAEA,cAAc,EAAE,QAAQ;AACtB,YAAM,gBAAgB,qCAAqC,OAAO,IAAI;AACtE,aAAO,KAAK,oBAAoB,KAAK,aAAa;AAAA,IACpD;AAAA,IAEA,kBAAkB,MAAM;AACtB,YAAM,MAAM,KAAK,OAAO,QAAQ,EAAE;AAClC,aAAO,IAAI,MAAM,KAAK,CAAC,MAAM,EAAE,QAAQ,KAAK,IAAI;AAAA,IAClD;AAAA,IAEA,iBAAiB,MAAM,aAAa;AAClC,YAAM,QAAQ,KAAK,cAAc,IAAI;AAErC,UAAI,aAAa;AACf,iBAAS,MAAM,KAAK,EAAE,OAAO,KAAK,MAAM,OAAO;AAAA,MACjD,OAAO;AACL,cAAM,WAAW,KAAK,kBAAkB,IAAI;AAC5C,aAAK,iBAAiB,UAAU,KAAK;AAAA,MACvC;AAEA,YAAM,mBACJ,KAAK,oBAAoB,KAAK,oBAAoB,EAAE;AACtD,WAAK,uBAAuB,mBAAmB,CAAC;AAEhD,WAAK,0BAA0B,gBAAgB;AAAA,IACjD;AAAA,IAEA,iBAAiB,WAAW,iBAAiB;AAC3C,YAAM,WAAW,KAAK,OAAO,QAAQ,EAAE,IAAI;AAC3C,YAAM,KAAK;AAEX,UAAI,CAAC,gBAAgB,QAAQ;AAC3B,aAAK,oBAAoB,OACvB,iDAAiD,OAC/C,UAAU,IACZ;AAAA,kCAEF;AACA,0BAAkB,KAAK,cAAc,SAAS;AAAA,MAChD;AAEA,sBAAgB,KACd,GAAG,oBAAoB;AAAA;AAAA;AAAA,OAGtB,UAAU;AAAA;AAAA,MAEX,qBAAqB;AAAA;AAAA,KAEtB,uBAAuB,GACxB;AAEA,oCAA8B;AAE9B,+CAAyC;AACvC,cAAM,YAAY,MAAM,KACtB,GAAG,oBAAoB,KAAK,mBAAmB,CACjD;AACA,WAAG,aAAa,KAAK,qBAAqB,EAAE,IAAI,SAAS,EAAE;AAC3D,WAAG,oBAAoB,KAAK,mBAAmB,EAAE,IAAI,SAAS,EAAE;AAChE,YAAI,YAAY,UAAU,OAAO,CAAC,YAAW,QAAQ;AACnD,cAAI,EAAE,GAAG,EAAE,MAAM,IAAI;AAAW,yBAAY,EAAE,GAAG,EAAE,MAAM;AACzD,iBAAO;AAAA,QACT,GAAG,CAAC;AAEJ,qBAAa;AACb,YAAI,aAAa;AAAG,sBAAY;AAEhC,WAAG,aAAa,KAAK,qBAAqB,EAAE,IAAI,SAAS,SAAS;AAClE,WAAG,oBAAoB,KAAK,mBAAmB,EAAE,IAAI,SAAS,SAAS;AAAA,MACzE;AAEA,wCAAkC;AAChC,YACE,UAAU,QACV,UAAU,UACV,UAAU,SAAS,UAAU,QAC7B;AACA,iBAAO;AAAA;AAAA,oCAEqB,UAAU,OAAO;AAAA;AAAA,gCAErB,gBAAgB,UAAU,QAAQ,QAAQ;AAAA,kCACxC,gBAAgB,UAAU,MAAM,QAAQ;AAAA;AAAA;AAAA,QAGpE,OAAO;AACL,iBAAO;AAAA;AAAA,oCAEqB,UAAU,OAAO;AAAA;AAAA,gCAErB,gBAAgB,UAAU,MAAM,QAAQ;AAAA;AAAA;AAAA,QAGlE;AAAA,MACF;AAEA,sCAAgC;AAC9B,YAAI,UAAU,aAAa;AACzB,cAAI,UAAU,YAAY,QAAQ,OAAO,KAAK,IAAI;AAChD,gBAAI;AACF,wBAAU,cAAc,EAAE,UAAU,WAAW,EAAE,KAAK;AAAA,YACxD,SAAS,OAAP;AACA,wBAAU,cAAc,UAAU,YAC/B,QAAQ,UAAU,GAAG,EACrB,QAAQ,YAAY,GAAG,EACvB,QAAQ,OAAO,GAAG;AAAA,YACvB;AAAA,UACF;AACA,oBAAU,cAAc,OAAO,SAAS,UAAU,aAAa,EAAE;AACjE,iBAAO,0BAA0B,UAAU;AAAA,QAC7C;AACA,eAAO;AAAA,MACT;AAEA,qCAA+B;AAC7B,cAAM,EAAE,OAAO,cAAc;AAC7B,YAAI,CAAC,GAAG,eAAe,OAAO;AAC5B,iBAAO;AAAA;AAAA;AAAA;AAAA,cAID,eAAe,OAAO,SAAS,SAAS;AAAA;AAAA,QAEhD,OAAO;AACL,iBAAO,qCAAqC,OAAO,SACjD,SACF;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAAA,IAEA,oBAAoB,MAAM;AACxB,YAAM,YAAY,EAAE,IAAI,EAAE,KAAK,KAAK;AACpC,QAAE,IAAI,EACH,OAAO,EACP,YAAY,qCAAqC,iBAAiB;AAAA,IACvE;AAAA,IAEA,mCAAmC,UAAU,OAAO,MAAM;AACxD,YAAM,kBAAkB,KAAK,cAAc,IAAI;AAC/C,sBAAgB,KAAK,QAAQ,YAAY,OAAO,KAAK,CAAC;AAAA,IACxD;AAAA,IAEA,oBAAoB,eAAe;AACjC,UAAI,eAAe;AACjB,aAAK,gBAAgB,KAAK,eAAe,EAAE,IAAI,WAAW,MAAM;AAChE,aAAK,gBAAgB,KAAK,gBAAgB,EAAE,IAAI,WAAW,MAAM;AAAA,MACnE,OAAO;AACL,aAAK,gBAAgB,KAAK,eAAe,EAAE,IAAI,WAAW,MAAM;AAChE,aAAK,gBAAgB,KAAK,gBAAgB,EAAE,IAAI,WAAW,MAAM;AAAA,MACnE;AAAA,IACF;AAAA,IAEA,uBAAuB,QAAQ;AAC7B,UAAI,QAAQ;AACV,aAAK,mBAAmB,IAAI,WAAW,MAAM;AAC7C,aAAK,gBAAgB,KAAK,eAAe,EAAE,IAAI;AAAA,UAC7C,oBAAoB;AAAA,QACtB,CAAC;AAAA,MACH,OAAO;AACL,aAAK,mBAAmB,IAAI,WAAW,MAAM;AAC7C,aAAK,gBAAgB,KAAK,eAAe,EAAE,IAAI;AAAA,UAC7C,oBAAoB;AAAA,QACtB,CAAC;AAAA,MACH;AAAA,IACF;AAAA,IAEA,0BAA0B,kBAAkB;AAC1C,YAAM,mBAAmB,KAAK,oBAAoB,KAAK,kBAAkB;AAGzE,yBAAmB,KACjB,oBACA,iBAAiB,OAAO,KACxB,KAAK,aAAa,IAAI,WAAW,MAAM;AAEzC,2BAAqB,KACnB,CAAC,iBAAiB,UAClB,KAAK,0BAA0B;AAAA,IACnC;AAAA,IAEA,gBAAgB,MAAM;AACpB,YAAM,iBAAiB,KAAK,KAAK,mBAAmB;AACpD,YAAM,uBAAuB;AAAA,QAC3B;AAAA,QACA;AAAA,QACA;AAAA,MACF,EAAE,SAAS,cAAc;AACzB,YAAM,oBAAoB,uBACrB,kBAAkB,UAAU,KAAK,qBACjC,kBAAkB,yBACjB,KAAK,yBACP,kBAAkB,QAClB;AAEJ,YAAM,0BAA0B,KAAK,gBAAgB;AACrD,YAAM,oBAAoB,CAAC,KAAK;AAChC,YAAM,wBACJ,KAAK,eAAe,KAAK,eAAe;AAE1C,UAAI,sBAAsB;AACxB,YAAI,CAAC,mBAAmB;AACtB,gBAAM,QACJ,kBAAkB,SAAS,OAAO,KAAK,IAAI,WAAW,KAAK;AAC7D,gBAAM,UAAU,GACd,0DACA,CAAC,KAAK,CACR;AACA,iBAAO,WAAW;AAAA,YAChB,WAAW;AAAA,YACX;AAAA,UACF,CAAC;AACD,iBAAO,MAAM,WAAW,OAAO;AAC/B;AAAA,QACF;AAEA,YAAI,qBAAqB,uBAAuB;AAC9C,eAAK,cAAc;AAAA,QACrB,WAAW,yBAAyB;AAClC,eAAK,cAAc;AAAA,QACrB;AACA,aAAK,eAAe;AAAA,MACtB,WAAW,mBAAmB,YAAY;AACxC,aAAK,cAAc;AACnB,aAAK,sBAAsB;AAC3B,aAAK,OAAO,aAAa,QAAW,cAAc;AAClD;AAAA,MACF,WAAW,mBAAmB,UAAU;AACtC,aAAK,cAAc;AACnB,aAAK,sBAAsB;AAC3B,aAAK,OAAO,aAAa,QAAW,cAAc;AAClD;AAAA,MACF,OAAO;AACL,aAAK,eACH,mBAAmB,WACf,KAAK,aAAa,MAAM,GAAG,EAAE,IAC7B,KAAK,eAAe;AAC1B,aAAK,eAAe,KAAK,gBAAgB;AAAA,MAC3C;AAEA,YAAM,sCACJ,CAAC,wBAAwB;AAE3B,UAAI,qCAAqC;AACvC,eAAO,WAAW;AAAA,UAChB,WAAW;AAAA,UACX,SAAS,GAAG,2CAA2C;AAAA,QACzD,CAAC;AACD,eAAO,MAAM,WAAW,OAAO;AAC/B;AAAA,MACF;AAEA,UACE,IAAI,KAAK,YAAY,IAAI,OACzB,KAAK,gBAAgB,uBACrB;AACA,eAAO,WAAW;AAAA,UAChB,SAAS,GAAG,sCAAsC;AAAA,UAClD,WAAW;AAAA,QACb,CAAC;AACD,eAAO,MAAM,WAAW,OAAO;AAC/B,aAAK,eAAe;AAAA,MACtB;AAEA,WAAK,qBAAqB,MAAM,cAAc;AAC9C,WAAK,OAAO,aAAa,KAAK,cAAc,KAAK,WAAW;AAAA,IAC9D;AAAA,IAEA,qBAAqB,MAAM,aAAa;AACtC,YAAM,6BAA6B,KAAK,SAAS,wBAAwB;AACzE,YAAM,wBAAwB;AAAA,QAC5B;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MACF,EAAE,SAAS,WAAW;AAEtB,UAAI,CAAC,4BAA4B;AAC/B,aAAK,SAAS,wBAAwB;AAAA,MACxC;AACA,UAAI,KAAK,gBAAgB,eAAe,4BAA4B;AAElE,aAAK,YAAY,wBAAwB;AAAA,MAC3C;AACA,UACE,KAAK,eACL,KAAK,gBAAgB,eACrB,uBACA;AAEA,cAAM,WAAW,EAAE,uBAAuB,KAAK,eAAe;AAC9D,iBAAS,YAAY,wBAAwB;AAAA,MAC/C;AACA,UAAI,CAAC,yBAAyB,gBAAgB,QAAQ;AAEpD,mBAAW,MAAM;AACf,eAAK,YAAY,wBAAwB;AAAA,QAC3C,GAAG,GAAG;AAAA,MACR;AAAA,IACF;AAAA,IAEA,cAAc,MAAM;AAClB,UAAI,MAAM;AACR,aAAK,gBAAgB,IAAI,WAAW,MAAM;AAC1C,aAAK,gBAAgB,IAAI,WAAW,MAAM;AAAA,MAC5C,OAAO;AACL,aAAK,gBAAgB,IAAI,WAAW,MAAM;AAC1C,aAAK,gBAAgB,IAAI,WAAW,MAAM;AAAA,MAC5C;AACA,WAAK,aAAa;AAAA,IACpB;AAAA,IAEA,eAAe;AACb,WAAK,eAAe;AACpB,WAAK,cAAc;AACnB,WAAK,gBACF,KAAK,yBAAyB,EAC9B,YAAY,wBAAwB;AAAA,IACzC;AAAA,IAEA,yBAAyB,WAAW;AAClC,UAAI,CAAC,OAAO,uBAAuB,MAAM,EAAE,SAAS,SAAS,GAAG;AAC9D,aAAK,gBAAgB,KAAK,uBAAuB,aAAa,EAAE,MAAM;AAAA,MACxE;AAAA,IACF;AAAA,IAEA,qBAAqB,MAAM;AACzB,UAAI,MAAM;AACR,cAAM,EAAE,aAAa,KAAK,iBAAiB,CAAC;AAE5C,aAAK,gBAAgB,IAAI,WAAW,MAAM;AAC1C,aAAK,kBAAkB,IAAI;AAAA,UACzB,QAAQ;AAAA,UACR,eAAe;AAAA,QACjB,CAAC;AACD,aAAK,kBAAkB,KAAK,mBAAmB,EAAE,KAC/C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OASD,KAAK,mBAAmB;AAAA;AAAA,mCAEI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8DAW7B;AAEA,aAAK,kBAAkB,OACrB,2CACF;AAEA,aAAK,uBAAuB;AAC5B,aAAK,4BAA4B;AAAA,MACnC,OAAO;AACL,aAAK,gBAAgB,IAAI,WAAW,MAAM;AAC1C,aAAK,kBAAkB,IAAI;AAAA,UACzB,QAAQ;AAAA,UACR,eAAe;AAAA,QACjB,CAAC;AAED,aAAK,wBAAwB;AAAA,MAC/B;AAAA,IACF;AAAA,IAEA,yBAAyB;AACvB,YAAM,iBAAiB,KAAK,kBAAkB,KAC5C,4BACF;AAEA,YAAM,MAAM;AAAA,QACV;AAAA,UACE,WAAW;AAAA,UACX,OAAO,GAAG,OAAO;AAAA,UACjB,WAAW;AAAA,UACX,SAAS;AAAA,UACT,aAAa,GAAG,wBAAwB;AAAA,QAC1C;AAAA,QACA;AAAA,UACE,WAAW;AAAA,UACX,OAAO,GAAG,cAAc;AAAA,UACxB,WAAW;AAAA,UACX,aAAa,GAAG,+BAA+B;AAAA,QACjD;AAAA,QACA;AAAA,UACE,WAAW;AAAA,UACX,OAAO,GAAG,iBAAiB;AAAA,UAC3B,WAAW;AAAA,UACX,SAAS;AAAA,UACT,aAAa,GAAG,wBAAwB;AAAA,QAC1C;AAAA,QACA;AAAA,UACE,WAAW;AAAA,UACX,OAAO,GAAG,gBAAgB;AAAA,UAC1B,WAAW;AAAA,UACX,WAAW;AAAA,QACb;AAAA,MACF;AAEA,YAAM,KAAK;AACX,UAAI,QAAQ,CAAC,OAAO;AAClB,aAAK,YAAY,GAAG,qBAAqB,OAAO,GAAG,KAAK,aAAa;AAAA,UACnE,IAAI,iCAAK,KAAL,EAAS,UAAU,6BAA6B;AAAA,UACpD,QAAQ,eAAe,KAAK,IAAI,GAAG,iBAAiB;AAAA,UACpD,cAAc;AAAA,QAChB,CAAC;AACD,aAAK,YAAY,GAAG,mBAAmB,UACrC,KAAK,cAAc,GAAG,UACxB;AAAA,MACF,CAAC;AAED,8CAAwC;AACtC,cAAM,gBAAgB,GAAG,cAAc,KAAK,GAAG;AAC/C,cAAM,mBAAmB,GAAG,cAAc;AAE1C,YACE,KAAK,SACL,iBAAiB,KAAK,SACtB,KAAK,GAAG,aAAa,kBACrB;AACA,iBAAO,KAAK;AAAA,YACV,QACE;AAAA,YACF,MAAM;AAAA,cACJ,WAAW,KAAK,GAAG;AAAA,cACnB,UAAU;AAAA,cACV,OAAO,KAAK;AAAA,YACd;AAAA,YACA,UAAU,CAAC,MAAM;AACf,kBAAI,CAAC,EAAE,KAAK;AACV,mBAAG,cAAc,KAAK,GAAG,aAAa,KAAK;AAC3C,uBAAO,WAAW;AAAA,kBAChB,SAAS,GAAG,wCAAwC;AAAA,kBACpD,WAAW;AAAA,gBACb,CAAC;AACD,uBAAO,MAAM,WAAW,QAAQ;AAAA,cAClC;AAAA,YACF;AAAA,UACF,CAAC;AAAA,QACH;AAAA,MACF;AAAA,IACF;AAAA,IAEA,8BAA8B;AAC5B,aAAO,GACJ,SAAS,eAAe;AAAA,QACvB,SAAS,EAAE,UAAU,KAAK,cAAc,UAAU,WAAW,EAAE;AAAA,QAC/D,QAAQ;AAAA,UACN;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,QACF;AAAA,QACA,OAAO;AAAA,MACT,CAAC,EACA,KAAK,CAAC,QAAQ;AACb,cAAM,wBAAwB,KAAK,kBAAkB,KACnD,wBACF;AAEA,YAAI,CAAC,IAAI,QAAQ;AACf,gCAAsB,KACpB,6EACF;AACA;AAAA,QACF;AAEA,cAAM,eAAe,OACnB,IAAI,GAAG,eAAe,MAAM,IAAI,GAAG,YACrC,EAAE,QAAQ;AACV,aAAK,kBACF,KAAK,gBAAgB,EACrB,KAAK,mBAAmB,cAAc;AAEzC,YAAI,QAAQ,CAAC,YAAY;AACvB,gBAAM,mBAAmB,OACvB,QAAQ,eAAe,MAAM,QAAQ,YACvC,EAAE,OAAO,gBAAgB;AACzB,cAAI,kBAAkB;AAAA,YACpB,MAAM;AAAA,YACN,OAAO;AAAA,YACP,QAAQ;AAAA,YACR,cAAc;AAAA,UAChB;AAEA,gCAAsB,OACpB,mDAAmD,OACjD,QAAQ,IACV;AAAA;AAAA,mCAEuB,QAAQ;AAAA,mCACR;AAAA;AAAA;AAAA;AAAA,UAIzB,gBAAgB,QAAQ,aAAa,QAAQ,UAAU,CAAC,KAAK;AAAA;AAAA;AAAA,wDAIrD,gBAAgB,QAAQ;AAAA,iBAEzB,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA,mCAMf;AAAA,QACF,CAAC;AAAA,MACH,CAAC;AAAA,IACL;AAAA,IAEA,2BAA2B,KAAK;AAC9B,QAAE,IAAI,OAAO,EAAE,IAAI,gBAAgB;AACnC,QAAE,IAAI,OAAO,EAAE,GAAG,kBAAkB,MAAM;AACxC,YAAI,IAAI,IAAI,MAAM,QAAQ;AACxB,eAAK,oBAAoB,KAAK,EAAE;AAChC,cAAI,IAAI,MAAM,QAAQ,CAAC,SAAS;AAC9B,iBAAK,iBAAiB,IAAI;AAAA,UAC5B,CAAC;AAAA,QACH;AACA,aAAK,sBAAsB,GAAG;AAAA,MAChC,CAAC;AAAA,IACH;AAAA,IAEA,eAAe;AACb,YAAM,MAAM,KAAK,OAAO,QAAQ;AAEhC,WAAK,2BAA2B,GAAG;AAEnC,WAAK,uBAAuB,IAAI,IAAI,QAAQ,EAAE,KAAK,MAAM;AACvD,aAAK,OAAO,yBAAyB,KAAK,aAAa;AACvD,aAAK,wBAAwB;AAAA,MAC/B,CAAC;AAED,WAAK,oBAAoB,KAAK,EAAE;AAChC,UAAI,IAAI,IAAI,MAAM,QAAQ;AACxB,YAAI,IAAI,MAAM,QAAQ,CAAC,SAAS;AAC9B,eAAK,iBAAiB,IAAI;AAAA,QAC5B,CAAC;AAAA,MACH,OAAO;AACL,aAAK,0BAA0B;AAC/B,aAAK,uBAAuB,KAAK;AAAA,MACnC;AAEA,WAAK,sBAAsB,GAAG;AAE9B,UAAI,IAAI,IAAI,cAAc,GAAG;AAC3B,aAAK,gBAAgB,KAAK,eAAe,EAAE,IAAI,WAAW,MAAM;AAChE,aAAK,gBAAgB,KAAK,gBAAgB,EAAE,IAAI,WAAW,MAAM;AAAA,MACnE,OAAO;AACL,aAAK,gBAAgB,KAAK,eAAe,EAAE,IAAI,WAAW,MAAM;AAChE,aAAK,gBAAgB,KAAK,gBAAgB,EAAE,IAAI,WAAW,MAAM;AAAA,MACnE;AAEA,WAAK,iBAAiB,IAAI;AAAA,IAC5B;AAAA,IAEA,iBAAiB,MAAM;AACrB,aACI,KAAK,WAAW,IAAI,WAAW,MAAM,IACrC,KAAK,WAAW,IAAI,WAAW,MAAM;AAAA,IAC3C;AAAA,EACF;;;ACzsCA,UAAQ,YAAY,cAAc,MAAM;AAAA,IACvC,YAAY,EAAE,SAAS,QAAQ,YAAY;AAC1C,WAAK,UAAU;AACf,WAAK,SAAS;AACd,WAAK,cAAc,SAAS;AAC5B,WAAK,oBAAoB,SAAS;AAClC,WAAK,wBAAwB,SAAS;AACtC,WAAK,eAAe,CAAC;AAErB,WAAK,eAAe;AAAA,IACrB;AAAA,IAEA,iBAAiB;AAChB,WAAK,YAAY;AACjB,WAAK,sBAAsB;AAC3B,WAAK,YAAY;AACjB,WAAK,iBAAiB;AAAA,IACvB;AAAA,IAEA,cAAc;AACb,WAAK,QAAQ,OACZ,oDACD;AAEA,WAAK,aAAa,KAAK,QAAQ,KAAK,yBAAyB;AAAA,IAC9D;AAAA,IAEA,wBAAwB;AACvB,WAAK,WAAW,KACf;AAAA,yBACsB,GAAG,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sCAiBxC;AAEA,WAAK,aAAa,KAAK,WAAW,KAAK,YAAY;AACnD,WAAK,oBAAoB,KAAK,WAAW,KAAK,YAAY;AAC1D,WAAK,cAAc,KAAK,WAAW,KAAK,aAAa;AACrD,WAAK,cAAc,KAAK,WAAW,KAAK,aAAa;AACrD,WAAK,kBAAkB,KAAK,WAAW,KAAK,iBAAiB;AAC7D,WAAK,mBAAmB,KAAK,WAAW,KAAK,mBAAmB;AAAA,IACjE;AAAA,IAEA,0BAA0B,MAAM;AAE/B,aAAO,QAAQ,KAAK,QAAQ,KAAK,aAAa;AAAA,IAC/C;AAAA,UAEM,4BAA4B,MAAM;AACvC,YAAM,uBAAuB,CAAC,KAAK,0BAA0B,IAAI;AAGjE,YAAM,oBAAoB,CAAC,QAAQ,IAAI,KAAK,CAAC;AAE7C,UAAK,CAAC,qBAAqB,wBAAyB,mBAAmB;AAGtE,cAAM,KAAK,2BAA2B;AAAA,MACvC;AAEA,WAAK,OAAO,qBAAqB,CAAC,iBAAiB;AACnD,WAAK,iBAAiB,CAAC,iBAAiB;AAExC,UAAI,QAAQ,sBAAsB;AACjC,aAAK,UAAU,KAAK;AACpB,aAAK,YAAY,OAAO,SAAS,KAAK,OAAO;AAC7C,aAAK,OAAO,KAAK;AACjB,aAAK,WAAW;AAChB,aAAK,WAAW,KAAK,OAAO,QAAQ,EAAE,IAAI;AAE1C,aAAK,eAAe;AAEpB,aAAK,WAAW,IAAI;AACpB,aAAK,oBAAoB,IAAI;AAC7B,aAAK,YAAY,IAAI;AACrB,aAAK,OAAO,oBAAoB,IAAI;AAAA,MACrC,OAAO;AACN,aAAK,eAAe,CAAC;AAAA,MACtB;AAAA,IACD;AAAA,IAEA,6BAA6B;AAC5B,YAAM,MAAM,KAAK,OAAO,QAAQ,EAAE;AAClC,YAAM,WAAW,IAAI,MAAM,KAAK,UAAQ,KAAK,SAAS,KAAK,IAAI;AAE/D,UAAI,CAAC;AAAU;AAEf,YAAM,aAAa,SAAS;AAC5B,YAAM,UAAU,SAAS;AACzB,YAAM,qBAAqB,CAAC,SAAS;AACrC,YAAM,oBAAoB,CAAC,SAAS;AAEpC,UAAK,cAAc,sBAAwB,WAAW,qBACpD,cAAc,WAAY,sBAAqB,qBAAsB;AAEtE,eAAO,WAAW;AAAA,UACjB,SAAS,GAAG,sDAAsD;AAAA,UAClE,WAAW;AAAA,QACZ,CAAC;AACD,eAAO,MAAM,WAAW,QAAQ;AAChC,eAAO,KAAK,OAAO,sBAAsB;AAAA,MAC1C;AAAA,IACD;AAAA,IAEA,WAAW,MAAM;AAChB,UAAI,EAAE,WAAW,aAAa,OAAO,oBAAoB;AAEzD,sCAAgC;AAC/B,YAAI,aAAa;AAChB,wBAAc,YAAY,QAAQ,KAAK,MAAM,MAAM,YAAY,SAAS,MAAM,YAAY,OAAO,GAAG,GAAG,IAAI,QAAQ;AACnH,iBAAO;AAAA,QACR;AACA,eAAO;AAAA,MACR;AAEA,WAAK,WAAW,KAAK,SAAS;AAC9B,WAAK,kBAAkB,KAAK,qBAAqB,CAAC;AAClD,WAAK,YAAY,KAAK,gBAAgB,iBAAiB,KAAK,QAAQ,CAAC;AACrE,UAAI,CAAC,KAAK,eAAe,OAAO;AAC/B,aAAK,YAAY,KAChB;AAAA;AAAA,2BAEuB;AAAA,YACf,OAAO,SAAS,SAAS;AAAA,iCAElC;AAAA,MACD,OAAO;AACN,aAAK,YAAY,KAAK,0BAA0B,OAAO,SAAS,SAAS,SAAS;AAAA,MACnF;AAAA,IAED;AAAA,IAEA,oBAAoB,MAAM;AACzB,YAAM,YAAY,EAAE,IAAI,EAAE,KAAK,KAAK;AACpC,QAAE,IAAI,EAAE,YAAY,0BAA0B,iBAAiB;AAAA,IAChE;AAAA,IAEA,oBAAoB,MAAM;AACzB,UAAI,KAAK,qBAAqB;AAC7B,aAAK,iBAAiB,KACrB,0BAA0B,gBAAgB,KAAK,iBAAiB,KAAK,QAAQ;AAAA,iCAChD,KAAK,gCACnC;AACA,aAAK,YAAY,KAAK,gBAAgB,KAAK,MAAM,KAAK,QAAQ,CAAC;AAAA,MAChE,OAAO;AACN,aAAK,iBAAiB,KAAK,EAAE;AAAA,MAC9B;AAAA,IACD;AAAA,IAEA,YAAY,MAAM;AACjB,YAAM,oBAAoB,KAAK,gBAAgB,IAAI;AACnD,WAAK,gBAAgB,KAAK,EAAE;AAE5B,wBAAkB,QAAQ,CAAC,WAAW,QAAQ;AAC7C,aAAK,gBAAgB,OACpB,eAAe,sCAAsC,mBACtD;AAEA,cAAM,aAAa,KAAK,UAAU,OAAO,KAAK,QAAM,GAAG,cAAc,SAAS;AAC9E,sBAAc,wBAAyB,WAAW,QAAQ,GAAG,cAAc,IAAK;AAChF,cAAM,KAAK;AAEX,aAAK,GAAG,uBAAuB,OAAO,GAAG,KAAK,aAAa;AAAA,UAC1D,IAAI,iCACA,aADA;AAAA,YAEH,UAAU,WAAW;AACpB,iBAAG,OAAO,aAAa,GAAG,cAAc,WAAW,KAAK,KAAK;AAAA,YAC9D;AAAA,UACD;AAAA,UACA,QAAQ,KAAK,gBAAgB,KAAK,IAAI,mBAAmB;AAAA,UACzD,cAAc;AAAA,QACf,CAAC;AACD,aAAK,GAAG,qBAAqB,UAAU,KAAK,UAAU;AAAA,MACvD,CAAC;AAED,WAAK,+BAA+B,IAAI;AAExC,WAAK,iCAAiC;AAAA,IACvC;AAAA,IAEA,gBAAgB,MAAM;AACrB,YAAM,SAAS,CAAC,OAAO,OAAO,QAAQ,qBAAqB,uBAAuB,aAAa,cAAc,iBAAiB;AAC9H,UAAI,KAAK;AAAe,eAAO,KAAK,WAAW;AAC/C,UAAI,KAAK;AAAc,eAAO,KAAK,UAAU;AAC7C,aAAO;AAAA,IACR;AAAA,IAEA,+BAA+B,MAAM;AACpC,UAAI,KAAK,eAAe;AACvB,YAAI,CAAC,KAAK,cAAc;AACvB,eAAK,gBAAgB,OACpB,2CACD;AAAA,QACD;AACA,cAAM,QAAQ,GAAG,2BAA2B;AAC5C,aAAK,gBAAgB,OACpB,wDAAwD,aACzD;AACA,aAAK,gBAAgB,KAAK,oBAAoB,EAAE,KAAK,UAAU,EAAE,IAAI,UAAU,MAAM;AAAA,MACtF;AAAA,IACD;AAAA,IAEA,mCAAmC;AAClC,YAAM,KAAK;AACX,UAAI,KAAK,cAAc;AACtB,aAAK,aAAa,GAAG,WAAW,WAAW;AAC1C,cAAI,KAAK,SAAS,IAAI,KAAK,KAAK,MAAM,GAAG;AACxC,eAAG,OAAO,aAAa,GAAG,cAAc,QAAQ,KAAK,KAAK,EAAE,KAAK,MAAM;AACtE,oBAAM,WAAW,OAAO,QAAQ,GAAG,SAAS,GAAG,IAAI;AACnD,oBAAM,MAAM,GAAG,OAAO,QAAQ,EAAE;AAChC,iBAAG,YAAY,KAAK,gBAAgB,SAAS,MAAM,IAAI,QAAQ,CAAC;AAChE,iBAAG,oBAAoB,QAAQ;AAAA,YAChC,CAAC;AAAA,UACF;AAAA,QACD;AACA,aAAK,aAAa,GAAG,YAAY,CAAC,KAAK;AACvC,aAAK,aAAa,QAAQ;AAAA,MAC3B;AAEA,UAAI,KAAK,+BAA+B,CAAC,KAAK,uBAAuB;AACpE,aAAK,4BAA4B,GAAG,YAAY;AAChD,aAAK,4BAA4B,QAAQ;AAAA,MAC1C;AAEA,UAAI,KAAK,mBAAmB;AAC3B,aAAK,kBAAkB,GAAG,OAAO;AACjC,aAAK,kBAAkB,GAAG,WAAW,WAAW;AAC/C,cAAI,KAAK,OAAO;AACf,eAAG,OAAO,aAAa,GAAG,cAAc,aAAa,KAAK,KAAK,EAAE,KAAK,MAAM;AAC3E,iBAAG,iBAAiB,GAAG,OAAO,mBAAmB;AACjD,oBAAM,gBAAgB,GAAG,eAAe,GAAG,SAAS,cAAc,GAAG,eAAe,GAAG,SAAS,WAAW,KAAK;AAChH,kBAAI,kBAAkB,QAAW;AAChC,mBAAG,OAAO,oBAAoB,GAAG,SAAS,WAAW,KAAK,KAAK,EAAE,KAAK,MAAM;AAE3E,qBAAG,kBAAkB,UAAU,KAAK,KAAK;AAAA,gBAC1C,CAAC;AAAA,cACF,WAAW,kBAAkB,GAAG;AAC/B,mBAAG,kBAAkB,UAAU,EAAE;AACjC,sBAAM,iBAAiB,GAAG,SAAS,UAAU,KAAK;AAClD,sBAAM,iBAAiB,KAAK,MAAM,KAAK;AACvC,uBAAO,MACN,GAAG,wDAAwD,CAAC,gBAAgB,cAAc,CAAC,CAC5F;AAAA,cACD;AACA,iBAAG,mBAAmB,UAAU,aAAa;AAAA,YAC9C,CAAC;AAAA,UACF;AAAA,QACD;AACA,aAAK,kBAAkB,GAAG,YAAY,MAAM;AAC3C,iBAAO;AAAA,YACN,SAAS,EAAE,SAAS,KAAK,OAAO,QAAQ,EAAE,IAAI,QAAQ;AAAA,UACvD;AAAA,QACD;AACA,aAAK,kBAAkB,QAAQ;AAAA,MAChC;AAEA,UAAI,KAAK,mBAAmB;AAC3B,aAAK,kBAAkB,GAAG,OAAO;AACjC,aAAK,kBAAkB,GAAG,WAAW,iBAAiB;AACrD,WAAC,GAAG,aAAa,YAAY,MAAM,GAAG,qBAAqB;AAC3D,aAAG,OAAO,aAAa,GAAG,cAAc,aAAa,KAAK,KAAK;AAAA,QAChE;AACA,aAAK,kBAAkB,QAAQ;AAAA,MAChC;AAEA,UAAI,KAAK,kBAAkB;AAC1B,aAAK,iBAAiB,GAAG,OAAO;AAChC,aAAK,iBAAiB,GAAG,YAAY,MAAM;AAC1C,iBAAO;AAAA,YACN,OAAO;AAAA,YACP,SAAS;AAAA,cACR,WAAW,GAAG,SAAS;AAAA,cACvB,WAAW,GAAG,SAAS;AAAA,cACvB,cAAc,GAAG,OAAO,QAAQ,EAAE,IAAI;AAAA,YACvC;AAAA,UACD;AAAA,QACD;AACA,aAAK,iBAAiB,QAAQ;AAAA,MAC/B;AAEA,UAAI,KAAK,aAAa;AACrB,aAAK,YAAY,GAAG,WAAW,WAAW;AACzC,aAAG,OAAO,aAAa,GAAG,cAAc,OAAO,KAAK,KAAK;AAEzD,gBAAM,WAAW,OAAO,QAAQ,GAAG,SAAS,GAAG,IAAI;AACnD,aAAG,0BAA0B,GAAG,YAAa,SAAS,aAAa,KAAK;AACxE,aAAG,0BAA0B,QAAQ;AAAA,QACtC;AAAA,MACD;AAEA,aAAO,MAAM,GAAG,oBAAoB,KAAK,CAAC,WAAW,OAAO,aAAa;AACxE,cAAM,gBAAgB,KAAK,GAAG;AAC9B,cAAM,2BAA2B,KAAK,0BAA0B,QAAQ;AAExE,YAAI,4BAA4B,iBAAiB,cAAc,UAAU,MAAM,OAAO;AACrF,wBAAc,UAAU,KAAK;AAC7B,kBAAQ,iBAAiB,QAAQ;AAAA,QAClC;AAAA,MACD,CAAC;AAAA,IACF;AAAA,UAEM,uBAAuB;AAC5B,UAAI,KAAK,qBAAqB,KAAK,kBAAkB;AACpD,cAAM,sBAAsB,KAAK,kBAAkB,UAAU,EAAE,MAAM;AAAA,CAAI,EAAE,OAAO,OAAK,CAAC;AACxF,YAAI,CAAC,oBAAoB;AAAQ;AAGjC,cAAM,wBAAwB,MAAM,OAAO,GAAG,SAAS,aAAa;AAAA,UACnE,SAAS,EAAE,QAAQ,CAAC,MAAM,mBAAmB,EAAC;AAAA,UAC9C,QAAQ,CAAC,YAAY,MAAM;AAAA,QAC5B,CAAC;AACD,cAAM,mBAAmB,sBAAsB,OAAO,CAAC,KAAK,MAAM;AACjE,cAAI,CAAC,IAAI,EAAE,WAAW;AACrB,gBAAI,EAAE,YAAY,CAAC;AAAA,UACpB;AACA,cAAI,EAAE,YAAY,CAAC,GAAG,IAAI,EAAE,WAAW,EAAE,IAAI;AAC7C,iBAAO;AAAA,QACR,GAAG,CAAC,CAAC;AAEL,cAAM,WAAW,OAAO,KAAK,gBAAgB,EAAE;AAC/C,cAAM,mBAAmB,iBAAiB,UAAU,KAAK;AAAA,CAAI;AAE7D,cAAM,oCAAoC,oBAAoB,WAAW,iBAAiB,UAAU;AAEpG,cAAM,mBAAmB,KAAK,iBAAiB,UAAU;AACzD,4BAAoB,YAAY,MAAM,KAAK,iBAAiB,UAAU,QAAQ;AAE9E,YAAI,mCAAmC;AACtC,eAAK,kBAAkB,UAAU,gBAAgB;AACjD,eAAK,YAAY,UAAU,iBAAiB,UAAU,MAAM;AAE5D,iBAAO,iBAAiB;AACxB,eAAK,OAAO,4BAA4B,kBAAkB,KAAK,YAAY;AAAA,QAC5E;AAAA,MACD;AAAA,IACD;AAAA,IAEA,cAAc;AACb,WAAK,6BAA6B;AAClC,WAAK,6BAA6B;AAElC,WAAK,WAAW,GAAG,SAAS,cAAc,MAAM;AAC/C,aAAK,OAAO,mBAAmB;AAAA,MAChC,CAAC;AAAA,IACF;AAAA,IAEA,mBAAmB;AAClB,WAAK,QAAQ,KAAK,YAAY,EAAE,KAAK,SAAS,KAAK;AACnD,aAAO,GAAG,KAAK,GAAG,UAAU,MAAM;AACjC,cAAM,uBAAuB,KAAK,WAAW,GAAG,UAAU;AAC1D,YAAI,sBAAsB;AACzB,eAAK,OAAO,mBAAmB;AAAA,QAChC;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,+BAA+B;AAC9B,YAAM,KAAK;AACX,WAAK,gBAAgB,GAAG,SAAS,wBAAwB,WAAW;AACnE,cAAM,YAAY,EAAE,IAAI,EAAE,KAAK,gBAAgB;AAC/C,YAAI,KAAK,sBAAsB,WAAW;AACzC,aAAG,OAAO,mBAAmB,SAAS;AACtC,eAAK,qBAAqB;AAAA,QAC3B;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,+BAA+B;AAC9B,WAAK,gBAAgB,GAAG,SAAS,mBAAmB,MAAM;AACzD,aAAK,oBAAoB,KAAK,iBAAiB,UAAU,EAAE;AAC3D,YAAI,MAAM,KAAK,YAAY,UAAU;AACrC,YAAI,oBAAoB,KAAK,0BAA0B,UAAU;AACjE,YAAI,cAAc,KAAK,SAAS,eAAe,KAAK,OAAO,QAAQ,EAAE,IAAI,eAAe;AAExF,YAAI,UAAU,OAAO,KAAK;AAAA,UACzB,QAAQ;AAAA,UACR,MAAM;AAAA,YACL,KAAK,MAAM;AAAA,YACX,WAAW,KAAK,aAAa;AAAA,YAC7B,WAAW,KAAK,kBAAkB,UAAU,KAAK;AAAA,YACjD,WAAW,KAAK,aAAa,YAAY;AAAA,YACzC,cAAc;AAAA,YACd,aAAa;AAAA,UACd;AAAA,QACD,CAAC;AAED,gBAAQ,KAAK,CAAC,SAAS;AACtB,cAAI,8BAA8B,KAAK;AACvC,cAAI,iBAAiB,4BAA4B;AACjD,cAAI,CAAC,gBAAgB;AACpB,kBAAM,YAAY,KAAK,kBAAkB,UAAU,EAAE,KAAK;AAC1D,kBAAM,YAAY,KAAK,aAAa,UAAU,KAAK;AACnD,mBAAO,SACN,GAAG,+FAA+F,CAAC,WAAW,SAAS,CAAC,CACzH;AAAA,UACD,WAAW,iBAAiB,KAAK;AAChC,mBAAO,SACN,GAAG,8CAA8C,CAAC,cAAc,CAAC,CAClE;AACA,iBAAK,YAAY,UAAU,cAAc;AAAA,UAC1C;AACA,oBAAU,4BAA4B,KAAK;AAAA,CAAI;AAC/C,eAAK,kBAAkB,UAAU,OAAO;AAAA,QACzC,CAAC;AAAA,MACF,CAAC;AAAA,IACF;AAAA,IAEA,iBAAiB,MAAM;AACtB,aAAO,KAAK,WAAW,IAAI,WAAW,MAAM,IAAI,KAAK,WAAW,IAAI,WAAW,MAAM;AAAA,IACtF;AAAA,EACD;;;ACxaA,UAAQ,YAAY,cAAc,cAAc,QAAQ,YAAY,YAAY;AAAA,UACzE,wBAAuB;AAC5B,WAAK,WAAW,KACf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAqBD;AAEA,WAAK,aAAa,KAAK,WAAW,KAAK,YAAY;AACnD,WAAK,oBAAoB,KAAK,WAAW,KAAK,YAAY;AAC1D,WAAK,cAAc,KAAK,WAAW,KAAK,aAAa;AACrD,WAAK,cAAc,KAAK,WAAW,KAAK,aAAa;AACrD,WAAK,kBAAkB,KAAK,WAAW,KAAK,iBAAiB;AAC7D,WAAK,mBAAmB,KAAK,WAAW,KAAK,mBAAmB;AAGhE,UAAG,OAAO,sBAAsB,GAAE;AAEjC,eAAO,UAAU,KAAK;AACtB,YAAG,OAAO,OAAO,iBAAkB,aAAY;AAC9C,cAAI,KAAK;AACT,iBAAO,gBAAgB,IAAI,OAAO,sCAAsC;AACxE,iBAAO,cAAc,YAAY,SAAS,GAAE;AAC3C,gBAAG,EAAE,KAAK,WAAW,WAAU;AAC9B,qBAAO,UAAU,IAAI;AAAA,YACtB,WACQ,EAAE,KAAK,WAAW,YAAY,OAAO,sBAAqB;AACjE,qBAAO,SAAS,EAAE,KAAK;AAGvB,yBAAW,WAAU;AACpB,mBAAG,YAAY,UAAU,OAAO,MAAM;AAAA,cACvC,GAAG,GAAG;AAAA,YACP;AAAA,UACD;AACA,iBAAO,cAAc,YAAY,EAAC,WAAW,UAAS,CAAC;AAAA,QACxD;AAEA,aAAK,WAAW,GAAG,SAAS,aAAa,MAAM;AAAA,QAE/C,CAAC;AAAA,MAEF;AAAA,IACD;AAAA,UAEM,4BAA4B,MAAM;AACvC,aAAO,uBAAuB;AAC9B,YAAM,uBAAuB,CAAC,KAAK,0BAA0B,IAAI;AAGjE,YAAM,oBAAoB,CAAC,QAAQ,IAAI,KAAK,CAAC;AAE7C,WAAK,OAAO,qBAAqB,CAAC,iBAAiB;AACnD,WAAK,iBAAiB,CAAC,iBAAiB;AAExC,UAAK,CAAC,qBAAqB,wBAAyB,mBAAmB;AAGtE,cAAM,KAAK,2BAA2B;AAAA,MACjC;AAEN,UAAI,QAAQ,sBAAsB;AACjC,aAAK,UAAU,KAAK;AACpB,aAAK,YAAY,OAAO,SAAS,KAAK,OAAO;AAC7C,aAAK,OAAO,KAAK;AACjB,aAAK,WAAW;AAChB,aAAK,WAAW,KAAK,OAAO,QAAQ,EAAE,IAAI;AAE1C,aAAK,eAAe;AAEpB,aAAK,WAAW,IAAI;AACpB,aAAK,oBAAoB,IAAI;AAC7B,aAAK,YAAY,IAAI;AACrB,aAAK,OAAO,oBAAoB,IAAI;AAGpC,eAAO,aAAa;AAAA,MACrB,OAAO;AACN,aAAK,eAAe,CAAC;AAAA,MACtB;AACA,UAAG,OAAO,sBAAsB,GAAE;AACjC,eAAO,cAAc,YAAY,EAAC,WAAW,QAAO,CAAC;AAAA,MACtD;AAAA,IACD;AAAA,EACD;;;ACtGA,UAAQ,YAAY,YAAY,MAAM;AAAA,IACrC,YAAY,EAAE,SAAS,QAAQ,MAAM,MAAM,aAAa,kBAAkB;AACzE,WAAK,UAAU;AACf,WAAK,SAAS;AACd,WAAK,OAAO;AACZ,WAAK,OAAO;AACZ,WAAK,cAAc,eAAe,CAAC;AACnC,WAAK,aAAa,kBAAkB,CAAC;AAErC,WAAK,eAAe;AAAA,IACrB;AAAA,IAEA,iBAAiB;AAChB,WAAK,YAAY;AACjB,WAAK,YAAY;AAAA,IAClB;AAAA,IAEA,cAAc;AACb,YAAM,EAAE,MAAM,MAAM,aAAa,eAAe;AAEhD,0BAAoB;AACnB,eAAO,KAAK,OAAO,CAAC,GAAG,KAAK,MAAM;AACjC,iBAAO,IAAI,IAAI,OAAO,CAAC,IAAI,QAAQ,MAAM;AACxC,kBAAM,kBAAkB,eAAe,YAAY,KAAK,YAAY,GAAG,KAAK;AAC5E,kBAAM,YAAY,cAAc,WAAW,UAC1C,WAAW,UAAU,OAAO,WAAW,WAAW,OAAO,MAAM,MAAM,IAAI;AAE1E,mBAAO,KAAK,0BAA0B,uCAAuC,cAAc,GAAG,MAAM;AAAA,UACrG,GAAG,EAAE;AAAA,QACN,GAAG,EAAE;AAAA,MACN;AAEA,WAAK,QAAQ,KACZ;AAAA,MACG,SAAS;AAAA,UAEb;AAAA,IACD;AAAA,IAEA,cAAc;AACb,YAAM,KAAK;AACX,WAAK,QAAQ,GAAG,SAAS,eAAe,WAAW;AAClD,cAAM,OAAO,EAAE,IAAI;AACnB,WAAG,OAAO,aAAa,IAAI;AAAA,MAC5B,CAAC;AAAA,IACF;AAAA,EACD;;;AC7CA,UAAQ,YAAY,UAAU,MAAM;AAAA,IACnC,YAAY,EAAE,QAAQ,WAAW;AAChC,WAAK,UAAU;AACf,WAAK,SAAS;AAEd,WAAK,eAAe;AAAA,IACrB;AAAA,IAEA,iBAAiB;AAChB,WAAK,YAAY;AACjB,WAAK,kBAAkB;AACvB,WAAK,YAAY;AACjB,WAAK,iBAAiB;AAAA,IAEvB;AAAA,IAEA,cAAc;AACb,WAAK,QAAQ,OACZ;AAAA,iDAC8C,GAAG,gBAAgB;AAAA;AAAA;AAAA;AAAA,mCAIjC,GAAG,wBAAwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oCAQ1B,GAAG,gBAAgB;AAAA,cAErD;AACA,WAAK,aAAa,KAAK,QAAQ,KAAK,oBAAoB;AACxD,WAAK,iBAAiB,KAAK,WAAW,KAAK,gBAAgB;AAC3D,WAAK,kBAAkB,KAAK,WAAW,KAAK,iBAAiB;AAC7D,WAAK,UAAU,KAAK,WAAW,KAAK,SAAS;AAC7C,WAAK,UAAU,KAAK,WAAW,KAAK,aAAa;AACjD,WAAK,0BAA0B,KAAK,WAAW,KAAK,iBAAiB;AAAA,IACtE;AAAA,IAEA,8BAA8B;AAC7B,aAAO,GAAG,QAAQ,gBAAgB,MAAS,EAAE,KAAK,CAAC,QAAQ;AAC1D,cAAM,SAAS,IAAI;AACnB,YAAI,CAAC,OAAO;AAAQ;AAEpB,aAAK,kBAAkB,KAAK,wBAAwB,KAAK,iBAAiB;AAC1E,aAAK,gBAAgB,KAAK,EAAE;AAC5B,cAAM,MAAM,KAAK,OAAO,QAAQ;AAEhC,eAAO,QAAQ,QAAM;AACpB,eAAK,gBAAgB,OACpB,oCAAoC,GAAG,oCAAoC,GAAG,mBAC/E;AACA,cAAI,YAAY;AAAA,YACf,UAAU,WAAW;AACpB,kBAAI,UAAU,KAAK,GAAG,WAAW,KAAK,UAAU,CAAC;AAAA,YAClD;AAAA,UACD;AACA,cAAI,GAAG,aAAa,UAAU;AAC7B,wBAAY;AAAA,cACX,OAAO,WAAW;AACjB,oBAAI,IAAI,eAAe,aAAa,GAAG,WAAW,IAAI,IAAI,OAAO,GAAG;AACnE,sBAAI,eAAe,QAAQ,GAAG,WAAW,IAAI,IAAI,SAAS,IAAI,IAAI,OAAO;AAAA,gBAC1E;AAAA,cACD;AAAA,YACD;AAAA,UACD;AAEA,eAAK,GAAG,GAAG,qBAAqB,OAAO,GAAG,KAAK,aAAa;AAAA,YAC3D,IAAI,kCACA,KACA;AAAA,YAEJ,QAAQ,KAAK,gBAAgB,KAAK,IAAI,GAAG,iBAAiB;AAAA,YAC1D,cAAc;AAAA,UACf,CAAC;AACD,eAAK,GAAG,GAAG,mBAAmB,UAAU,IAAI,IAAI,GAAG,UAAU;AAAA,QAC9D,CAAC;AAAA,MACF,CAAC;AAAA,IACF;AAAA,IAEA,oBAAoB;AACnB,YAAM,KAAK;AACX,WAAK,aAAa,IAAI,QAAQ,YAAY,UAAU;AAAA,QACnD,SAAS,KAAK;AAAA,QACd,QAAQ;AAAA,UACP,cAAc,SAAS,MAAM;AAC5B,eAAG,kBAAkB,IAAI;AAAA,UAC1B;AAAA,QACD;AAAA,QACA,MAAM;AAAA,QACN,MAAM;AAAA,UACL,CAAE,GAAG,GAAG,CAAE;AAAA,UACV,CAAE,GAAG,GAAG,CAAE;AAAA,UACV,CAAE,GAAG,GAAG,CAAE;AAAA,UACV,CAAE,KAAK,GAAG,QAAS;AAAA,QACpB;AAAA,MACD,CAAC;AAED,WAAK,eAAe;AAAA,IACrB;AAAA,IAEA,kBAAkB,MAAM;AACvB,YAAM,eAAe,KAAK,KAAK,mBAAmB;AAElD,2BAAqB,IAAI;AACzB,WAAK,eAAe,iBAAiB,WAAW,KAAK,aAAa,MAAM,GAAG,EAAE,IAAI,KAAK,eAAe;AACrG,WAAK,cAAc,OAAO,IAAI,CAAC,EAAE,MAAM;AACvC,WAAK,cAAc,UAAU,KAAK,YAAY;AAE9C,oCAA8B,OAAM;AACnC,cAAK,SAAS,+BAA+B;AAC7C,mBAAW,MAAM;AAChB,gBAAK,YAAY,+BAA+B;AAAA,QACjD,GAAG,GAAG;AAAA,MACP;AAAA,IACD;AAAA,IAEA,cAAc;AACb,YAAM,KAAK;AAEX,WAAK,eAAe,GAAG,SAAS,oBAAoB,SAAS,GAAG;AAC/D,cAAM,eAAe,EAAE,IAAI;AAE3B,YAAI,CAAC,EAAE,EAAE,MAAM,EAAE,GAAG,YAAY;AAAG;AAEnC,cAAM,aAAa,aAAa,OAAO,EAAE,OAAO,GAAG,eAAe,OAAO,EAAE,OAAO,GAAG,eAAe,WAAW;AAC/G,WAAG,eAAe,QAAQ,EAAE,WAAW,CAAC;AAExC,cAAM,OAAO,aAAa,KAAK,WAAW;AAG1C,UAAE,0BAA0B,EAAE,IAAI,WAAW,MAAM;AACnD,UAAE,iBAAiB,EAAE,IAAI,WAAW,MAAM;AAC1C,WAAG,eAAe,KAAK,aAAa,EAAE,IAAI,WAAW,QAAQ;AAC7D,WAAG,eAAe,KAAK,sBAAsB,EAAE,IAAI,WAAW,MAAM;AAGpE,UAAE,kBAAkB,EAAE,YAAY,gBAAgB;AAElD,YAAI,aAAa,SAAS,gBAAgB,GAAG;AAE5C,uBAAa,YAAY,gBAAgB;AACzC,aAAG,gBAAgB;AAAA,QACpB,OAAO;AAEN,uBAAa,SAAS,gBAAgB;AACtC,uBAAa,KAAK,0BAA0B,EAAE,IAAI,WAAW,MAAM;AACnE,uBAAa,KAAK,iBAAiB,EAAE,IAAI,WAAW,MAAM;AAC1D,aAAG,eAAe,KAAK,IAAI,aAAa,EAAE,IAAI,WAAW,MAAM;AAC/D,aAAG,eAAe,KAAK,IAAI,WAAW,EAAE,IAAI,WAAW,QAAQ;AAE/D,aAAG,gBAAgB,GAAG,GAAG;AACzB,aAAG,iBAAiB,GAAG,cAAc,OAAO,IAAI,CAAC,EAAE,MAAM;AACzD,aAAG,0BAA0B;AAAA,QAC9B;AAAA,MACD,CAAC;AAED,aAAO,GAAG,KAAK,GAAG,eAAe,kBAAkB,CAAC,QAAQ;AAjK9D;AAkKG,cAAM,UAAU,IAAI,IAAI;AACxB,cAAM,iBAAiB,EAAE,WAAK,8BAAL,mBAAgC,OAAO,EAAE;AAClE,YAAI,SAAS;AACZ,yBAAe,YAAY,aAAa,EAAE,SAAS,aAAa;AAAA,QACjE,OAAO;AACN,yBAAe,YAAY,aAAa,EAAE,SAAS,aAAa;AAAA,QACjE;AAAA,MACD,CAAC;AAED,aAAO,GAAG,KAAK,GAAG,eAAe,eAAe,CAAC,QAAQ;AACxD,YAAI,IAAI,IAAI,eAAe,CAAC,IAAI,0BAA0B;AACzD,cAAI,CAAC,IAAI,IAAI,qBAAqB;AACjC,gBAAI,2BAA2B;AAC/B,mBAAO,aAAa;AAAA,cACnB,MAAM,IAAI,IAAI,sBAAoB;AAAA,cAClC,MAAM,IAAI,QAAQ,qBAAqB;AAAA,cACvC,MAAM,IAAI,IAAI,sBAAoB;AAAA,cAClC,MAAM,IAAI,QAAQ,oBAAoB;AAAA,cACtC,MAAM,IAAI,KAAK;AAAA,cACf,MAAM,KAAK,sBAAsB,IAAI,GAAG;AAAA,cACxC,MAAO,IAAI,2BAA2B;AAAA,YACvC,CAAC;AAAA,UACF,WAAW,IAAI,IAAI,qBAAqB;AACvC,mBAAO,WAAW;AAAA,cACjB,SAAS,GAAG,2DAA2D;AAAA,cACvE,WAAW;AAAA,YACZ,CAAC;AAAA,UACF;AAAA,QACD;AAAA,MACD,CAAC;AAED,WAAK,4BAA4B;AAEjC,WAAK,eAAe,GAAG,SAAS,aAAa,WAAW;AACvD,cAAM,QAAQ,EAAE,IAAI,EAAE,KAAK,YAAY;AACvC,WAAG,cAAc,UAAU,KAAK;AAAA,MACjC,CAAC;AAED,WAAK,WAAW,GAAG,SAAS,qBAAqB,MAAM;AACtD,cAAM,MAAM,KAAK,OAAO,QAAQ,EAAE;AAClC,cAAM,cAAc,IAAI;AACxB,cAAM,QAAQ,IAAI;AAElB,YAAI,eAAe,KAAK,CAAC,MAAM,QAAQ;AACtC,gBAAM,UAAU,MAAM,SAAS,GAAG,8CAA8C,IAAI,GAAG,gCAAgC;AACvH,iBAAO,WAAW,EAAE,SAAS,WAAW,SAAS,CAAC;AAClD,iBAAO,MAAM,WAAW,OAAO;AAC/B;AAAA,QACD;AAEA,aAAK,OAAO,eAAe;AAAA,MAC5B,CAAC;AAED,aAAO,GAAG,KAAK,GAAG,eAAe,eAAe,CAAC,QAAQ;AACxD,aAAK,sBAAsB,IAAI,GAAG;AAGlC,cAAM,8BAA8B,CAAC,KAAK,eAAe,KAAK,iBAAiB,EAAE,GAAG,UAAU;AAC9F,aAAK,sBAAsB,IAAI,GAAG;AAClC,SAAC,+BAA+B,KAAK,eAAe,KAAK,iBAAiB,EAAE,IAAI,WAAW,MAAM;AACjG,aAAK,wBAAwB;AAAA,MAC9B,CAAC;AAED,aAAO,GAAG,KAAK,GAAG,eAAe,kBAAkB,CAAC,QAAQ;AAC3D,cAAM,qBAAqB,gBAAgB,IAAI,IAAI,gBAAgB,IAAI,IAAI,QAAQ;AACnF,aAAK,eAAe,KAAK,wBAAwB,EAAE,KAAK,kBAAkB;AAAA,MAC3E,CAAC;AAED,aAAO,GAAG,KAAK,GAAG,yBAAyB,UAAU,CAAC,KAAK,KAAK,QAAQ;AAEvE,cAAM,cAAc,OAAO,KAAK;AAChC,cAAM,OAAO,YAAY,gBAAgB,QAAQ,OAAO,GAAG,EAAE,YAAY;AACzE,YAAI,KAAK,GAAG,mBAAmB,KAAK,GAAG,gBAAgB,UAAU,KAAK,YAAY,QAAQ;AACzF,eAAK,GAAG,gBAAgB,UAAU,YAAY,MAAM;AAAA,QACrD;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,8BAA8B;AAC7B,aAAO,SAAS,GAAG,yBAAyB,CAAC,SAAS;AACrD,cAAM,MAAM,KAAK,OAAO,QAAQ,EAAE;AAClC,cAAM,EAAE,UAAU,QAAQ,SAAS,oBAAoB;AACvD,YAAI,SAAS;AAEb,YAAI,SAAS;AACZ,kBAAQ,GAAG,kBAAkB;AAC7B,gBAAM,cAAc,KAAK,OAAO,aAAa,qBAAqB,IAAI,IAAI,cAAc,IAAI;AAC5F,cAAI,UAAU,aAAa;AAC1B,mBAAO,IAAI,SAAS;AACpB,sBAAU,GAAG,yCAAyC,CAAC,gBAAgB,QAAQ,IAAI,UAAU,CAAC,CAAC,CAAC;AAChG,iBAAK,OAAO,eAAe;AAC3B,oBAAQ,WAAW;AAAA,UAEpB,OAAO;AACN,sBAAU,GAAG,mFAAmF,CAAC,gBAAgB,QAAQ,IAAI,UAAU,CAAC,CAAC,CAAC;AAAA,UAC3I;AAAA,QACD,WAAW,iBAAiB;AAC3B,oBAAU;AACV,kBAAQ,GAAG,gBAAgB;AAAA,QAC5B;AAEA,eAAO,SAAS,EAAE,WAAW,SAAS,SAAS,MAAM,CAAC;AAAA,MACvD,CAAC;AAAA,IACF;AAAA,IAEA,4BAA4B;AAC3B,YAAM,MAAM,KAAK,OAAO,QAAQ,EAAE;AAClC,YAAM,cAAc,KAAK,OAAO,aAAa,qBAAqB,IAAI,IAAI,cAAc,IAAI;AAC5F,YAAM,mBAAmB,cAAc,IAAI;AAC3C,YAAM,gBAAgB,KAAK,gBAAgB,KAAK,cAAc,UAAU,IAAI;AAC5E,UAAI,CAAC,iBAAiB,mBAAmB,KAAK,KAAK,eAAe;AACjE,aAAK,cAAc,UAAU,gBAAgB;AAAA,MAC9C;AAAA,IACD;AAAA,IAEA,mBAAmB;AAClB,YAAM,aAAa,OAAO,MAAM,OAAO,IAAI,WAAM;AACjD,WAAK,WAAW,KAAK,mBAAmB,EAAE,KAAK,SAAS,GAAG,kBAAkB;AAC7E,aAAO,GAAG,KAAK,GAAG,cAAc,MAAM;AACrC,cAAM,qBAAqB,KAAK,WAAW,GAAG,UAAU;AACxD,cAAM,cAAc,KAAK,eAAe,KAAK,iBAAiB;AAC9D,YAAI,sBAAsB,YAAY,QAAQ;AAC7C,eAAK,WAAW,KAAK,mBAAmB,EAAE,MAAM;AAAA,QACjD;AAAA,MACD,CAAC;AAED,aAAO,GAAG,KAAK,aAAa;AAAA,QAC3B,UAAU;AAAA,QACV,QAAQ,MAAM;AACb,gBAAM,qBAAqB,KAAK,WAAW,GAAG,UAAU;AACxD,cAAI,cAAc,KAAK,eAAe,KAAK,iBAAiB;AAC5D,wBAAc,YAAY,SAAS,YAAY,KAAK,WAAW,IAAI;AAEnE,cAAI,CAAC;AAAa;AAElB,gBAAM,mBAAmB,MAAM,KAAK,KAAK,eAAe,KAAK,kBAAkB,CAAC,EAAE,IAAI,OAAK,EAAE,CAAC,EAAE,KAAK,WAAW,CAAC;AACjH,gBAAM,aAAa,iBAAiB,QAAQ,WAAW;AACvD,gBAAM,kBAAmB,cAAa,KAAK,iBAAiB;AAC5D,gBAAM,0BAA0B,KAAK,eAAe,KAAK,+BAA+B,iBAAiB,oBAAoB;AAE7H,cAAI,sBAAsB,cAAc,iBAAiB;AACxD,oCAAwB,MAAM;AAAA,UAC/B;AAAA,QACD;AAAA,QACA,WAAW,MAAM,KAAK,WAAW,GAAG,UAAU,KAAK,KAAK,eAAe,KAAK,iBAAiB,EAAE;AAAA,QAC/F,aAAa,GAAG,8BAA8B;AAAA,QAC9C,eAAe;AAAA,QACf,MAAM,SAAS,KAAK;AAAA,MACrB,CAAC;AAAA,IACF;AAAA,IAEA,gBAAgB;AAAA,IAEhB;AAAA,IAEA,yBAAyB;AACxB,WAAK,wBAAwB;AAC7B,WAAK,4BAA4B;AACjC,WAAK,sBAAsB;AAC3B,WAAK,qBAAqB;AAAA,IAC3B;AAAA,IAEA,YAAY;AACX,WAAK,OAAO,sBAAsB,KAAK;AACvC,WAAK,iBAAiB,KAAK;AAAA,IAC5B;AAAA,IAEA,WAAW;AACV,WAAK,OAAO,sBAAsB,IAAI;AACtC,WAAK,iBAAiB,IAAI;AAE1B,WAAK,uBAAuB;AAAA,IAC7B;AAAA,IAEA,yBAAyB;AACxB,UAAI,KAAK,SAAS,KAAK,iBAAiB,EAAE,QAAQ;AACjD,aAAK,SAAS,KAAK,cAAc;AAAA,MAClC,OAAO;AACN,aAAK,SAAS,KAAK,EAAE;AACrB,aAAK,oBAAoB,OAAO,GAAG,KAAK,aAAa;AAAA,UACpD,IAAI;AAAA,YACH,OAAO,GAAG,QAAQ;AAAA,YAClB,WAAW;AAAA,YACX,UAAU,WAAW;AAAA,YAAC;AAAA,UACvB;AAAA,UACA,QAAQ,KAAK,gBAAgB,KAAK,UAAU;AAAA,UAC5C,cAAc;AAAA,QACf,CAAC;AACD,aAAK,kBAAkB,UAAU,EAAE;AAAA,MACpC;AAAA,IACD;AAAA,IAEA,0BAA0B;AACzB,YAAM,MAAM,KAAK,OAAO,QAAQ,EAAE;AAClC,YAAM,WAAW,IAAI;AACrB,YAAM,WAAW,IAAI;AAErB,WAAK,eAAe,KAAK,GACxB,SAAS,IAAI,CAAC,GAAG,MAAM;AACtB,cAAM,OAAO,EAAE,gBAAgB,QAAQ,OAAO,GAAG,EAAE,YAAY;AAC/D,cAAM,eAAe,EAAE;AACvB,cAAM,SAAS,IAAI,MAAM,IAAI,SAAS;AACtC,cAAM,SAAS,EAAE,SAAS,IAAI,gBAAgB,EAAE,QAAQ,QAAQ,IAAI;AAEpE,eAAQ;AAAA;AAAA,gDAEoC,4BAA4B;AAAA,SACnE,EAAE;AAAA,qBACU,2BAA2B;AAAA,qBAC3B;AAAA;AAAA;AAAA;AAAA,MAIlB,CAAC,EAAE,KAAK,EAAE,GACT;AAEF,eAAS,QAAQ,OAAK;AACrB,cAAM,OAAO,EAAE,gBAAgB,QAAQ,OAAO,GAAG,EAAE,YAAY;AAC/D,cAAM,KAAK;AACX,aAAK,GAAG,kBAAkB,OAAO,GAAG,KAAK,aAAa;AAAA,UACrD,IAAI;AAAA,YACH,OAAO,EAAE;AAAA,YACT,WAAW;AAAA,YACX,aAAa,GAAG,qBAAqB,CAAC,EAAE,eAAe,CAAC;AAAA,YACxD,UAAU,WAAW;AACpB,oBAAM,gBAAgB,OAAO,MAAM,UAAU,EAAE,SAAS,EAAE,MAAM,QAAQ;AACxE,kBAAI,iBAAiB,KAAK,OAAO;AAChC,uBAAO,MACL,UAAU,EAAE,SAAS,EAAE,MAAM,UAAU,IAAI,KAAK,KAAK,CAAC,EACtD,KAAK,MAAM,GAAG,sBAAsB,CAAC;AAEvC,sBAAM,qBAAqB,gBAAgB,KAAK,OAAO,QAAQ;AAC/D,mBAAG,eAAe,KAAK,IAAI,aAAa,EAAE,KAAK,kBAAkB;AAAA,cAClE;AAAA,YACD;AAAA,UACD;AAAA,UACA,QAAQ,KAAK,eAAe,KAAK,IAAI,8BAA8B;AAAA,UACnE,cAAc;AAAA,QACf,CAAC;AACD,aAAK,GAAG,gBAAgB,aAAa,KAAK;AAC1C,aAAK,GAAG,gBAAgB,UAAU,EAAE,MAAM;AAAA,MAC3C,CAAC;AAED,WAAK,mCAAmC;AAExC,WAAK,sBAAsB,GAAG;AAAA,IAC/B;AAAA,IAEA,uBAAuB;AACtB,YAAM,MAAM,KAAK,OAAO,QAAQ,EAAE;AAClC,YAAM,WAAW,IAAI;AACrB,eAAS,QAAQ,OAAK;AACrB,cAAM,OAAO,EAAE,gBAAgB,QAAQ,OAAO,GAAG,EAAE,YAAY;AAC/D,YAAI,EAAE,SAAS;AACd,qBAAW,MAAM;AAChB,iBAAK,eAAe,KAAK,IAAI,8BAA8B,EAAE,OAAO,EAAE,MAAM;AAAA,UAC7E,GAAG,GAAG;AAAA,QACP;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,sBAAsB,KAAK;AAC1B,YAAM,cAAc,KAAK,OAAO,aAAa,qBAAqB,IAAI,IAAI,cAAc,IAAI;AAC5F,YAAM,WAAW,IAAI;AAErB,YAAM,YAAY,KAAK,mBAAmB,IAAI,WAAW,CAAC;AAE1D,WAAK,eAAe,KAAK,iBAAiB,EAAE,OAAO;AACnD,UAAI,iBAAiB,UAAU,IAAI,OAAK;AACvC,eAAO,qCAAqC,MAAM,gBAAgB,GAAG,UAAU,CAAC;AAAA,MACjF,CAAC,EAAE,KAAK,EAAE;AAEV,WAAK,eAAe,KAAK,4BAA4B,EAAE,KAAK,0BAA0B,EACpF,MAAM,+BAA+B,sBAAsB;AAAA,IAC9D;AAAA,IAEA,mBAAmB,aAAa;AAC/B,UAAI,QAAQ,CAAC,GAAG,GAAG,EAAE;AACrB,YAAM,SAAS,OAAO,KAAK,MAAM,WAAW,CAAC,EAAE;AAE/C,cAAQ,MAAM,IAAI,OAAK,IAAK,MAAO,UAAS,EAAG;AAE/C,YAAM,cAAc,CAAC,QAAQ,MAAM;AAClC,YAAI,YAAY,KAAK,KAAM,SAAS,CAAE,IAAI;AAC1C,eAAO,cAAc,SAAS,YAAY,IAAI;AAAA,MAC/C;AAEA,aAAO,MAAM,OAAO,CAAC,UAAU,MAAM;AACpC,YAAI,YAAY,YAAY,aAAa,CAAC;AAC1C,oBAAY,SAAS,QAAQ,SAAS,KAAK,KAAK,YAAY,IAAI;AAChE,eAAO,CAAC,GAAG,UAAU,SAAS;AAAA,MAC/B,GAAG,CAAC,CAAC;AAAA,IACN;AAAA,IAEA,qCAAqC;AACpC,YAAM,KAAK;AACX,YAAM,MAAM,KAAK,OAAO,QAAQ,EAAE;AAClC,YAAM,EAAE,iBAAiB,gBAAgB,sBAAsB,KAAK,OAAO,qBAAqB;AAEhG,WAAK,eAAe,KAAK,8CAA8C,EAAE,OAAO,EAAE,OAAO;AAEzF,UAAI,CAAC;AAAiB;AAEtB,UAAI,aAAa,WAAW;AAC5B,UAAI,CAAC,gBAAgB;AACpB,sBAAc,GAAG,yCAAyC;AAC1D,oBAAY;AAAA,MACb,OAAO;AACN,gCAAwB,IAAI,IAAI,cAAc,IAAI,IAAI,iBAAiB,GAAG,UAAU,kBAAkB,GAAG,CAAC;AAC1G,sBAAc,GAAG,4BAA4B,CAAC,gBAAgB,qBAAqB,CAAC,CAAC;AACrF,oBAAY;AAAA,MACb;AAEA,YAAM,SAAS,KAAK,eAAe,SAAS,EAAE,SAAS,MAAM,IAAI,SAAS;AAC1E,YAAM,SAAS,IAAI,iBAAiB,IAAI,gBAAgB,IAAI,gBAAgB,IAAI,QAAQ,IAAI;AAC5F,WAAK,eAAe,OACnB;AAAA;AAAA;AAAA,qDAGkD;AAAA,wCACb;AAAA;AAAA;AAAA,UAItC;AAEA,WAAK,4BAA4B,OAAO,GAAG,KAAK,aAAa;AAAA,QAC5D,IAAI;AAAA,UACH,OAAO,GAAG,uBAAuB;AAAA,UACjC,WAAW;AAAA,UACX,aAAa,GAAG,8BAA8B;AAAA,UAC9C,SAAS;AAAA,UACT;AAAA,UACA,UAAU,iBAAiB;AAC1B,gBAAI,CAAC;AAAgB;AAErB,gBAAI,KAAK,QAAQ,uBAAuB;AACvC,qBAAO,WAAW;AAAA,gBACjB,SAAS,GAAG,oCAAoC,CAAC,gBAAgB,qBAAqB,CAAC,CAAC;AAAA,gBACxF,WAAW;AAAA,cACZ,CAAC;AACD,qBAAO,MAAM,WAAW,QAAQ;AAChC,iBAAG,0BAA0B,UAAU,CAAC;AACxC;AAAA,YACD;AACA,kBAAM,wBAAwB,KAAK,QAAQ,IAAI,IAAI;AACnD,kBAAM,OAAO,MAAM,UAAU,IAAI,SAAS,IAAI,MAAM,yBAAyB,qBAAqB;AAClG,mBAAO,MAAM,UAAU,IAAI,SAAS,IAAI,MAAM,kBAAkB,SAAS,KAAK,QAAQ,iBAAiB,CAAC;AAAA,UACzG;AAAA,UACA;AAAA,QACD;AAAA,QACA,QAAQ,KAAK,eAAe,KAAK,yCAAyC;AAAA,QAC1E,cAAc;AAAA,MACf,CAAC;AACD,WAAK,0BAA0B,aAAa,KAAK;AAAA,IAGlD;AAAA,IAEA,gCAAgC;AAC/B,YAAM,YAAY,KAAK,OAAO,QAAQ,EAAE,IAAI;AAC5C,UAAI,cAAc;AACjB,aAAK,eAAe,OACnB;AAAA;AAAA,WAGD;AAAA,IACF;AAAA,IAEA,sBAAsB,KAAK;AAC1B,UAAI,CAAC;AAAK,cAAM,KAAK,OAAO,QAAQ,EAAE;AACtC,YAAM,cAAc,IAAI;AACxB,YAAM,cAAc,KAAK,OAAO,aAAa,qBAAqB,IAAI,IAAI,cAAc,IAAI;AAC5F,YAAM,YAAY,cAAc,IAAI;AACpC,YAAM,SAAS,IAAI,iBAAiB,aAAa,IAAI,KAAK,YAAY;AACtE,YAAM,WAAW,IAAI;AACrB,YAAM,QAAQ,SAAS,GAAG,QAAQ,IAAI,GAAG,YAAY;AAErD,WAAK,QAAQ,KACZ;AAAA,+BAC4B,GAAG,aAAa;AAAA,yBACtB,gBAAgB,aAAa,QAAQ;AAAA;AAAA;AAAA;AAAA,+BAI/B,GAAG,aAAa;AAAA,yBACtB,gBAAgB,aAAa,QAAQ;AAAA;AAAA;AAAA;AAAA,+BAI/B;AAAA,yBACN,gBAAgB,UAAU,WAAW,QAAQ;AAAA,UAEpE;AAAA,IACD;AAAA,IAEA,iBAAiB,MAAM;AACtB,aAAO,KAAK,WAAW,IAAI,WAAW,MAAM,IAAI,KAAK,WAAW,IAAI,WAAW,MAAM;AAAA,IACtF;AAAA,EACD;;;ACjjBA,UAAQ,YAAY,UAAU,cAAc,QAAQ,YAAY,QAAQ;AAAA,IACvE,cAAc;AACb,WAAK,QAAQ,OACZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAeD;AACA,WAAK,aAAa,KAAK,QAAQ,KAAK,oBAAoB;AACxD,WAAK,iBAAiB,KAAK,WAAW,KAAK,gBAAgB;AAC3D,WAAK,kBAAkB,KAAK,WAAW,KAAK,iBAAiB;AAC7D,WAAK,UAAU,KAAK,WAAW,KAAK,SAAS;AAC7C,WAAK,UAAU,KAAK,WAAW,KAAK,aAAa;AACjD,WAAK,0BAA0B,KAAK,WAAW,KAAK,iBAAiB;AAAA,IACtE;AAAA,IAEA,8BAA8B;AAC7B,aAAO,GAAG,QAAQ,gBAAgB,MAAS,EAAE,KAAK,CAAC,QAAQ;AAC1D,cAAM,SAAS,IAAI;AACnB,YAAI,CAAC,OAAO;AAAQ;AAEpB,aAAK,kBAAkB,KAAK,wBAAwB,KAAK,iBAAiB;AAC1E,aAAK,gBAAgB,KAAK,EAAE;AAC5B,cAAM,MAAM,KAAK,OAAO,QAAQ;AAEhC,eAAO,QAAQ,QAAM;AACpB,eAAK,gBAAgB,OACpB,oCAAoC,GAAG,oCAAoC,GAAG,mBAC/E;AACA,cAAI,YAAY;AAAA,YACf,UAAU,WAAW;AACpB,kBAAI,UAAU,KAAK,GAAG,WAAW,KAAK,UAAU,CAAC;AAAA,YAClD;AAAA,UACD;AACA,cAAI,GAAG,aAAa,UAAU;AAC7B,wBAAY;AAAA,cACX,OAAO,WAAW;AACjB,oBAAI,IAAI,eAAe,aAAa,GAAG,WAAW,IAAI,IAAI,OAAO,GAAG;AACnE,sBAAI,eAAe,QAAQ,GAAG,WAAW,IAAI,IAAI,SAAS,IAAI,IAAI,OAAO;AAAA,gBAC1E;AAAA,cACD;AAAA,YACD;AAAA,UACD;AAEA,eAAK,GAAG,GAAG,qBAAqB,OAAO,GAAG,KAAK,aAAa;AAAA,YAC3D,IAAI,kCACA,KACA;AAAA,YAEJ,QAAQ,KAAK,gBAAgB,KAAK,IAAI,GAAG,iBAAiB;AAAA,YAC1D,cAAc;AAAA,UACf,CAAC;AACD,eAAK,GAAG,GAAG,mBAAmB,UAAU,IAAI,IAAI,GAAG,UAAU;AAAA,QAC9D,CAAC;AAAA,MACF,CAAC;AAGD,UAAG,OAAO,oBAAoB,GAAE;AAC/B,aAAK,wBAAwB,KAAK,iBAAiB,EAAE,OACpD;AAAA;AAAA,WAGD;AAAA,MACD;AAAA,IACD;AAAA,IAEA,cAAc;AACb,YAAM,KAAK;AAEX,WAAK,eAAe,GAAG,SAAS,oBAAoB,SAAS,GAAG;AAC/D,cAAM,eAAe,EAAE,IAAI;AAE3B,YAAI,CAAC,EAAE,EAAE,MAAM,EAAE,GAAG,YAAY;AAAG;AAEnC,cAAM,aAAa,aAAa,OAAO,EAAE,OAAO,GAAG,eAAe,OAAO,EAAE,OAAO,GAAG,eAAe,WAAW;AAC/G,WAAG,eAAe,QAAQ,EAAE,WAAW,CAAC;AAExC,cAAM,OAAO,aAAa,KAAK,WAAW;AAG1C,UAAE,0BAA0B,EAAE,IAAI,WAAW,MAAM;AACnD,UAAE,iBAAiB,EAAE,IAAI,WAAW,MAAM;AAC1C,WAAG,eAAe,KAAK,aAAa,EAAE,IAAI,WAAW,QAAQ;AAC7D,WAAG,eAAe,KAAK,sBAAsB,EAAE,IAAI,WAAW,MAAM;AAGpE,UAAE,kBAAkB,EAAE,YAAY,gBAAgB;AAElD,YAAI,aAAa,SAAS,gBAAgB,GAAG;AAE5C,uBAAa,YAAY,gBAAgB;AACzC,aAAG,gBAAgB;AAAA,QACpB,OAAO;AAEN,uBAAa,SAAS,gBAAgB;AACtC,uBAAa,KAAK,0BAA0B,EAAE,IAAI,WAAW,MAAM;AACnE,uBAAa,KAAK,iBAAiB,EAAE,IAAI,WAAW,MAAM;AAC1D,aAAG,eAAe,KAAK,IAAI,aAAa,EAAE,IAAI,WAAW,MAAM;AAC/D,aAAG,eAAe,KAAK,IAAI,WAAW,EAAE,IAAI,WAAW,QAAQ;AAE/D,aAAG,gBAAgB,GAAG,GAAG;AACzB,aAAG,iBAAiB,GAAG,cAAc,OAAO,IAAI,CAAC,EAAE,MAAM;AACzD,aAAG,0BAA0B;AAAA,QAC9B;AAAA,MACD,CAAC;AAED,aAAO,GAAG,KAAK,GAAG,eAAe,kBAAkB,CAAC,QAAQ;AAC3D,cAAM,UAAU,IAAI,IAAI;AACxB,cAAM,iBAAiB,EAAE,KAAK,0BAA0B,OAAO,EAAE;AACjE,YAAI,SAAS;AACZ,yBAAe,YAAY,aAAa,EAAE,SAAS,aAAa;AAAA,QACjE,OAAO;AACN,yBAAe,YAAY,aAAa,EAAE,SAAS,aAAa;AAAA,QACjE;AAAA,MACD,CAAC;AAED,aAAO,GAAG,KAAK,GAAG,eAAe,eAAe,CAAC,QAAQ;AACxD,YAAI,IAAI,IAAI,eAAe,CAAC,IAAI,0BAA0B;AACzD,cAAI,CAAC,IAAI,IAAI,qBAAqB;AACjC,gBAAI,2BAA2B;AAC/B,mBAAO,aAAa;AAAA,cACnB,MAAM,IAAI,IAAI,sBAAoB;AAAA,cAClC,MAAM,IAAI,QAAQ,qBAAqB;AAAA,cACvC,MAAM,IAAI,IAAI,sBAAoB;AAAA,cAClC,MAAM,IAAI,QAAQ,oBAAoB;AAAA,cACtC,MAAM,IAAI,KAAK;AAAA,cACf,MAAM,KAAK,sBAAsB,IAAI,GAAG;AAAA,cACxC,MAAO,IAAI,2BAA2B;AAAA,YACvC,CAAC;AAAA,UACF,WAAW,IAAI,IAAI,qBAAqB;AACvC,mBAAO,WAAW;AAAA,cACjB,SAAS,GAAG,2DAA2D;AAAA,cACvE,WAAW;AAAA,YACZ,CAAC;AAAA,UACF;AAAA,QACD;AAAA,MACD,CAAC;AAED,WAAK,4BAA4B;AAEjC,WAAK,eAAe,GAAG,SAAS,aAAa,WAAW;AACvD,cAAM,QAAQ,EAAE,IAAI,EAAE,KAAK,YAAY;AACvC,WAAG,cAAc,UAAU,KAAK;AAAA,MACjC,CAAC;AAED,WAAK,WAAW,GAAG,SAAS,qBAAqB,MAAM;AACtD,cAAM,MAAM,KAAK,OAAO,QAAQ,EAAE;AAClC,cAAM,cAAc,IAAI;AACxB,cAAM,QAAQ,IAAI;AAElB,YAAI,eAAe,KAAK,CAAC,MAAM,QAAQ;AACtC,gBAAM,UAAU,MAAM,SAAS,GAAG,8CAA8C,IAAI,GAAG,gCAAgC;AACvH,iBAAO,WAAW,EAAE,SAAS,WAAW,SAAS,CAAC;AAClD,iBAAO,MAAM,WAAW,OAAO;AAC/B;AAAA,QACD;AAEA,aAAK,OAAO,eAAe;AAAA,MAC5B,CAAC;AAED,aAAO,GAAG,KAAK,GAAG,eAAe,eAAe,CAAC,QAAQ;AACxD,aAAK,sBAAsB,IAAI,GAAG;AAGlC,cAAM,8BAA8B,CAAC,KAAK,eAAe,KAAK,iBAAiB,EAAE,GAAG,UAAU;AAC9F,aAAK,sBAAsB,IAAI,GAAG;AAClC,SAAC,+BAA+B,KAAK,eAAe,KAAK,iBAAiB,EAAE,IAAI,WAAW,MAAM;AACjG,aAAK,wBAAwB;AAAA,MAC9B,CAAC;AAED,aAAO,GAAG,KAAK,GAAG,eAAe,kBAAkB,CAAC,QAAQ;AAC3D,cAAM,qBAAqB,gBAAgB,IAAI,IAAI,gBAAgB,IAAI,IAAI,QAAQ;AACnF,aAAK,eAAe,KAAK,wBAAwB,EAAE,KAAK,kBAAkB;AAAA,MAC3E,CAAC;AAED,aAAO,GAAG,KAAK,GAAG,yBAAyB,UAAU,CAAC,KAAK,KAAK,QAAQ;AAEvE,cAAM,cAAc,OAAO,KAAK;AAChC,cAAM,OAAO,YAAY,gBAAgB,QAAQ,OAAO,GAAG,EAAE,YAAY;AACzE,YAAI,KAAK,GAAG,mBAAmB,KAAK,GAAG,gBAAgB,UAAU,KAAK,YAAY,QAAQ;AACzF,eAAK,GAAG,gBAAgB,UAAU,YAAY,MAAM;AAAA,QACrD;AAAA,MACD,CAAC;AAED,WAAK,WAAW,GAAG,SAAS,oBAAoB,MAAM;AACrD,aAAK,OAAO,iBAAiB;AAAA,MAC9B,CAAC;AAAA,IACF;AAAA,IAEA,WAAW;AACV,WAAK,OAAO,sBAAsB,IAAI;AACtC,WAAK,iBAAiB,IAAI;AAE1B,WAAK,uBAAuB;AAG5B,UAAG,OAAO,sBAAsB,GAAE;AACjC,YAAG,OAAO,OAAO,iBAAkB,aAAY;AAC9C,iBAAO,cAAc,YAAY,EAAC,WAAW,OAAM,CAAC;AAAA,QACrD;AAAA,MACD;AAAA,IACD;AAAA,EACD;;;ACrNA,UAAQ,YAAY,gBAAgB,MAAM;AAAA,IACzC,YAAY,EAAE,SAAS,UAAU;AAChC,WAAK,UAAU;AACf,WAAK,SAAS;AAEd,WAAK,eAAe;AAAA,IACrB;AAAA,IAEA,iBAAiB;AAChB,WAAK,YAAY;AACjB,WAAK,oBAAoB;AACzB,WAAK,YAAY;AAAA,IAClB;AAAA,IAEA,cAAc;AACb,WAAK,QAAQ,OACZ;AAAA;AAAA,0BAEuB,GAAG,eAAe;AAAA;AAAA;AAAA;AAAA;AAAA,cAM1C;AAEA,WAAK,aAAa,KAAK,QAAQ,KAAK,kBAAkB;AACtD,WAAK,sBAAsB,KAAK,WAAW,KAAK,qBAAqB;AAAA,IACtE;AAAA,IAEA,cAAc;AACb,WAAK,aAAa,OAAO,GAAG,SAAS,CAAC,MAAM;AAC3C,qBAAa,KAAK,WAAW;AAC7B,aAAK,cAAc,WAAW,MAAM;AACnC,gBAAM,cAAc,EAAE,OAAO;AAC7B,eAAK,aAAa,aAAa,KAAK,aAAa,UAAU,CAAC;AAAA,QAC7D,GAAG,GAAG;AAAA,MACP,CAAC;AACD,YAAM,KAAK;AACX,WAAK,oBAAoB,GAAG,SAAS,oBAAoB,WAAW;AACnE,cAAM,eAAe,SAAS,EAAE,IAAI,EAAE,KAAK,mBAAmB,CAAC;AAE/D,WAAG,OAAO,kBAAkB,YAAY;AAAA,MACzC,CAAC;AAAA,IACF;AAAA,IAEA,sBAAsB;AACrB,YAAM,KAAK;AACX,WAAK,eAAe,OAAO,GAAG,KAAK,aAAa;AAAA,QAC/C,IAAI;AAAA,UACH,OAAO,GAAG,QAAQ;AAAA,UAClB,WAAW;AAAA,UACX,aAAa,GAAG,uCAAuC;AAAA,QACxD;AAAA,QACA,QAAQ,KAAK,WAAW,KAAK,eAAe;AAAA,QAC5C,cAAc;AAAA,MACf,CAAC;AACD,WAAK,eAAe,OAAO,GAAG,KAAK,aAAa;AAAA,QAC/C,IAAI;AAAA,UACH,OAAO,GAAG,gBAAgB;AAAA,UAC1B,WAAW;AAAA,UACX,SAAS;AAAA;AAAA;AAAA;AAAA,UACT,aAAa,GAAG,0BAA0B;AAAA,UAC1C,UAAU,WAAW;AACpB,gBAAI,GAAG,WAAW,GAAG,UAAU;AAAG,iBAAG,aAAa;AAAA,UACnD;AAAA,QACD;AAAA,QACA,QAAQ,KAAK,WAAW,KAAK,eAAe;AAAA,QAC5C,cAAc;AAAA,MACf,CAAC;AACD,WAAK,aAAa,aAAa,KAAK;AACpC,WAAK,aAAa,aAAa,KAAK;AACpC,WAAK,aAAa,UAAU,OAAO;AAAA,IACpC;AAAA,IAEA,eAAe;AACd,aAAO,IAAI,OAAO;AAClB,WAAK,OAAO,cAAc;AAC1B,YAAM,cAAc,KAAK,aAAa,UAAU;AAChD,YAAM,SAAS,KAAK,aAAa,UAAU;AAE3C,WAAK,oBAAoB,KAAK,EAAE;AAEhC,aAAO,OAAO,KAAK;AAAA,QAClB,QAAQ;AAAA,QACR,QAAQ;AAAA,QACR,MAAM,EAAE,aAAa,OAAO;AAAA,QAC5B,UAAU,CAAC,aAAa;AACvB,iBAAO,IAAI,SAAS;AACpB,mBAAS,QAAQ,QAAQ,aAAW;AACnC,kBAAM,eAAe,KAAK,iBAAiB,OAAO;AAClD,iBAAK,oBAAoB,OAAO,YAAY;AAAA,UAC7C,CAAC;AAAA,QACF;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,iBAAiB,SAAS;AACzB,YAAM,mBAAmB,OAAO,QAAQ,eAAa,MAAI,QAAQ,YAAY,EAAE,OAAO,gBAAgB;AACtG,aACC,mDAAmD,OAAO,QAAQ,IAAI;AAAA;AAAA,iCAExC,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA,QAKjC,OAAO,SAAS,QAAQ,UAAU,EAAE;AAAA;AAAA;AAAA;AAAA,kCAIV,gBAAgB,QAAQ,aAAa,QAAQ,UAAU,CAAC,KAAK;AAAA,iCAC9D;AAAA;AAAA;AAAA;AAAA,IAKhC;AAAA,IAEA,iBAAiB,MAAM;AACtB,aAAO,KAAK,WAAW,IAAI,WAAW,MAAM,KAAK,KAAK,aAAa,IAAI,KAAK,WAAW,IAAI,WAAW,MAAM;AAAA,IAC7G;AAAA,EACD;;;AC1HA,UAAQ,YAAY,mBAAmB,MAAM;AAAA,IAC5C,YAAY,EAAE,SAAS,UAAU;AAChC,WAAK,UAAU;AACf,WAAK,SAAS;AAEd,WAAK,eAAe;AAAA,IACrB;AAAA,IAEA,iBAAiB;AAChB,WAAK,YAAY;AACjB,WAAK,wBAAwB;AAC7B,WAAK,YAAY;AACjB,WAAK,iBAAiB;AAAA,IACvB;AAAA,IAEA,cAAc;AACb,WAAK,QAAQ,OACZ;AAAA;AAAA,OAEI,GAAG,wCAAwC;AAAA;AAAA;AAAA;AAAA;AAAA,2BAKvB,GAAG,OAAO;AAAA;AAAA,2BAEV,GAAG,QAAQ;AAAA;AAAA,2BAEX,GAAG,UAAU;AAAA;AAAA;AAAA;AAAA;AAAA,cAMtC;AAEA,WAAK,aAAa,KAAK,QAAQ,KAAK,qBAAqB;AACzD,WAAK,mBAAmB,KAAK,WAAW,KAAK,0BAA0B;AACvE,WAAK,qBAAqB,KAAK,WAAW,KAAK,gBAAgB;AAC/D,WAAK,iBAAiB,KAAK,mBAAmB,KAAK,gBAAgB;AACnE,WAAK,mBAAmB,KAAK,mBAAmB,KAAK,kBAAkB;AACvE,WAAK,oBAAoB,KAAK,mBAAmB,KAAK,mBAAmB;AACzE,WAAK,qBAAqB,KAAK,mBAAmB,KAAK,qBAAqB;AAC5E,WAAK,gBAAgB,KAAK,mBAAmB,KAAK,eAAe;AAAA,IAClE;AAAA,IAEA,0BAA0B;AACzB,YAAM,eAAe,IAAI,OAAO,GAAG,OAAO;AAAA,QACzC,OAAO;AAAA,QACP,QAAQ;AAAA,UACP,EAAC,WAAW,YAAY,WAAW,QAAQ,SAAS,SAAS,OAAO,WAAU;AAAA,QAE/E;AAAA,QACA,gBAAgB,MAAM;AACrB,eAAK,WAAW;AAAA,QACjB;AAAA,QACA,sBAAsB,GAAG,MAAM;AAAA,MAChC,CAAC;AACD,WAAK,eAAe;AAEpB,YAAM,eAAe,IAAI,OAAO,GAAG,OAAO;AAAA,QACzC,OAAO;AAAA,QACP,QAAQ;AAAA,UACP,EAAC,WAAW,SAAS,WAAW,QAAQ,OAAO,gBAAe;AAAA,QAC/D;AAAA,QACA,gBAAgB,MAAM;AACrB,eAAK,cAAc;AAAA,QACpB;AAAA,QACA,sBAAsB,GAAG,OAAO;AAAA,MACjC,CAAC;AACD,WAAK,eAAe;AAAA,IACrB;AAAA,IAEA,uBAAuB,KAAK;AAC3B,YAAM,EAAE,WAAW;AACnB,UAAI,kBAAkB;AAEtB,cAAQ,CAAC,QAAQ,cAAc,GAAG,MAAM,KAAM,mBAAkB;AAChE,iBAAW,WAAY,mBAAkB;AACzC,iBAAW,YAAa,mBAAkB;AAE1C,aAAO;AAAA,kCACyB,IAAI;AAAA,mCACH,KAAK;AAAA,4BACZ,GAAG,SAAS,MAAM,IAAI;AAAA;AAAA;AAAA,gCAGlB,gBAAgB,IAAI,aAAa,IAAI,QAAQ;AAAA,iCAC5C,IAAI;AAAA,qDACgB,0BAA0B,IAAI;AAAA;AAAA,IAElF;AAAA,IAEA,cAAc,KAAK,WAAW;AAC7B,aAAO;AAAA,8BACqB,UAAU;AAAA,6BACX,UAAU,OAAO;AAAA,mCACX,uBAAuB;AAAA;AAGxD,wCAAkC;AACjC,YAAI,UAAU,QAAQ,UAAU,mBAAmB,UAAU,SAAS,UAAU,iBAAiB;AAChG,iBAAO,4BAA4B,UAAU;AAAA,+BAClB,gBAAgB,UAAU,MAAM,IAAI,QAAQ;AAAA,QACxE,OAAO;AACN,iBAAO,0BAA0B,gBAAgB,UAAU,mBAAmB,UAAU,MAAM,IAAI,QAAQ;AAAA,QAC3G;AAAA,MACD;AAAA,IACD;AAAA,IAEA,kBAAkB,KAAK;AACtB,UAAI,IAAI,iBAAiB;AACxB,eAAO;AAAA,uBACa,IAAI;AAAA,aACd,gBAAgB,IAAI,iBAAiB,IAAI,QAAQ;AAAA;AAAA,MAE5D,OAAO;AACN,eAAO;AAAA,MACR;AAAA,IACD;AAAA,IAEA,mBAAmB,KAAK;AACvB,aAAO;AAAA,YACG,GAAG,WAAW;AAAA,YACd,gBAAgB,IAAI,WAAW,IAAI,QAAQ;AAAA;AAAA,IAEtD;AAAA,IAEA,eAAe,KAAK;AACnB,UAAI,CAAC,IAAI,MAAM;AAAQ,eAAO;AAE9B,UAAI,aAAa,IAAI,MAAM,IAAI,OAAK;AACnC,cAAM,cAAc,SAAS,KAAK,EAAE,WAAW,IAAI,EAAE,cAAc,GAAG,EAAE,iBAAiB,EAAE;AAC3F,eAAO;AAAA;AAAA,8BAEoB;AAAA,8BACA,gBAAgB,EAAE,kCAAkC,IAAI,QAAQ;AAAA;AAAA;AAAA,MAG5F,CAAC,EAAE,KAAK,EAAE;AAEV,aAAO,8BAA8B;AAAA,IACtC;AAAA,IAEA,qBAAqB,KAAK;AACzB,aAAO;AAAA,YACG,GAAG,aAAa;AAAA,YAChB,gBAAgB,IAAI,aAAa,IAAI,QAAQ;AAAA;AAAA,IAExD;AAAA,IAEA,iBAAiB,KAAK,SAAS;AAC9B,aAAO;AAAA,YACG,GAAG,QAAQ,eAAe;AAAA,YAC1B,gBAAgB,QAAQ,QAAQ,IAAI,QAAQ;AAAA;AAAA,IAEvD;AAAA,IAEA,cAAc;AACb,WAAK,mBAAmB,GAAG,SAAS,eAAe,MAAM;AACxD,aAAK,OAAO,eAAe,KAAK,IAAI,IAAI;AACxC,aAAK,iBAAiB,KAAK;AAC3B,aAAK,WAAW,KAAK,yBAAyB,EAAE,IAAI,WAAW,MAAM;AACrE,aAAK,iBAAiB,IAAI,WAAW,MAAM;AAAA,MAC5C,CAAC;AAED,WAAK,mBAAmB,GAAG,SAAS,aAAa,MAAM;AACtD,aAAK,OAAO,WAAW,KAAK,IAAI,IAAI;AACpC,aAAK,iBAAiB,KAAK;AAC3B,aAAK,WAAW,KAAK,yBAAyB,EAAE,IAAI,WAAW,MAAM;AACrE,aAAK,iBAAiB,IAAI,WAAW,MAAM;AAAA,MAC5C,CAAC;AAED,WAAK,mBAAmB,GAAG,SAAS,eAAe,MAAM;AACxD,aAAK,OAAO,aAAa,KAAK,IAAI,IAAI;AACtC,aAAK,yBAAyB;AAAA,MAC/B,CAAC;AAED,WAAK,mBAAmB,GAAG,SAAS,eAAe,MAAM;AACxD,aAAK,OAAO,aAAa,KAAK,IAAI,IAAI;AACtC,aAAK,yBAAyB;AAAA,MAI/B,CAAC;AAED,WAAK,mBAAmB,GAAG,SAAS,YAAY,MAAM;AACrD,aAAK,OAAO,UAAU;AACtB,aAAK,iBAAiB,KAAK;AAC3B,aAAK,WAAW,KAAK,yBAAyB,EAAE,IAAI,WAAW,MAAM;AACrE,aAAK,iBAAiB,IAAI,WAAW,MAAM;AAAA,MAC5C,CAAC;AAED,WAAK,mBAAmB,GAAG,SAAS,cAAc,MAAM;AACvD,aAAK,aAAa,YAAY,SAAS,UAAU,KAAK,cAAc;AACpE,aAAK,aAAa,KAAK;AAAA,MACxB,CAAC;AAED,WAAK,mBAAmB,GAAG,SAAS,cAAc,MAAM;AACvD,aAAK,cAAc;AAAA,MACpB,CAAC;AAAA,IACF;AAAA,IAEA,gBAAgB;AACf,YAAM,MAAM,KAAK,OAAO,QAAQ;AAChC,aAAO,MAAM,MACZ,KAAK,IAAI,SACT,KAAK,IAAI,MACT,IAAI,kBACJ,KAAK,IAAI,aACT,KAAK,IAAI,YAAY,OAAO,KAAK,IAClC;AAAA,IACD;AAAA,IAEA,mBAAmB;AAClB,YAAM,aAAa,OAAO,MAAM,OAAO,IAAI,WAAM;AACjD,WAAK,mBAAmB,KAAK,YAAY,EAAE,KAAK,SAAS,GAAG,cAAc;AAC1E,aAAO,GAAG,KAAK,aAAa;AAAA,QAC3B,UAAU;AAAA,QACV,QAAQ,MAAM,KAAK,mBAAmB,KAAK,YAAY,EAAE,MAAM;AAAA,QAC/D,WAAW,MAAM,KAAK,WAAW,GAAG,UAAU,KAAK,KAAK,mBAAmB,KAAK,YAAY,EAAE,GAAG,UAAU;AAAA,QAC3G,aAAa,GAAG,eAAe;AAAA,QAC/B,MAAM,SAAS,KAAK;AAAA,MACrB,CAAC;AACD,WAAK,mBAAmB,KAAK,UAAU,EAAE,KAAK,SAAS,GAAG,kBAAkB;AAC5E,aAAO,GAAG,KAAK,GAAG,cAAc,MAAM;AACrC,cAAM,qBAAqB,KAAK,WAAW,GAAG,UAAU;AACxD,YAAI,sBAAsB,KAAK,mBAAmB,KAAK,UAAU,EAAE,GAAG,UAAU,GAAG;AAClF,eAAK,mBAAmB,KAAK,UAAU,EAAE,MAAM;AAAA,QAChD;AAAA,MACD,CAAC;AACD,WAAK,mBAAmB,KAAK,WAAW,EAAE,KAAK,SAAS,GAAG,cAAc;AACzE,aAAO,GAAG,KAAK,aAAa;AAAA,QAC3B,UAAU;AAAA,QACV,QAAQ,MAAM,KAAK,mBAAmB,KAAK,WAAW,EAAE,MAAM;AAAA,QAC9D,WAAW,MAAM,KAAK,WAAW,GAAG,UAAU,KAAK,KAAK,mBAAmB,KAAK,WAAW,EAAE,GAAG,UAAU;AAAA,QAC1G,aAAa,GAAG,cAAc;AAAA,QAC9B,MAAM,SAAS,KAAK;AAAA,MACrB,CAAC;AAAA,IACF;AAAA,IAEA,aAAa;AACZ,YAAM,MAAM,KAAK,OAAO,QAAQ;AAChC,YAAM,aAAa,KAAK,aAAa,WAAW,EAAE;AAClD,YAAM,MAAM,KAAK,OAAO,IAAI;AAC5B,YAAM,eAAe,IAAI;AAEzB,aAAO,KAAK;AAAA,QACX,QAAQ;AAAA,QACR,MAAM;AAAA,UACL;AAAA,UACA,SAAS,GAAG,IAAI,KAAK,IAAI,IAAI,OAAO,IAAI;AAAA,UACxC,SAAS,IAAI;AAAA,UACb,MAAM,IAAI;AAAA,UACV,YAAY;AAAA,UACZ;AAAA,UACA,kBAAkB,OAAO,KAAK,UAAU;AAAA,UACxC,OAAO,IAAI;AAAA,QACZ;AAAA,QACA,UAAU,OAAK;AACd,cAAI,CAAC,EAAE,KAAK;AACX,mBAAO,MAAM,WAAW,OAAO;AAC/B,gBAAI,EAAE,QAAQ,uBAAuB;AACpC,qBAAO,SAAS,GACf,mDACA,CAAE,OAAO,MAAM,YAAY,EAAE,QAAQ,qBAAqB,CAAE,CAC7D,CAAC;AAAA,YACF,OAAO;AACN,qBAAO,WAAW;AAAA,gBACjB,SAAS,GAAG,0BAA0B;AAAA,gBACtC,WAAW;AAAA,cACZ,CAAC;AAAA,YACF;AACA,iBAAK,aAAa,KAAK;AAAA,UACxB,OAAO;AACN,mBAAO,SAAS,GAAG,0DAA0D,CAAC;AAAA,UAC/E;AAAA,QACD;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,iBAAiB,KAAK;AACrB,WAAK,cAAc,KAAK,EAAE;AAC1B,UAAI,QAAQ,OAAK;AAChB,YAAI,EAAE,WAAW;AAChB,YAAE,aAAa,QAAQ,OAAK;AAC3B,kBAAM,aAAa,EAAE,MAAM,GAAG,EAAE,GAAG,YAAY;AAC/C,kBAAM,MAAM,GAAG,CAAC;AAChB,iBAAK,cAAc,OAClB,2CAA2C,mBAAmB,WAC/D;AAAA,UACD,CAAC;AAAA,QACF;AAAA,MACD,CAAC;AACD,WAAK,cAAc,SAAS,EAAE,KAAK,EAAE,YAAY,MAAM;AAAA,IACxD;AAAA,IAEA,2BAA2B,MAAM;AAChC,UAAI,MAAM;AACT,aAAK,iBAAiB,IAAI,WAAW,MAAM;AAC3C,aAAK,WAAW,KAAK,yBAAyB,EAAE,IAAI,WAAW,MAAM;AAAA,MACtE,OAAO;AACN,aAAK,iBAAiB,IAAI,WAAW,MAAM;AAC3C,aAAK,WAAW,KAAK,yBAAyB,EAAE,IAAI,WAAW,MAAM;AAAA,MACtE;AAAA,IACD;AAAA,IAEA,sBAAsB,kBAAkB;AACvC,UAAI;AACH,eAAO,CAAC,EAAE,WAAW,MAAM,cAAc,CAAC,iBAAiB,iBAAiB,WAAW,EAAE,CAAC;AAE3F,aAAO;AAAA,QACN,EAAE,WAAW,KAAK,IAAI,cAAc,GAAG,cAAc,CAAC,cAAc,cAAc,EAAE;AAAA,QACpF,EAAE,WAAW,CAAC,KAAK,IAAI,aAAa,KAAK,IAAI,cAAc,GAAG,cAAc,CAAC,iBAAiB,iBAAiB,QAAQ,EAAC;AAAA,QACxH,EAAE,WAAW,KAAK,IAAI,aAAa,KAAK,IAAI,cAAc,GAAG,cAAc,CAAC,iBAAiB,eAAe,EAAC;AAAA,MAC9G;AAAA,IACD;AAAA,IAEA,gBAAgB,KAAK,mBAAiB,OAAO;AAC5C,yBACC,KAAK,WAAW,IAAI,eAAe,mBAAmB,IACtD,KAAK,WAAW,IAAI,eAAe,iBAAiB;AAErD,WAAK,2BAA2B,KAAK;AAErC,WAAK,MAAM;AAEX,WAAK,qBAAqB,GAAG;AAE7B,WAAK,kBAAkB,GAAG;AAE1B,WAAK,mBAAmB,GAAG;AAE3B,WAAK,qBAAqB,GAAG;AAE7B,YAAM,qBAAqB,KAAK,sBAAsB,gBAAgB;AAEtE,WAAK,iBAAiB,kBAAkB;AAAA,IACzC;AAAA,IAEA,qBAAqB,KAAK;AACzB,aAAO,GAAG,UAAU,YAAY,KAAK,IAAI,UAAU,UAAU,EAAE,KAAK,CAAC,EAAE,cAAc;AACpF,aAAK,iBAAiB,QAAQ,YAAY;AAC1C,cAAM,oBAAoB,KAAK,uBAAuB,GAAG;AACzD,aAAK,eAAe,KAAK,iBAAiB;AAAA,MAC3C,CAAC;AAAA,IACF;AAAA,IAEA,kBAAkB,KAAK;AACtB,WAAK,iBAAiB,KAAK,EAAE;AAC7B,UAAI,MAAM,QAAQ,UAAQ;AACzB,cAAM,WAAW,KAAK,cAAc,KAAK,IAAI;AAC7C,aAAK,iBAAiB,OAAO,QAAQ;AACrC,aAAK,8BAA8B;AAAA,MACpC,CAAC;AAAA,IACF;AAAA,IAEA,gCAAgC;AAC/B,YAAM,YAAY,MAAM,KAAK,KAAK,iBAAiB,KAAK,iBAAiB,CAAC;AAC1E,WAAK,iBAAiB,KAAK,iBAAiB,EAAE,IAAI,SAAS,EAAE;AAC7D,UAAI,YAAY,UAAU,OAAO,CAAC,YAAW,QAAQ;AACpD,YAAI,EAAE,GAAG,EAAE,MAAM,IAAI;AACpB,uBAAY,EAAE,GAAG,EAAE,MAAM;AAC1B,eAAO;AAAA,MACR,GAAG,CAAC;AAEJ,mBAAa;AACb,UAAI,aAAa;AAAG,oBAAY;AAEhC,WAAK,iBAAiB,KAAK,iBAAiB,EAAE,IAAI,SAAS,SAAS;AAAA,IACrE;AAAA,IAEA,qBAAqB,KAAK;AACzB,WAAK,mBAAmB,KAAK,EAAE;AAC/B,UAAI,SAAS,QAAQ,OAAK;AACzB,YAAI,EAAE,QAAQ;AACb,gBAAM,cAAc,KAAK,iBAAiB,KAAK,CAAC;AAChD,eAAK,mBAAmB,OAAO,WAAW;AAAA,QAC3C;AAAA,MACD,CAAC;AACD,UAAI,IAAI,yBAAyB,IAAI,gBAAgB;AACpD,cAAM,cAAc,KAAK,iBAAiB,KAAK;AAAA,UAC9C,iBAAiB;AAAA,UACjB,QAAQ,IAAI;AAAA,QACb,CAAC;AACD,aAAK,mBAAmB,OAAO,WAAW;AAAA,MAC3C;AAAA,IACD;AAAA,IAEA,mBAAmB,KAAK;AACvB,WAAK,kBAAkB,KAAK,EAAE;AAE9B,YAAM,gBAAgB,KAAK,mBAAmB,GAAG;AACjD,YAAM,YAAY,KAAK,eAAe,GAAG;AACzC,YAAM,eAAe,KAAK,kBAAkB,GAAG;AAC/C,YAAM,kBAAkB,KAAK,qBAAqB,GAAG;AACrD,WAAK,kBAAkB,OAAO,aAAa;AAC3C,WAAK,kBAAkB,OAAO,SAAS;AACvC,WAAK,kBAAkB,OAAO,YAAY;AAC1C,WAAK,kBAAkB,OAAO,eAAe;AAAA,IAC9C;AAAA,IAEA,iBAAiB,MAAM;AACtB,aAAO,KAAK,WAAW,IAAI,WAAW,MAAM,IAAI,KAAK,WAAW,IAAI,WAAW,MAAM;AAAA,IACtF;AAAA,EACD;;;ACrZA,UAAQ,YAAY,mBAAmB,cAAc,QAAQ,YAAY,iBAAgB;AAAA,IACxF,cAAc;AACb,WAAK,mBAAmB,GAAG,SAAS,eAAe,MAAM;AACxD,aAAK,OAAO,eAAe,KAAK,IAAI,IAAI;AACxC,aAAK,iBAAiB,KAAK;AAC3B,aAAK,WAAW,KAAK,yBAAyB,EAAE,IAAI,WAAW,MAAM;AACrE,aAAK,iBAAiB,IAAI,WAAW,MAAM;AAAA,MAC5C,CAAC;AAED,WAAK,mBAAmB,GAAG,SAAS,aAAa,MAAM;AACtD,aAAK,OAAO,WAAW,KAAK,IAAI,IAAI;AACpC,aAAK,iBAAiB,KAAK;AAC3B,aAAK,WAAW,KAAK,yBAAyB,EAAE,IAAI,WAAW,MAAM;AACrE,aAAK,iBAAiB,IAAI,WAAW,MAAM;AAAA,MAC5C,CAAC;AAED,WAAK,mBAAmB,GAAG,SAAS,eAAe,MAAM;AACxD,aAAK,OAAO,aAAa,KAAK,IAAI,IAAI;AACtC,aAAK,yBAAyB;AAAA,MAC/B,CAAC;AAED,WAAK,mBAAmB,GAAG,SAAS,eAAe,MAAM;AACxD,aAAK,OAAO,aAAa,KAAK,IAAI,IAAI;AACtC,aAAK,yBAAyB;AAAA,MAI/B,CAAC;AAED,WAAK,mBAAmB,GAAG,SAAS,YAAY,MAAM;AACrD,aAAK,OAAO,UAAU;AACtB,aAAK,iBAAiB,KAAK;AAC3B,aAAK,WAAW,KAAK,yBAAyB,EAAE,IAAI,WAAW,MAAM;AACrE,aAAK,iBAAiB,IAAI,WAAW,MAAM;AAAA,MAC5C,CAAC;AAED,WAAK,mBAAmB,GAAG,SAAS,cAAc,MAAM;AACvD,aAAK,aAAa,YAAY,SAAS,UAAU,KAAK,cAAc;AACpE,aAAK,aAAa,KAAK;AAAA,MACxB,CAAC;AAED,WAAK,mBAAmB,GAAG,SAAS,cAAc,MAAM;AACvD,aAAK,cAAc;AAAA,MACpB,CAAC;AAGD,WAAK,mBAAmB,GAAG,SAAS,qBAAqB,MAAM;AAC9D,aAAK,OAAO,UAAU;AAAA,MACvB,CAAC;AAED,WAAK,mBAAmB,GAAG,SAAS,oBAAoB,MAAM;AAC7D,aAAK,OAAO,iBAAiB;AAAA,MAC9B,CAAC;AAAA,IACF;AAAA,IAEA,cAAc;AACb,WAAK,QAAQ,OACZ;AAAA;AAAA,OAEI,GAAG,wCAAwC;AAAA;AAAA;AAAA;AAAA;AAAA,2BAKvB,GAAG,OAAO;AAAA;AAAA,2BAEV,GAAG,QAAQ;AAAA;AAAA,2BAEX,GAAG,UAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAOtC;AAEA,WAAK,aAAa,KAAK,QAAQ,KAAK,qBAAqB;AACzD,WAAK,mBAAmB,KAAK,WAAW,KAAK,0BAA0B;AACvE,WAAK,qBAAqB,KAAK,WAAW,KAAK,gBAAgB;AAC/D,WAAK,iBAAiB,KAAK,mBAAmB,KAAK,gBAAgB;AACnE,WAAK,mBAAmB,KAAK,mBAAmB,KAAK,kBAAkB;AACvE,WAAK,oBAAoB,KAAK,mBAAmB,KAAK,mBAAmB;AACzE,WAAK,qBAAqB,KAAK,mBAAmB,KAAK,qBAAqB;AAC5E,WAAK,gBAAgB,KAAK,mBAAmB,KAAK,eAAe;AACjE,WAAK,YAAY,KAAK,mBAAmB,KAAK,WAAW;AAAA,IAC1D;AAAA,IAEA,gBAAgB,KAAK,mBAAiB,OAAO;AAC5C,yBACC,KAAK,WAAW,IAAI,eAAe,mBAAmB,IACtD,KAAK,WAAW,IAAI,eAAe,iBAAiB;AAErD,WAAK,2BAA2B,KAAK;AAErC,WAAK,MAAM;AAEX,WAAK,qBAAqB,GAAG;AAE7B,WAAK,kBAAkB,GAAG;AAE1B,WAAK,mBAAmB,GAAG;AAE3B,WAAK,qBAAqB,GAAG;AAE7B,YAAM,qBAAqB,KAAK,sBAAsB,gBAAgB;AAEtE,WAAK,iBAAiB,kBAAkB;AACxC,WAAK,aAAa;AAAA,IACnB;AAAA,IAEA,eAAc;AACb,WAAK,UAAU,KAAK,EAAE;AACtB,UAAG,OAAO,oBAAoB,KAAK,OAAO,aAAY;AACrD,aAAK,UAAU,OACd;AAAA,8GAED;AAAA,MACD;AACA,WAAK,UAAU,SAAS,EAAE,KAAK,EAAE,YAAY,MAAM;AAAA,IACpD;AAAA,EACD;;;ACzHA,UAAQ,YAAY,aAAa,MAAM;AAAA,IACtC,YAAY,SAAS;AACpB,WAAK,UAAU,EAAE,OAAO,EAAE,KAAK,sBAAsB;AACrD,WAAK,OAAO,QAAQ;AAEpB,WAAK,oBAAoB;AAAA,IAC1B;AAAA,IAEA,sBAAsB;AACrB,aAAO,OAAO,KAAK,wEAAwE,EAAE,QAAQ,OAAO,QAAQ,KAAK,CAAC;AAAA,IAC3H;AAAA,IAEA,sBAAsB;AACrB,WAAK,oBAAoB,EAAE,KAAK,CAAC,MAAM;AACtC,YAAI,EAAE,QAAQ,QAAQ;AAErB,eAAK,qBAAqB,EAAE,QAAQ,EAAE;AAAA,QACvC,OAAO;AACN,eAAK,uBAAuB;AAAA,QAC7B;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,yBAAyB;AACxB,YAAM,KAAK;AACX,YAAM,eAAe;AAAA,QACpB;AAAA,UACC,WAAW;AAAA,UAAmB,WAAW;AAAA,UACzC,cAAc;AAAA,UAAG,OAAO;AAAA,UACxB,SAAS;AAAA,UAAmB,MAAM;AAAA,QACnC;AAAA,QACA;AAAA,UACC,WAAW;AAAA,UAAkB,WAAW;AAAA,UACxC,cAAc;AAAA,UAAG,OAAO;AAAA,UACxB,SAAS;AAAA,UACT,QAAQ,WAAY;AACnB,mBAAO,YAAY,gBAAgB,GAAG,KAAK,KAAK,OAAK;AACpD,kBAAI,EAAE,OAAO,KAAK,IAAI,KAAK;AAC1B,kBAAE,iBAAiB,KAAK;AACxB,uBAAO,YAAY,gBAAgB,KAAK,QAAQ;AAChD,uBAAO;AAAA,cACR;AAAA,YACD,CAAC;AAAA,UACF;AAAA,QACD;AAAA,MACD;AACA,YAAM,4BAA4B,MAAM;AACvC,cAAM,cAAc,OAAO,YAAY,YAAY,UAAU;AAC7D,YAAI,CAAC;AAAa;AAClB,eAAO,GAAG,QAAQ,eAAe,WAAW,EAAE,KAAK,CAAC,EAAE,eAAe;AACpE,iBAAO,YAAY,gBAAgB,GAAG,OAAO,CAAC;AAC9C,mBAAS,QAAQ,SAAO;AACvB,kBAAM,EAAE,oBAAoB;AAC5B,mBAAO,YAAY,gBAAgB,GAAG,KAAK,KAAK,EAAE,iBAAiB,gBAAgB,IAAI,CAAC;AAAA,UACzF,CAAC;AACD,iBAAO,YAAY,gBAAgB,KAAK,QAAQ;AAAA,QACjD,CAAC;AAAA,MACF;AACA,YAAM,SAAS,IAAI,OAAO,GAAG,OAAO;AAAA,QACnC,OAAO,GAAG,0BAA0B;AAAA,QACpC,QAAQ;AAAA,QACR,QAAQ;AAAA,UACP;AAAA,YACC,WAAW;AAAA,YAAQ,OAAO,GAAG,SAAS;AAAA,YAAG,SAAS,OAAO,SAAS,YAAY,SAAS;AAAA,YACvF,SAAS;AAAA,YAAW,WAAW;AAAA,YAAW,MAAM;AAAA,UACjD;AAAA,UACA;AAAA,YACC,WAAW;AAAA,YAAQ,OAAO,GAAG,aAAa;AAAA,YAC1C,SAAS;AAAA,YAAe,WAAW;AAAA,YAAe,MAAM;AAAA,YACxD,WAAW,MAAM;AAAA,YACjB,UAAU,MAAM,0BAA0B;AAAA,UAC3C;AAAA,UACA;AAAA,YACC,WAAW;AAAA,YACX,WAAW;AAAA,YACX,OAAO;AAAA,YACP,iBAAiB;AAAA,YACjB,eAAe;AAAA,YACf,MAAM;AAAA,YACN,MAAM,CAAC;AAAA,YACP,QAAQ;AAAA,UACT;AAAA,QACD;AAAA,QACA,gBAAgB,eAAe,EAAE,mBAAS,aAAa,mBAAmB;AACzE,cAAI,CAAC,gBAAgB,QAAQ;AAC5B,mBAAO,WAAW;AAAA,cACjB,SAAS,GAAG,0DAA0D;AAAA,cACtE,WAAW;AAAA,YACZ,CAAC;AACD,mBAAO,OAAO,MAAM,WAAW,OAAO;AAAA,UACvC;AAGA,4BAAkB,gBAAgB,OAAO,OAAK,EAAE,eAAe;AAE/D,gBAAM,SAAS;AACf,gBAAM,MAAM,MAAM,OAAO,KAAK,EAAE,QAAQ,MAAM,EAAE,aAAa,mBAAS,gBAAgB,GAAG,QAAO,KAAK,CAAC;AACtG,WAAC,IAAI,OAAO,GAAG,qBAAqB,IAAI,OAAO;AAC/C,iBAAO,KAAK;AAAA,QACb;AAAA,QACA,sBAAsB,GAAG,QAAQ;AAAA,MAClC,CAAC;AACD,aAAO,KAAK;AACZ,YAAM,oBAAoB;AAAA,QACzB,OAAO;AAAA,QACP,SAAS,EAAE,SAAS,OAAO,YAAY,QAAQ,UAAU,EAAE;AAAA,MAC5D;AAAA,IACD;AAAA,UAEM,qBAAqB,MAAM;AAChC,WAAK,cAAc,KAAK;AACxB,WAAK,UAAU,KAAK;AACpB,WAAK,cAAc,KAAK;AACxB,WAAK,mBAAmB,KAAK;AAC7B,WAAK,iBAAiB,CAAC;AACvB,WAAK,WAAW,CAAC;AAEjB,aAAO,GAAG,UAAU,kBAAkB,QAAW,sBAAsB,EAAE,KAAK,CAAC,EAAE,cAAc;AAC9F,aAAK,uBAAuB,IAAI,QAAQ,oBAAoB,KAAK;AAAA,MAClE,CAAC;AAED,aAAO,KAAK;AAAA,QACX,QAAQ;AAAA,QACR,MAAM,EAAE,eAAe,KAAK,YAAY;AAAA,QACxC,UAAU,CAAC,QAAQ;AAClB,gBAAM,UAAU,IAAI;AACpB,iBAAO,OAAO,KAAK,UAAU,OAAO;AACpC,eAAK,SAAS,kBAAkB,QAAQ,gBAAgB,IAAI,WAAS,MAAM,IAAI;AAC/E,eAAK,SAAS;AAAA,QACf;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,2BAA2B;AAC1B,WAAK,KAAK,cACT;AAAA,8DAC2D,KAAK;AAAA,iBAClD,OAAO,KAAK,gBAAgB,EAAE,OAAO,gBAAgB;AAAA;AAAA,WAE3D;AAAA,IACV;AAAA,IAEA,WAAW;AACV,WAAK,YAAY;AACjB,WAAK,mBAAmB;AACxB,WAAK,aAAa;AAClB,WAAK,iBAAiB;AAAA,IACvB;AAAA,IAEA,cAAc;AACb,WAAK,QAAQ,OACZ,uCACD;AAEA,WAAK,sBAAsB,KAAK,QAAQ,KAAK,oBAAoB;AAAA,IAClE;AAAA,IAEA,qBAAqB;AACpB,WAAK,mBAAmB;AACxB,WAAK,kBAAkB;AACvB,WAAK,eAAe;AACpB,WAAK,cAAc;AACnB,WAAK,uBAAuB;AAC5B,WAAK,mBAAmB;AAAA,IACzB;AAAA,IAEA,eAAe;AACd,WAAK,KAAK,WAAW;AAErB,WAAK,KAAK,cAAc,GAAG,gBAAgB,GAAG,KAAK,eAAe,KAAK,IAAI,GAAG,OAAO,QAAQ;AAE7F,WAAK,KAAK,cAAc,GAAG,sBAAsB,GAAG,KAAK,oBAAoB,KAAK,IAAI,GAAG,OAAO,QAAQ;AAExG,WAAK,KAAK,cAAc,GAAG,eAAe,GAAG,KAAK,mBAAmB,KAAK,IAAI,GAAG,OAAO,QAAQ;AAEhG,WAAK,KAAK,cAAc,GAAG,eAAe,GAAG,KAAK,UAAU,KAAK,IAAI,GAAG,OAAO,cAAc;AAAA,IAC9F;AAAA,IAEA,iBAAiB;AAChB,aAAO,MAAM,KAAK,KAAK,IAAI,GAAG;AAC9B,aAAO,UAAU,QAAQ,KAAK,IAAI,IAAI,SAAS,KAAK,IAAI,IAAI,IAAI;AAAA,IACjE;AAAA,IAEA,sBAAsB;AACrB,YAAM,OAAO,KAAK,kBAAkB,WAAW,GAAG,SAAS;AAC3D,WAAK,yBAAyB,IAAI;AAAA,IACnC;AAAA,IAEA,qBAAqB;AACpB,UAAI,CAAC,KAAK,oBAAoB,GAAG,UAAU;AAAG;AAE9C,UAAI,KAAK,IAAI,IAAI,MAAM,UAAU,GAAG;AACnC,eAAO,WAAW;AAAA,UACjB,SAAS,GAAG,oDAAoD;AAAA,UAChE,WAAU;AAAA,QACX,CAAC;AACD,eAAO,MAAM,WAAW,OAAO;AAC/B;AAAA,MACD;AAEA,WAAK,IAAI,KAAK,QAAW,QAAW,QAAW,MAAM;AACpD,eAAO,WAAW;AAAA,UACjB,SAAS,GAAG,yCAAyC;AAAA,UACrD,WAAW;AAAA,QACZ,CAAC;AACD,eAAO,MAAM,WAAW,OAAO;AAAA,MAChC,CAAC,EAAE,KAAK,MAAM;AACb,eAAO,aAAa;AAAA,UACnB,MAAM,OAAO,IAAI,OAAO;AAAA,UACxB,MAAM,KAAK,iBAAiB;AAAA,UAC5B,MAAM,OAAO,IAAI,SAAS;AAAA,QAC3B,CAAC;AAAA,MACF,CAAC;AAAA,IACF;AAAA,IAEA,YAAY;AACX,UAAI,CAAC,KAAK,oBAAoB,GAAG,UAAU;AAAG;AAE9C,UAAI,UAAU,OAAO,MAAM,YAAY,mBAAmB;AAC1D,cAAQ,cAAc,KAAK,IAAI,IAAI;AACnC,cAAQ,OAAO,OAAO,QAAQ;AAC9B,cAAQ,UAAU,KAAK,IAAI,IAAI;AAC/B,cAAQ,oBAAoB,KAAK;AACjC,cAAQ,kBAAkB,OAAO,SAAS,aAAa;AACvD,cAAQ,eAAe,OAAO,SAAS,SAAS;AAChD,aAAO,UAAU,QAAQ,qBAAqB,QAAQ,IAAI;AAAA,IAC3D;AAAA,IAEA,qBAAqB;AACpB,WAAK,gBAAgB,IAAI,QAAQ,YAAY,aAAa;AAAA,QACzD,SAAS,KAAK;AAAA,QACd,aAAa,KAAK;AAAA,QAClB,UAAU,KAAK;AAAA,QACf,QAAQ;AAAA,UACP,eAAe,UAAQ,KAAK,eAAe,IAAI;AAAA,UAE/C,SAAS,MAAM,KAAK,OAAO,CAAC;AAAA,QAC7B;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,iBAAiB;AAChB,WAAK,OAAO,IAAI,QAAQ,YAAY,SAAS;AAAA,QAC5C,SAAS,KAAK;AAAA,QACd,UAAU,KAAK;AAAA,QACf,QAAQ;AAAA,UACP,SAAS,MAAM,KAAK;AAAA,UAEpB,mBAAmB,CAAC,SAAS;AAC5B,kBAAM,WAAW,KAAK,kBAAkB,IAAI;AAC5C,iBAAK,aAAa,4BAA4B,QAAQ;AAAA,UACvD;AAAA,UAEA,cAAc,CAAC,OAAO,WAAW,KAAK,kBAAkB,OAAO,MAAM;AAAA,UAErE,UAAU,MAAM,KAAK,kBAAkB;AAAA,UAEvC,WAAW,MAAM,KAAK,QAAQ,UAAU;AAAA,UAExC,0BAA0B,CAAC,YAAY;AACtC,iBAAK,mBAAmB;AAExB,iBAAK,QAAQ,mCAAmC;AAAA,UACjD;AAAA,QACD;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,oBAAoB;AACnB,WAAK,eAAe,IAAI,QAAQ,YAAY,YAAY;AAAA,QACvD,SAAS,KAAK;AAAA,QACd,UAAU,KAAK;AAAA,QACf,QAAQ;AAAA,UACP,SAAS,MAAM,KAAK;AAAA,UAEpB,sBAAsB,CAAC,aAAa;AACnC,iBAAK,cAAc,gBAAgB,QAAQ;AAC3C,iBAAK,KAAK,cAAc,QAAQ;AAAA,UACjC;AAAA,UAEA,cAAc,CAAC,MAAM,OAAO,UAAU;AACrC,kBAAM,WAAW,OAAO,MAAM,QAAQ,KAAK,SAAS,KAAK,IAAI;AAC7D,gBAAI,YAAY,SAAS,UAAU,OAAO;AACzC,oBAAM,OAAO;AAAA,gBACZ;AAAA,gBACA;AAAA,gBACA,MAAM,KAAK,aAAa;AAAA,cACzB;AACA,qBAAO,KAAK,eAAe,IAAI;AAAA,YAChC;AAEA,mBAAO,QAAQ,QAAQ;AAAA,UACxB;AAAA,UAEA,qBAAqB,CAAC,SAAS;AAC9B,kBAAM,YAAY,KAAK,KAAK,cAAc,IAAI;AAC9C,iBAAK,KAAK,sBAAsB,SAAS;AAAA,UAC1C;AAAA,UAEA,oBAAoB,CAAC,cAAc;AAClC,iBAAK,KAAK,yBAAyB,SAAS;AAAA,UAC7C;AAAA,UACA,gCAAgC,CAAC,UAAU,UAAU;AACpD,iBAAK,KAAK,mCAAmC,UAAU,OAAO,KAAK,aAAa,YAAY;AAAA,UAC7F;AAAA,UACA,6BAA6B,CAAC,kBAAkB,SAAS;AAGxD,mBAAO,KAAK,gBAAgB,EAAE,QAAQ,WAAS;AAC9C,oBAAM,gBAAgB,KAAK,IAAI,IAAI,MAAM,KAAK,OAAK,EAAE,QAAQ,KAAK,IAAI;AACtE,oBAAM,UAAU,KAAK,IAAI,UAAU,SAAS,mBAAK,cAAe;AAEhE,sBAAQ,WAAW;AACnB,sBAAQ,YAAY,iBAAiB,OAAO,KAAK;AAAA,CAAI;AACrD,sBAAQ,MAAM,iBAAiB,OAAO;AACtC,mBAAK,IAAI,IAAI,MAAM,QAAQ,SAAO;AACjC,oBAAI,KAAK,cAAc,IAAI,WAAW;AACrC,uBAAK,iBAAiB,GAAG;AAAA,gBAC1B;AAAA,cACD,CAAC;AAAA,YACF,CAAC;AAAA,UACF;AAAA,UACA,uBAAuB,MAAM,KAAK,sBAAsB;AAAA,UACxD,oBAAoB,MAAM,KAAK;AAAA,UAC/B,oBAAoB,MAAM;AACzB,iBAAK,aAAa,4BAA4B,IAAI;AAClD,iBAAK,KAAK,cAAc;AACxB,iBAAK,KAAK,sBAAsB;AAAA,UACjC;AAAA,UACA,qBAAqB,CAAC,WAAW,cAAc,KAAK,oBAAoB,WAAW,SAAS;AAAA,QAC7F;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,gBAAgB;AACf,WAAK,UAAU,IAAI,QAAQ,YAAY,QAAQ;AAAA,QAC9C,SAAS,KAAK;AAAA,QACd,QAAQ;AAAA,UACP,SAAS,MAAM,KAAK,OAAO,CAAC;AAAA,UAE5B,sBAAsB,MAAM,KAAK,oBAAoB,CAAC;AAAA,UAEtD,uBAAuB,CAAC,SAAS;AAChC,gBAAI,MAAM;AACT,mBAAK,aAAa,WAAW,GAAG,UAAU,IAAI,KAAK,aAAa,WAAW,IAAI,WAAW,MAAM,IAAI;AACpG,mBAAK,cAAc,iBAAiB,KAAK;AAAA,YAC1C,OAAO;AACN,mBAAK,cAAc,iBAAiB,IAAI;AAAA,YACzC;AAAA,UACD;AAAA,UAEA,gBAAgB,MAAM;AACrB,iBAAK,IAAI,WAAW,EAClB,KAAK,CAAC,MAAM;AACZ,mBAAK,kBAAkB,KAAK;AAC5B,mBAAK,cAAc,iBAAiB,IAAI;AACxC,mBAAK,cAAc,gBAAgB,KAAK,IAAI,KAAK,IAAI;AACrD,qBAAO,WAAW;AAAA,gBACjB,WAAW;AAAA,gBACX,SAAS,GAAG,uCAAuC,CAAC,EAAE,IAAI,IAAI,CAAC;AAAA,cAChE,CAAC;AAAA,YACF,CAAC;AAAA,UACH;AAAA,QACD;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,yBAAyB;AACxB,WAAK,oBAAoB,IAAI,QAAQ,YAAY,cAAc;AAAA,QAC9D,SAAS,KAAK;AAAA,QACd,QAAQ;AAAA,UACP,mBAAmB,CAAC,SAAS;AAC5B,mBAAO,GAAG,QAAQ,eAAe,IAAI,EAAE,KAAK,CAAC,QAAQ;AACpD,mBAAK,cAAc,gBAAgB,GAAG;AAAA,YACvC,CAAC;AAAA,UACF;AAAA,UACA,eAAe,MAAM,KAAK,cAAc,2BAA2B,IAAI;AAAA,QACxE;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,qBAAqB;AACpB,WAAK,gBAAgB,IAAI,QAAQ,YAAY,iBAAiB;AAAA,QAC7D,SAAS,KAAK;AAAA,QACd,QAAQ;AAAA,UACP,SAAS,MAAM,KAAK;AAAA,UAEpB,gBAAgB,CAAC,SAAS;AACzB,iBAAK,kBAAkB,iBAAiB,KAAK;AAC7C,mBAAO,GAAG,QAAQ,eAAe,IAAI,EAAE,KAAK,CAAC,QAAQ;AACpD,qBAAO,aAAa;AAAA,gBACnB,MAAM,KAAK,oBAAoB,GAAG;AAAA,gBAClC,MAAM,KAAK,KAAK,aAAa;AAAA,gBAC7B,MAAM,KAAK,cAAc,iBAAiB,IAAI;AAAA,cAC/C,CAAC;AAAA,YACF,CAAC;AAAA,UACF;AAAA,UACA,YAAY,CAAC,SAAS;AACrB,iBAAK,kBAAkB,iBAAiB,KAAK;AAC7C,mBAAO,aAAa;AAAA,cACnB,MAAM,KAAK,IAAI,QAAQ,IAAI;AAAA,cAC3B,MAAM,KAAK,IAAI,KAAK,wBAAwB;AAAA,cAC5C,MAAM,KAAK,KAAK,aAAa;AAAA,cAC7B,MAAM,KAAK,cAAc,iBAAiB,IAAI;AAAA,YAC/C,CAAC;AAAA,UACF;AAAA,UACA,cAAc,CAAC,SAAS;AACvB,mBAAO,MAAM,WAAW,KAAK,IAAI,IAAI,SAAS,MAAM,MAAM;AACzD,mBAAK,kBAAkB,aAAa;AAAA,YACrC,CAAC;AAAA,UACF;AAAA,UACA,WAAW,MAAM;AAChB,mBAAO,aAAa;AAAA,cACnB,MAAM,OAAO,IAAI,OAAO;AAAA,cACxB,MAAM,KAAK,iBAAiB;AAAA,cAC5B,MAAM,KAAK,cAAc,iBAAiB,IAAI;AAAA,cAC9C,MAAM,OAAO,IAAI,SAAS;AAAA,YAC3B,CAAC;AAAA,UACF;AAAA,QACD;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,yBAAyB,MAAM;AAC9B,WAAK,kBAAkB,CAAC,IAAI;AAC5B,WAAK,kBAAkB,iBAAiB,IAAI;AAC5C,WAAK,cAAc,iBAAiB,IAAI;AAAA,IACzC;AAAA,IAEA,kBAAkB,MAAM;AACvB,WAAK,KAAK,iBAAiB,IAAI;AAC/B,WAAK,cAAc,iBAAiB,IAAI;AAGxC,OAAC,OAAQ,KAAK,aAAa,iBAAiB,KAAK,KAAK,KAAK,QAAQ,iBAAiB,KAAK,IAAK;AAAA,IAC/F;AAAA,IAEA,mBAAmB;AAClB,aAAO,OAAO,aAAa;AAAA,QAC1B,MAAM,OAAO,IAAI,OAAO;AAAA,QACxB,MAAM,KAAK,uBAAuB;AAAA,QAClC,MAAM,KAAK,qBAAqB;AAAA,QAChC,MAAM,KAAK,uBAAuB;AAAA,QAClC,MAAM,KAAK,KAAK,aAAa;AAAA,QAC7B,MAAM,OAAO,IAAI,SAAS;AAAA,MAC3B,CAAC;AAAA,IACF;AAAA,IAEA,yBAAyB;AACxB,YAAM,UAAU;AAChB,aAAO,IAAI,QAAQ,aAAW;AAC7B,YAAI,KAAK,KAAK;AACb,eAAK,MAAM,KAAK,YAAY,KAAK,GAAG;AACpC,eAAK,IAAI,IAAI,QAAQ,CAAC;AACtB,eAAK,IAAI,IAAI,SAAS;AACtB,kBAAQ;AAAA,QACT,OAAO;AACN,iBAAO,MAAM,aAAa,SAAS,MAAM;AACxC,iBAAK,MAAM,KAAK,YAAY;AAC5B,iBAAK,IAAI,IAAI,QAAQ,CAAC;AACtB,iBAAK,IAAI,IAAI,SAAS;AACtB,oBAAQ;AAAA,UACT,CAAC;AAAA,QACF;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,YAAY,MAAM;AACjB,YAAM,UAAU;AAChB,YAAM,OAAO,EAAE,OAAO;AACtB,YAAM,MAAM,QAAQ,IAAI,OAAO,GAAG,KAAK,KAAK,SAAS,MAAM,KAAK;AAChE,YAAM,OAAO,OAAO,MAAM,0BAA0B,SAAS,IAAI;AACjE,UAAI,QAAQ,IAAI;AAEhB,aAAO;AAAA,IACR;AAAA,UAEM,oBAAoB,KAAK;AAC9B,aAAO,IAAI,OAAO;AAClB,WAAK,MAAM,KAAK,YAAY,KAAK,GAAG;AACpC,WAAK,IAAI,IAAI,QAAQ,CAAC;AACtB,aAAO,OAAO,KAAK;AAAA,QAClB,QAAQ;AAAA,QACR,MAAM;AAAA,UACL,eAAe,IAAI;AAAA,UACnB,cAAc,KAAK,IAAI;AAAA,QACxB;AAAA,QACA,UAAU,CAAC,MAAM;AAChB,iBAAO,MAAM,KAAK,EAAE,OAAO;AAC3B,iBAAO,QAAQ,EAAE,QAAQ,SAAS,EAAE,QAAQ,IAAI,EAAE,sBAAsB;AACxE,eAAK,qBAAqB,EAAE,KAAK,MAAM;AACtC,mBAAO,IAAI,SAAS;AAAA,UACrB,CAAC;AAAA,QACF;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,uBAAuB;AACtB,UAAI,KAAK,WAAW,CAAC,KAAK,IAAI,IAAI;AAAS,aAAK,IAAI,IAAI,UAAU,KAAK;AACvE,UAAK,MAAK,eAAe,CAAC,KAAK,IAAI,IAAI,eAAgB,MAAK,IAAI,IAAI,aAAa,KAAK,eAAe,KAAK,IAAI,IAAI,cAAc;AAC/H,aAAK,IAAI,IAAI,cAAc,KAAK;AAAA,MACjC;AAEA,UAAI,CAAC,KAAK,IAAI,IAAI;AAAS;AAE3B,aAAO,KAAK,IAAI,QAAQ,cAAc;AAAA,IACvC;AAAA,IAEA,yBAAyB;AACxB,WAAK,KAAK,cAAc,KAAK,aAAa,MAAM;AAAA,IACjD;AAAA,UAEM,eAAe,MAAM;AAC1B,aAAO,IAAI,OAAO;AAClB,UAAI,WAAW;AACf,UAAI;AACH,YAAI,EAAE,OAAO,OAAO,SAAS;AAC7B,mBAAW,KAAK,kBAAkB,IAAI;AACtC,cAAM,kBAAkB,CAAC,EAAE,cAAc,QAAQ;AAEjD,cAAM,gBAAgB,UAAU,SAAS,UAAU;AACnD,YAAI;AACH,kBAAQ,IAAI,SAAS,GAAG,IAAI,IAAI,KAAK;AAEtC,YAAI,iBAAiB;AACpB,cAAI,UAAU;AACb,oBAAQ,IAAI,KAAK;AAElB,cAAI,CAAC,OAAO,mBAAmB,EAAE,SAAS,KAAK,KAAK,QAAQ,KAAK,CAAC,KAAK,sBAAsB;AAC5F,kBAAM,aAAa,UAAU,QAAQ,QAAQ,SAAS,oBAAoB,SAAS,MAAM;AACzF,kBAAM,KAAK,yBAAyB,UAAU,YAAY,KAAK,IAAI,IAAI,aAAa;AAAA,UACrF;AAEA,cAAI,KAAK,6BAA6B,QAAQ,KAAK,eAAe;AACjE,kBAAM,OAAO,MAAM,UAAU,SAAS,SAAS,SAAS,MAAM,OAAO,KAAK;AAC1E,iBAAK,iBAAiB,QAAQ;AAAA,UAC/B;AAAA,QAED,OAAO;AACN,cAAI,CAAC,KAAK,IAAI,IAAI;AACjB,mBAAO,KAAK,+BAA+B;AAE5C,gBAAM,EAAE,WAAW,UAAU,WAAW,SAAS;AAEjD,cAAI,CAAC;AACJ;AAED,gBAAM,WAAW,EAAE,WAAW,UAAU,OAAO,QAAQ,MAAM;AAE7D,cAAI,WAAW;AACd,kBAAM,KAAK,6BAA6B,WAAW,KAAK,IAAI,IAAI,eAAe,SAAS;AACxF,qBAAS,eAAe;AAAA,UACzB;AAEA,cAAI,UAAU;AACb,qBAAS,SAAS,MAAM,MAAM;AAAA,CAAI,EAAE,UAAU;AAE/C,qBAAW,KAAK,IAAI,UAAU,SAAS,QAAQ;AAE/C,cAAI,UAAU,SAAS,UAAU,KAAK,CAAC,KAAK;AAC3C,kBAAM,KAAK,yBAAyB,UAAU,OAAO,KAAK,IAAI,IAAI,aAAa;AAEhF,gBAAM,KAAK,wBAAwB,QAAQ;AAE3C,eAAK,iBAAiB,QAAQ;AAE9B,cAAI,KAAK,aAAa,WAAW,GAAG,UAAU;AAC7C,iBAAK,qBAAqB,QAAQ;AAEnC,cAAI,KAAK,oCAAoC,QAAQ,KAAK,CAAC,KAAK,aAAa,WAAW,GAAG,UAAU;AACpG,iBAAK,qBAAqB,QAAQ;AAAA,QACpC;AAAA,MAED,SAAS,OAAP;AACD,gBAAQ,IAAI,KAAK;AAAA,MAClB,UAAE;AACD,eAAO,IAAI,SAAS;AACpB,eAAO;AAAA,MACR;AAAA,IACD;AAAA,IAEA,iCAAiC;AAChC,aAAO,IAAI,SAAS;AACpB,aAAO,WAAW;AAAA,QACjB,SAAS,GAAG,mDAAmD;AAAA,QAC/D,WAAW;AAAA,MACZ,CAAC;AACD,aAAO,MAAM,WAAW,OAAO;AAAA,IAChC;AAAA,IAEA,kBAAkB,EAAE,MAAM,WAAW,UAAU,KAAK,QAAQ;AAC3D,UAAI,WAAW;AACf,UAAI,MAAM;AACT,mBAAW,KAAK,IAAI,IAAI,MAAM,KAAK,OAAK,EAAE,QAAQ,IAAI;AAAA,MACvD,OAAO;AAIN,cAAM,eAAe;AACrB,mBAAW,KAAK,IAAI,IAAI,MAAM,KAC7B,OAAK,EAAE,cAAc,aAChB,EAAC,gBAAiB,gBAAgB,EAAE,aAAa,aACjD,EAAE,QAAQ,OACV,EAAE,QAAQ,IAChB;AAAA,MACD;AAEA,aAAO,YAAY,CAAC;AAAA,IACrB;AAAA,IAEA,qBAAqB,UAAU;AAC9B,WAAK,aAAa,4BAA4B,QAAQ;AAAA,IACvD;AAAA,IAEA,6BAA6B,UAAU;AACtC,aAAO,SAAS,QAAQ,KAAK,aAAa,aAAa;AAAA,IACxD;AAAA,IAEA,iBAAiB,UAAU,aAAa;AACvC,WAAK,KAAK,iBAAiB,UAAU,WAAW;AAChD,WAAK,KAAK,sBAAsB,KAAK,GAAG;AAAA,IACzC;AAAA,IAEA,oCAAoC,UAAU;AAG7C,YAAM,aAAa,SAAS;AAC5B,YAAM,UAAU,SAAS;AACzB,YAAM,qBAAqB,CAAC,SAAS;AACrC,YAAM,oBAAoB,CAAC,SAAS;AAEpC,UAAK,cAAc,sBAAwB,WAAW,qBACpD,cAAc,WAAY,sBAAqB,qBAAsB;AACtE,eAAO;AAAA,MACR;AACA,aAAO;AAAA,IACR;AAAA,UAEM,wBAAwB,UAAU;AACvC,YAAM,KAAK,IAAI,eAAe,QAAQ,aAAa,SAAS,SAAS,SAAS,IAAI;AAClF,YAAM,KAAK,IAAI,eAAe,QAAQ,OAAO,SAAS,SAAS,SAAS,IAAI;AAAA,IAC7E;AAAA,UAEM,yBAAyB,UAAU,YAAY,WAAW;AAC/D,YAAM,OAAQ,OAAM,KAAK,oBAAoB,SAAS,WAAW,SAAS,GAAG;AAC7E,YAAM,gBAAgB,KAAK;AAC3B,YAAM,gBAAgB,KAAK;AAE3B,aAAO,IAAI,SAAS;AACpB,YAAM,iBAAiB,SAAS,UAAU,KAAK;AAC/C,YAAM,iBAAiB,UAAU,KAAK;AACtC,YAAM,qBAAqB,cAAc,SAAS,EAAE,KAAK;AACzD,UAAI,CAAE,iBAAgB,IAAI;AACzB,YAAI,eAAe;AAClB,iBAAO,MAAM,UAAU,SAAS,SAAS,SAAS,IAAI;AACtD,iBAAO,MAAM;AAAA,YACZ,OAAO,GAAG,eAAe;AAAA,YACzB,SAAS,GAAG,wDAAwD,CAAC,gBAAgB,cAAc,CAAC;AAAA,UACrG,CAAC;AAAA,QACF,OAAO;AACN;AAAA,QACD;AAAA,MACD,WAAW,gBAAgB,YAAY;AACtC,eAAO,MAAM;AAAA,UACZ,SAAS,GAAG,6FAA6F,CAAC,gBAAgB,gBAAgB,kBAAkB,CAAC;AAAA,UAC7J,WAAW;AAAA,QACZ,CAAC;AACD,eAAO,MAAM,WAAW,OAAO;AAAA,MAChC;AACA,aAAO,IAAI,OAAO;AAAA,IACnB;AAAA,UAEM,6BAA6B,WAAW,WAAW,WAAW;AACnE,YAAM,SAAS;AACf,YAAM,OAAO,EAAC,SAAS,EAAE,WAAW,UAAU,EAAC;AAC/C,YAAM,MAAM,MAAM,OAAO,KAAK,EAAE,QAAQ,KAAK,CAAC;AAE9C,UAAI,IAAI,QAAQ,SAAS,SAAS,GAAG;AACpC,eAAO,MAAM;AAAA,UACZ,OAAO,GAAG,eAAe;AAAA,UACzB,SAAS,GAAG,wEAAwE,CAAC,UAAU,KAAK,CAAC,CAAC;AAAA,QACvG,CAAC;AAAA,MACF;AAAA,IACD;AAAA,IAEA,oBAAoB,WAAW,WAAW;AACzC,YAAM,KAAK;AACX,aAAO,OAAO,KAAK;AAAA,QAClB,QAAQ;AAAA,QACR,MAAM;AAAA,UACL,aAAa;AAAA,UACb,aAAa;AAAA,QACd;AAAA,QACA,SAAS,KAAK;AACb,cAAI,CAAC,GAAG,eAAe;AACtB,eAAG,eAAe,aAAa,CAAC;AACjC,aAAG,eAAe,WAAW,aAAa,IAAI,QAAQ;AAAA,QACvD;AAAA,MACD,CAAC;AAAA,IACF;AAAA,IAEA,kBAAkB,OAAO,iBAAiB;AACzC,UAAI,oBAAoB,YAAY;AACnC,aAAK,aAAa,4BAA4B,IAAI;AAAA,MACnD,WAAW,oBAAoB,UAAU;AACxC,aAAK,sBAAsB;AAAA,MAC5B,OAAO;AACN,cAAM,gBAAgB,KAAK,aAAa,GAAG;AAC3C,YAAI,CAAC;AAAe;AACpB,sBAAc,UAAU;AACxB,iBAAS,MAAM,cAAc,UAAU,KAAK;AAAA,MAC7C;AAAA,IACD;AAAA,IAEA,wBAAwB;AACvB,aAAO,IAAI,OAAO;AAClB,YAAM,EAAE,SAAS,MAAM,iBAAiB,KAAK;AAE7C,aAAO,OAAO,MAAM,UAAU,SAAS,MAAM,OAAO,CAAC,EACnD,KAAK,MAAM;AACX,eAAO,MAAM,UAAU,SAAS,IAAI;AACpC,aAAK,iBAAiB,cAAc,IAAI;AACxC,aAAK,aAAa,4BAA4B,IAAI;AAClD,eAAO,IAAI,SAAS;AAAA,MACrB,CAAC,EACA,MAAM,OAAK,QAAQ,IAAI,CAAC,CAAC;AAAA,IAC5B;AAAA,UAEM,oBAAoB;AACzB,UAAI,KAAK,IAAI,SAAS,GAAG;AACxB,YAAI,aAAa;AACjB,cAAM,KAAK,IAAI,KAAK,MAAM,MAAM,MAAM,MAAM,aAAa,IAAI;AAE7D,SAAC,cAAc,KAAK,QAAQ,SAAS;AAErC,sBAAc,WAAW,MAAM;AAC9B,eAAK,KAAK,oBAAoB,IAAI;AAAA,QACnC,GAAG,GAAG;AAAA,MACP,OAAO;AACN,aAAK,QAAQ,SAAS;AAAA,MACvB;AAAA,IACD;AAAA,EACD;;;ACtuBA,MAAI,gBAAgB;AACpB,UAAQ,YAAY,aAAa,cAAc,QAAQ,YAAY,WAAW;AAAA,IAC5E,WAAW;AACT,WAAK,YAAY;AACjB,WAAK,mBAAmB;AACxB,WAAK,aAAa;AAClB,WAAK,iBAAiB;AACtB,WAAK,qBAAqB;AAAA,IAC5B;AAAA,IAEA,uBAAuB;AACrB,UAAI,OAAO,0BAA0B,GAAG;AACtC,aAAK,SAAS,IAAI,QAAQ,YAAY,eAAe;AACrD,eAAO,IAAI,OAAO;AAElB,aAAK,OAAO,+BAA+B,MAAM,IAAI;AACrD,eAAO,IAAI,SAAS;AAAA,MACtB;AAAA,IACF;AAAA,IAEA,qBAAqB;AACnB,WAAK,gBAAgB,IAAI,QAAQ,YAAY,iBAAiB;AAAA,QAC5D,SAAS,KAAK;AAAA,QACd,QAAQ;AAAA,UACN,SAAS,MAAM,KAAK;AAAA,UAEpB,gBAAgB,CAAC,SAAS;AACxB,iBAAK,kBAAkB,iBAAiB,KAAK;AAC7C,mBAAO,GAAG,QAAQ,eAAe,IAAI,EAAE,KAAK,CAAC,QAAQ;AACnD,qBAAO,aAAa;AAAA,gBAClB,MAAM,KAAK,oBAAoB,GAAG;AAAA,gBAClC,MAAM,KAAK,KAAK,aAAa;AAAA,gBAC7B,MAAM,KAAK,cAAc,iBAAiB,IAAI;AAAA,cAChD,CAAC;AAAA,YACH,CAAC;AAAA,UACH;AAAA,UACA,YAAY,CAAC,SAAS;AACpB,iBAAK,kBAAkB,iBAAiB,KAAK;AAC7C,mBAAO,aAAa;AAAA,cAClB,MAAM,KAAK,IAAI,QAAQ,IAAI;AAAA,cAC3B,MAAM,KAAK,IAAI,KAAK,wBAAwB;AAAA,cAC5C,MAAM,KAAK,KAAK,aAAa;AAAA,cAC7B,MAAM,KAAK,cAAc,iBAAiB,IAAI;AAAA,YAChD,CAAC;AAAA,UACH;AAAA,UACA,cAAc,CAAC,SAAS;AACtB,mBAAO,MAAM,WAAW,KAAK,IAAI,IAAI,SAAS,MAAM,MAAM;AACxD,mBAAK,kBAAkB,aAAa;AAAA,YACtC,CAAC;AAAA,UACH;AAAA,UACA,WAAW,MAAM;AACf,mBAAO,aAAa;AAAA,cAClB,MAAM,OAAO,IAAI,OAAO;AAAA,cACxB,MAAM,KAAK,iBAAiB;AAAA,cAC5B,MAAM,KAAK,cAAc,iBAAiB,IAAI;AAAA,cAC9C,MAAM,OAAO,IAAI,SAAS;AAAA,YAC5B,CAAC;AAAA,UACH;AAAA,UACA,WAAW,MAAM;AACf,iBAAK,UAAU,KAAK,GAAG;AAAA,UACzB;AAAA,UACA,kBAAkB,MAAM;AACtB,iBAAK,iBAAiB;AAAA,UACxB;AAAA,QACF;AAAA,MACF,CAAC;AAAA,IACH;AAAA,UAEM,qBAAqB,MAAM;AAC/B,WAAK,cAAc,KAAK;AACxB,WAAK,UAAU,KAAK;AACpB,WAAK,cAAc,KAAK;AACxB,WAAK,mBAAmB,KAAK;AAC7B,WAAK,iBAAiB,CAAC;AACvB,WAAK,WAAW,CAAC;AACjB,aAAO,gBAAgB,CAAC;AACxB,aAAO,UAAU,CAAC;AAElB,aAAO,GACJ,UAAU,kBAAkB,QAAW,sBAAsB,EAC7D,KAAK,CAAC,EAAE,cAAc;AACrB,aAAK,uBAAuB,IAAI,QAAQ,oBAAoB,KAAK;AAAA,MACnE,CAAC;AAEH,aAAO,GACJ,SAAS,qBAAqB;AAAA,QAC7B,SAAS,EAAE,SAAS,KAAK,QAAQ;AAAA,QACjC,QAAQ,CAAC,QAAQ,OAAO;AAAA,MAC1B,CAAC,EACA,KAAK,CAAC,QAAQ;AACb,eAAO,gBAAgB;AAAA,MACzB,CAAC;AAEH,aAAO,GAAG,QAAQ,WAAW,KAAK,OAAO,EAAE,KAAK,CAAC,QAAQ;AACvD,eAAO,UAAU;AAAA,MACnB,CAAC;AAED,aAAO,KAAK;AAAA,QACV,QACE;AAAA,QACF,MAAM,EAAE,aAAa,KAAK,YAAY;AAAA,QACtC,UAAU,CAAC,QAAQ;AACjB,gBAAM,UAAU,IAAI;AACpB,iBAAO,mBAAmB,QAAQ;AAClC,iBAAO,yBAAyB,QAAQ;AACxC,iBAAO,yBAAyB,QAAQ;AAExC,cAAI,OAAO,oBAAoB,GAAG;AAChC,mBAAO,GAAG,QAAQ,oBAAoB,MAAS,EAAE,KAAK,CAAC,WAAW;AAChE,kBACE,OAAO,uBAAuB,QAC9B,OAAO,uBAAuB,MAC9B,OAAO,uBAAuB,MAC9B,OAAO,uBAAuB,MAC9B;AACA,uBAAO,GAAG,KAAK,QAAQ,EAAE,KAAK,WAAY;AAExC,qBAAG,SAAS,sBAAsB,SAAU,SAAS,QAAQ;AAC3D,4BAAQ,OAAO,mBAAmB;AAAA,kBACpC,CAAC;AACD,qBAAG,SAAS,oBAAoB,SAAU,QAAQ;AAChD,2BAAO,SAAU,SAAS,QAAQ;AAChC,0BAAI;AACF,4BAAI,KAAK,QAAQ,OAAO,OAAO,mBAAmB;AAElD,4BAAI,MAAM,IAAI,KAAK,OAAO,UAAU;AAAA,0BAClC,KAAK;AAAA,wBACP,CAAC;AACD,4BAAI,KAAK,EAAE;AACX,4BAAI,aAAa,MAAM;AACvB,4BAAI,MAAM,IAAI,KAAK;AACnB,gCAAQ,OAAO,UAAU,GAAG,CAAC,CAAC;AAAA,sBAChC,SAAS,KAAP;AACA,gCAAQ,MAAM,GAAG;AACjB,+BAAO,GAAG;AAAA,sBACZ;AAAA,oBACF;AAAA,kBACF,CAAC;AAAA,gBACH,CAAC;AAAA,cACH;AACA,kBAAI,IAAI,IAAI,OAAO,GAAG,OAAO;AAAA,gBAC3B,QAAQ;AAAA,kBACN;AAAA,oBACE,WAAW;AAAA,oBACX,WAAW;AAAA,oBACX,MAAM;AAAA,oBACN,OAAO;AAAA,kBACT;AAAA,gBACF;AAAA,gBACA,gBAAgB,WAAY;AAC1B,yBAAO,cAAc,EAAE,WAAW,EAAE;AACpC,oBAAE,KAAK;AAAA,gBACT;AAAA,gBACA,kBAAkB,WAAY;AAC5B,oBAAE,KAAK;AAAA,gBACT;AAAA,gBACA,wBAAwB;AAAA,gBACxB,OAAO;AAAA,cACT,CAAC;AACD,qBAAO,GAAG,KAAK,oBAAoB,EAAE,KAAK,CAAC,UAAS;AAClD,kBAAE,gBAAgB,WAAW,WAAW,KAAI;AAC5C,kBAAE,KAAK;AAAA,cACT,CAAC;AAAA,YACH,CAAC;AAAA,UACH;AACA,iBAAO,sBAAsB,QAAQ;AACrC,iBAAO,iCACL,QAAQ;AAEV,iBAAO,qBAAqB,QAAQ;AACpC,iBAAO,OAAO,KAAK,UAAU,OAAO;AACpC,eAAK,SAAS,kBAAkB,QAAQ,gBAAgB,IACtD,CAAC,UAAU,MAAM,IACnB;AACA,eAAK,SAAS;AAAA,QAChB;AAAA,MACF,CAAC;AAAA,IA6DH;AAAA,IAEA,oBAAoB;AAClB,WAAK,eAAe,IAAI,QAAQ,YAAY,YAAY;AAAA,QACtD,SAAS,KAAK;AAAA,QACd,UAAU,KAAK;AAAA,QACf,QAAQ;AAAA,UACN,SAAS,MAAM,KAAK;AAAA,UAEpB,sBAAsB,CAAC,aAAa;AAClC,iBAAK,cAAc,gBAAgB,QAAQ;AAC3C,iBAAK,KAAK,cAAc,QAAQ;AAAA,UAClC;AAAA,UAEA,cAAc,CAAC,MAAM,OAAO,UAAU;AACpC,kBAAM,WAAW,OAAO,MAAM,QAAQ,KAAK,SAAS,KAAK,IAAI;AAC7D,gBAAI,YAAY,SAAS,UAAU,OAAO;AACxC,oBAAM,OAAO;AAAA,gBACX;AAAA,gBACA;AAAA,gBACA,MAAM,KAAK,aAAa;AAAA,cAC1B;AACA,qBAAO,KAAK,eAAe,IAAI;AAAA,YACjC;AAEA,mBAAO,QAAQ,QAAQ;AAAA,UACzB;AAAA,UAEA,qBAAqB,CAAC,SAAS;AAC7B,kBAAM,YAAY,KAAK,KAAK,cAAc,IAAI;AAC9C,iBAAK,KAAK,sBAAsB,SAAS;AAAA,UAC3C;AAAA,UAEA,oBAAoB,CAAC,cAAc;AACjC,iBAAK,KAAK,yBAAyB,SAAS;AAAA,UAC9C;AAAA,UACA,gCAAgC,CAAC,UAAU,UAAU;AACnD,iBAAK,KAAK,mCACR,UACA,OACA,KAAK,aAAa,YACpB;AAAA,UACF;AAAA,UACA,6BAA6B,CAAC,kBAAkB,SAAS;AAGvD,mBAAO,KAAK,gBAAgB,EAAE,QAAQ,CAAC,UAAU;AAC/C,oBAAM,gBAAgB,KAAK,IAAI,IAAI,MAAM,KACvC,CAAC,MAAM,EAAE,QAAQ,KAAK,IACxB;AACA,oBAAM,UAAU,KAAK,IAAI,UAAU,SAAS,mBAAK,cAAe;AAEhE,sBAAQ,WAAW;AACnB,sBAAQ,YAAY,iBAAiB,OAAO,KAAK;AAAA,CAAI;AACrD,sBAAQ,MAAM,iBAAiB,OAAO;AACtC,mBAAK,IAAI,IAAI,MAAM,QAAQ,CAAC,QAAQ;AAClC,oBAAI,KAAK,cAAc,IAAI,WAAW;AACpC,uBAAK,iBAAiB,GAAG;AAAA,gBAC3B;AAAA,cACF,CAAC;AAAA,YACH,CAAC;AAAA,UACH;AAAA,UACA,uBAAuB,MAAM,KAAK,sBAAsB;AAAA,UACxD,oBAAoB,MAAM,KAAK;AAAA,UAC/B,oBAAoB,MAAM;AACxB,iBAAK,aAAa,4BAA4B,IAAI;AAClD,iBAAK,KAAK,cAAc;AACxB,iBAAK,KAAK,sBAAsB;AAEhC,gBAAI,OAAO,sBAAsB,GAAG;AAClC,qBAAO,uBAAuB;AAC9B,qBAAO,cAAc,YAAY,EAAE,SAAS,OAAO,CAAC;AAAA,YACtD;AAAA,UACF;AAAA,UACA,qBAAqB,CAAC,WAAW,cAC/B,KAAK,oBAAoB,WAAW,SAAS;AAAA,QACjD;AAAA,MACF,CAAC;AAAA,IACH;AAAA,IAEA,wBAAwB;AACtB,aAAO,IAAI,OAAO;AAClB,YAAM,EAAE,SAAS,MAAM,iBAAiB,KAAK;AAE7C,aAAO,OAAO,MACX,UAAU,SAAS,MAAM,OAAO,CAAC,EACjC,KAAK,MAAM;AACV,eAAO,MAAM,UAAU,SAAS,IAAI;AACpC,aAAK,iBAAiB,cAAc,IAAI;AACxC,aAAK,aAAa,4BAA4B,IAAI;AAClD,eAAO,IAAI,SAAS;AAAA,MACtB,CAAC,EACA,MAAM,CAAC,MAAM,QAAQ,IAAI,CAAC,CAAC;AAG9B,UAAI,OAAO,sBAAsB,GAAG;AAClC,eAAO,uBAAuB;AAAA,MAChC;AAAA,IACF;AAAA,IAEA,gBAAgB;AACd,WAAK,UAAU,IAAI,QAAQ,YAAY,QAAQ;AAAA,QAC7C,SAAS,KAAK;AAAA,QACd,QAAQ;AAAA,UACN,SAAS,MAAM,KAAK,OAAO,CAAC;AAAA,UAE5B,sBAAsB,MAAM,KAAK,oBAAoB,CAAC;AAAA,UAEtD,uBAAuB,CAAC,SAAS;AAC/B,gBAAI,MAAM;AACR,mBAAK,aAAa,WAAW,GAAG,UAAU,IACtC,KAAK,aAAa,WAAW,IAAI,WAAW,MAAM,IAClD;AACJ,mBAAK,cAAc,iBAAiB,KAAK;AAAA,YAC3C,OAAO;AACL,mBAAK,cAAc,iBAAiB,IAAI;AAAA,YAC1C;AAAA,UACF;AAAA,UAEA,gBAAgB,MAAM;AAEpB,gBAAI,cAAc;AAClB,gBAAI,OAAO,0BAA0B,GAAG;AACtC,kBAAI,KAAK,IAAI,IAAI,SAAS,SAAS,GAAG;AACpC,yBAAS,IAAI,GAAG,KAAK,KAAK,IAAI,IAAI,SAAS,QAAQ,KAAK;AACtD,sBAAI,KAAK,IAAI,IAAI,SAAS,MAAM,QAAW;AACzC,wBACE,KAAK,IAAI,IAAI,SAAS,GAAG,mBACvB,OAAO,0BACT,KAAK,IAAI,IAAI,SAAS,GAAG,eAAe,GACxC;AACA,0BAAI,KAAK,IAAI,IAAI,SAAS,GAAG,SAAS,GAAG;AACvC,sCAAc;AAAA,sBAChB,WACE,KAAK,IAAI,IAAI,aAAa,KAC1B,KAAK,IAAI,IAAI,SAAS,GAAG,qBACzB;AACA,sCAAc;AAAA,sBAChB,WACE,KAAK,IAAI,IAAI,aAAa,KAC1B,CAAC,KAAK,IAAI,IAAI,SAAS,GAAG,qBAC1B;AACA,+BAAO,MACL,gGACF;AAAA,sBACF;AAAA,oBACF;AAAA,kBACF;AAAA,gBACF;AAAA,cACF;AAAA,YACF;AAEA,gBAAI,eAAe,GAAG;AACpB,mBAAK,IAAI,WAAW,EAAE,KAAK,CAAC,MAAM;AAEhC,oBAAI,OAAO,kCAAkC,GAAG;AAC9C,uBAAK,iBAAiB;AAAA,gBACxB;AAEA,oBAAI,OAAO,uBAAuB,GAAG;AACnC,uBAAK,UAAU,KAAK,GAAG;AAAA,gBACzB;AACA,qBAAK,kBAAkB,KAAK;AAC5B,qBAAK,cAAc,iBAAiB,IAAI;AACxC,qBAAK,cAAc,gBAAgB,KAAK,IAAI,KAAK,IAAI;AACrD,uBAAO,WAAW;AAAA,kBAChB,WAAW;AAAA,kBACX,SAAS,GAAG,uCAAuC;AAAA,oBACjD,EAAE,IAAI;AAAA,kBACR,CAAC;AAAA,gBACH,CAAC;AAAA,cACH,CAAC;AAAA,YACH,OAAO;AAGL,mBAAK,OAAO,oBAAoB,MAAM,IAAI;AAAA,YAC5C;AAAA,UACF;AAAA,UAEA,WAAW,MAAM;AACf,iBAAK,UAAU,KAAK,GAAG;AAAA,UACzB;AAAA,UAEA,kBAAkB,MAAM;AACtB,iBAAK,iBAAiB;AAAA,UACxB;AAAA,QACF;AAAA,MACF,CAAC;AAAA,IACH;AAAA,UAEM,eAAe,MAAM;AACzB,aAAO,IAAI,OAAO;AAClB,UAAI,WAAW;AACf,UAAI;AACF,YAAI,EAAE,OAAO,OAAO,SAAS;AAC7B,mBAAW,KAAK,kBAAkB,IAAI;AACtC,cAAM,kBAAkB,CAAC,EAAE,cAAc,QAAQ;AAEjD,cAAM,gBAAgB,UAAU,SAAS,UAAU;AACnD,YAAI;AAAe,kBAAQ,IAAI,SAAS,GAAG,IAAI,IAAI,KAAK;AAExD,YAAI,iBAAiB;AACnB,cAAI,UAAU;AAAO,oBAAQ,IAAI,KAAK;AAEtC,cACE,CAAC,OAAO,mBAAmB,EAAE,SAAS,KAAK,KAC3C,QAAQ,KACR,CAAC,KAAK,sBACN;AACA,kBAAM,aACJ,UAAU,QACN,QAAQ,SAAS,oBACjB,SAAS,MAAM;AACrB,kBAAM,KAAK,yBACT,UACA,YACA,KAAK,IAAI,IAAI,aACf;AAAA,UACF;AAEA,cAAI,KAAK,6BAA6B,QAAQ,KAAK,eAAe;AAChE,kBAAM,OAAO,MAAM,UACjB,SAAS,SACT,SAAS,MACT,OACA,KACF;AACA,iBAAK,iBAAiB,QAAQ;AAAA,UAChC;AAAA,QACF,OAAO;AACL,cAAI,CAAC,KAAK,IAAI,IAAI;AAChB,mBAAO,KAAK,+BAA+B;AAE7C,gBAAM,EAAE,WAAW,UAAU,WAAW,SAAS;AAEjD,cAAI,CAAC;AAAW;AAEhB,gBAAM,WAAW,EAAE,WAAW,UAAU,OAAO,QAAQ,MAAM;AAE7D,cAAI,WAAW;AACb,kBAAM,KAAK,6BACT,WACA,KAAK,IAAI,IAAI,eACb,SACF;AACA,qBAAS,eAAe;AAAA,UAC1B;AAEA,cAAI,UAAU;AACZ,qBAAS,SAAS,MAAM,MAAM;AAAA,CAAI,EAAE,UAAU;AAEhD,qBAAW,KAAK,IAAI,UAAU,SAAS,QAAQ;AAE/C,cAAI,UAAU,SAAS,UAAU,KAAK,CAAC,KAAK;AAC1C,kBAAM,KAAK,yBACT,UACA,OACA,KAAK,IAAI,IAAI,aACf;AAEF,gBAAM,KAAK,wBAAwB,QAAQ;AAE3C,eAAK,iBAAiB,QAAQ;AAE9B,cAAI,KAAK,aAAa,WAAW,GAAG,UAAU;AAC5C,iBAAK,qBAAqB,QAAQ;AAEpC,cACE,KAAK,oCAAoC,QAAQ,KACjD,CAAC,KAAK,aAAa,WAAW,GAAG,UAAU;AAE3C,iBAAK,qBAAqB,QAAQ;AAAA,QACtC;AAAA,MACF,SAAS,OAAP;AACA,gBAAQ,IAAI,KAAK;AAAA,MACnB,UAAE;AACA,YAAI,OAAO,0BAA0B,GAAG;AACtC,eAAK,OAAO,gBAAgB,IAAI;AAAA,QAClC;AACA,eAAO,IAAI,SAAS;AACpB,eAAO;AAAA,MACT;AAAA,IACF;AAAA,IAEA,mBAAmB;AACjB,UAAI,OAAO,oBAAoB,KAAK,OAAO,aAAa;AACtD,YAAI,KAAK;AACT,eAAO,GAAG,KAAK,oBAAoB,EAAE,KAAK,SAAU,UAAU;AAC5D,cAAI;AACJ,mBAAS,QAAQ,SAAU,SAAS;AAClC,gBAAI,WAAW,OAAO,aAAa;AACjC,uBAAS,GAAG,QAAQ,OAAO,OAAO;AAAA,YACpC;AAAA,UACF,CAAC;AACD,cAAI,OAAO;AAAA,YACT;AAAA,UACF;AACA,aAAG,MAAM,QAAQ,IAAI;AAAA,QACvB,CAAC;AAAA,MACH;AAAA,IACF;AAAA,IAEA,UAAU,KAAK;AACb,UAAI,OAAO,oBAAoB,KAAK,OAAO,aAAa;AACtD,YAAI,KAAK;AAET,eAAO,GAAG,KAAK,oBAAoB,EAAE,KAAK,SAAU,UAAU;AAC5D,cAAI;AACJ,mBAAS,QAAQ,SAAU,SAAS;AAClC,gBAAI,WAAW,OAAO,aAAa;AACjC,uBAAS,GAAG,QAAQ,OAAO,OAAO;AAAA,YACpC;AAAA,UACF,CAAC;AAED,cAAI,OAAO;AAAA,YACT;AAAA,YACA;AAAA,YACA,IAAI,IAAI,UAAU;AAAA,YAClB,QAAQ,SAAS;AAAA,YACjB,IAAI,IAAI,wBACL,QAAQ,OAAO,EAAE,EACjB,QAAQ,iBAAiB,IAAM,IAAI;AAAA,YACtC;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA,IAAI,IAAI,iBAAiB;AAAA,YACzB;AAAA,YACA,IAAI,IAAI,MAAM;AAAA,YACd,0BACE,OAAO,IAAI,IAAI,oBAAoB,EAAE,OAAO,YAAY,IACxD;AAAA,YACF,uBAEE,IAAI,IAAI,iBAAiB,QAAQ,QAAQ,IAAM,IAC/C;AAAA,YACF;AAAA,YACA,eAAe,IAAI,IAAI,gBAAgB;AAAA,YACvC,eACG,KAAI,IAAI,kBAAkB,IAAI,IAAI,kBAAkB,MACrD;AAAA,YACF,eACE,OAAO,IAAI,IAAI,YAAY,EAAE,OAAO,YAAY,IAChD;AAAA,YACF;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,UACF;AACA,cAAI,IAAI,MAAM,QAAQ,SAAU,KAAK;AACnC,gBAAI,QAAQ,GAAG,eACb,IAAI,WACJ,IAAI,KACJ,IAAI,MACJ,IAAI,QACJ,IAAI,IAAI,QACV;AACA,iBAAK,KAAK,MAAM,MAAM,KAAK;AAAA,UAC7B,CAAC;AAID,eAAK,KAAK,MAAM,MAAM;AAAA,YACpB;AAAA,UACF,CAAC;AACD,cAAI,SAAS,GAAG,gBAAgB,IAAI,GAAG;AACvC,eAAK,KAAK,MAAM,MAAM,MAAM;AAC5B,cAAI,aAAa,GAAG,gBAAgB,IAAI,GAAG;AAC3C,eAAK,KAAK,MAAM,MAAM,UAAU;AAChC,cAAI,MAAM;AAAA,YACR;AAAA,YAUA;AAAA,UACF;AACA,eAAK,KAAK,MAAM,MAAM,GAAG;AACzB,aAAG,MAAM,QAAQ,IAAI;AAAA,QACvB,CAAC;AAAA,MACH;AAAA,IACF;AAAA,IAEA,gBAAgB,KAAK;AACnB,UAAI,MAAM,CAAC;AAEX,UAAI,SAAS,IAAI,UAAU,SAAS,EAAE;AACtC,UAAI,WAAW;AACf,eAAS,IAAI,QAAQ,KAAK,IAAI,KAAK;AACjC,mBAAW,WAAW;AAAA,MACxB;AACA,iBAAW,WAAW,gBAAgB,IAAI,SAAS;AACnD,UAAI,UAAU,SAAS;AAEvB,eAAS,IAAI,GAAG,IAAI,KAAK,SAAS,KAAK;AACrC,mBAAW,MAAM;AAAA,MACnB;AACA,UAAI,KAAK,WAAW,IAAM;AAG1B,UAAI,SAAS,IAAI,gBAAgB,SAAS,EAAE;AAC5C,UAAI,YAAY;AAChB,eAAS,IAAI,QAAQ,KAAK,IAAI,KAAK;AACjC,oBAAY,YAAY;AAAA,MAC1B;AACA,kBAAY,YAAY,gBAAgB,IAAI,eAAe;AAC3D,UAAI,UAAU,UAAU;AAExB,eAAS,IAAI,GAAG,IAAI,KAAK,SAAS,KAAK;AACrC,oBAAY,MAAM;AAAA,MACpB;AACA,UAAI,KAAK,YAAY,IAAM;AAG3B,UAAI,qBAAqB,OAAO,QAC9B,KAAK,MAAM,IAAI,MAAM,GAAG,oBAAoB,CAC9C;AACA,UAAI,gBAAgB;AAAA,QAClB,cAAc;AAAA,QACd,kBAAkB;AAAA,QAClB,iBAAiB;AAAA,QACjB,cAAc;AAAA,QACd,cAAc;AAAA,QACd,kBAAkB;AAAA,QAClB,kBAAkB;AAAA,MACpB;AAEA,aAAO,cAAc,IAAI,CAAC,iBAAiB;AACzC,YAAI,MAAM,QAAQ,CAAC,SAAS;AAC1B,cAAI,KAAK,qBAAqB,aAAa,MAAM;AAC/C,gBAAI,aAAa,SAAS,WAAW;AACnC,4BAAc,gBAAgB,KAAK;AACnC,iCAAmB,IAAI,CAAC,aAAa;AACnC,oBAAI,SAAS,OAAO,KAAK,WAAW;AAClC,gCAAc,oBAAoB,SAAS,GAAG;AAAA,gBAChD;AAAA,cACF,CAAC;AAAA,YACH;AACA,gBAAI,aAAa,SAAS,WAAW;AACnC,4BAAc,gBAAgB,KAAK;AACnC,iCAAmB,IAAI,CAAC,aAAa;AACnC,oBAAI,SAAS,OAAO,KAAK,WAAW;AAClC,gCAAc,oBAAoB,SAAS,GAAG;AAAA,gBAChD;AAAA,cACF,CAAC;AAAA,YACH;AACA,gBAAI,aAAa,SAAS,UAAU;AAClC,4BAAc,gBAAgB,KAAK;AACnC,iCAAmB,IAAI,CAAC,aAAa;AACnC,oBAAI,SAAS,OAAO,KAAK,WAAW;AAClC,gCAAc,oBAAoB,SAAS,GAAG;AAAA,gBAChD;AAAA,cACF,CAAC;AAAA,YACH;AAAA,UACF;AAAA,QACF,CAAC;AAAA,MACH,CAAC;AAGD,UAAI,SAAS,cAAc,aAAa,SAAS,EAAE;AACnD,UAAI,SAAS;AACb,eAAS,IAAI,QAAQ,KAAK,IAAI,KAAK;AACjC,iBAAS,SAAS;AAAA,MACpB;AACA,eAAS,SAAS,gBAAgB,cAAc,YAAY;AAC5D,UAAI,UAAU,OAAO;AAErB,eAAS,IAAI,GAAG,IAAI,KAAK,SAAS,KAAK;AACrC,iBAAS,MAAM;AAAA,MACjB;AACA,UAAI,KAAK,SAAS,IAAM;AAGxB,UAAI,SAAS,cAAc,gBAAgB,SAAS,EAAE;AACtD,UAAI,SAAS;AACb,eAAS,IAAI,QAAQ,KAAK,IAAI,KAAK;AACjC,iBAAS,SAAS;AAAA,MACpB;AACA,eAAS,SAAS,gBAAgB,cAAc,eAAe;AAC/D,UAAI,UAAU,OAAO;AAErB,eAAS,IAAI,GAAG,IAAI,KAAK,SAAS,KAAK;AACrC,iBAAS,MAAM;AAAA,MACjB;AACA,UAAI,KAAK,SAAS,IAAM;AAGxB,UAAI,SAAS,cAAc,iBAAiB,SAAS,EAAE;AACvD,UAAI,SAAS;AACb,eAAS,IAAI,QAAQ,KAAK,IAAI,KAAK;AACjC,iBAAS,SAAS;AAAA,MACpB;AACA,eAAS,SAAS,gBAAgB,cAAc,gBAAgB;AAChE,UAAI,UAAU,OAAO;AAErB,eAAS,IAAI,GAAG,IAAI,KAAK,SAAS,KAAK;AACrC,iBAAS,MAAM;AAAA,MACjB;AACA,UAAI,KAAK,SAAS,IAAM;AAGxB,UAAI,SAAS,cAAc,iBAAiB,SAAS,EAAE;AACvD,UAAI,SAAS;AACb,eAAS,IAAI,QAAQ,KAAK,IAAI,KAAK;AACjC,iBAAS,SAAS;AAAA,MACpB;AACA,eAAS,SAAS,gBAAgB,cAAc,gBAAgB;AAChE,UAAI,UAAU,OAAO;AAErB,eAAS,IAAI,GAAG,IAAI,KAAK,SAAS,KAAK;AACrC,iBAAS,MAAM;AAAA,MACjB;AACA,UAAI,KAAK,SAAS,IAAM;AAGxB,UAAI,SAAS,cAAc,aAAa,SAAS,EAAE;AACnD,UAAI,SAAS;AACb,eAAS,IAAI,QAAQ,KAAK,IAAI,KAAK;AACjC,iBAAS,SAAS;AAAA,MACpB;AACA,eAAS,SAAS,gBAAgB,cAAc,YAAY;AAC5D,UAAI,UAAU,OAAO;AAErB,eAAS,IAAI,GAAG,IAAI,KAAK,SAAS,KAAK;AACrC,iBAAS,MAAM;AAAA,MACjB;AACA,UAAI,KAAK,SAAS,IAAM;AAGxB,UAAI,SAAS,cAAc,aAAa,SAAS,EAAE;AACnD,UAAI,SAAS;AACb,eAAS,IAAI,QAAQ,KAAK,IAAI,KAAK;AACjC,iBAAS,SAAS;AAAA,MACpB;AACA,eAAS,SAAS,gBAAgB,cAAc,YAAY;AAC5D,UAAI,UAAU,OAAO;AAErB,eAAS,IAAI,GAAG,IAAI,KAAK,SAAS,KAAK;AACrC,iBAAS,MAAM;AAAA,MACjB;AACA,UAAI,KAAK,SAAS,IAAM;AAoBxB,UAAI,KAAK,SAAwB;AACjC,UAAI,QAAQ;AACZ,eAAS,IAAI,YAAY,SAAS,EAAE;AACpC,eAAS,IAAI,QAAQ,KAAK,IAAI,KAAK;AACjC,gBAAQ,QAAQ;AAAA,MAClB;AACA,cAAQ,QAAQ,gBAAgB,IAAI,WAAW;AAC/C,UAAI,UAAU,MAAM;AAEpB,eAAS,IAAI,GAAG,IAAI,KAAK,SAAS,KAAK;AACrC,gBAAQ,MAAM;AAAA,MAChB;AACA,UAAI,KAAK,QAAQ,IAAM;AACvB,UAAI,KAAK,WAAiC;AAG1C,UAAI,cAAc,CAAC;AACnB,UAAI,cAAc,CAAC;AACnB,UAAI,IAAI,YAAY,IAAI,SAAS,SAAS,GAAG;AAC3C,YAAI,SAAS,QAAQ,SAAU,KAAK;AAClC,cAAI,IAAI,cAAc,GAAG;AACvB,qBAAS,IAAI,YAAY,SAAS,EAAE;AACpC,oBAAQ,IAAI,kBAAkB;AAC9B,qBAAS,KAAI,QAAQ,MAAK,IAAI,MAAK;AACjC,sBAAQ,QAAQ;AAAA,YAClB;AACA,oBAAQ,QAAQ,gBAAgB,IAAI,WAAW;AAC/C,gBAAI,WAAU,MAAM;AAEpB,qBAAS,KAAI,GAAG,KAAI,KAAK,UAAS,MAAK;AACrC,sBAAQ,MAAM;AAAA,YAChB;AACA,gBAAI,KAAK,QAAQ,IAAM;AAGvB,gBACE,IAAI,mBAAmB,OAAO,0BAC9B,IAAI,cAAc,GAClB;AACA,4BAAc;AAAA,gBACZ;AAAA,gBACA;AAAA,gBACA,IAAI,WAAW,YAAY,IACzB,kBACA,IAAI,aACJ;AAAA,gBACF,cAAc,IAAI,0BAA0B;AAAA,gBAC5C,UAAU,IAAI,2BAA2B;AAAA,gBACzC,IAAI,kCAAkC;AAAA,gBACtC,UAAU,IAAI,qCAAqC;AAAA,gBACnD,UAAU,IAAI,sCAAsC;AAAA,gBACpD,UAAU,IAAI;AAAA,cAChB;AAAA,YACF;AAAA,UACF;AAAA,QACF,CAAC;AAAA,MACH;AAGA,UAAI,KAAK,SAAwB;AACjC,cAAQ;AACR,eAAS,IAAI,YAAY,SAAS,EAAE;AACpC,eAAS,IAAI,QAAQ,KAAK,IAAI,KAAK;AACjC,gBAAQ,QAAQ;AAAA,MAClB;AACA,cAAQ,QAAQ,gBAAgB,IAAI,WAAW;AAC/C,UAAI,UAAU,MAAM;AAEpB,eAAS,IAAI,GAAG,IAAI,KAAK,SAAS,KAAK;AACrC,gBAAQ,MAAM;AAAA,MAChB;AACA,UAAI,KAAK,QAAQ,IAAM;AACvB,UAAI,KAAK,WAAiC;AAE1C,UAAI,KAAK,cAAc,IAAI,aAAa,EAAE,MAAM,KAAK,CAAC,IAAI,MAAe;AAGzE,UAAI,YAAY,SAAS,GAAG;AAC1B,YAAI,KAAK,MAAM,KAAK,WAAW;AAAA,MACjC;AAEA,aAAO;AAAA,IACT;AAAA,IAEA,gBAAgB,KAAK;AACnB,UAAI,MAAM;AAAA,QACR,kBACG,KAAI,8BACD,IAAI,4BAA4B,SAAS,IACzC,MACJ;AAAA,QACF,+BACG,KAAI,4CACD,IAAI,0CAA0C,SAAS,IACvD,MACJ;AAAA,QACF,eACG,KAAI,kCACD,IAAI,gCAAgC,SAAS,IAC7C,MACJ;AAAA,MACJ;AAEA,aAAO;AAAA,IACT;AAAA,IAEA,eAAe,MAAM,KAAK,MAAM,QAAQ,UAAU;AAChD,UAAI,UAAU,KAAK;AACnB,UAAI,MAAM,CAAC;AAEX,eAAS,IAAI,GAAG,IAAI,SAAS,IAAI,IAAI,IAAI;AACvC,YAAI,KAAK,KAAK,UAAU,GAAG,IAAI,EAAE,IAAI,IAAM;AAAA,MAC7C;AAGA,UAAI,WAAW,IAAI,SAAS,IAAI,QAAQ,gBAAgB,IAAI;AAC5D,UAAI,UAAU,SAAS;AACvB,eAAS,IAAI,GAAG,IAAI,KAAK,SAAS,KAAK;AACrC,mBAAW,WAAW;AAAA,MACxB;AAGA,UAAI,UAAU,gBAAgB,MAAM,EAAE;AACtC,eAAS,IAAI,GAAG,IAAI,KAAK,SAAS,KAAK;AACrC,mBAAW,WAAW;AAAA,MACxB;AACA,iBAAW,WAAW,gBAAgB,MAAM;AAC5C,UAAI,KAAK,WAAW,IAAM;AAC1B,aAAO;AAAA,IACT;AAAA,EACF;",
  "names": []
}
